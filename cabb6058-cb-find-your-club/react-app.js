(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))m(b);new MutationObserver(b=>{for(const M of b)if(M.type==="childList")for(const P of M.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&m(P)}).observe(document,{childList:!0,subtree:!0});function h(b){const M={};return b.integrity&&(M.integrity=b.integrity),b.referrerPolicy&&(M.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?M.credentials="include":b.crossOrigin==="anonymous"?M.credentials="omit":M.credentials="same-origin",M}function m(b){if(b.ep)return;b.ep=!0;const M=h(b);fetch(b.href,M)}})();var V_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var KP={exports:{}},mw={},JP={exports:{}},fr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K0=Symbol.for("react.element"),pk=Symbol.for("react.portal"),mk=Symbol.for("react.fragment"),_k=Symbol.for("react.strict_mode"),gk=Symbol.for("react.profiler"),yk=Symbol.for("react.provider"),xk=Symbol.for("react.context"),vk=Symbol.for("react.forward_ref"),wk=Symbol.for("react.suspense"),bk=Symbol.for("react.memo"),Tk=Symbol.for("react.lazy"),dM=Symbol.iterator;function Sk(r){return r===null||typeof r!="object"?null:(r=dM&&r[dM]||r["@@iterator"],typeof r=="function"?r:null)}var QP={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},eR=Object.assign,tR={};function xg(r,a,h){this.props=r,this.context=a,this.refs=tR,this.updater=h||QP}xg.prototype.isReactComponent={};xg.prototype.setState=function(r,a){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,a,"setState")};xg.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function nR(){}nR.prototype=xg.prototype;function qS(r,a,h){this.props=r,this.context=a,this.refs=tR,this.updater=h||QP}var HS=qS.prototype=new nR;HS.constructor=qS;eR(HS,xg.prototype);HS.isPureReactComponent=!0;var fM=Array.isArray,rR=Object.prototype.hasOwnProperty,ZS={current:null},iR={key:!0,ref:!0,__self:!0,__source:!0};function sR(r,a,h){var m,b={},M=null,P=null;if(a!=null)for(m in a.ref!==void 0&&(P=a.ref),a.key!==void 0&&(M=""+a.key),a)rR.call(a,m)&&!iR.hasOwnProperty(m)&&(b[m]=a[m]);var V=arguments.length-2;if(V===1)b.children=h;else if(1<V){for(var o=Array(V),q=0;q<V;q++)o[q]=arguments[q+2];b.children=o}if(r&&r.defaultProps)for(m in V=r.defaultProps,V)b[m]===void 0&&(b[m]=V[m]);return{$$typeof:K0,type:r,key:M,ref:P,props:b,_owner:ZS.current}}function Ek(r,a){return{$$typeof:K0,type:r.type,key:a,ref:r.ref,props:r.props,_owner:r._owner}}function XS(r){return typeof r=="object"&&r!==null&&r.$$typeof===K0}function Ck(r){var a={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(h){return a[h]})}var pM=/\/+/g;function VT(r,a){return typeof r=="object"&&r!==null&&r.key!=null?Ck(""+r.key):a.toString(36)}function _v(r,a,h,m,b){var M=typeof r;(M==="undefined"||M==="boolean")&&(r=null);var P=!1;if(r===null)P=!0;else switch(M){case"string":case"number":P=!0;break;case"object":switch(r.$$typeof){case K0:case pk:P=!0}}if(P)return P=r,b=b(P),r=m===""?"."+VT(P,0):m,fM(b)?(h="",r!=null&&(h=r.replace(pM,"$&/")+"/"),_v(b,a,h,"",function(q){return q})):b!=null&&(XS(b)&&(b=Ek(b,h+(!b.key||P&&P.key===b.key?"":(""+b.key).replace(pM,"$&/")+"/")+r)),a.push(b)),1;if(P=0,m=m===""?".":m+":",fM(r))for(var V=0;V<r.length;V++){M=r[V];var o=m+VT(M,V);P+=_v(M,a,h,o,b)}else if(o=Sk(r),typeof o=="function")for(r=o.call(r),V=0;!(M=r.next()).done;)M=M.value,o=m+VT(M,V++),P+=_v(M,a,h,o,b);else if(M==="object")throw a=String(r),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return P}function Y1(r,a,h){if(r==null)return r;var m=[],b=0;return _v(r,m,"","",function(M){return a.call(h,M,b++)}),m}function Ak(r){if(r._status===-1){var a=r._result;a=a(),a.then(function(h){(r._status===0||r._status===-1)&&(r._status=1,r._result=h)},function(h){(r._status===0||r._status===-1)&&(r._status=2,r._result=h)}),r._status===-1&&(r._status=0,r._result=a)}if(r._status===1)return r._result.default;throw r._result}var Do={current:null},gv={transition:null},Mk={ReactCurrentDispatcher:Do,ReactCurrentBatchConfig:gv,ReactCurrentOwner:ZS};function oR(){throw Error("act(...) is not supported in production builds of React.")}fr.Children={map:Y1,forEach:function(r,a,h){Y1(r,function(){a.apply(this,arguments)},h)},count:function(r){var a=0;return Y1(r,function(){a++}),a},toArray:function(r){return Y1(r,function(a){return a})||[]},only:function(r){if(!XS(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};fr.Component=xg;fr.Fragment=mk;fr.Profiler=gk;fr.PureComponent=qS;fr.StrictMode=_k;fr.Suspense=wk;fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mk;fr.act=oR;fr.cloneElement=function(r,a,h){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var m=eR({},r.props),b=r.key,M=r.ref,P=r._owner;if(a!=null){if(a.ref!==void 0&&(M=a.ref,P=ZS.current),a.key!==void 0&&(b=""+a.key),r.type&&r.type.defaultProps)var V=r.type.defaultProps;for(o in a)rR.call(a,o)&&!iR.hasOwnProperty(o)&&(m[o]=a[o]===void 0&&V!==void 0?V[o]:a[o])}var o=arguments.length-2;if(o===1)m.children=h;else if(1<o){V=Array(o);for(var q=0;q<o;q++)V[q]=arguments[q+2];m.children=V}return{$$typeof:K0,type:r.type,key:b,ref:M,props:m,_owner:P}};fr.createContext=function(r){return r={$$typeof:xk,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:yk,_context:r},r.Consumer=r};fr.createElement=sR;fr.createFactory=function(r){var a=sR.bind(null,r);return a.type=r,a};fr.createRef=function(){return{current:null}};fr.forwardRef=function(r){return{$$typeof:vk,render:r}};fr.isValidElement=XS;fr.lazy=function(r){return{$$typeof:Tk,_payload:{_status:-1,_result:r},_init:Ak}};fr.memo=function(r,a){return{$$typeof:bk,type:r,compare:a===void 0?null:a}};fr.startTransition=function(r){var a=gv.transition;gv.transition={};try{r()}finally{gv.transition=a}};fr.unstable_act=oR;fr.useCallback=function(r,a){return Do.current.useCallback(r,a)};fr.useContext=function(r){return Do.current.useContext(r)};fr.useDebugValue=function(){};fr.useDeferredValue=function(r){return Do.current.useDeferredValue(r)};fr.useEffect=function(r,a){return Do.current.useEffect(r,a)};fr.useId=function(){return Do.current.useId()};fr.useImperativeHandle=function(r,a,h){return Do.current.useImperativeHandle(r,a,h)};fr.useInsertionEffect=function(r,a){return Do.current.useInsertionEffect(r,a)};fr.useLayoutEffect=function(r,a){return Do.current.useLayoutEffect(r,a)};fr.useMemo=function(r,a){return Do.current.useMemo(r,a)};fr.useReducer=function(r,a,h){return Do.current.useReducer(r,a,h)};fr.useRef=function(r){return Do.current.useRef(r)};fr.useState=function(r){return Do.current.useState(r)};fr.useSyncExternalStore=function(r,a,h){return Do.current.useSyncExternalStore(r,a,h)};fr.useTransition=function(){return Do.current.useTransition()};fr.version="18.3.1";JP.exports=fr;var on=JP.exports;const aR=pw(on);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ik=on,Pk=Symbol.for("react.element"),Rk=Symbol.for("react.fragment"),Lk=Object.prototype.hasOwnProperty,Dk=Ik.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zk={key:!0,ref:!0,__self:!0,__source:!0};function lR(r,a,h){var m,b={},M=null,P=null;h!==void 0&&(M=""+h),a.key!==void 0&&(M=""+a.key),a.ref!==void 0&&(P=a.ref);for(m in a)Lk.call(a,m)&&!zk.hasOwnProperty(m)&&(b[m]=a[m]);if(r&&r.defaultProps)for(m in a=r.defaultProps,a)b[m]===void 0&&(b[m]=a[m]);return{$$typeof:Pk,type:r,key:M,ref:P,props:b,_owner:Dk.current}}mw.Fragment=Rk;mw.jsx=lR;mw.jsxs=lR;KP.exports=mw;var at=KP.exports,P3={},uR={exports:{}},Ua={},cR={exports:{}},hR={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function a(Gt,_n){var zn=Gt.length;Gt.push(_n);e:for(;0<zn;){var lr=zn-1>>>1,Br=Gt[lr];if(0<b(Br,_n))Gt[lr]=_n,Gt[zn]=Br,zn=lr;else break e}}function h(Gt){return Gt.length===0?null:Gt[0]}function m(Gt){if(Gt.length===0)return null;var _n=Gt[0],zn=Gt.pop();if(zn!==_n){Gt[0]=zn;e:for(var lr=0,Br=Gt.length,jn=Br>>>1;lr<jn;){var ps=2*(lr+1)-1,Fr=Gt[ps],is=ps+1,da=Gt[is];if(0>b(Fr,zn))is<Br&&0>b(da,Fr)?(Gt[lr]=da,Gt[is]=zn,lr=is):(Gt[lr]=Fr,Gt[ps]=zn,lr=ps);else if(is<Br&&0>b(da,zn))Gt[lr]=da,Gt[is]=zn,lr=is;else break e}}return _n}function b(Gt,_n){var zn=Gt.sortIndex-_n.sortIndex;return zn!==0?zn:Gt.id-_n.id}if(typeof performance=="object"&&typeof performance.now=="function"){var M=performance;r.unstable_now=function(){return M.now()}}else{var P=Date,V=P.now();r.unstable_now=function(){return P.now()-V}}var o=[],q=[],J=1,Q=null,ae=3,xe=!1,Re=!1,Ue=!1,Tt=typeof setTimeout=="function"?setTimeout:null,Te=typeof clearTimeout=="function"?clearTimeout:null,Ee=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Me(Gt){for(var _n=h(q);_n!==null;){if(_n.callback===null)m(q);else if(_n.startTime<=Gt)m(q),_n.sortIndex=_n.expirationTime,a(o,_n);else break;_n=h(q)}}function et(Gt){if(Ue=!1,Me(Gt),!Re)if(h(o)!==null)Re=!0,Pi(pt);else{var _n=h(q);_n!==null&&Cn(et,_n.startTime-Gt)}}function pt(Gt,_n){Re=!1,Ue&&(Ue=!1,Te(zt),zt=-1),xe=!0;var zn=ae;try{for(Me(_n),Q=h(o);Q!==null&&(!(Q.expirationTime>_n)||Gt&&!xn());){var lr=Q.callback;if(typeof lr=="function"){Q.callback=null,ae=Q.priorityLevel;var Br=lr(Q.expirationTime<=_n);_n=r.unstable_now(),typeof Br=="function"?Q.callback=Br:Q===h(o)&&m(o),Me(_n)}else m(o);Q=h(o)}if(Q!==null)var jn=!0;else{var ps=h(q);ps!==null&&Cn(et,ps.startTime-_n),jn=!1}return jn}finally{Q=null,ae=zn,xe=!1}}var Ct=!1,Ot=null,zt=-1,Zn=5,wn=-1;function xn(){return!(r.unstable_now()-wn<Zn)}function rs(){if(Ot!==null){var Gt=r.unstable_now();wn=Gt;var _n=!0;try{_n=Ot(!0,Gt)}finally{_n?bn():(Ct=!1,Ot=null)}}else Ct=!1}var bn;if(typeof Ee=="function")bn=function(){Ee(rs)};else if(typeof MessageChannel<"u"){var xo=new MessageChannel,Jr=xo.port2;xo.port1.onmessage=rs,bn=function(){Jr.postMessage(null)}}else bn=function(){Tt(rs,0)};function Pi(Gt){Ot=Gt,Ct||(Ct=!0,bn())}function Cn(Gt,_n){zt=Tt(function(){Gt(r.unstable_now())},_n)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Gt){Gt.callback=null},r.unstable_continueExecution=function(){Re||xe||(Re=!0,Pi(pt))},r.unstable_forceFrameRate=function(Gt){0>Gt||125<Gt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zn=0<Gt?Math.floor(1e3/Gt):5},r.unstable_getCurrentPriorityLevel=function(){return ae},r.unstable_getFirstCallbackNode=function(){return h(o)},r.unstable_next=function(Gt){switch(ae){case 1:case 2:case 3:var _n=3;break;default:_n=ae}var zn=ae;ae=_n;try{return Gt()}finally{ae=zn}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Gt,_n){switch(Gt){case 1:case 2:case 3:case 4:case 5:break;default:Gt=3}var zn=ae;ae=Gt;try{return _n()}finally{ae=zn}},r.unstable_scheduleCallback=function(Gt,_n,zn){var lr=r.unstable_now();switch(typeof zn=="object"&&zn!==null?(zn=zn.delay,zn=typeof zn=="number"&&0<zn?lr+zn:lr):zn=lr,Gt){case 1:var Br=-1;break;case 2:Br=250;break;case 5:Br=1073741823;break;case 4:Br=1e4;break;default:Br=5e3}return Br=zn+Br,Gt={id:J++,callback:_n,priorityLevel:Gt,startTime:zn,expirationTime:Br,sortIndex:-1},zn>lr?(Gt.sortIndex=zn,a(q,Gt),h(o)===null&&Gt===h(q)&&(Ue?(Te(zt),zt=-1):Ue=!0,Cn(et,zn-lr))):(Gt.sortIndex=Br,a(o,Gt),Re||xe||(Re=!0,Pi(pt))),Gt},r.unstable_shouldYield=xn,r.unstable_wrapCallback=function(Gt){var _n=ae;return function(){var zn=ae;ae=_n;try{return Gt.apply(this,arguments)}finally{ae=zn}}}})(hR);cR.exports=hR;var kk=cR.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ok=on,Na=kk;function Nt(r){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+r,h=1;h<arguments.length;h++)a+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dR=new Set,M0={};function Dm(r,a){ug(r,a),ug(r+"Capture",a)}function ug(r,a){for(M0[r]=a,r=0;r<a.length;r++)dR.add(a[r])}var od=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),R3=Object.prototype.hasOwnProperty,Bk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,mM={},_M={};function Fk(r){return R3.call(_M,r)?!0:R3.call(mM,r)?!1:Bk.test(r)?_M[r]=!0:(mM[r]=!0,!1)}function Nk(r,a,h,m){if(h!==null&&h.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return m?!1:h!==null?!h.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Vk(r,a,h,m){if(a===null||typeof a>"u"||Nk(r,a,h,m))return!0;if(m)return!1;if(h!==null)switch(h.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function zo(r,a,h,m,b,M,P){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=m,this.attributeNamespace=b,this.mustUseProperty=h,this.propertyName=r,this.type=a,this.sanitizeURL=M,this.removeEmptyString=P}var Ys={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Ys[r]=new zo(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var a=r[0];Ys[a]=new zo(a,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Ys[r]=new zo(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Ys[r]=new zo(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Ys[r]=new zo(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Ys[r]=new zo(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Ys[r]=new zo(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Ys[r]=new zo(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Ys[r]=new zo(r,5,!1,r.toLowerCase(),null,!1,!1)});var YS=/[\-:]([a-z])/g;function KS(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var a=r.replace(YS,KS);Ys[a]=new zo(a,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var a=r.replace(YS,KS);Ys[a]=new zo(a,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var a=r.replace(YS,KS);Ys[a]=new zo(a,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Ys[r]=new zo(r,1,!1,r.toLowerCase(),null,!1,!1)});Ys.xlinkHref=new zo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Ys[r]=new zo(r,1,!1,r.toLowerCase(),null,!0,!0)});function JS(r,a,h,m){var b=Ys.hasOwnProperty(a)?Ys[a]:null;(b!==null?b.type!==0:m||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(Vk(a,h,b,m)&&(h=null),m||b===null?Fk(a)&&(h===null?r.removeAttribute(a):r.setAttribute(a,""+h)):b.mustUseProperty?r[b.propertyName]=h===null?b.type===3?!1:"":h:(a=b.attributeName,m=b.attributeNamespace,h===null?r.removeAttribute(a):(b=b.type,h=b===3||b===4&&h===!0?"":""+h,m?r.setAttributeNS(m,a,h):r.setAttribute(a,h))))}var dd=Ok.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,K1=Symbol.for("react.element"),U_=Symbol.for("react.portal"),j_=Symbol.for("react.fragment"),QS=Symbol.for("react.strict_mode"),L3=Symbol.for("react.profiler"),fR=Symbol.for("react.provider"),pR=Symbol.for("react.context"),eE=Symbol.for("react.forward_ref"),D3=Symbol.for("react.suspense"),z3=Symbol.for("react.suspense_list"),tE=Symbol.for("react.memo"),If=Symbol.for("react.lazy"),mR=Symbol.for("react.offscreen"),gM=Symbol.iterator;function e0(r){return r===null||typeof r!="object"?null:(r=gM&&r[gM]||r["@@iterator"],typeof r=="function"?r:null)}var Ii=Object.assign,UT;function c0(r){if(UT===void 0)try{throw Error()}catch(h){var a=h.stack.trim().match(/\n( *(at )?)/);UT=a&&a[1]||""}return`
`+UT+r}var jT=!1;function GT(r,a){if(!r||jT)return"";jT=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(q){var m=q}Reflect.construct(r,[],a)}else{try{a.call()}catch(q){m=q}r.call(a.prototype)}else{try{throw Error()}catch(q){m=q}r()}}catch(q){if(q&&m&&typeof q.stack=="string"){for(var b=q.stack.split(`
`),M=m.stack.split(`
`),P=b.length-1,V=M.length-1;1<=P&&0<=V&&b[P]!==M[V];)V--;for(;1<=P&&0<=V;P--,V--)if(b[P]!==M[V]){if(P!==1||V!==1)do if(P--,V--,0>V||b[P]!==M[V]){var o=`
`+b[P].replace(" at new "," at ");return r.displayName&&o.includes("<anonymous>")&&(o=o.replace("<anonymous>",r.displayName)),o}while(1<=P&&0<=V);break}}}finally{jT=!1,Error.prepareStackTrace=h}return(r=r?r.displayName||r.name:"")?c0(r):""}function Uk(r){switch(r.tag){case 5:return c0(r.type);case 16:return c0("Lazy");case 13:return c0("Suspense");case 19:return c0("SuspenseList");case 0:case 2:case 15:return r=GT(r.type,!1),r;case 11:return r=GT(r.type.render,!1),r;case 1:return r=GT(r.type,!0),r;default:return""}}function k3(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case j_:return"Fragment";case U_:return"Portal";case L3:return"Profiler";case QS:return"StrictMode";case D3:return"Suspense";case z3:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case pR:return(r.displayName||"Context")+".Consumer";case fR:return(r._context.displayName||"Context")+".Provider";case eE:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case tE:return a=r.displayName||null,a!==null?a:k3(r.type)||"Memo";case If:a=r._payload,r=r._init;try{return k3(r(a))}catch{}}return null}function jk(r){var a=r.type;switch(r.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=a.render,r=r.displayName||r.name||"",a.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return k3(a);case 8:return a===QS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function qf(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function _R(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Gk(r){var a=_R(r)?"checked":"value",h=Object.getOwnPropertyDescriptor(r.constructor.prototype,a),m=""+r[a];if(!r.hasOwnProperty(a)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var b=h.get,M=h.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return b.call(this)},set:function(P){m=""+P,M.call(this,P)}}),Object.defineProperty(r,a,{enumerable:h.enumerable}),{getValue:function(){return m},setValue:function(P){m=""+P},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function J1(r){r._valueTracker||(r._valueTracker=Gk(r))}function gR(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var h=a.getValue(),m="";return r&&(m=_R(r)?r.checked?"true":"false":r.value),r=m,r!==h?(a.setValue(r),!0):!1}function kv(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function O3(r,a){var h=a.checked;return Ii({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??r._wrapperState.initialChecked})}function yM(r,a){var h=a.defaultValue==null?"":a.defaultValue,m=a.checked!=null?a.checked:a.defaultChecked;h=qf(a.value!=null?a.value:h),r._wrapperState={initialChecked:m,initialValue:h,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function yR(r,a){a=a.checked,a!=null&&JS(r,"checked",a,!1)}function B3(r,a){yR(r,a);var h=qf(a.value),m=a.type;if(h!=null)m==="number"?(h===0&&r.value===""||r.value!=h)&&(r.value=""+h):r.value!==""+h&&(r.value=""+h);else if(m==="submit"||m==="reset"){r.removeAttribute("value");return}a.hasOwnProperty("value")?F3(r,a.type,h):a.hasOwnProperty("defaultValue")&&F3(r,a.type,qf(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(r.defaultChecked=!!a.defaultChecked)}function xM(r,a,h){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var m=a.type;if(!(m!=="submit"&&m!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+r._wrapperState.initialValue,h||a===r.value||(r.value=a),r.defaultValue=a}h=r.name,h!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,h!==""&&(r.name=h)}function F3(r,a,h){(a!=="number"||kv(r.ownerDocument)!==r)&&(h==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+h&&(r.defaultValue=""+h))}var h0=Array.isArray;function rg(r,a,h,m){if(r=r.options,a){a={};for(var b=0;b<h.length;b++)a["$"+h[b]]=!0;for(h=0;h<r.length;h++)b=a.hasOwnProperty("$"+r[h].value),r[h].selected!==b&&(r[h].selected=b),b&&m&&(r[h].defaultSelected=!0)}else{for(h=""+qf(h),a=null,b=0;b<r.length;b++){if(r[b].value===h){r[b].selected=!0,m&&(r[b].defaultSelected=!0);return}a!==null||r[b].disabled||(a=r[b])}a!==null&&(a.selected=!0)}}function N3(r,a){if(a.dangerouslySetInnerHTML!=null)throw Error(Nt(91));return Ii({},a,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function vM(r,a){var h=a.value;if(h==null){if(h=a.children,a=a.defaultValue,h!=null){if(a!=null)throw Error(Nt(92));if(h0(h)){if(1<h.length)throw Error(Nt(93));h=h[0]}a=h}a==null&&(a=""),h=a}r._wrapperState={initialValue:qf(h)}}function xR(r,a){var h=qf(a.value),m=qf(a.defaultValue);h!=null&&(h=""+h,h!==r.value&&(r.value=h),a.defaultValue==null&&r.defaultValue!==h&&(r.defaultValue=h)),m!=null&&(r.defaultValue=""+m)}function wM(r){var a=r.textContent;a===r._wrapperState.initialValue&&a!==""&&a!==null&&(r.value=a)}function vR(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function V3(r,a){return r==null||r==="http://www.w3.org/1999/xhtml"?vR(a):r==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Q1,wR=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,h,m,b){MSApp.execUnsafeLocalFunction(function(){return r(a,h,m,b)})}:r}(function(r,a){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=a;else{for(Q1=Q1||document.createElement("div"),Q1.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=Q1.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;a.firstChild;)r.appendChild(a.firstChild)}});function I0(r,a){if(a){var h=r.firstChild;if(h&&h===r.lastChild&&h.nodeType===3){h.nodeValue=a;return}}r.textContent=a}var m0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Wk=["Webkit","ms","Moz","O"];Object.keys(m0).forEach(function(r){Wk.forEach(function(a){a=a+r.charAt(0).toUpperCase()+r.substring(1),m0[a]=m0[r]})});function bR(r,a,h){return a==null||typeof a=="boolean"||a===""?"":h||typeof a!="number"||a===0||m0.hasOwnProperty(r)&&m0[r]?(""+a).trim():a+"px"}function TR(r,a){r=r.style;for(var h in a)if(a.hasOwnProperty(h)){var m=h.indexOf("--")===0,b=bR(h,a[h],m);h==="float"&&(h="cssFloat"),m?r.setProperty(h,b):r[h]=b}}var $k=Ii({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function U3(r,a){if(a){if($k[r]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(Nt(137,r));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(Nt(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(Nt(61))}if(a.style!=null&&typeof a.style!="object")throw Error(Nt(62))}}function j3(r,a){if(r.indexOf("-")===-1)return typeof a.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var G3=null;function nE(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var W3=null,ig=null,sg=null;function bM(r){if(r=ex(r)){if(typeof W3!="function")throw Error(Nt(280));var a=r.stateNode;a&&(a=vw(a),W3(r.stateNode,r.type,a))}}function SR(r){ig?sg?sg.push(r):sg=[r]:ig=r}function ER(){if(ig){var r=ig,a=sg;if(sg=ig=null,bM(r),a)for(r=0;r<a.length;r++)bM(a[r])}}function CR(r,a){return r(a)}function AR(){}var WT=!1;function MR(r,a,h){if(WT)return r(a,h);WT=!0;try{return CR(r,a,h)}finally{WT=!1,(ig!==null||sg!==null)&&(AR(),ER())}}function P0(r,a){var h=r.stateNode;if(h===null)return null;var m=vw(h);if(m===null)return null;h=m[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(r=r.type,m=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!m;break e;default:r=!1}if(r)return null;if(h&&typeof h!="function")throw Error(Nt(231,a,typeof h));return h}var $3=!1;if(od)try{var t0={};Object.defineProperty(t0,"passive",{get:function(){$3=!0}}),window.addEventListener("test",t0,t0),window.removeEventListener("test",t0,t0)}catch{$3=!1}function qk(r,a,h,m,b,M,P,V,o){var q=Array.prototype.slice.call(arguments,3);try{a.apply(h,q)}catch(J){this.onError(J)}}var _0=!1,Ov=null,Bv=!1,q3=null,Hk={onError:function(r){_0=!0,Ov=r}};function Zk(r,a,h,m,b,M,P,V,o){_0=!1,Ov=null,qk.apply(Hk,arguments)}function Xk(r,a,h,m,b,M,P,V,o){if(Zk.apply(this,arguments),_0){if(_0){var q=Ov;_0=!1,Ov=null}else throw Error(Nt(198));Bv||(Bv=!0,q3=q)}}function zm(r){var a=r,h=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,a.flags&4098&&(h=a.return),r=a.return;while(r)}return a.tag===3?h:null}function IR(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function TM(r){if(zm(r)!==r)throw Error(Nt(188))}function Yk(r){var a=r.alternate;if(!a){if(a=zm(r),a===null)throw Error(Nt(188));return a!==r?null:r}for(var h=r,m=a;;){var b=h.return;if(b===null)break;var M=b.alternate;if(M===null){if(m=b.return,m!==null){h=m;continue}break}if(b.child===M.child){for(M=b.child;M;){if(M===h)return TM(b),r;if(M===m)return TM(b),a;M=M.sibling}throw Error(Nt(188))}if(h.return!==m.return)h=b,m=M;else{for(var P=!1,V=b.child;V;){if(V===h){P=!0,h=b,m=M;break}if(V===m){P=!0,m=b,h=M;break}V=V.sibling}if(!P){for(V=M.child;V;){if(V===h){P=!0,h=M,m=b;break}if(V===m){P=!0,m=M,h=b;break}V=V.sibling}if(!P)throw Error(Nt(189))}}if(h.alternate!==m)throw Error(Nt(190))}if(h.tag!==3)throw Error(Nt(188));return h.stateNode.current===h?r:a}function PR(r){return r=Yk(r),r!==null?RR(r):null}function RR(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var a=RR(r);if(a!==null)return a;r=r.sibling}return null}var LR=Na.unstable_scheduleCallback,SM=Na.unstable_cancelCallback,Kk=Na.unstable_shouldYield,Jk=Na.unstable_requestPaint,Xi=Na.unstable_now,Qk=Na.unstable_getCurrentPriorityLevel,rE=Na.unstable_ImmediatePriority,DR=Na.unstable_UserBlockingPriority,Fv=Na.unstable_NormalPriority,eO=Na.unstable_LowPriority,zR=Na.unstable_IdlePriority,_w=null,qc=null;function tO(r){if(qc&&typeof qc.onCommitFiberRoot=="function")try{qc.onCommitFiberRoot(_w,r,void 0,(r.current.flags&128)===128)}catch{}}var Au=Math.clz32?Math.clz32:iO,nO=Math.log,rO=Math.LN2;function iO(r){return r>>>=0,r===0?32:31-(nO(r)/rO|0)|0}var ev=64,tv=4194304;function d0(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Nv(r,a){var h=r.pendingLanes;if(h===0)return 0;var m=0,b=r.suspendedLanes,M=r.pingedLanes,P=h&268435455;if(P!==0){var V=P&~b;V!==0?m=d0(V):(M&=P,M!==0&&(m=d0(M)))}else P=h&~b,P!==0?m=d0(P):M!==0&&(m=d0(M));if(m===0)return 0;if(a!==0&&a!==m&&!(a&b)&&(b=m&-m,M=a&-a,b>=M||b===16&&(M&4194240)!==0))return a;if(m&4&&(m|=h&16),a=r.entangledLanes,a!==0)for(r=r.entanglements,a&=m;0<a;)h=31-Au(a),b=1<<h,m|=r[h],a&=~b;return m}function sO(r,a){switch(r){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oO(r,a){for(var h=r.suspendedLanes,m=r.pingedLanes,b=r.expirationTimes,M=r.pendingLanes;0<M;){var P=31-Au(M),V=1<<P,o=b[P];o===-1?(!(V&h)||V&m)&&(b[P]=sO(V,a)):o<=a&&(r.expiredLanes|=V),M&=~V}}function H3(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function kR(){var r=ev;return ev<<=1,!(ev&4194240)&&(ev=64),r}function $T(r){for(var a=[],h=0;31>h;h++)a.push(r);return a}function J0(r,a,h){r.pendingLanes|=a,a!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,a=31-Au(a),r[a]=h}function aO(r,a){var h=r.pendingLanes&~a;r.pendingLanes=a,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=a,r.mutableReadLanes&=a,r.entangledLanes&=a,a=r.entanglements;var m=r.eventTimes;for(r=r.expirationTimes;0<h;){var b=31-Au(h),M=1<<b;a[b]=0,m[b]=-1,r[b]=-1,h&=~M}}function iE(r,a){var h=r.entangledLanes|=a;for(r=r.entanglements;h;){var m=31-Au(h),b=1<<m;b&a|r[m]&a&&(r[m]|=a),h&=~b}}var Hr=0;function OR(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var BR,sE,FR,NR,VR,Z3=!1,nv=[],Of=null,Bf=null,Ff=null,R0=new Map,L0=new Map,Lf=[],lO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function EM(r,a){switch(r){case"focusin":case"focusout":Of=null;break;case"dragenter":case"dragleave":Bf=null;break;case"mouseover":case"mouseout":Ff=null;break;case"pointerover":case"pointerout":R0.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":L0.delete(a.pointerId)}}function n0(r,a,h,m,b,M){return r===null||r.nativeEvent!==M?(r={blockedOn:a,domEventName:h,eventSystemFlags:m,nativeEvent:M,targetContainers:[b]},a!==null&&(a=ex(a),a!==null&&sE(a)),r):(r.eventSystemFlags|=m,a=r.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),r)}function uO(r,a,h,m,b){switch(a){case"focusin":return Of=n0(Of,r,a,h,m,b),!0;case"dragenter":return Bf=n0(Bf,r,a,h,m,b),!0;case"mouseover":return Ff=n0(Ff,r,a,h,m,b),!0;case"pointerover":var M=b.pointerId;return R0.set(M,n0(R0.get(M)||null,r,a,h,m,b)),!0;case"gotpointercapture":return M=b.pointerId,L0.set(M,n0(L0.get(M)||null,r,a,h,m,b)),!0}return!1}function UR(r){var a=xm(r.target);if(a!==null){var h=zm(a);if(h!==null){if(a=h.tag,a===13){if(a=IR(h),a!==null){r.blockedOn=a,VR(r.priority,function(){FR(h)});return}}else if(a===3&&h.stateNode.current.memoizedState.isDehydrated){r.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}r.blockedOn=null}function yv(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var h=X3(r.domEventName,r.eventSystemFlags,a[0],r.nativeEvent);if(h===null){h=r.nativeEvent;var m=new h.constructor(h.type,h);G3=m,h.target.dispatchEvent(m),G3=null}else return a=ex(h),a!==null&&sE(a),r.blockedOn=h,!1;a.shift()}return!0}function CM(r,a,h){yv(r)&&h.delete(a)}function cO(){Z3=!1,Of!==null&&yv(Of)&&(Of=null),Bf!==null&&yv(Bf)&&(Bf=null),Ff!==null&&yv(Ff)&&(Ff=null),R0.forEach(CM),L0.forEach(CM)}function r0(r,a){r.blockedOn===a&&(r.blockedOn=null,Z3||(Z3=!0,Na.unstable_scheduleCallback(Na.unstable_NormalPriority,cO)))}function D0(r){function a(b){return r0(b,r)}if(0<nv.length){r0(nv[0],r);for(var h=1;h<nv.length;h++){var m=nv[h];m.blockedOn===r&&(m.blockedOn=null)}}for(Of!==null&&r0(Of,r),Bf!==null&&r0(Bf,r),Ff!==null&&r0(Ff,r),R0.forEach(a),L0.forEach(a),h=0;h<Lf.length;h++)m=Lf[h],m.blockedOn===r&&(m.blockedOn=null);for(;0<Lf.length&&(h=Lf[0],h.blockedOn===null);)UR(h),h.blockedOn===null&&Lf.shift()}var og=dd.ReactCurrentBatchConfig,Vv=!0;function hO(r,a,h,m){var b=Hr,M=og.transition;og.transition=null;try{Hr=1,oE(r,a,h,m)}finally{Hr=b,og.transition=M}}function dO(r,a,h,m){var b=Hr,M=og.transition;og.transition=null;try{Hr=4,oE(r,a,h,m)}finally{Hr=b,og.transition=M}}function oE(r,a,h,m){if(Vv){var b=X3(r,a,h,m);if(b===null)t3(r,a,m,Uv,h),EM(r,m);else if(uO(b,r,a,h,m))m.stopPropagation();else if(EM(r,m),a&4&&-1<lO.indexOf(r)){for(;b!==null;){var M=ex(b);if(M!==null&&BR(M),M=X3(r,a,h,m),M===null&&t3(r,a,m,Uv,h),M===b)break;b=M}b!==null&&m.stopPropagation()}else t3(r,a,m,null,h)}}var Uv=null;function X3(r,a,h,m){if(Uv=null,r=nE(m),r=xm(r),r!==null)if(a=zm(r),a===null)r=null;else if(h=a.tag,h===13){if(r=IR(a),r!==null)return r;r=null}else if(h===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null);return Uv=r,null}function jR(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qk()){case rE:return 1;case DR:return 4;case Fv:case eO:return 16;case zR:return 536870912;default:return 16}default:return 16}}var zf=null,aE=null,xv=null;function GR(){if(xv)return xv;var r,a=aE,h=a.length,m,b="value"in zf?zf.value:zf.textContent,M=b.length;for(r=0;r<h&&a[r]===b[r];r++);var P=h-r;for(m=1;m<=P&&a[h-m]===b[M-m];m++);return xv=b.slice(r,1<m?1-m:void 0)}function vv(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function rv(){return!0}function AM(){return!1}function ja(r){function a(h,m,b,M,P){this._reactName=h,this._targetInst=b,this.type=m,this.nativeEvent=M,this.target=P,this.currentTarget=null;for(var V in r)r.hasOwnProperty(V)&&(h=r[V],this[V]=h?h(M):M[V]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?rv:AM,this.isPropagationStopped=AM,this}return Ii(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=rv)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=rv)},persist:function(){},isPersistent:rv}),a}var vg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lE=ja(vg),Q0=Ii({},vg,{view:0,detail:0}),fO=ja(Q0),qT,HT,i0,gw=Ii({},Q0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uE,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==i0&&(i0&&r.type==="mousemove"?(qT=r.screenX-i0.screenX,HT=r.screenY-i0.screenY):HT=qT=0,i0=r),qT)},movementY:function(r){return"movementY"in r?r.movementY:HT}}),MM=ja(gw),pO=Ii({},gw,{dataTransfer:0}),mO=ja(pO),_O=Ii({},Q0,{relatedTarget:0}),ZT=ja(_O),gO=Ii({},vg,{animationName:0,elapsedTime:0,pseudoElement:0}),yO=ja(gO),xO=Ii({},vg,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),vO=ja(xO),wO=Ii({},vg,{data:0}),IM=ja(wO),bO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},TO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function EO(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=SO[r])?!!a[r]:!1}function uE(){return EO}var CO=Ii({},Q0,{key:function(r){if(r.key){var a=bO[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=vv(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?TO[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uE,charCode:function(r){return r.type==="keypress"?vv(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?vv(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),AO=ja(CO),MO=Ii({},gw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),PM=ja(MO),IO=Ii({},Q0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uE}),PO=ja(IO),RO=Ii({},vg,{propertyName:0,elapsedTime:0,pseudoElement:0}),LO=ja(RO),DO=Ii({},gw,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),zO=ja(DO),kO=[9,13,27,32],cE=od&&"CompositionEvent"in window,g0=null;od&&"documentMode"in document&&(g0=document.documentMode);var OO=od&&"TextEvent"in window&&!g0,WR=od&&(!cE||g0&&8<g0&&11>=g0),RM=" ",LM=!1;function $R(r,a){switch(r){case"keyup":return kO.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qR(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var G_=!1;function BO(r,a){switch(r){case"compositionend":return qR(a);case"keypress":return a.which!==32?null:(LM=!0,RM);case"textInput":return r=a.data,r===RM&&LM?null:r;default:return null}}function FO(r,a){if(G_)return r==="compositionend"||!cE&&$R(r,a)?(r=GR(),xv=aE=zf=null,G_=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return WR&&a.locale!=="ko"?null:a.data;default:return null}}var NO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function DM(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!NO[r.type]:a==="textarea"}function HR(r,a,h,m){SR(m),a=jv(a,"onChange"),0<a.length&&(h=new lE("onChange","change",null,h,m),r.push({event:h,listeners:a}))}var y0=null,z0=null;function VO(r){iL(r,0)}function yw(r){var a=q_(r);if(gR(a))return r}function UO(r,a){if(r==="change")return a}var ZR=!1;if(od){var XT;if(od){var YT="oninput"in document;if(!YT){var zM=document.createElement("div");zM.setAttribute("oninput","return;"),YT=typeof zM.oninput=="function"}XT=YT}else XT=!1;ZR=XT&&(!document.documentMode||9<document.documentMode)}function kM(){y0&&(y0.detachEvent("onpropertychange",XR),z0=y0=null)}function XR(r){if(r.propertyName==="value"&&yw(z0)){var a=[];HR(a,z0,r,nE(r)),MR(VO,a)}}function jO(r,a,h){r==="focusin"?(kM(),y0=a,z0=h,y0.attachEvent("onpropertychange",XR)):r==="focusout"&&kM()}function GO(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return yw(z0)}function WO(r,a){if(r==="click")return yw(a)}function $O(r,a){if(r==="input"||r==="change")return yw(a)}function qO(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var Pu=typeof Object.is=="function"?Object.is:qO;function k0(r,a){if(Pu(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var h=Object.keys(r),m=Object.keys(a);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var b=h[m];if(!R3.call(a,b)||!Pu(r[b],a[b]))return!1}return!0}function OM(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function BM(r,a){var h=OM(r);r=0;for(var m;h;){if(h.nodeType===3){if(m=r+h.textContent.length,r<=a&&m>=a)return{node:h,offset:a-r};r=m}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=OM(h)}}function YR(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?YR(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function KR(){for(var r=window,a=kv();a instanceof r.HTMLIFrameElement;){try{var h=typeof a.contentWindow.location.href=="string"}catch{h=!1}if(h)r=a.contentWindow;else break;a=kv(r.document)}return a}function hE(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}function HO(r){var a=KR(),h=r.focusedElem,m=r.selectionRange;if(a!==h&&h&&h.ownerDocument&&YR(h.ownerDocument.documentElement,h)){if(m!==null&&hE(h)){if(a=m.start,r=m.end,r===void 0&&(r=a),"selectionStart"in h)h.selectionStart=a,h.selectionEnd=Math.min(r,h.value.length);else if(r=(a=h.ownerDocument||document)&&a.defaultView||window,r.getSelection){r=r.getSelection();var b=h.textContent.length,M=Math.min(m.start,b);m=m.end===void 0?M:Math.min(m.end,b),!r.extend&&M>m&&(b=m,m=M,M=b),b=BM(h,M);var P=BM(h,m);b&&P&&(r.rangeCount!==1||r.anchorNode!==b.node||r.anchorOffset!==b.offset||r.focusNode!==P.node||r.focusOffset!==P.offset)&&(a=a.createRange(),a.setStart(b.node,b.offset),r.removeAllRanges(),M>m?(r.addRange(a),r.extend(P.node,P.offset)):(a.setEnd(P.node,P.offset),r.addRange(a)))}}for(a=[],r=h;r=r.parentNode;)r.nodeType===1&&a.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<a.length;h++)r=a[h],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var ZO=od&&"documentMode"in document&&11>=document.documentMode,W_=null,Y3=null,x0=null,K3=!1;function FM(r,a,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;K3||W_==null||W_!==kv(m)||(m=W_,"selectionStart"in m&&hE(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),x0&&k0(x0,m)||(x0=m,m=jv(Y3,"onSelect"),0<m.length&&(a=new lE("onSelect","select",null,a,h),r.push({event:a,listeners:m}),a.target=W_)))}function iv(r,a){var h={};return h[r.toLowerCase()]=a.toLowerCase(),h["Webkit"+r]="webkit"+a,h["Moz"+r]="moz"+a,h}var $_={animationend:iv("Animation","AnimationEnd"),animationiteration:iv("Animation","AnimationIteration"),animationstart:iv("Animation","AnimationStart"),transitionend:iv("Transition","TransitionEnd")},KT={},JR={};od&&(JR=document.createElement("div").style,"AnimationEvent"in window||(delete $_.animationend.animation,delete $_.animationiteration.animation,delete $_.animationstart.animation),"TransitionEvent"in window||delete $_.transitionend.transition);function xw(r){if(KT[r])return KT[r];if(!$_[r])return r;var a=$_[r],h;for(h in a)if(a.hasOwnProperty(h)&&h in JR)return KT[r]=a[h];return r}var QR=xw("animationend"),eL=xw("animationiteration"),tL=xw("animationstart"),nL=xw("transitionend"),rL=new Map,NM="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Yf(r,a){rL.set(r,a),Dm(a,[r])}for(var JT=0;JT<NM.length;JT++){var QT=NM[JT],XO=QT.toLowerCase(),YO=QT[0].toUpperCase()+QT.slice(1);Yf(XO,"on"+YO)}Yf(QR,"onAnimationEnd");Yf(eL,"onAnimationIteration");Yf(tL,"onAnimationStart");Yf("dblclick","onDoubleClick");Yf("focusin","onFocus");Yf("focusout","onBlur");Yf(nL,"onTransitionEnd");ug("onMouseEnter",["mouseout","mouseover"]);ug("onMouseLeave",["mouseout","mouseover"]);ug("onPointerEnter",["pointerout","pointerover"]);ug("onPointerLeave",["pointerout","pointerover"]);Dm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Dm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Dm("onBeforeInput",["compositionend","keypress","textInput","paste"]);Dm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Dm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Dm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var f0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KO=new Set("cancel close invalid load scroll toggle".split(" ").concat(f0));function VM(r,a,h){var m=r.type||"unknown-event";r.currentTarget=h,Xk(m,a,void 0,r),r.currentTarget=null}function iL(r,a){a=(a&4)!==0;for(var h=0;h<r.length;h++){var m=r[h],b=m.event;m=m.listeners;e:{var M=void 0;if(a)for(var P=m.length-1;0<=P;P--){var V=m[P],o=V.instance,q=V.currentTarget;if(V=V.listener,o!==M&&b.isPropagationStopped())break e;VM(b,V,q),M=o}else for(P=0;P<m.length;P++){if(V=m[P],o=V.instance,q=V.currentTarget,V=V.listener,o!==M&&b.isPropagationStopped())break e;VM(b,V,q),M=o}}}if(Bv)throw r=q3,Bv=!1,q3=null,r}function hi(r,a){var h=a[nS];h===void 0&&(h=a[nS]=new Set);var m=r+"__bubble";h.has(m)||(sL(a,r,2,!1),h.add(m))}function e3(r,a,h){var m=0;a&&(m|=4),sL(h,r,m,a)}var sv="_reactListening"+Math.random().toString(36).slice(2);function O0(r){if(!r[sv]){r[sv]=!0,dR.forEach(function(h){h!=="selectionchange"&&(KO.has(h)||e3(h,!1,r),e3(h,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[sv]||(a[sv]=!0,e3("selectionchange",!1,a))}}function sL(r,a,h,m){switch(jR(a)){case 1:var b=hO;break;case 4:b=dO;break;default:b=oE}h=b.bind(null,a,h,r),b=void 0,!$3||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),m?b!==void 0?r.addEventListener(a,h,{capture:!0,passive:b}):r.addEventListener(a,h,!0):b!==void 0?r.addEventListener(a,h,{passive:b}):r.addEventListener(a,h,!1)}function t3(r,a,h,m,b){var M=m;if(!(a&1)&&!(a&2)&&m!==null)e:for(;;){if(m===null)return;var P=m.tag;if(P===3||P===4){var V=m.stateNode.containerInfo;if(V===b||V.nodeType===8&&V.parentNode===b)break;if(P===4)for(P=m.return;P!==null;){var o=P.tag;if((o===3||o===4)&&(o=P.stateNode.containerInfo,o===b||o.nodeType===8&&o.parentNode===b))return;P=P.return}for(;V!==null;){if(P=xm(V),P===null)return;if(o=P.tag,o===5||o===6){m=M=P;continue e}V=V.parentNode}}m=m.return}MR(function(){var q=M,J=nE(h),Q=[];e:{var ae=rL.get(r);if(ae!==void 0){var xe=lE,Re=r;switch(r){case"keypress":if(vv(h)===0)break e;case"keydown":case"keyup":xe=AO;break;case"focusin":Re="focus",xe=ZT;break;case"focusout":Re="blur",xe=ZT;break;case"beforeblur":case"afterblur":xe=ZT;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=MM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=mO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=PO;break;case QR:case eL:case tL:xe=yO;break;case nL:xe=LO;break;case"scroll":xe=fO;break;case"wheel":xe=zO;break;case"copy":case"cut":case"paste":xe=vO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=PM}var Ue=(a&4)!==0,Tt=!Ue&&r==="scroll",Te=Ue?ae!==null?ae+"Capture":null:ae;Ue=[];for(var Ee=q,Me;Ee!==null;){Me=Ee;var et=Me.stateNode;if(Me.tag===5&&et!==null&&(Me=et,Te!==null&&(et=P0(Ee,Te),et!=null&&Ue.push(B0(Ee,et,Me)))),Tt)break;Ee=Ee.return}0<Ue.length&&(ae=new xe(ae,Re,null,h,J),Q.push({event:ae,listeners:Ue}))}}if(!(a&7)){e:{if(ae=r==="mouseover"||r==="pointerover",xe=r==="mouseout"||r==="pointerout",ae&&h!==G3&&(Re=h.relatedTarget||h.fromElement)&&(xm(Re)||Re[ad]))break e;if((xe||ae)&&(ae=J.window===J?J:(ae=J.ownerDocument)?ae.defaultView||ae.parentWindow:window,xe?(Re=h.relatedTarget||h.toElement,xe=q,Re=Re?xm(Re):null,Re!==null&&(Tt=zm(Re),Re!==Tt||Re.tag!==5&&Re.tag!==6)&&(Re=null)):(xe=null,Re=q),xe!==Re)){if(Ue=MM,et="onMouseLeave",Te="onMouseEnter",Ee="mouse",(r==="pointerout"||r==="pointerover")&&(Ue=PM,et="onPointerLeave",Te="onPointerEnter",Ee="pointer"),Tt=xe==null?ae:q_(xe),Me=Re==null?ae:q_(Re),ae=new Ue(et,Ee+"leave",xe,h,J),ae.target=Tt,ae.relatedTarget=Me,et=null,xm(J)===q&&(Ue=new Ue(Te,Ee+"enter",Re,h,J),Ue.target=Me,Ue.relatedTarget=Tt,et=Ue),Tt=et,xe&&Re)t:{for(Ue=xe,Te=Re,Ee=0,Me=Ue;Me;Me=N_(Me))Ee++;for(Me=0,et=Te;et;et=N_(et))Me++;for(;0<Ee-Me;)Ue=N_(Ue),Ee--;for(;0<Me-Ee;)Te=N_(Te),Me--;for(;Ee--;){if(Ue===Te||Te!==null&&Ue===Te.alternate)break t;Ue=N_(Ue),Te=N_(Te)}Ue=null}else Ue=null;xe!==null&&UM(Q,ae,xe,Ue,!1),Re!==null&&Tt!==null&&UM(Q,Tt,Re,Ue,!0)}}e:{if(ae=q?q_(q):window,xe=ae.nodeName&&ae.nodeName.toLowerCase(),xe==="select"||xe==="input"&&ae.type==="file")var pt=UO;else if(DM(ae))if(ZR)pt=$O;else{pt=GO;var Ct=jO}else(xe=ae.nodeName)&&xe.toLowerCase()==="input"&&(ae.type==="checkbox"||ae.type==="radio")&&(pt=WO);if(pt&&(pt=pt(r,q))){HR(Q,pt,h,J);break e}Ct&&Ct(r,ae,q),r==="focusout"&&(Ct=ae._wrapperState)&&Ct.controlled&&ae.type==="number"&&F3(ae,"number",ae.value)}switch(Ct=q?q_(q):window,r){case"focusin":(DM(Ct)||Ct.contentEditable==="true")&&(W_=Ct,Y3=q,x0=null);break;case"focusout":x0=Y3=W_=null;break;case"mousedown":K3=!0;break;case"contextmenu":case"mouseup":case"dragend":K3=!1,FM(Q,h,J);break;case"selectionchange":if(ZO)break;case"keydown":case"keyup":FM(Q,h,J)}var Ot;if(cE)e:{switch(r){case"compositionstart":var zt="onCompositionStart";break e;case"compositionend":zt="onCompositionEnd";break e;case"compositionupdate":zt="onCompositionUpdate";break e}zt=void 0}else G_?$R(r,h)&&(zt="onCompositionEnd"):r==="keydown"&&h.keyCode===229&&(zt="onCompositionStart");zt&&(WR&&h.locale!=="ko"&&(G_||zt!=="onCompositionStart"?zt==="onCompositionEnd"&&G_&&(Ot=GR()):(zf=J,aE="value"in zf?zf.value:zf.textContent,G_=!0)),Ct=jv(q,zt),0<Ct.length&&(zt=new IM(zt,r,null,h,J),Q.push({event:zt,listeners:Ct}),Ot?zt.data=Ot:(Ot=qR(h),Ot!==null&&(zt.data=Ot)))),(Ot=OO?BO(r,h):FO(r,h))&&(q=jv(q,"onBeforeInput"),0<q.length&&(J=new IM("onBeforeInput","beforeinput",null,h,J),Q.push({event:J,listeners:q}),J.data=Ot))}iL(Q,a)})}function B0(r,a,h){return{instance:r,listener:a,currentTarget:h}}function jv(r,a){for(var h=a+"Capture",m=[];r!==null;){var b=r,M=b.stateNode;b.tag===5&&M!==null&&(b=M,M=P0(r,h),M!=null&&m.unshift(B0(r,M,b)),M=P0(r,a),M!=null&&m.push(B0(r,M,b))),r=r.return}return m}function N_(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function UM(r,a,h,m,b){for(var M=a._reactName,P=[];h!==null&&h!==m;){var V=h,o=V.alternate,q=V.stateNode;if(o!==null&&o===m)break;V.tag===5&&q!==null&&(V=q,b?(o=P0(h,M),o!=null&&P.unshift(B0(h,o,V))):b||(o=P0(h,M),o!=null&&P.push(B0(h,o,V)))),h=h.return}P.length!==0&&r.push({event:a,listeners:P})}var JO=/\r\n?/g,QO=/\u0000|\uFFFD/g;function jM(r){return(typeof r=="string"?r:""+r).replace(JO,`
`).replace(QO,"")}function ov(r,a,h){if(a=jM(a),jM(r)!==a&&h)throw Error(Nt(425))}function Gv(){}var J3=null,Q3=null;function eS(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var tS=typeof setTimeout=="function"?setTimeout:void 0,eB=typeof clearTimeout=="function"?clearTimeout:void 0,GM=typeof Promise=="function"?Promise:void 0,tB=typeof queueMicrotask=="function"?queueMicrotask:typeof GM<"u"?function(r){return GM.resolve(null).then(r).catch(nB)}:tS;function nB(r){setTimeout(function(){throw r})}function n3(r,a){var h=a,m=0;do{var b=h.nextSibling;if(r.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"){if(m===0){r.removeChild(b),D0(a);return}m--}else h!=="$"&&h!=="$?"&&h!=="$!"||m++;h=b}while(h);D0(a)}function Nf(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return r}function WM(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var h=r.data;if(h==="$"||h==="$!"||h==="$?"){if(a===0)return r;a--}else h==="/$"&&a++}r=r.previousSibling}return null}var wg=Math.random().toString(36).slice(2),Wc="__reactFiber$"+wg,F0="__reactProps$"+wg,ad="__reactContainer$"+wg,nS="__reactEvents$"+wg,rB="__reactListeners$"+wg,iB="__reactHandles$"+wg;function xm(r){var a=r[Wc];if(a)return a;for(var h=r.parentNode;h;){if(a=h[ad]||h[Wc]){if(h=a.alternate,a.child!==null||h!==null&&h.child!==null)for(r=WM(r);r!==null;){if(h=r[Wc])return h;r=WM(r)}return a}r=h,h=r.parentNode}return null}function ex(r){return r=r[Wc]||r[ad],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function q_(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Nt(33))}function vw(r){return r[F0]||null}var rS=[],H_=-1;function Kf(r){return{current:r}}function di(r){0>H_||(r.current=rS[H_],rS[H_]=null,H_--)}function si(r,a){H_++,rS[H_]=r.current,r.current=a}var Hf={},yo=Kf(Hf),la=Kf(!1),Am=Hf;function cg(r,a){var h=r.type.contextTypes;if(!h)return Hf;var m=r.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===a)return m.__reactInternalMemoizedMaskedChildContext;var b={},M;for(M in h)b[M]=a[M];return m&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=a,r.__reactInternalMemoizedMaskedChildContext=b),b}function ua(r){return r=r.childContextTypes,r!=null}function Wv(){di(la),di(yo)}function $M(r,a,h){if(yo.current!==Hf)throw Error(Nt(168));si(yo,a),si(la,h)}function oL(r,a,h){var m=r.stateNode;if(a=a.childContextTypes,typeof m.getChildContext!="function")return h;m=m.getChildContext();for(var b in m)if(!(b in a))throw Error(Nt(108,jk(r)||"Unknown",b));return Ii({},h,m)}function $v(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Hf,Am=yo.current,si(yo,r),si(la,la.current),!0}function qM(r,a,h){var m=r.stateNode;if(!m)throw Error(Nt(169));h?(r=oL(r,a,Am),m.__reactInternalMemoizedMergedChildContext=r,di(la),di(yo),si(yo,r)):di(la),si(la,h)}var Jh=null,ww=!1,r3=!1;function aL(r){Jh===null?Jh=[r]:Jh.push(r)}function sB(r){ww=!0,aL(r)}function Jf(){if(!r3&&Jh!==null){r3=!0;var r=0,a=Hr;try{var h=Jh;for(Hr=1;r<h.length;r++){var m=h[r];do m=m(!0);while(m!==null)}Jh=null,ww=!1}catch(b){throw Jh!==null&&(Jh=Jh.slice(r+1)),LR(rE,Jf),b}finally{Hr=a,r3=!1}}return null}var Z_=[],X_=0,qv=null,Hv=0,Sl=[],El=0,Mm=null,Qh=1,ed="";function mm(r,a){Z_[X_++]=Hv,Z_[X_++]=qv,qv=r,Hv=a}function lL(r,a,h){Sl[El++]=Qh,Sl[El++]=ed,Sl[El++]=Mm,Mm=r;var m=Qh;r=ed;var b=32-Au(m)-1;m&=~(1<<b),h+=1;var M=32-Au(a)+b;if(30<M){var P=b-b%5;M=(m&(1<<P)-1).toString(32),m>>=P,b-=P,Qh=1<<32-Au(a)+b|h<<b|m,ed=M+r}else Qh=1<<M|h<<b|m,ed=r}function dE(r){r.return!==null&&(mm(r,1),lL(r,1,0))}function fE(r){for(;r===qv;)qv=Z_[--X_],Z_[X_]=null,Hv=Z_[--X_],Z_[X_]=null;for(;r===Mm;)Mm=Sl[--El],Sl[El]=null,ed=Sl[--El],Sl[El]=null,Qh=Sl[--El],Sl[El]=null}var Fa=null,Ba=null,vi=!1,Cu=null;function uL(r,a){var h=Cl(5,null,null,0);h.elementType="DELETED",h.stateNode=a,h.return=r,a=r.deletions,a===null?(r.deletions=[h],r.flags|=16):a.push(h)}function HM(r,a){switch(r.tag){case 5:var h=r.type;return a=a.nodeType!==1||h.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(r.stateNode=a,Fa=r,Ba=Nf(a.firstChild),!0):!1;case 6:return a=r.pendingProps===""||a.nodeType!==3?null:a,a!==null?(r.stateNode=a,Fa=r,Ba=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(h=Mm!==null?{id:Qh,overflow:ed}:null,r.memoizedState={dehydrated:a,treeContext:h,retryLane:1073741824},h=Cl(18,null,null,0),h.stateNode=a,h.return=r,r.child=h,Fa=r,Ba=null,!0):!1;default:return!1}}function iS(r){return(r.mode&1)!==0&&(r.flags&128)===0}function sS(r){if(vi){var a=Ba;if(a){var h=a;if(!HM(r,a)){if(iS(r))throw Error(Nt(418));a=Nf(h.nextSibling);var m=Fa;a&&HM(r,a)?uL(m,h):(r.flags=r.flags&-4097|2,vi=!1,Fa=r)}}else{if(iS(r))throw Error(Nt(418));r.flags=r.flags&-4097|2,vi=!1,Fa=r}}}function ZM(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Fa=r}function av(r){if(r!==Fa)return!1;if(!vi)return ZM(r),vi=!0,!1;var a;if((a=r.tag!==3)&&!(a=r.tag!==5)&&(a=r.type,a=a!=="head"&&a!=="body"&&!eS(r.type,r.memoizedProps)),a&&(a=Ba)){if(iS(r))throw cL(),Error(Nt(418));for(;a;)uL(r,a),a=Nf(a.nextSibling)}if(ZM(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Nt(317));e:{for(r=r.nextSibling,a=0;r;){if(r.nodeType===8){var h=r.data;if(h==="/$"){if(a===0){Ba=Nf(r.nextSibling);break e}a--}else h!=="$"&&h!=="$!"&&h!=="$?"||a++}r=r.nextSibling}Ba=null}}else Ba=Fa?Nf(r.stateNode.nextSibling):null;return!0}function cL(){for(var r=Ba;r;)r=Nf(r.nextSibling)}function hg(){Ba=Fa=null,vi=!1}function pE(r){Cu===null?Cu=[r]:Cu.push(r)}var oB=dd.ReactCurrentBatchConfig;function s0(r,a,h){if(r=h.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Nt(309));var m=h.stateNode}if(!m)throw Error(Nt(147,r));var b=m,M=""+r;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===M?a.ref:(a=function(P){var V=b.refs;P===null?delete V[M]:V[M]=P},a._stringRef=M,a)}if(typeof r!="string")throw Error(Nt(284));if(!h._owner)throw Error(Nt(290,r))}return r}function lv(r,a){throw r=Object.prototype.toString.call(a),Error(Nt(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r))}function XM(r){var a=r._init;return a(r._payload)}function hL(r){function a(Te,Ee){if(r){var Me=Te.deletions;Me===null?(Te.deletions=[Ee],Te.flags|=16):Me.push(Ee)}}function h(Te,Ee){if(!r)return null;for(;Ee!==null;)a(Te,Ee),Ee=Ee.sibling;return null}function m(Te,Ee){for(Te=new Map;Ee!==null;)Ee.key!==null?Te.set(Ee.key,Ee):Te.set(Ee.index,Ee),Ee=Ee.sibling;return Te}function b(Te,Ee){return Te=Gf(Te,Ee),Te.index=0,Te.sibling=null,Te}function M(Te,Ee,Me){return Te.index=Me,r?(Me=Te.alternate,Me!==null?(Me=Me.index,Me<Ee?(Te.flags|=2,Ee):Me):(Te.flags|=2,Ee)):(Te.flags|=1048576,Ee)}function P(Te){return r&&Te.alternate===null&&(Te.flags|=2),Te}function V(Te,Ee,Me,et){return Ee===null||Ee.tag!==6?(Ee=c3(Me,Te.mode,et),Ee.return=Te,Ee):(Ee=b(Ee,Me),Ee.return=Te,Ee)}function o(Te,Ee,Me,et){var pt=Me.type;return pt===j_?J(Te,Ee,Me.props.children,et,Me.key):Ee!==null&&(Ee.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===If&&XM(pt)===Ee.type)?(et=b(Ee,Me.props),et.ref=s0(Te,Ee,Me),et.return=Te,et):(et=Av(Me.type,Me.key,Me.props,null,Te.mode,et),et.ref=s0(Te,Ee,Me),et.return=Te,et)}function q(Te,Ee,Me,et){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==Me.containerInfo||Ee.stateNode.implementation!==Me.implementation?(Ee=h3(Me,Te.mode,et),Ee.return=Te,Ee):(Ee=b(Ee,Me.children||[]),Ee.return=Te,Ee)}function J(Te,Ee,Me,et,pt){return Ee===null||Ee.tag!==7?(Ee=Sm(Me,Te.mode,et,pt),Ee.return=Te,Ee):(Ee=b(Ee,Me),Ee.return=Te,Ee)}function Q(Te,Ee,Me){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return Ee=c3(""+Ee,Te.mode,Me),Ee.return=Te,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case K1:return Me=Av(Ee.type,Ee.key,Ee.props,null,Te.mode,Me),Me.ref=s0(Te,null,Ee),Me.return=Te,Me;case U_:return Ee=h3(Ee,Te.mode,Me),Ee.return=Te,Ee;case If:var et=Ee._init;return Q(Te,et(Ee._payload),Me)}if(h0(Ee)||e0(Ee))return Ee=Sm(Ee,Te.mode,Me,null),Ee.return=Te,Ee;lv(Te,Ee)}return null}function ae(Te,Ee,Me,et){var pt=Ee!==null?Ee.key:null;if(typeof Me=="string"&&Me!==""||typeof Me=="number")return pt!==null?null:V(Te,Ee,""+Me,et);if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case K1:return Me.key===pt?o(Te,Ee,Me,et):null;case U_:return Me.key===pt?q(Te,Ee,Me,et):null;case If:return pt=Me._init,ae(Te,Ee,pt(Me._payload),et)}if(h0(Me)||e0(Me))return pt!==null?null:J(Te,Ee,Me,et,null);lv(Te,Me)}return null}function xe(Te,Ee,Me,et,pt){if(typeof et=="string"&&et!==""||typeof et=="number")return Te=Te.get(Me)||null,V(Ee,Te,""+et,pt);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case K1:return Te=Te.get(et.key===null?Me:et.key)||null,o(Ee,Te,et,pt);case U_:return Te=Te.get(et.key===null?Me:et.key)||null,q(Ee,Te,et,pt);case If:var Ct=et._init;return xe(Te,Ee,Me,Ct(et._payload),pt)}if(h0(et)||e0(et))return Te=Te.get(Me)||null,J(Ee,Te,et,pt,null);lv(Ee,et)}return null}function Re(Te,Ee,Me,et){for(var pt=null,Ct=null,Ot=Ee,zt=Ee=0,Zn=null;Ot!==null&&zt<Me.length;zt++){Ot.index>zt?(Zn=Ot,Ot=null):Zn=Ot.sibling;var wn=ae(Te,Ot,Me[zt],et);if(wn===null){Ot===null&&(Ot=Zn);break}r&&Ot&&wn.alternate===null&&a(Te,Ot),Ee=M(wn,Ee,zt),Ct===null?pt=wn:Ct.sibling=wn,Ct=wn,Ot=Zn}if(zt===Me.length)return h(Te,Ot),vi&&mm(Te,zt),pt;if(Ot===null){for(;zt<Me.length;zt++)Ot=Q(Te,Me[zt],et),Ot!==null&&(Ee=M(Ot,Ee,zt),Ct===null?pt=Ot:Ct.sibling=Ot,Ct=Ot);return vi&&mm(Te,zt),pt}for(Ot=m(Te,Ot);zt<Me.length;zt++)Zn=xe(Ot,Te,zt,Me[zt],et),Zn!==null&&(r&&Zn.alternate!==null&&Ot.delete(Zn.key===null?zt:Zn.key),Ee=M(Zn,Ee,zt),Ct===null?pt=Zn:Ct.sibling=Zn,Ct=Zn);return r&&Ot.forEach(function(xn){return a(Te,xn)}),vi&&mm(Te,zt),pt}function Ue(Te,Ee,Me,et){var pt=e0(Me);if(typeof pt!="function")throw Error(Nt(150));if(Me=pt.call(Me),Me==null)throw Error(Nt(151));for(var Ct=pt=null,Ot=Ee,zt=Ee=0,Zn=null,wn=Me.next();Ot!==null&&!wn.done;zt++,wn=Me.next()){Ot.index>zt?(Zn=Ot,Ot=null):Zn=Ot.sibling;var xn=ae(Te,Ot,wn.value,et);if(xn===null){Ot===null&&(Ot=Zn);break}r&&Ot&&xn.alternate===null&&a(Te,Ot),Ee=M(xn,Ee,zt),Ct===null?pt=xn:Ct.sibling=xn,Ct=xn,Ot=Zn}if(wn.done)return h(Te,Ot),vi&&mm(Te,zt),pt;if(Ot===null){for(;!wn.done;zt++,wn=Me.next())wn=Q(Te,wn.value,et),wn!==null&&(Ee=M(wn,Ee,zt),Ct===null?pt=wn:Ct.sibling=wn,Ct=wn);return vi&&mm(Te,zt),pt}for(Ot=m(Te,Ot);!wn.done;zt++,wn=Me.next())wn=xe(Ot,Te,zt,wn.value,et),wn!==null&&(r&&wn.alternate!==null&&Ot.delete(wn.key===null?zt:wn.key),Ee=M(wn,Ee,zt),Ct===null?pt=wn:Ct.sibling=wn,Ct=wn);return r&&Ot.forEach(function(rs){return a(Te,rs)}),vi&&mm(Te,zt),pt}function Tt(Te,Ee,Me,et){if(typeof Me=="object"&&Me!==null&&Me.type===j_&&Me.key===null&&(Me=Me.props.children),typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case K1:e:{for(var pt=Me.key,Ct=Ee;Ct!==null;){if(Ct.key===pt){if(pt=Me.type,pt===j_){if(Ct.tag===7){h(Te,Ct.sibling),Ee=b(Ct,Me.props.children),Ee.return=Te,Te=Ee;break e}}else if(Ct.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===If&&XM(pt)===Ct.type){h(Te,Ct.sibling),Ee=b(Ct,Me.props),Ee.ref=s0(Te,Ct,Me),Ee.return=Te,Te=Ee;break e}h(Te,Ct);break}else a(Te,Ct);Ct=Ct.sibling}Me.type===j_?(Ee=Sm(Me.props.children,Te.mode,et,Me.key),Ee.return=Te,Te=Ee):(et=Av(Me.type,Me.key,Me.props,null,Te.mode,et),et.ref=s0(Te,Ee,Me),et.return=Te,Te=et)}return P(Te);case U_:e:{for(Ct=Me.key;Ee!==null;){if(Ee.key===Ct)if(Ee.tag===4&&Ee.stateNode.containerInfo===Me.containerInfo&&Ee.stateNode.implementation===Me.implementation){h(Te,Ee.sibling),Ee=b(Ee,Me.children||[]),Ee.return=Te,Te=Ee;break e}else{h(Te,Ee);break}else a(Te,Ee);Ee=Ee.sibling}Ee=h3(Me,Te.mode,et),Ee.return=Te,Te=Ee}return P(Te);case If:return Ct=Me._init,Tt(Te,Ee,Ct(Me._payload),et)}if(h0(Me))return Re(Te,Ee,Me,et);if(e0(Me))return Ue(Te,Ee,Me,et);lv(Te,Me)}return typeof Me=="string"&&Me!==""||typeof Me=="number"?(Me=""+Me,Ee!==null&&Ee.tag===6?(h(Te,Ee.sibling),Ee=b(Ee,Me),Ee.return=Te,Te=Ee):(h(Te,Ee),Ee=c3(Me,Te.mode,et),Ee.return=Te,Te=Ee),P(Te)):h(Te,Ee)}return Tt}var dg=hL(!0),dL=hL(!1),Zv=Kf(null),Xv=null,Y_=null,mE=null;function _E(){mE=Y_=Xv=null}function gE(r){var a=Zv.current;di(Zv),r._currentValue=a}function oS(r,a,h){for(;r!==null;){var m=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,m!==null&&(m.childLanes|=a)):m!==null&&(m.childLanes&a)!==a&&(m.childLanes|=a),r===h)break;r=r.return}}function ag(r,a){Xv=r,mE=Y_=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&a&&(aa=!0),r.firstContext=null)}function Il(r){var a=r._currentValue;if(mE!==r)if(r={context:r,memoizedValue:a,next:null},Y_===null){if(Xv===null)throw Error(Nt(308));Y_=r,Xv.dependencies={lanes:0,firstContext:r}}else Y_=Y_.next=r;return a}var vm=null;function yE(r){vm===null?vm=[r]:vm.push(r)}function fL(r,a,h,m){var b=a.interleaved;return b===null?(h.next=h,yE(a)):(h.next=b.next,b.next=h),a.interleaved=h,ld(r,m)}function ld(r,a){r.lanes|=a;var h=r.alternate;for(h!==null&&(h.lanes|=a),h=r,r=r.return;r!==null;)r.childLanes|=a,h=r.alternate,h!==null&&(h.childLanes|=a),h=r,r=r.return;return h.tag===3?h.stateNode:null}var Pf=!1;function xE(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pL(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function nd(r,a){return{eventTime:r,lane:a,tag:0,payload:null,callback:null,next:null}}function Vf(r,a,h){var m=r.updateQueue;if(m===null)return null;if(m=m.shared,Pr&2){var b=m.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),m.pending=a,ld(r,h)}return b=m.interleaved,b===null?(a.next=a,yE(m)):(a.next=b.next,b.next=a),m.interleaved=a,ld(r,h)}function wv(r,a,h){if(a=a.updateQueue,a!==null&&(a=a.shared,(h&4194240)!==0)){var m=a.lanes;m&=r.pendingLanes,h|=m,a.lanes=h,iE(r,h)}}function YM(r,a){var h=r.updateQueue,m=r.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var b=null,M=null;if(h=h.firstBaseUpdate,h!==null){do{var P={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};M===null?b=M=P:M=M.next=P,h=h.next}while(h!==null);M===null?b=M=a:M=M.next=a}else b=M=a;h={baseState:m.baseState,firstBaseUpdate:b,lastBaseUpdate:M,shared:m.shared,effects:m.effects},r.updateQueue=h;return}r=h.lastBaseUpdate,r===null?h.firstBaseUpdate=a:r.next=a,h.lastBaseUpdate=a}function Yv(r,a,h,m){var b=r.updateQueue;Pf=!1;var M=b.firstBaseUpdate,P=b.lastBaseUpdate,V=b.shared.pending;if(V!==null){b.shared.pending=null;var o=V,q=o.next;o.next=null,P===null?M=q:P.next=q,P=o;var J=r.alternate;J!==null&&(J=J.updateQueue,V=J.lastBaseUpdate,V!==P&&(V===null?J.firstBaseUpdate=q:V.next=q,J.lastBaseUpdate=o))}if(M!==null){var Q=b.baseState;P=0,J=q=o=null,V=M;do{var ae=V.lane,xe=V.eventTime;if((m&ae)===ae){J!==null&&(J=J.next={eventTime:xe,lane:0,tag:V.tag,payload:V.payload,callback:V.callback,next:null});e:{var Re=r,Ue=V;switch(ae=a,xe=h,Ue.tag){case 1:if(Re=Ue.payload,typeof Re=="function"){Q=Re.call(xe,Q,ae);break e}Q=Re;break e;case 3:Re.flags=Re.flags&-65537|128;case 0:if(Re=Ue.payload,ae=typeof Re=="function"?Re.call(xe,Q,ae):Re,ae==null)break e;Q=Ii({},Q,ae);break e;case 2:Pf=!0}}V.callback!==null&&V.lane!==0&&(r.flags|=64,ae=b.effects,ae===null?b.effects=[V]:ae.push(V))}else xe={eventTime:xe,lane:ae,tag:V.tag,payload:V.payload,callback:V.callback,next:null},J===null?(q=J=xe,o=Q):J=J.next=xe,P|=ae;if(V=V.next,V===null){if(V=b.shared.pending,V===null)break;ae=V,V=ae.next,ae.next=null,b.lastBaseUpdate=ae,b.shared.pending=null}}while(!0);if(J===null&&(o=Q),b.baseState=o,b.firstBaseUpdate=q,b.lastBaseUpdate=J,a=b.shared.interleaved,a!==null){b=a;do P|=b.lane,b=b.next;while(b!==a)}else M===null&&(b.shared.lanes=0);Pm|=P,r.lanes=P,r.memoizedState=Q}}function KM(r,a,h){if(r=a.effects,a.effects=null,r!==null)for(a=0;a<r.length;a++){var m=r[a],b=m.callback;if(b!==null){if(m.callback=null,m=h,typeof b!="function")throw Error(Nt(191,b));b.call(m)}}}var tx={},Hc=Kf(tx),N0=Kf(tx),V0=Kf(tx);function wm(r){if(r===tx)throw Error(Nt(174));return r}function vE(r,a){switch(si(V0,a),si(N0,r),si(Hc,tx),r=a.nodeType,r){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:V3(null,"");break;default:r=r===8?a.parentNode:a,a=r.namespaceURI||null,r=r.tagName,a=V3(a,r)}di(Hc),si(Hc,a)}function fg(){di(Hc),di(N0),di(V0)}function mL(r){wm(V0.current);var a=wm(Hc.current),h=V3(a,r.type);a!==h&&(si(N0,r),si(Hc,h))}function wE(r){N0.current===r&&(di(Hc),di(N0))}var Ci=Kf(0);function Kv(r){for(var a=r;a!==null;){if(a.tag===13){var h=a.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var i3=[];function bE(){for(var r=0;r<i3.length;r++)i3[r]._workInProgressVersionPrimary=null;i3.length=0}var bv=dd.ReactCurrentDispatcher,s3=dd.ReactCurrentBatchConfig,Im=0,Mi=null,ds=null,Ps=null,Jv=!1,v0=!1,U0=0,aB=0;function co(){throw Error(Nt(321))}function TE(r,a){if(a===null)return!1;for(var h=0;h<a.length&&h<r.length;h++)if(!Pu(r[h],a[h]))return!1;return!0}function SE(r,a,h,m,b,M){if(Im=M,Mi=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,bv.current=r===null||r.memoizedState===null?hB:dB,r=h(m,b),v0){M=0;do{if(v0=!1,U0=0,25<=M)throw Error(Nt(301));M+=1,Ps=ds=null,a.updateQueue=null,bv.current=fB,r=h(m,b)}while(v0)}if(bv.current=Qv,a=ds!==null&&ds.next!==null,Im=0,Ps=ds=Mi=null,Jv=!1,a)throw Error(Nt(300));return r}function EE(){var r=U0!==0;return U0=0,r}function Gc(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ps===null?Mi.memoizedState=Ps=r:Ps=Ps.next=r,Ps}function Pl(){if(ds===null){var r=Mi.alternate;r=r!==null?r.memoizedState:null}else r=ds.next;var a=Ps===null?Mi.memoizedState:Ps.next;if(a!==null)Ps=a,ds=r;else{if(r===null)throw Error(Nt(310));ds=r,r={memoizedState:ds.memoizedState,baseState:ds.baseState,baseQueue:ds.baseQueue,queue:ds.queue,next:null},Ps===null?Mi.memoizedState=Ps=r:Ps=Ps.next=r}return Ps}function j0(r,a){return typeof a=="function"?a(r):a}function o3(r){var a=Pl(),h=a.queue;if(h===null)throw Error(Nt(311));h.lastRenderedReducer=r;var m=ds,b=m.baseQueue,M=h.pending;if(M!==null){if(b!==null){var P=b.next;b.next=M.next,M.next=P}m.baseQueue=b=M,h.pending=null}if(b!==null){M=b.next,m=m.baseState;var V=P=null,o=null,q=M;do{var J=q.lane;if((Im&J)===J)o!==null&&(o=o.next={lane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),m=q.hasEagerState?q.eagerState:r(m,q.action);else{var Q={lane:J,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null};o===null?(V=o=Q,P=m):o=o.next=Q,Mi.lanes|=J,Pm|=J}q=q.next}while(q!==null&&q!==M);o===null?P=m:o.next=V,Pu(m,a.memoizedState)||(aa=!0),a.memoizedState=m,a.baseState=P,a.baseQueue=o,h.lastRenderedState=m}if(r=h.interleaved,r!==null){b=r;do M=b.lane,Mi.lanes|=M,Pm|=M,b=b.next;while(b!==r)}else b===null&&(h.lanes=0);return[a.memoizedState,h.dispatch]}function a3(r){var a=Pl(),h=a.queue;if(h===null)throw Error(Nt(311));h.lastRenderedReducer=r;var m=h.dispatch,b=h.pending,M=a.memoizedState;if(b!==null){h.pending=null;var P=b=b.next;do M=r(M,P.action),P=P.next;while(P!==b);Pu(M,a.memoizedState)||(aa=!0),a.memoizedState=M,a.baseQueue===null&&(a.baseState=M),h.lastRenderedState=M}return[M,m]}function _L(){}function gL(r,a){var h=Mi,m=Pl(),b=a(),M=!Pu(m.memoizedState,b);if(M&&(m.memoizedState=b,aa=!0),m=m.queue,CE(vL.bind(null,h,m,r),[r]),m.getSnapshot!==a||M||Ps!==null&&Ps.memoizedState.tag&1){if(h.flags|=2048,G0(9,xL.bind(null,h,m,b,a),void 0,null),Rs===null)throw Error(Nt(349));Im&30||yL(h,a,b)}return b}function yL(r,a,h){r.flags|=16384,r={getSnapshot:a,value:h},a=Mi.updateQueue,a===null?(a={lastEffect:null,stores:null},Mi.updateQueue=a,a.stores=[r]):(h=a.stores,h===null?a.stores=[r]:h.push(r))}function xL(r,a,h,m){a.value=h,a.getSnapshot=m,wL(a)&&bL(r)}function vL(r,a,h){return h(function(){wL(a)&&bL(r)})}function wL(r){var a=r.getSnapshot;r=r.value;try{var h=a();return!Pu(r,h)}catch{return!0}}function bL(r){var a=ld(r,1);a!==null&&Mu(a,r,1,-1)}function JM(r){var a=Gc();return typeof r=="function"&&(r=r()),a.memoizedState=a.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:j0,lastRenderedState:r},a.queue=r,r=r.dispatch=cB.bind(null,Mi,r),[a.memoizedState,r]}function G0(r,a,h,m){return r={tag:r,create:a,destroy:h,deps:m,next:null},a=Mi.updateQueue,a===null?(a={lastEffect:null,stores:null},Mi.updateQueue=a,a.lastEffect=r.next=r):(h=a.lastEffect,h===null?a.lastEffect=r.next=r:(m=h.next,h.next=r,r.next=m,a.lastEffect=r)),r}function TL(){return Pl().memoizedState}function Tv(r,a,h,m){var b=Gc();Mi.flags|=r,b.memoizedState=G0(1|a,h,void 0,m===void 0?null:m)}function bw(r,a,h,m){var b=Pl();m=m===void 0?null:m;var M=void 0;if(ds!==null){var P=ds.memoizedState;if(M=P.destroy,m!==null&&TE(m,P.deps)){b.memoizedState=G0(a,h,M,m);return}}Mi.flags|=r,b.memoizedState=G0(1|a,h,M,m)}function QM(r,a){return Tv(8390656,8,r,a)}function CE(r,a){return bw(2048,8,r,a)}function SL(r,a){return bw(4,2,r,a)}function EL(r,a){return bw(4,4,r,a)}function CL(r,a){if(typeof a=="function")return r=r(),a(r),function(){a(null)};if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function AL(r,a,h){return h=h!=null?h.concat([r]):null,bw(4,4,CL.bind(null,a,r),h)}function AE(){}function ML(r,a){var h=Pl();a=a===void 0?null:a;var m=h.memoizedState;return m!==null&&a!==null&&TE(a,m[1])?m[0]:(h.memoizedState=[r,a],r)}function IL(r,a){var h=Pl();a=a===void 0?null:a;var m=h.memoizedState;return m!==null&&a!==null&&TE(a,m[1])?m[0]:(r=r(),h.memoizedState=[r,a],r)}function PL(r,a,h){return Im&21?(Pu(h,a)||(h=kR(),Mi.lanes|=h,Pm|=h,r.baseState=!0),a):(r.baseState&&(r.baseState=!1,aa=!0),r.memoizedState=h)}function lB(r,a){var h=Hr;Hr=h!==0&&4>h?h:4,r(!0);var m=s3.transition;s3.transition={};try{r(!1),a()}finally{Hr=h,s3.transition=m}}function RL(){return Pl().memoizedState}function uB(r,a,h){var m=jf(r);if(h={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null},LL(r))DL(a,h);else if(h=fL(r,a,h,m),h!==null){var b=Lo();Mu(h,r,m,b),zL(h,a,m)}}function cB(r,a,h){var m=jf(r),b={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null};if(LL(r))DL(a,b);else{var M=r.alternate;if(r.lanes===0&&(M===null||M.lanes===0)&&(M=a.lastRenderedReducer,M!==null))try{var P=a.lastRenderedState,V=M(P,h);if(b.hasEagerState=!0,b.eagerState=V,Pu(V,P)){var o=a.interleaved;o===null?(b.next=b,yE(a)):(b.next=o.next,o.next=b),a.interleaved=b;return}}catch{}finally{}h=fL(r,a,b,m),h!==null&&(b=Lo(),Mu(h,r,m,b),zL(h,a,m))}}function LL(r){var a=r.alternate;return r===Mi||a!==null&&a===Mi}function DL(r,a){v0=Jv=!0;var h=r.pending;h===null?a.next=a:(a.next=h.next,h.next=a),r.pending=a}function zL(r,a,h){if(h&4194240){var m=a.lanes;m&=r.pendingLanes,h|=m,a.lanes=h,iE(r,h)}}var Qv={readContext:Il,useCallback:co,useContext:co,useEffect:co,useImperativeHandle:co,useInsertionEffect:co,useLayoutEffect:co,useMemo:co,useReducer:co,useRef:co,useState:co,useDebugValue:co,useDeferredValue:co,useTransition:co,useMutableSource:co,useSyncExternalStore:co,useId:co,unstable_isNewReconciler:!1},hB={readContext:Il,useCallback:function(r,a){return Gc().memoizedState=[r,a===void 0?null:a],r},useContext:Il,useEffect:QM,useImperativeHandle:function(r,a,h){return h=h!=null?h.concat([r]):null,Tv(4194308,4,CL.bind(null,a,r),h)},useLayoutEffect:function(r,a){return Tv(4194308,4,r,a)},useInsertionEffect:function(r,a){return Tv(4,2,r,a)},useMemo:function(r,a){var h=Gc();return a=a===void 0?null:a,r=r(),h.memoizedState=[r,a],r},useReducer:function(r,a,h){var m=Gc();return a=h!==void 0?h(a):a,m.memoizedState=m.baseState=a,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:a},m.queue=r,r=r.dispatch=uB.bind(null,Mi,r),[m.memoizedState,r]},useRef:function(r){var a=Gc();return r={current:r},a.memoizedState=r},useState:JM,useDebugValue:AE,useDeferredValue:function(r){return Gc().memoizedState=r},useTransition:function(){var r=JM(!1),a=r[0];return r=lB.bind(null,r[1]),Gc().memoizedState=r,[a,r]},useMutableSource:function(){},useSyncExternalStore:function(r,a,h){var m=Mi,b=Gc();if(vi){if(h===void 0)throw Error(Nt(407));h=h()}else{if(h=a(),Rs===null)throw Error(Nt(349));Im&30||yL(m,a,h)}b.memoizedState=h;var M={value:h,getSnapshot:a};return b.queue=M,QM(vL.bind(null,m,M,r),[r]),m.flags|=2048,G0(9,xL.bind(null,m,M,h,a),void 0,null),h},useId:function(){var r=Gc(),a=Rs.identifierPrefix;if(vi){var h=ed,m=Qh;h=(m&~(1<<32-Au(m)-1)).toString(32)+h,a=":"+a+"R"+h,h=U0++,0<h&&(a+="H"+h.toString(32)),a+=":"}else h=aB++,a=":"+a+"r"+h.toString(32)+":";return r.memoizedState=a},unstable_isNewReconciler:!1},dB={readContext:Il,useCallback:ML,useContext:Il,useEffect:CE,useImperativeHandle:AL,useInsertionEffect:SL,useLayoutEffect:EL,useMemo:IL,useReducer:o3,useRef:TL,useState:function(){return o3(j0)},useDebugValue:AE,useDeferredValue:function(r){var a=Pl();return PL(a,ds.memoizedState,r)},useTransition:function(){var r=o3(j0)[0],a=Pl().memoizedState;return[r,a]},useMutableSource:_L,useSyncExternalStore:gL,useId:RL,unstable_isNewReconciler:!1},fB={readContext:Il,useCallback:ML,useContext:Il,useEffect:CE,useImperativeHandle:AL,useInsertionEffect:SL,useLayoutEffect:EL,useMemo:IL,useReducer:a3,useRef:TL,useState:function(){return a3(j0)},useDebugValue:AE,useDeferredValue:function(r){var a=Pl();return ds===null?a.memoizedState=r:PL(a,ds.memoizedState,r)},useTransition:function(){var r=a3(j0)[0],a=Pl().memoizedState;return[r,a]},useMutableSource:_L,useSyncExternalStore:gL,useId:RL,unstable_isNewReconciler:!1};function Su(r,a){if(r&&r.defaultProps){a=Ii({},a),r=r.defaultProps;for(var h in r)a[h]===void 0&&(a[h]=r[h]);return a}return a}function aS(r,a,h,m){a=r.memoizedState,h=h(m,a),h=h==null?a:Ii({},a,h),r.memoizedState=h,r.lanes===0&&(r.updateQueue.baseState=h)}var Tw={isMounted:function(r){return(r=r._reactInternals)?zm(r)===r:!1},enqueueSetState:function(r,a,h){r=r._reactInternals;var m=Lo(),b=jf(r),M=nd(m,b);M.payload=a,h!=null&&(M.callback=h),a=Vf(r,M,b),a!==null&&(Mu(a,r,b,m),wv(a,r,b))},enqueueReplaceState:function(r,a,h){r=r._reactInternals;var m=Lo(),b=jf(r),M=nd(m,b);M.tag=1,M.payload=a,h!=null&&(M.callback=h),a=Vf(r,M,b),a!==null&&(Mu(a,r,b,m),wv(a,r,b))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var h=Lo(),m=jf(r),b=nd(h,m);b.tag=2,a!=null&&(b.callback=a),a=Vf(r,b,m),a!==null&&(Mu(a,r,m,h),wv(a,r,m))}};function eI(r,a,h,m,b,M,P){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(m,M,P):a.prototype&&a.prototype.isPureReactComponent?!k0(h,m)||!k0(b,M):!0}function kL(r,a,h){var m=!1,b=Hf,M=a.contextType;return typeof M=="object"&&M!==null?M=Il(M):(b=ua(a)?Am:yo.current,m=a.contextTypes,M=(m=m!=null)?cg(r,b):Hf),a=new a(h,M),r.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=Tw,r.stateNode=a,a._reactInternals=r,m&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=b,r.__reactInternalMemoizedMaskedChildContext=M),a}function tI(r,a,h,m){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(h,m),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(h,m),a.state!==r&&Tw.enqueueReplaceState(a,a.state,null)}function lS(r,a,h,m){var b=r.stateNode;b.props=h,b.state=r.memoizedState,b.refs={},xE(r);var M=a.contextType;typeof M=="object"&&M!==null?b.context=Il(M):(M=ua(a)?Am:yo.current,b.context=cg(r,M)),b.state=r.memoizedState,M=a.getDerivedStateFromProps,typeof M=="function"&&(aS(r,a,M,h),b.state=r.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(a=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),a!==b.state&&Tw.enqueueReplaceState(b,b.state,null),Yv(r,h,b,m),b.state=r.memoizedState),typeof b.componentDidMount=="function"&&(r.flags|=4194308)}function pg(r,a){try{var h="",m=a;do h+=Uk(m),m=m.return;while(m);var b=h}catch(M){b=`
Error generating stack: `+M.message+`
`+M.stack}return{value:r,source:a,stack:b,digest:null}}function l3(r,a,h){return{value:r,source:null,stack:h??null,digest:a??null}}function uS(r,a){try{console.error(a.value)}catch(h){setTimeout(function(){throw h})}}var pB=typeof WeakMap=="function"?WeakMap:Map;function OL(r,a,h){h=nd(-1,h),h.tag=3,h.payload={element:null};var m=a.value;return h.callback=function(){tw||(tw=!0,xS=m),uS(r,a)},h}function BL(r,a,h){h=nd(-1,h),h.tag=3;var m=r.type.getDerivedStateFromError;if(typeof m=="function"){var b=a.value;h.payload=function(){return m(b)},h.callback=function(){uS(r,a)}}var M=r.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(h.callback=function(){uS(r,a),typeof m!="function"&&(Uf===null?Uf=new Set([this]):Uf.add(this));var P=a.stack;this.componentDidCatch(a.value,{componentStack:P!==null?P:""})}),h}function nI(r,a,h){var m=r.pingCache;if(m===null){m=r.pingCache=new pB;var b=new Set;m.set(a,b)}else b=m.get(a),b===void 0&&(b=new Set,m.set(a,b));b.has(h)||(b.add(h),r=MB.bind(null,r,a,h),a.then(r,r))}function rI(r){do{var a;if((a=r.tag===13)&&(a=r.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return r;r=r.return}while(r!==null);return null}function iI(r,a,h,m,b){return r.mode&1?(r.flags|=65536,r.lanes=b,r):(r===a?r.flags|=65536:(r.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(a=nd(-1,1),a.tag=2,Vf(h,a,1))),h.lanes|=1),r)}var mB=dd.ReactCurrentOwner,aa=!1;function Ro(r,a,h,m){a.child=r===null?dL(a,null,h,m):dg(a,r.child,h,m)}function sI(r,a,h,m,b){h=h.render;var M=a.ref;return ag(a,b),m=SE(r,a,h,m,M,b),h=EE(),r!==null&&!aa?(a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~b,ud(r,a,b)):(vi&&h&&dE(a),a.flags|=1,Ro(r,a,m,b),a.child)}function oI(r,a,h,m,b){if(r===null){var M=h.type;return typeof M=="function"&&!kE(M)&&M.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(a.tag=15,a.type=M,FL(r,a,M,m,b)):(r=Av(h.type,null,m,a,a.mode,b),r.ref=a.ref,r.return=a,a.child=r)}if(M=r.child,!(r.lanes&b)){var P=M.memoizedProps;if(h=h.compare,h=h!==null?h:k0,h(P,m)&&r.ref===a.ref)return ud(r,a,b)}return a.flags|=1,r=Gf(M,m),r.ref=a.ref,r.return=a,a.child=r}function FL(r,a,h,m,b){if(r!==null){var M=r.memoizedProps;if(k0(M,m)&&r.ref===a.ref)if(aa=!1,a.pendingProps=m=M,(r.lanes&b)!==0)r.flags&131072&&(aa=!0);else return a.lanes=r.lanes,ud(r,a,b)}return cS(r,a,h,m,b)}function NL(r,a,h){var m=a.pendingProps,b=m.children,M=r!==null?r.memoizedState:null;if(m.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},si(J_,Oa),Oa|=h;else{if(!(h&1073741824))return r=M!==null?M.baseLanes|h:h,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:r,cachePool:null,transitions:null},a.updateQueue=null,si(J_,Oa),Oa|=r,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=M!==null?M.baseLanes:h,si(J_,Oa),Oa|=m}else M!==null?(m=M.baseLanes|h,a.memoizedState=null):m=h,si(J_,Oa),Oa|=m;return Ro(r,a,b,h),a.child}function VL(r,a){var h=a.ref;(r===null&&h!==null||r!==null&&r.ref!==h)&&(a.flags|=512,a.flags|=2097152)}function cS(r,a,h,m,b){var M=ua(h)?Am:yo.current;return M=cg(a,M),ag(a,b),h=SE(r,a,h,m,M,b),m=EE(),r!==null&&!aa?(a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~b,ud(r,a,b)):(vi&&m&&dE(a),a.flags|=1,Ro(r,a,h,b),a.child)}function aI(r,a,h,m,b){if(ua(h)){var M=!0;$v(a)}else M=!1;if(ag(a,b),a.stateNode===null)Sv(r,a),kL(a,h,m),lS(a,h,m,b),m=!0;else if(r===null){var P=a.stateNode,V=a.memoizedProps;P.props=V;var o=P.context,q=h.contextType;typeof q=="object"&&q!==null?q=Il(q):(q=ua(h)?Am:yo.current,q=cg(a,q));var J=h.getDerivedStateFromProps,Q=typeof J=="function"||typeof P.getSnapshotBeforeUpdate=="function";Q||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(V!==m||o!==q)&&tI(a,P,m,q),Pf=!1;var ae=a.memoizedState;P.state=ae,Yv(a,m,P,b),o=a.memoizedState,V!==m||ae!==o||la.current||Pf?(typeof J=="function"&&(aS(a,h,J,m),o=a.memoizedState),(V=Pf||eI(a,h,V,m,ae,o,q))?(Q||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(a.flags|=4194308)):(typeof P.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=m,a.memoizedState=o),P.props=m,P.state=o,P.context=q,m=V):(typeof P.componentDidMount=="function"&&(a.flags|=4194308),m=!1)}else{P=a.stateNode,pL(r,a),V=a.memoizedProps,q=a.type===a.elementType?V:Su(a.type,V),P.props=q,Q=a.pendingProps,ae=P.context,o=h.contextType,typeof o=="object"&&o!==null?o=Il(o):(o=ua(h)?Am:yo.current,o=cg(a,o));var xe=h.getDerivedStateFromProps;(J=typeof xe=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(V!==Q||ae!==o)&&tI(a,P,m,o),Pf=!1,ae=a.memoizedState,P.state=ae,Yv(a,m,P,b);var Re=a.memoizedState;V!==Q||ae!==Re||la.current||Pf?(typeof xe=="function"&&(aS(a,h,xe,m),Re=a.memoizedState),(q=Pf||eI(a,h,q,m,ae,Re,o)||!1)?(J||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(m,Re,o),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(m,Re,o)),typeof P.componentDidUpdate=="function"&&(a.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof P.componentDidUpdate!="function"||V===r.memoizedProps&&ae===r.memoizedState||(a.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||V===r.memoizedProps&&ae===r.memoizedState||(a.flags|=1024),a.memoizedProps=m,a.memoizedState=Re),P.props=m,P.state=Re,P.context=o,m=q):(typeof P.componentDidUpdate!="function"||V===r.memoizedProps&&ae===r.memoizedState||(a.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||V===r.memoizedProps&&ae===r.memoizedState||(a.flags|=1024),m=!1)}return hS(r,a,h,m,M,b)}function hS(r,a,h,m,b,M){VL(r,a);var P=(a.flags&128)!==0;if(!m&&!P)return b&&qM(a,h,!1),ud(r,a,M);m=a.stateNode,mB.current=a;var V=P&&typeof h.getDerivedStateFromError!="function"?null:m.render();return a.flags|=1,r!==null&&P?(a.child=dg(a,r.child,null,M),a.child=dg(a,null,V,M)):Ro(r,a,V,M),a.memoizedState=m.state,b&&qM(a,h,!0),a.child}function UL(r){var a=r.stateNode;a.pendingContext?$M(r,a.pendingContext,a.pendingContext!==a.context):a.context&&$M(r,a.context,!1),vE(r,a.containerInfo)}function lI(r,a,h,m,b){return hg(),pE(b),a.flags|=256,Ro(r,a,h,m),a.child}var dS={dehydrated:null,treeContext:null,retryLane:0};function fS(r){return{baseLanes:r,cachePool:null,transitions:null}}function jL(r,a,h){var m=a.pendingProps,b=Ci.current,M=!1,P=(a.flags&128)!==0,V;if((V=P)||(V=r!==null&&r.memoizedState===null?!1:(b&2)!==0),V?(M=!0,a.flags&=-129):(r===null||r.memoizedState!==null)&&(b|=1),si(Ci,b&1),r===null)return sS(a),r=a.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(a.mode&1?r.data==="$!"?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(P=m.children,r=m.fallback,M?(m=a.mode,M=a.child,P={mode:"hidden",children:P},!(m&1)&&M!==null?(M.childLanes=0,M.pendingProps=P):M=Cw(P,m,0,null),r=Sm(r,m,h,null),M.return=a,r.return=a,M.sibling=r,a.child=M,a.child.memoizedState=fS(h),a.memoizedState=dS,r):ME(a,P));if(b=r.memoizedState,b!==null&&(V=b.dehydrated,V!==null))return _B(r,a,P,m,V,b,h);if(M){M=m.fallback,P=a.mode,b=r.child,V=b.sibling;var o={mode:"hidden",children:m.children};return!(P&1)&&a.child!==b?(m=a.child,m.childLanes=0,m.pendingProps=o,a.deletions=null):(m=Gf(b,o),m.subtreeFlags=b.subtreeFlags&14680064),V!==null?M=Gf(V,M):(M=Sm(M,P,h,null),M.flags|=2),M.return=a,m.return=a,m.sibling=M,a.child=m,m=M,M=a.child,P=r.child.memoizedState,P=P===null?fS(h):{baseLanes:P.baseLanes|h,cachePool:null,transitions:P.transitions},M.memoizedState=P,M.childLanes=r.childLanes&~h,a.memoizedState=dS,m}return M=r.child,r=M.sibling,m=Gf(M,{mode:"visible",children:m.children}),!(a.mode&1)&&(m.lanes=h),m.return=a,m.sibling=null,r!==null&&(h=a.deletions,h===null?(a.deletions=[r],a.flags|=16):h.push(r)),a.child=m,a.memoizedState=null,m}function ME(r,a){return a=Cw({mode:"visible",children:a},r.mode,0,null),a.return=r,r.child=a}function uv(r,a,h,m){return m!==null&&pE(m),dg(a,r.child,null,h),r=ME(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function _B(r,a,h,m,b,M,P){if(h)return a.flags&256?(a.flags&=-257,m=l3(Error(Nt(422))),uv(r,a,P,m)):a.memoizedState!==null?(a.child=r.child,a.flags|=128,null):(M=m.fallback,b=a.mode,m=Cw({mode:"visible",children:m.children},b,0,null),M=Sm(M,b,P,null),M.flags|=2,m.return=a,M.return=a,m.sibling=M,a.child=m,a.mode&1&&dg(a,r.child,null,P),a.child.memoizedState=fS(P),a.memoizedState=dS,M);if(!(a.mode&1))return uv(r,a,P,null);if(b.data==="$!"){if(m=b.nextSibling&&b.nextSibling.dataset,m)var V=m.dgst;return m=V,M=Error(Nt(419)),m=l3(M,m,void 0),uv(r,a,P,m)}if(V=(P&r.childLanes)!==0,aa||V){if(m=Rs,m!==null){switch(P&-P){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(m.suspendedLanes|P)?0:b,b!==0&&b!==M.retryLane&&(M.retryLane=b,ld(r,b),Mu(m,r,b,-1))}return zE(),m=l3(Error(Nt(421))),uv(r,a,P,m)}return b.data==="$?"?(a.flags|=128,a.child=r.child,a=IB.bind(null,r),b._reactRetry=a,null):(r=M.treeContext,Ba=Nf(b.nextSibling),Fa=a,vi=!0,Cu=null,r!==null&&(Sl[El++]=Qh,Sl[El++]=ed,Sl[El++]=Mm,Qh=r.id,ed=r.overflow,Mm=a),a=ME(a,m.children),a.flags|=4096,a)}function uI(r,a,h){r.lanes|=a;var m=r.alternate;m!==null&&(m.lanes|=a),oS(r.return,a,h)}function u3(r,a,h,m,b){var M=r.memoizedState;M===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:b}:(M.isBackwards=a,M.rendering=null,M.renderingStartTime=0,M.last=m,M.tail=h,M.tailMode=b)}function GL(r,a,h){var m=a.pendingProps,b=m.revealOrder,M=m.tail;if(Ro(r,a,m.children,h),m=Ci.current,m&2)m=m&1|2,a.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&uI(r,h,a);else if(r.tag===19)uI(r,h,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}m&=1}if(si(Ci,m),!(a.mode&1))a.memoizedState=null;else switch(b){case"forwards":for(h=a.child,b=null;h!==null;)r=h.alternate,r!==null&&Kv(r)===null&&(b=h),h=h.sibling;h=b,h===null?(b=a.child,a.child=null):(b=h.sibling,h.sibling=null),u3(a,!1,b,h,M);break;case"backwards":for(h=null,b=a.child,a.child=null;b!==null;){if(r=b.alternate,r!==null&&Kv(r)===null){a.child=b;break}r=b.sibling,b.sibling=h,h=b,b=r}u3(a,!0,h,null,M);break;case"together":u3(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Sv(r,a){!(a.mode&1)&&r!==null&&(r.alternate=null,a.alternate=null,a.flags|=2)}function ud(r,a,h){if(r!==null&&(a.dependencies=r.dependencies),Pm|=a.lanes,!(h&a.childLanes))return null;if(r!==null&&a.child!==r.child)throw Error(Nt(153));if(a.child!==null){for(r=a.child,h=Gf(r,r.pendingProps),a.child=h,h.return=a;r.sibling!==null;)r=r.sibling,h=h.sibling=Gf(r,r.pendingProps),h.return=a;h.sibling=null}return a.child}function gB(r,a,h){switch(a.tag){case 3:UL(a),hg();break;case 5:mL(a);break;case 1:ua(a.type)&&$v(a);break;case 4:vE(a,a.stateNode.containerInfo);break;case 10:var m=a.type._context,b=a.memoizedProps.value;si(Zv,m._currentValue),m._currentValue=b;break;case 13:if(m=a.memoizedState,m!==null)return m.dehydrated!==null?(si(Ci,Ci.current&1),a.flags|=128,null):h&a.child.childLanes?jL(r,a,h):(si(Ci,Ci.current&1),r=ud(r,a,h),r!==null?r.sibling:null);si(Ci,Ci.current&1);break;case 19:if(m=(h&a.childLanes)!==0,r.flags&128){if(m)return GL(r,a,h);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),si(Ci,Ci.current),m)break;return null;case 22:case 23:return a.lanes=0,NL(r,a,h)}return ud(r,a,h)}var WL,pS,$L,qL;WL=function(r,a){for(var h=a.child;h!==null;){if(h.tag===5||h.tag===6)r.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};pS=function(){};$L=function(r,a,h,m){var b=r.memoizedProps;if(b!==m){r=a.stateNode,wm(Hc.current);var M=null;switch(h){case"input":b=O3(r,b),m=O3(r,m),M=[];break;case"select":b=Ii({},b,{value:void 0}),m=Ii({},m,{value:void 0}),M=[];break;case"textarea":b=N3(r,b),m=N3(r,m),M=[];break;default:typeof b.onClick!="function"&&typeof m.onClick=="function"&&(r.onclick=Gv)}U3(h,m);var P;h=null;for(q in b)if(!m.hasOwnProperty(q)&&b.hasOwnProperty(q)&&b[q]!=null)if(q==="style"){var V=b[q];for(P in V)V.hasOwnProperty(P)&&(h||(h={}),h[P]="")}else q!=="dangerouslySetInnerHTML"&&q!=="children"&&q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&q!=="autoFocus"&&(M0.hasOwnProperty(q)?M||(M=[]):(M=M||[]).push(q,null));for(q in m){var o=m[q];if(V=b!=null?b[q]:void 0,m.hasOwnProperty(q)&&o!==V&&(o!=null||V!=null))if(q==="style")if(V){for(P in V)!V.hasOwnProperty(P)||o&&o.hasOwnProperty(P)||(h||(h={}),h[P]="");for(P in o)o.hasOwnProperty(P)&&V[P]!==o[P]&&(h||(h={}),h[P]=o[P])}else h||(M||(M=[]),M.push(q,h)),h=o;else q==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,V=V?V.__html:void 0,o!=null&&V!==o&&(M=M||[]).push(q,o)):q==="children"?typeof o!="string"&&typeof o!="number"||(M=M||[]).push(q,""+o):q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&(M0.hasOwnProperty(q)?(o!=null&&q==="onScroll"&&hi("scroll",r),M||V===o||(M=[])):(M=M||[]).push(q,o))}h&&(M=M||[]).push("style",h);var q=M;(a.updateQueue=q)&&(a.flags|=4)}};qL=function(r,a,h,m){h!==m&&(a.flags|=4)};function o0(r,a){if(!vi)switch(r.tailMode){case"hidden":a=r.tail;for(var h=null;a!==null;)a.alternate!==null&&(h=a),a=a.sibling;h===null?r.tail=null:h.sibling=null;break;case"collapsed":h=r.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:m.sibling=null}}function ho(r){var a=r.alternate!==null&&r.alternate.child===r.child,h=0,m=0;if(a)for(var b=r.child;b!==null;)h|=b.lanes|b.childLanes,m|=b.subtreeFlags&14680064,m|=b.flags&14680064,b.return=r,b=b.sibling;else for(b=r.child;b!==null;)h|=b.lanes|b.childLanes,m|=b.subtreeFlags,m|=b.flags,b.return=r,b=b.sibling;return r.subtreeFlags|=m,r.childLanes=h,a}function yB(r,a,h){var m=a.pendingProps;switch(fE(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ho(a),null;case 1:return ua(a.type)&&Wv(),ho(a),null;case 3:return m=a.stateNode,fg(),di(la),di(yo),bE(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(r===null||r.child===null)&&(av(a)?a.flags|=4:r===null||r.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,Cu!==null&&(bS(Cu),Cu=null))),pS(r,a),ho(a),null;case 5:wE(a);var b=wm(V0.current);if(h=a.type,r!==null&&a.stateNode!=null)$L(r,a,h,m,b),r.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!m){if(a.stateNode===null)throw Error(Nt(166));return ho(a),null}if(r=wm(Hc.current),av(a)){m=a.stateNode,h=a.type;var M=a.memoizedProps;switch(m[Wc]=a,m[F0]=M,r=(a.mode&1)!==0,h){case"dialog":hi("cancel",m),hi("close",m);break;case"iframe":case"object":case"embed":hi("load",m);break;case"video":case"audio":for(b=0;b<f0.length;b++)hi(f0[b],m);break;case"source":hi("error",m);break;case"img":case"image":case"link":hi("error",m),hi("load",m);break;case"details":hi("toggle",m);break;case"input":yM(m,M),hi("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!M.multiple},hi("invalid",m);break;case"textarea":vM(m,M),hi("invalid",m)}U3(h,M),b=null;for(var P in M)if(M.hasOwnProperty(P)){var V=M[P];P==="children"?typeof V=="string"?m.textContent!==V&&(M.suppressHydrationWarning!==!0&&ov(m.textContent,V,r),b=["children",V]):typeof V=="number"&&m.textContent!==""+V&&(M.suppressHydrationWarning!==!0&&ov(m.textContent,V,r),b=["children",""+V]):M0.hasOwnProperty(P)&&V!=null&&P==="onScroll"&&hi("scroll",m)}switch(h){case"input":J1(m),xM(m,M,!0);break;case"textarea":J1(m),wM(m);break;case"select":case"option":break;default:typeof M.onClick=="function"&&(m.onclick=Gv)}m=b,a.updateQueue=m,m!==null&&(a.flags|=4)}else{P=b.nodeType===9?b:b.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=vR(h)),r==="http://www.w3.org/1999/xhtml"?h==="script"?(r=P.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof m.is=="string"?r=P.createElement(h,{is:m.is}):(r=P.createElement(h),h==="select"&&(P=r,m.multiple?P.multiple=!0:m.size&&(P.size=m.size))):r=P.createElementNS(r,h),r[Wc]=a,r[F0]=m,WL(r,a,!1,!1),a.stateNode=r;e:{switch(P=j3(h,m),h){case"dialog":hi("cancel",r),hi("close",r),b=m;break;case"iframe":case"object":case"embed":hi("load",r),b=m;break;case"video":case"audio":for(b=0;b<f0.length;b++)hi(f0[b],r);b=m;break;case"source":hi("error",r),b=m;break;case"img":case"image":case"link":hi("error",r),hi("load",r),b=m;break;case"details":hi("toggle",r),b=m;break;case"input":yM(r,m),b=O3(r,m),hi("invalid",r);break;case"option":b=m;break;case"select":r._wrapperState={wasMultiple:!!m.multiple},b=Ii({},m,{value:void 0}),hi("invalid",r);break;case"textarea":vM(r,m),b=N3(r,m),hi("invalid",r);break;default:b=m}U3(h,b),V=b;for(M in V)if(V.hasOwnProperty(M)){var o=V[M];M==="style"?TR(r,o):M==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,o!=null&&wR(r,o)):M==="children"?typeof o=="string"?(h!=="textarea"||o!=="")&&I0(r,o):typeof o=="number"&&I0(r,""+o):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(M0.hasOwnProperty(M)?o!=null&&M==="onScroll"&&hi("scroll",r):o!=null&&JS(r,M,o,P))}switch(h){case"input":J1(r),xM(r,m,!1);break;case"textarea":J1(r),wM(r);break;case"option":m.value!=null&&r.setAttribute("value",""+qf(m.value));break;case"select":r.multiple=!!m.multiple,M=m.value,M!=null?rg(r,!!m.multiple,M,!1):m.defaultValue!=null&&rg(r,!!m.multiple,m.defaultValue,!0);break;default:typeof b.onClick=="function"&&(r.onclick=Gv)}switch(h){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return ho(a),null;case 6:if(r&&a.stateNode!=null)qL(r,a,r.memoizedProps,m);else{if(typeof m!="string"&&a.stateNode===null)throw Error(Nt(166));if(h=wm(V0.current),wm(Hc.current),av(a)){if(m=a.stateNode,h=a.memoizedProps,m[Wc]=a,(M=m.nodeValue!==h)&&(r=Fa,r!==null))switch(r.tag){case 3:ov(m.nodeValue,h,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&ov(m.nodeValue,h,(r.mode&1)!==0)}M&&(a.flags|=4)}else m=(h.nodeType===9?h:h.ownerDocument).createTextNode(m),m[Wc]=a,a.stateNode=m}return ho(a),null;case 13:if(di(Ci),m=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(vi&&Ba!==null&&a.mode&1&&!(a.flags&128))cL(),hg(),a.flags|=98560,M=!1;else if(M=av(a),m!==null&&m.dehydrated!==null){if(r===null){if(!M)throw Error(Nt(318));if(M=a.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(Nt(317));M[Wc]=a}else hg(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;ho(a),M=!1}else Cu!==null&&(bS(Cu),Cu=null),M=!0;if(!M)return a.flags&65536?a:null}return a.flags&128?(a.lanes=h,a):(m=m!==null,m!==(r!==null&&r.memoizedState!==null)&&m&&(a.child.flags|=8192,a.mode&1&&(r===null||Ci.current&1?fs===0&&(fs=3):zE())),a.updateQueue!==null&&(a.flags|=4),ho(a),null);case 4:return fg(),pS(r,a),r===null&&O0(a.stateNode.containerInfo),ho(a),null;case 10:return gE(a.type._context),ho(a),null;case 17:return ua(a.type)&&Wv(),ho(a),null;case 19:if(di(Ci),M=a.memoizedState,M===null)return ho(a),null;if(m=(a.flags&128)!==0,P=M.rendering,P===null)if(m)o0(M,!1);else{if(fs!==0||r!==null&&r.flags&128)for(r=a.child;r!==null;){if(P=Kv(r),P!==null){for(a.flags|=128,o0(M,!1),m=P.updateQueue,m!==null&&(a.updateQueue=m,a.flags|=4),a.subtreeFlags=0,m=h,h=a.child;h!==null;)M=h,r=m,M.flags&=14680066,P=M.alternate,P===null?(M.childLanes=0,M.lanes=r,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=P.childLanes,M.lanes=P.lanes,M.child=P.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=P.memoizedProps,M.memoizedState=P.memoizedState,M.updateQueue=P.updateQueue,M.type=P.type,r=P.dependencies,M.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),h=h.sibling;return si(Ci,Ci.current&1|2),a.child}r=r.sibling}M.tail!==null&&Xi()>mg&&(a.flags|=128,m=!0,o0(M,!1),a.lanes=4194304)}else{if(!m)if(r=Kv(P),r!==null){if(a.flags|=128,m=!0,h=r.updateQueue,h!==null&&(a.updateQueue=h,a.flags|=4),o0(M,!0),M.tail===null&&M.tailMode==="hidden"&&!P.alternate&&!vi)return ho(a),null}else 2*Xi()-M.renderingStartTime>mg&&h!==1073741824&&(a.flags|=128,m=!0,o0(M,!1),a.lanes=4194304);M.isBackwards?(P.sibling=a.child,a.child=P):(h=M.last,h!==null?h.sibling=P:a.child=P,M.last=P)}return M.tail!==null?(a=M.tail,M.rendering=a,M.tail=a.sibling,M.renderingStartTime=Xi(),a.sibling=null,h=Ci.current,si(Ci,m?h&1|2:h&1),a):(ho(a),null);case 22:case 23:return DE(),m=a.memoizedState!==null,r!==null&&r.memoizedState!==null!==m&&(a.flags|=8192),m&&a.mode&1?Oa&1073741824&&(ho(a),a.subtreeFlags&6&&(a.flags|=8192)):ho(a),null;case 24:return null;case 25:return null}throw Error(Nt(156,a.tag))}function xB(r,a){switch(fE(a),a.tag){case 1:return ua(a.type)&&Wv(),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return fg(),di(la),di(yo),bE(),r=a.flags,r&65536&&!(r&128)?(a.flags=r&-65537|128,a):null;case 5:return wE(a),null;case 13:if(di(Ci),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(Nt(340));hg()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return di(Ci),null;case 4:return fg(),null;case 10:return gE(a.type._context),null;case 22:case 23:return DE(),null;case 24:return null;default:return null}}var cv=!1,mo=!1,vB=typeof WeakSet=="function"?WeakSet:Set,an=null;function K_(r,a){var h=r.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(m){Vi(r,a,m)}else h.current=null}function mS(r,a,h){try{h()}catch(m){Vi(r,a,m)}}var cI=!1;function wB(r,a){if(J3=Vv,r=KR(),hE(r)){if("selectionStart"in r)var h={start:r.selectionStart,end:r.selectionEnd};else e:{h=(h=r.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var b=m.anchorOffset,M=m.focusNode;m=m.focusOffset;try{h.nodeType,M.nodeType}catch{h=null;break e}var P=0,V=-1,o=-1,q=0,J=0,Q=r,ae=null;t:for(;;){for(var xe;Q!==h||b!==0&&Q.nodeType!==3||(V=P+b),Q!==M||m!==0&&Q.nodeType!==3||(o=P+m),Q.nodeType===3&&(P+=Q.nodeValue.length),(xe=Q.firstChild)!==null;)ae=Q,Q=xe;for(;;){if(Q===r)break t;if(ae===h&&++q===b&&(V=P),ae===M&&++J===m&&(o=P),(xe=Q.nextSibling)!==null)break;Q=ae,ae=Q.parentNode}Q=xe}h=V===-1||o===-1?null:{start:V,end:o}}else h=null}h=h||{start:0,end:0}}else h=null;for(Q3={focusedElem:r,selectionRange:h},Vv=!1,an=a;an!==null;)if(a=an,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,an=r;else for(;an!==null;){a=an;try{var Re=a.alternate;if(a.flags&1024)switch(a.tag){case 0:case 11:case 15:break;case 1:if(Re!==null){var Ue=Re.memoizedProps,Tt=Re.memoizedState,Te=a.stateNode,Ee=Te.getSnapshotBeforeUpdate(a.elementType===a.type?Ue:Su(a.type,Ue),Tt);Te.__reactInternalSnapshotBeforeUpdate=Ee}break;case 3:var Me=a.stateNode.containerInfo;Me.nodeType===1?Me.textContent="":Me.nodeType===9&&Me.documentElement&&Me.removeChild(Me.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Nt(163))}}catch(et){Vi(a,a.return,et)}if(r=a.sibling,r!==null){r.return=a.return,an=r;break}an=a.return}return Re=cI,cI=!1,Re}function w0(r,a,h){var m=a.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var b=m=m.next;do{if((b.tag&r)===r){var M=b.destroy;b.destroy=void 0,M!==void 0&&mS(a,h,M)}b=b.next}while(b!==m)}}function Sw(r,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var h=a=a.next;do{if((h.tag&r)===r){var m=h.create;h.destroy=m()}h=h.next}while(h!==a)}}function _S(r){var a=r.ref;if(a!==null){var h=r.stateNode;switch(r.tag){case 5:r=h;break;default:r=h}typeof a=="function"?a(r):a.current=r}}function HL(r){var a=r.alternate;a!==null&&(r.alternate=null,HL(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&(delete a[Wc],delete a[F0],delete a[nS],delete a[rB],delete a[iB])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function ZL(r){return r.tag===5||r.tag===3||r.tag===4}function hI(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||ZL(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function gS(r,a,h){var m=r.tag;if(m===5||m===6)r=r.stateNode,a?h.nodeType===8?h.parentNode.insertBefore(r,a):h.insertBefore(r,a):(h.nodeType===8?(a=h.parentNode,a.insertBefore(r,h)):(a=h,a.appendChild(r)),h=h._reactRootContainer,h!=null||a.onclick!==null||(a.onclick=Gv));else if(m!==4&&(r=r.child,r!==null))for(gS(r,a,h),r=r.sibling;r!==null;)gS(r,a,h),r=r.sibling}function yS(r,a,h){var m=r.tag;if(m===5||m===6)r=r.stateNode,a?h.insertBefore(r,a):h.appendChild(r);else if(m!==4&&(r=r.child,r!==null))for(yS(r,a,h),r=r.sibling;r!==null;)yS(r,a,h),r=r.sibling}var Hs=null,Eu=!1;function Cf(r,a,h){for(h=h.child;h!==null;)XL(r,a,h),h=h.sibling}function XL(r,a,h){if(qc&&typeof qc.onCommitFiberUnmount=="function")try{qc.onCommitFiberUnmount(_w,h)}catch{}switch(h.tag){case 5:mo||K_(h,a);case 6:var m=Hs,b=Eu;Hs=null,Cf(r,a,h),Hs=m,Eu=b,Hs!==null&&(Eu?(r=Hs,h=h.stateNode,r.nodeType===8?r.parentNode.removeChild(h):r.removeChild(h)):Hs.removeChild(h.stateNode));break;case 18:Hs!==null&&(Eu?(r=Hs,h=h.stateNode,r.nodeType===8?n3(r.parentNode,h):r.nodeType===1&&n3(r,h),D0(r)):n3(Hs,h.stateNode));break;case 4:m=Hs,b=Eu,Hs=h.stateNode.containerInfo,Eu=!0,Cf(r,a,h),Hs=m,Eu=b;break;case 0:case 11:case 14:case 15:if(!mo&&(m=h.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){b=m=m.next;do{var M=b,P=M.destroy;M=M.tag,P!==void 0&&(M&2||M&4)&&mS(h,a,P),b=b.next}while(b!==m)}Cf(r,a,h);break;case 1:if(!mo&&(K_(h,a),m=h.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=h.memoizedProps,m.state=h.memoizedState,m.componentWillUnmount()}catch(V){Vi(h,a,V)}Cf(r,a,h);break;case 21:Cf(r,a,h);break;case 22:h.mode&1?(mo=(m=mo)||h.memoizedState!==null,Cf(r,a,h),mo=m):Cf(r,a,h);break;default:Cf(r,a,h)}}function dI(r){var a=r.updateQueue;if(a!==null){r.updateQueue=null;var h=r.stateNode;h===null&&(h=r.stateNode=new vB),a.forEach(function(m){var b=PB.bind(null,r,m);h.has(m)||(h.add(m),m.then(b,b))})}}function Tu(r,a){var h=a.deletions;if(h!==null)for(var m=0;m<h.length;m++){var b=h[m];try{var M=r,P=a,V=P;e:for(;V!==null;){switch(V.tag){case 5:Hs=V.stateNode,Eu=!1;break e;case 3:Hs=V.stateNode.containerInfo,Eu=!0;break e;case 4:Hs=V.stateNode.containerInfo,Eu=!0;break e}V=V.return}if(Hs===null)throw Error(Nt(160));XL(M,P,b),Hs=null,Eu=!1;var o=b.alternate;o!==null&&(o.return=null),b.return=null}catch(q){Vi(b,a,q)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)YL(a,r),a=a.sibling}function YL(r,a){var h=r.alternate,m=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Tu(a,r),jc(r),m&4){try{w0(3,r,r.return),Sw(3,r)}catch(Ue){Vi(r,r.return,Ue)}try{w0(5,r,r.return)}catch(Ue){Vi(r,r.return,Ue)}}break;case 1:Tu(a,r),jc(r),m&512&&h!==null&&K_(h,h.return);break;case 5:if(Tu(a,r),jc(r),m&512&&h!==null&&K_(h,h.return),r.flags&32){var b=r.stateNode;try{I0(b,"")}catch(Ue){Vi(r,r.return,Ue)}}if(m&4&&(b=r.stateNode,b!=null)){var M=r.memoizedProps,P=h!==null?h.memoizedProps:M,V=r.type,o=r.updateQueue;if(r.updateQueue=null,o!==null)try{V==="input"&&M.type==="radio"&&M.name!=null&&yR(b,M),j3(V,P);var q=j3(V,M);for(P=0;P<o.length;P+=2){var J=o[P],Q=o[P+1];J==="style"?TR(b,Q):J==="dangerouslySetInnerHTML"?wR(b,Q):J==="children"?I0(b,Q):JS(b,J,Q,q)}switch(V){case"input":B3(b,M);break;case"textarea":xR(b,M);break;case"select":var ae=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!M.multiple;var xe=M.value;xe!=null?rg(b,!!M.multiple,xe,!1):ae!==!!M.multiple&&(M.defaultValue!=null?rg(b,!!M.multiple,M.defaultValue,!0):rg(b,!!M.multiple,M.multiple?[]:"",!1))}b[F0]=M}catch(Ue){Vi(r,r.return,Ue)}}break;case 6:if(Tu(a,r),jc(r),m&4){if(r.stateNode===null)throw Error(Nt(162));b=r.stateNode,M=r.memoizedProps;try{b.nodeValue=M}catch(Ue){Vi(r,r.return,Ue)}}break;case 3:if(Tu(a,r),jc(r),m&4&&h!==null&&h.memoizedState.isDehydrated)try{D0(a.containerInfo)}catch(Ue){Vi(r,r.return,Ue)}break;case 4:Tu(a,r),jc(r);break;case 13:Tu(a,r),jc(r),b=r.child,b.flags&8192&&(M=b.memoizedState!==null,b.stateNode.isHidden=M,!M||b.alternate!==null&&b.alternate.memoizedState!==null||(RE=Xi())),m&4&&dI(r);break;case 22:if(J=h!==null&&h.memoizedState!==null,r.mode&1?(mo=(q=mo)||J,Tu(a,r),mo=q):Tu(a,r),jc(r),m&8192){if(q=r.memoizedState!==null,(r.stateNode.isHidden=q)&&!J&&r.mode&1)for(an=r,J=r.child;J!==null;){for(Q=an=J;an!==null;){switch(ae=an,xe=ae.child,ae.tag){case 0:case 11:case 14:case 15:w0(4,ae,ae.return);break;case 1:K_(ae,ae.return);var Re=ae.stateNode;if(typeof Re.componentWillUnmount=="function"){m=ae,h=ae.return;try{a=m,Re.props=a.memoizedProps,Re.state=a.memoizedState,Re.componentWillUnmount()}catch(Ue){Vi(m,h,Ue)}}break;case 5:K_(ae,ae.return);break;case 22:if(ae.memoizedState!==null){pI(Q);continue}}xe!==null?(xe.return=ae,an=xe):pI(Q)}J=J.sibling}e:for(J=null,Q=r;;){if(Q.tag===5){if(J===null){J=Q;try{b=Q.stateNode,q?(M=b.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none"):(V=Q.stateNode,o=Q.memoizedProps.style,P=o!=null&&o.hasOwnProperty("display")?o.display:null,V.style.display=bR("display",P))}catch(Ue){Vi(r,r.return,Ue)}}}else if(Q.tag===6){if(J===null)try{Q.stateNode.nodeValue=q?"":Q.memoizedProps}catch(Ue){Vi(r,r.return,Ue)}}else if((Q.tag!==22&&Q.tag!==23||Q.memoizedState===null||Q===r)&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===r)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===r)break e;J===Q&&(J=null),Q=Q.return}J===Q&&(J=null),Q.sibling.return=Q.return,Q=Q.sibling}}break;case 19:Tu(a,r),jc(r),m&4&&dI(r);break;case 21:break;default:Tu(a,r),jc(r)}}function jc(r){var a=r.flags;if(a&2){try{e:{for(var h=r.return;h!==null;){if(ZL(h)){var m=h;break e}h=h.return}throw Error(Nt(160))}switch(m.tag){case 5:var b=m.stateNode;m.flags&32&&(I0(b,""),m.flags&=-33);var M=hI(r);yS(r,M,b);break;case 3:case 4:var P=m.stateNode.containerInfo,V=hI(r);gS(r,V,P);break;default:throw Error(Nt(161))}}catch(o){Vi(r,r.return,o)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function bB(r,a,h){an=r,KL(r)}function KL(r,a,h){for(var m=(r.mode&1)!==0;an!==null;){var b=an,M=b.child;if(b.tag===22&&m){var P=b.memoizedState!==null||cv;if(!P){var V=b.alternate,o=V!==null&&V.memoizedState!==null||mo;V=cv;var q=mo;if(cv=P,(mo=o)&&!q)for(an=b;an!==null;)P=an,o=P.child,P.tag===22&&P.memoizedState!==null?mI(b):o!==null?(o.return=P,an=o):mI(b);for(;M!==null;)an=M,KL(M),M=M.sibling;an=b,cv=V,mo=q}fI(r)}else b.subtreeFlags&8772&&M!==null?(M.return=b,an=M):fI(r)}}function fI(r){for(;an!==null;){var a=an;if(a.flags&8772){var h=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:mo||Sw(5,a);break;case 1:var m=a.stateNode;if(a.flags&4&&!mo)if(h===null)m.componentDidMount();else{var b=a.elementType===a.type?h.memoizedProps:Su(a.type,h.memoizedProps);m.componentDidUpdate(b,h.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var M=a.updateQueue;M!==null&&KM(a,M,m);break;case 3:var P=a.updateQueue;if(P!==null){if(h=null,a.child!==null)switch(a.child.tag){case 5:h=a.child.stateNode;break;case 1:h=a.child.stateNode}KM(a,P,h)}break;case 5:var V=a.stateNode;if(h===null&&a.flags&4){h=V;var o=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":o.autoFocus&&h.focus();break;case"img":o.src&&(h.src=o.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var q=a.alternate;if(q!==null){var J=q.memoizedState;if(J!==null){var Q=J.dehydrated;Q!==null&&D0(Q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Nt(163))}mo||a.flags&512&&_S(a)}catch(ae){Vi(a,a.return,ae)}}if(a===r){an=null;break}if(h=a.sibling,h!==null){h.return=a.return,an=h;break}an=a.return}}function pI(r){for(;an!==null;){var a=an;if(a===r){an=null;break}var h=a.sibling;if(h!==null){h.return=a.return,an=h;break}an=a.return}}function mI(r){for(;an!==null;){var a=an;try{switch(a.tag){case 0:case 11:case 15:var h=a.return;try{Sw(4,a)}catch(o){Vi(a,h,o)}break;case 1:var m=a.stateNode;if(typeof m.componentDidMount=="function"){var b=a.return;try{m.componentDidMount()}catch(o){Vi(a,b,o)}}var M=a.return;try{_S(a)}catch(o){Vi(a,M,o)}break;case 5:var P=a.return;try{_S(a)}catch(o){Vi(a,P,o)}}}catch(o){Vi(a,a.return,o)}if(a===r){an=null;break}var V=a.sibling;if(V!==null){V.return=a.return,an=V;break}an=a.return}}var TB=Math.ceil,ew=dd.ReactCurrentDispatcher,IE=dd.ReactCurrentOwner,Al=dd.ReactCurrentBatchConfig,Pr=0,Rs=null,es=null,Xs=0,Oa=0,J_=Kf(0),fs=0,W0=null,Pm=0,Ew=0,PE=0,b0=null,oa=null,RE=0,mg=1/0,Kh=null,tw=!1,xS=null,Uf=null,hv=!1,kf=null,nw=0,T0=0,vS=null,Ev=-1,Cv=0;function Lo(){return Pr&6?Xi():Ev!==-1?Ev:Ev=Xi()}function jf(r){return r.mode&1?Pr&2&&Xs!==0?Xs&-Xs:oB.transition!==null?(Cv===0&&(Cv=kR()),Cv):(r=Hr,r!==0||(r=window.event,r=r===void 0?16:jR(r.type)),r):1}function Mu(r,a,h,m){if(50<T0)throw T0=0,vS=null,Error(Nt(185));J0(r,h,m),(!(Pr&2)||r!==Rs)&&(r===Rs&&(!(Pr&2)&&(Ew|=h),fs===4&&Df(r,Xs)),ca(r,m),h===1&&Pr===0&&!(a.mode&1)&&(mg=Xi()+500,ww&&Jf()))}function ca(r,a){var h=r.callbackNode;oO(r,a);var m=Nv(r,r===Rs?Xs:0);if(m===0)h!==null&&SM(h),r.callbackNode=null,r.callbackPriority=0;else if(a=m&-m,r.callbackPriority!==a){if(h!=null&&SM(h),a===1)r.tag===0?sB(_I.bind(null,r)):aL(_I.bind(null,r)),tB(function(){!(Pr&6)&&Jf()}),h=null;else{switch(OR(m)){case 1:h=rE;break;case 4:h=DR;break;case 16:h=Fv;break;case 536870912:h=zR;break;default:h=Fv}h=s4(h,JL.bind(null,r))}r.callbackPriority=a,r.callbackNode=h}}function JL(r,a){if(Ev=-1,Cv=0,Pr&6)throw Error(Nt(327));var h=r.callbackNode;if(lg()&&r.callbackNode!==h)return null;var m=Nv(r,r===Rs?Xs:0);if(m===0)return null;if(m&30||m&r.expiredLanes||a)a=rw(r,m);else{a=m;var b=Pr;Pr|=2;var M=e4();(Rs!==r||Xs!==a)&&(Kh=null,mg=Xi()+500,Tm(r,a));do try{CB();break}catch(V){QL(r,V)}while(!0);_E(),ew.current=M,Pr=b,es!==null?a=0:(Rs=null,Xs=0,a=fs)}if(a!==0){if(a===2&&(b=H3(r),b!==0&&(m=b,a=wS(r,b))),a===1)throw h=W0,Tm(r,0),Df(r,m),ca(r,Xi()),h;if(a===6)Df(r,m);else{if(b=r.current.alternate,!(m&30)&&!SB(b)&&(a=rw(r,m),a===2&&(M=H3(r),M!==0&&(m=M,a=wS(r,M))),a===1))throw h=W0,Tm(r,0),Df(r,m),ca(r,Xi()),h;switch(r.finishedWork=b,r.finishedLanes=m,a){case 0:case 1:throw Error(Nt(345));case 2:_m(r,oa,Kh);break;case 3:if(Df(r,m),(m&130023424)===m&&(a=RE+500-Xi(),10<a)){if(Nv(r,0)!==0)break;if(b=r.suspendedLanes,(b&m)!==m){Lo(),r.pingedLanes|=r.suspendedLanes&b;break}r.timeoutHandle=tS(_m.bind(null,r,oa,Kh),a);break}_m(r,oa,Kh);break;case 4:if(Df(r,m),(m&4194240)===m)break;for(a=r.eventTimes,b=-1;0<m;){var P=31-Au(m);M=1<<P,P=a[P],P>b&&(b=P),m&=~M}if(m=b,m=Xi()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*TB(m/1960))-m,10<m){r.timeoutHandle=tS(_m.bind(null,r,oa,Kh),m);break}_m(r,oa,Kh);break;case 5:_m(r,oa,Kh);break;default:throw Error(Nt(329))}}}return ca(r,Xi()),r.callbackNode===h?JL.bind(null,r):null}function wS(r,a){var h=b0;return r.current.memoizedState.isDehydrated&&(Tm(r,a).flags|=256),r=rw(r,a),r!==2&&(a=oa,oa=h,a!==null&&bS(a)),r}function bS(r){oa===null?oa=r:oa.push.apply(oa,r)}function SB(r){for(var a=r;;){if(a.flags&16384){var h=a.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var m=0;m<h.length;m++){var b=h[m],M=b.getSnapshot;b=b.value;try{if(!Pu(M(),b))return!1}catch{return!1}}}if(h=a.child,a.subtreeFlags&16384&&h!==null)h.return=a,a=h;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Df(r,a){for(a&=~PE,a&=~Ew,r.suspendedLanes|=a,r.pingedLanes&=~a,r=r.expirationTimes;0<a;){var h=31-Au(a),m=1<<h;r[h]=-1,a&=~m}}function _I(r){if(Pr&6)throw Error(Nt(327));lg();var a=Nv(r,0);if(!(a&1))return ca(r,Xi()),null;var h=rw(r,a);if(r.tag!==0&&h===2){var m=H3(r);m!==0&&(a=m,h=wS(r,m))}if(h===1)throw h=W0,Tm(r,0),Df(r,a),ca(r,Xi()),h;if(h===6)throw Error(Nt(345));return r.finishedWork=r.current.alternate,r.finishedLanes=a,_m(r,oa,Kh),ca(r,Xi()),null}function LE(r,a){var h=Pr;Pr|=1;try{return r(a)}finally{Pr=h,Pr===0&&(mg=Xi()+500,ww&&Jf())}}function Rm(r){kf!==null&&kf.tag===0&&!(Pr&6)&&lg();var a=Pr;Pr|=1;var h=Al.transition,m=Hr;try{if(Al.transition=null,Hr=1,r)return r()}finally{Hr=m,Al.transition=h,Pr=a,!(Pr&6)&&Jf()}}function DE(){Oa=J_.current,di(J_)}function Tm(r,a){r.finishedWork=null,r.finishedLanes=0;var h=r.timeoutHandle;if(h!==-1&&(r.timeoutHandle=-1,eB(h)),es!==null)for(h=es.return;h!==null;){var m=h;switch(fE(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&Wv();break;case 3:fg(),di(la),di(yo),bE();break;case 5:wE(m);break;case 4:fg();break;case 13:di(Ci);break;case 19:di(Ci);break;case 10:gE(m.type._context);break;case 22:case 23:DE()}h=h.return}if(Rs=r,es=r=Gf(r.current,null),Xs=Oa=a,fs=0,W0=null,PE=Ew=Pm=0,oa=b0=null,vm!==null){for(a=0;a<vm.length;a++)if(h=vm[a],m=h.interleaved,m!==null){h.interleaved=null;var b=m.next,M=h.pending;if(M!==null){var P=M.next;M.next=b,m.next=P}h.pending=m}vm=null}return r}function QL(r,a){do{var h=es;try{if(_E(),bv.current=Qv,Jv){for(var m=Mi.memoizedState;m!==null;){var b=m.queue;b!==null&&(b.pending=null),m=m.next}Jv=!1}if(Im=0,Ps=ds=Mi=null,v0=!1,U0=0,IE.current=null,h===null||h.return===null){fs=1,W0=a,es=null;break}e:{var M=r,P=h.return,V=h,o=a;if(a=Xs,V.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){var q=o,J=V,Q=J.tag;if(!(J.mode&1)&&(Q===0||Q===11||Q===15)){var ae=J.alternate;ae?(J.updateQueue=ae.updateQueue,J.memoizedState=ae.memoizedState,J.lanes=ae.lanes):(J.updateQueue=null,J.memoizedState=null)}var xe=rI(P);if(xe!==null){xe.flags&=-257,iI(xe,P,V,M,a),xe.mode&1&&nI(M,q,a),a=xe,o=q;var Re=a.updateQueue;if(Re===null){var Ue=new Set;Ue.add(o),a.updateQueue=Ue}else Re.add(o);break e}else{if(!(a&1)){nI(M,q,a),zE();break e}o=Error(Nt(426))}}else if(vi&&V.mode&1){var Tt=rI(P);if(Tt!==null){!(Tt.flags&65536)&&(Tt.flags|=256),iI(Tt,P,V,M,a),pE(pg(o,V));break e}}M=o=pg(o,V),fs!==4&&(fs=2),b0===null?b0=[M]:b0.push(M),M=P;do{switch(M.tag){case 3:M.flags|=65536,a&=-a,M.lanes|=a;var Te=OL(M,o,a);YM(M,Te);break e;case 1:V=o;var Ee=M.type,Me=M.stateNode;if(!(M.flags&128)&&(typeof Ee.getDerivedStateFromError=="function"||Me!==null&&typeof Me.componentDidCatch=="function"&&(Uf===null||!Uf.has(Me)))){M.flags|=65536,a&=-a,M.lanes|=a;var et=BL(M,V,a);YM(M,et);break e}}M=M.return}while(M!==null)}n4(h)}catch(pt){a=pt,es===h&&h!==null&&(es=h=h.return);continue}break}while(!0)}function e4(){var r=ew.current;return ew.current=Qv,r===null?Qv:r}function zE(){(fs===0||fs===3||fs===2)&&(fs=4),Rs===null||!(Pm&268435455)&&!(Ew&268435455)||Df(Rs,Xs)}function rw(r,a){var h=Pr;Pr|=2;var m=e4();(Rs!==r||Xs!==a)&&(Kh=null,Tm(r,a));do try{EB();break}catch(b){QL(r,b)}while(!0);if(_E(),Pr=h,ew.current=m,es!==null)throw Error(Nt(261));return Rs=null,Xs=0,fs}function EB(){for(;es!==null;)t4(es)}function CB(){for(;es!==null&&!Kk();)t4(es)}function t4(r){var a=i4(r.alternate,r,Oa);r.memoizedProps=r.pendingProps,a===null?n4(r):es=a,IE.current=null}function n4(r){var a=r;do{var h=a.alternate;if(r=a.return,a.flags&32768){if(h=xB(h,a),h!==null){h.flags&=32767,es=h;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{fs=6,es=null;return}}else if(h=yB(h,a,Oa),h!==null){es=h;return}if(a=a.sibling,a!==null){es=a;return}es=a=r}while(a!==null);fs===0&&(fs=5)}function _m(r,a,h){var m=Hr,b=Al.transition;try{Al.transition=null,Hr=1,AB(r,a,h,m)}finally{Al.transition=b,Hr=m}return null}function AB(r,a,h,m){do lg();while(kf!==null);if(Pr&6)throw Error(Nt(327));h=r.finishedWork;var b=r.finishedLanes;if(h===null)return null;if(r.finishedWork=null,r.finishedLanes=0,h===r.current)throw Error(Nt(177));r.callbackNode=null,r.callbackPriority=0;var M=h.lanes|h.childLanes;if(aO(r,M),r===Rs&&(es=Rs=null,Xs=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||hv||(hv=!0,s4(Fv,function(){return lg(),null})),M=(h.flags&15990)!==0,h.subtreeFlags&15990||M){M=Al.transition,Al.transition=null;var P=Hr;Hr=1;var V=Pr;Pr|=4,IE.current=null,wB(r,h),YL(h,r),HO(Q3),Vv=!!J3,Q3=J3=null,r.current=h,bB(h),Jk(),Pr=V,Hr=P,Al.transition=M}else r.current=h;if(hv&&(hv=!1,kf=r,nw=b),M=r.pendingLanes,M===0&&(Uf=null),tO(h.stateNode),ca(r,Xi()),a!==null)for(m=r.onRecoverableError,h=0;h<a.length;h++)b=a[h],m(b.value,{componentStack:b.stack,digest:b.digest});if(tw)throw tw=!1,r=xS,xS=null,r;return nw&1&&r.tag!==0&&lg(),M=r.pendingLanes,M&1?r===vS?T0++:(T0=0,vS=r):T0=0,Jf(),null}function lg(){if(kf!==null){var r=OR(nw),a=Al.transition,h=Hr;try{if(Al.transition=null,Hr=16>r?16:r,kf===null)var m=!1;else{if(r=kf,kf=null,nw=0,Pr&6)throw Error(Nt(331));var b=Pr;for(Pr|=4,an=r.current;an!==null;){var M=an,P=M.child;if(an.flags&16){var V=M.deletions;if(V!==null){for(var o=0;o<V.length;o++){var q=V[o];for(an=q;an!==null;){var J=an;switch(J.tag){case 0:case 11:case 15:w0(8,J,M)}var Q=J.child;if(Q!==null)Q.return=J,an=Q;else for(;an!==null;){J=an;var ae=J.sibling,xe=J.return;if(HL(J),J===q){an=null;break}if(ae!==null){ae.return=xe,an=ae;break}an=xe}}}var Re=M.alternate;if(Re!==null){var Ue=Re.child;if(Ue!==null){Re.child=null;do{var Tt=Ue.sibling;Ue.sibling=null,Ue=Tt}while(Ue!==null)}}an=M}}if(M.subtreeFlags&2064&&P!==null)P.return=M,an=P;else e:for(;an!==null;){if(M=an,M.flags&2048)switch(M.tag){case 0:case 11:case 15:w0(9,M,M.return)}var Te=M.sibling;if(Te!==null){Te.return=M.return,an=Te;break e}an=M.return}}var Ee=r.current;for(an=Ee;an!==null;){P=an;var Me=P.child;if(P.subtreeFlags&2064&&Me!==null)Me.return=P,an=Me;else e:for(P=Ee;an!==null;){if(V=an,V.flags&2048)try{switch(V.tag){case 0:case 11:case 15:Sw(9,V)}}catch(pt){Vi(V,V.return,pt)}if(V===P){an=null;break e}var et=V.sibling;if(et!==null){et.return=V.return,an=et;break e}an=V.return}}if(Pr=b,Jf(),qc&&typeof qc.onPostCommitFiberRoot=="function")try{qc.onPostCommitFiberRoot(_w,r)}catch{}m=!0}return m}finally{Hr=h,Al.transition=a}}return!1}function gI(r,a,h){a=pg(h,a),a=OL(r,a,1),r=Vf(r,a,1),a=Lo(),r!==null&&(J0(r,1,a),ca(r,a))}function Vi(r,a,h){if(r.tag===3)gI(r,r,h);else for(;a!==null;){if(a.tag===3){gI(a,r,h);break}else if(a.tag===1){var m=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Uf===null||!Uf.has(m))){r=pg(h,r),r=BL(a,r,1),a=Vf(a,r,1),r=Lo(),a!==null&&(J0(a,1,r),ca(a,r));break}}a=a.return}}function MB(r,a,h){var m=r.pingCache;m!==null&&m.delete(a),a=Lo(),r.pingedLanes|=r.suspendedLanes&h,Rs===r&&(Xs&h)===h&&(fs===4||fs===3&&(Xs&130023424)===Xs&&500>Xi()-RE?Tm(r,0):PE|=h),ca(r,a)}function r4(r,a){a===0&&(r.mode&1?(a=tv,tv<<=1,!(tv&130023424)&&(tv=4194304)):a=1);var h=Lo();r=ld(r,a),r!==null&&(J0(r,a,h),ca(r,h))}function IB(r){var a=r.memoizedState,h=0;a!==null&&(h=a.retryLane),r4(r,h)}function PB(r,a){var h=0;switch(r.tag){case 13:var m=r.stateNode,b=r.memoizedState;b!==null&&(h=b.retryLane);break;case 19:m=r.stateNode;break;default:throw Error(Nt(314))}m!==null&&m.delete(a),r4(r,h)}var i4;i4=function(r,a,h){if(r!==null)if(r.memoizedProps!==a.pendingProps||la.current)aa=!0;else{if(!(r.lanes&h)&&!(a.flags&128))return aa=!1,gB(r,a,h);aa=!!(r.flags&131072)}else aa=!1,vi&&a.flags&1048576&&lL(a,Hv,a.index);switch(a.lanes=0,a.tag){case 2:var m=a.type;Sv(r,a),r=a.pendingProps;var b=cg(a,yo.current);ag(a,h),b=SE(null,a,m,r,b,h);var M=EE();return a.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,ua(m)?(M=!0,$v(a)):M=!1,a.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,xE(a),b.updater=Tw,a.stateNode=b,b._reactInternals=a,lS(a,m,r,h),a=hS(null,a,m,!0,M,h)):(a.tag=0,vi&&M&&dE(a),Ro(null,a,b,h),a=a.child),a;case 16:m=a.elementType;e:{switch(Sv(r,a),r=a.pendingProps,b=m._init,m=b(m._payload),a.type=m,b=a.tag=LB(m),r=Su(m,r),b){case 0:a=cS(null,a,m,r,h);break e;case 1:a=aI(null,a,m,r,h);break e;case 11:a=sI(null,a,m,r,h);break e;case 14:a=oI(null,a,m,Su(m.type,r),h);break e}throw Error(Nt(306,m,""))}return a;case 0:return m=a.type,b=a.pendingProps,b=a.elementType===m?b:Su(m,b),cS(r,a,m,b,h);case 1:return m=a.type,b=a.pendingProps,b=a.elementType===m?b:Su(m,b),aI(r,a,m,b,h);case 3:e:{if(UL(a),r===null)throw Error(Nt(387));m=a.pendingProps,M=a.memoizedState,b=M.element,pL(r,a),Yv(a,m,null,h);var P=a.memoizedState;if(m=P.element,M.isDehydrated)if(M={element:m,isDehydrated:!1,cache:P.cache,pendingSuspenseBoundaries:P.pendingSuspenseBoundaries,transitions:P.transitions},a.updateQueue.baseState=M,a.memoizedState=M,a.flags&256){b=pg(Error(Nt(423)),a),a=lI(r,a,m,h,b);break e}else if(m!==b){b=pg(Error(Nt(424)),a),a=lI(r,a,m,h,b);break e}else for(Ba=Nf(a.stateNode.containerInfo.firstChild),Fa=a,vi=!0,Cu=null,h=dL(a,null,m,h),a.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(hg(),m===b){a=ud(r,a,h);break e}Ro(r,a,m,h)}a=a.child}return a;case 5:return mL(a),r===null&&sS(a),m=a.type,b=a.pendingProps,M=r!==null?r.memoizedProps:null,P=b.children,eS(m,b)?P=null:M!==null&&eS(m,M)&&(a.flags|=32),VL(r,a),Ro(r,a,P,h),a.child;case 6:return r===null&&sS(a),null;case 13:return jL(r,a,h);case 4:return vE(a,a.stateNode.containerInfo),m=a.pendingProps,r===null?a.child=dg(a,null,m,h):Ro(r,a,m,h),a.child;case 11:return m=a.type,b=a.pendingProps,b=a.elementType===m?b:Su(m,b),sI(r,a,m,b,h);case 7:return Ro(r,a,a.pendingProps,h),a.child;case 8:return Ro(r,a,a.pendingProps.children,h),a.child;case 12:return Ro(r,a,a.pendingProps.children,h),a.child;case 10:e:{if(m=a.type._context,b=a.pendingProps,M=a.memoizedProps,P=b.value,si(Zv,m._currentValue),m._currentValue=P,M!==null)if(Pu(M.value,P)){if(M.children===b.children&&!la.current){a=ud(r,a,h);break e}}else for(M=a.child,M!==null&&(M.return=a);M!==null;){var V=M.dependencies;if(V!==null){P=M.child;for(var o=V.firstContext;o!==null;){if(o.context===m){if(M.tag===1){o=nd(-1,h&-h),o.tag=2;var q=M.updateQueue;if(q!==null){q=q.shared;var J=q.pending;J===null?o.next=o:(o.next=J.next,J.next=o),q.pending=o}}M.lanes|=h,o=M.alternate,o!==null&&(o.lanes|=h),oS(M.return,h,a),V.lanes|=h;break}o=o.next}}else if(M.tag===10)P=M.type===a.type?null:M.child;else if(M.tag===18){if(P=M.return,P===null)throw Error(Nt(341));P.lanes|=h,V=P.alternate,V!==null&&(V.lanes|=h),oS(P,h,a),P=M.sibling}else P=M.child;if(P!==null)P.return=M;else for(P=M;P!==null;){if(P===a){P=null;break}if(M=P.sibling,M!==null){M.return=P.return,P=M;break}P=P.return}M=P}Ro(r,a,b.children,h),a=a.child}return a;case 9:return b=a.type,m=a.pendingProps.children,ag(a,h),b=Il(b),m=m(b),a.flags|=1,Ro(r,a,m,h),a.child;case 14:return m=a.type,b=Su(m,a.pendingProps),b=Su(m.type,b),oI(r,a,m,b,h);case 15:return FL(r,a,a.type,a.pendingProps,h);case 17:return m=a.type,b=a.pendingProps,b=a.elementType===m?b:Su(m,b),Sv(r,a),a.tag=1,ua(m)?(r=!0,$v(a)):r=!1,ag(a,h),kL(a,m,b),lS(a,m,b,h),hS(null,a,m,!0,r,h);case 19:return GL(r,a,h);case 22:return NL(r,a,h)}throw Error(Nt(156,a.tag))};function s4(r,a){return LR(r,a)}function RB(r,a,h,m){this.tag=r,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cl(r,a,h,m){return new RB(r,a,h,m)}function kE(r){return r=r.prototype,!(!r||!r.isReactComponent)}function LB(r){if(typeof r=="function")return kE(r)?1:0;if(r!=null){if(r=r.$$typeof,r===eE)return 11;if(r===tE)return 14}return 2}function Gf(r,a){var h=r.alternate;return h===null?(h=Cl(r.tag,a,r.key,r.mode),h.elementType=r.elementType,h.type=r.type,h.stateNode=r.stateNode,h.alternate=r,r.alternate=h):(h.pendingProps=a,h.type=r.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=r.flags&14680064,h.childLanes=r.childLanes,h.lanes=r.lanes,h.child=r.child,h.memoizedProps=r.memoizedProps,h.memoizedState=r.memoizedState,h.updateQueue=r.updateQueue,a=r.dependencies,h.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},h.sibling=r.sibling,h.index=r.index,h.ref=r.ref,h}function Av(r,a,h,m,b,M){var P=2;if(m=r,typeof r=="function")kE(r)&&(P=1);else if(typeof r=="string")P=5;else e:switch(r){case j_:return Sm(h.children,b,M,a);case QS:P=8,b|=8;break;case L3:return r=Cl(12,h,a,b|2),r.elementType=L3,r.lanes=M,r;case D3:return r=Cl(13,h,a,b),r.elementType=D3,r.lanes=M,r;case z3:return r=Cl(19,h,a,b),r.elementType=z3,r.lanes=M,r;case mR:return Cw(h,b,M,a);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case fR:P=10;break e;case pR:P=9;break e;case eE:P=11;break e;case tE:P=14;break e;case If:P=16,m=null;break e}throw Error(Nt(130,r==null?r:typeof r,""))}return a=Cl(P,h,a,b),a.elementType=r,a.type=m,a.lanes=M,a}function Sm(r,a,h,m){return r=Cl(7,r,m,a),r.lanes=h,r}function Cw(r,a,h,m){return r=Cl(22,r,m,a),r.elementType=mR,r.lanes=h,r.stateNode={isHidden:!1},r}function c3(r,a,h){return r=Cl(6,r,null,a),r.lanes=h,r}function h3(r,a,h){return a=Cl(4,r.children!==null?r.children:[],r.key,a),a.lanes=h,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}function DB(r,a,h,m,b){this.tag=a,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$T(0),this.expirationTimes=$T(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$T(0),this.identifierPrefix=m,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function OE(r,a,h,m,b,M,P,V,o){return r=new DB(r,a,h,V,o),a===1?(a=1,M===!0&&(a|=8)):a=0,M=Cl(3,null,null,a),r.current=M,M.stateNode=r,M.memoizedState={element:m,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},xE(M),r}function zB(r,a,h){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:U_,key:m==null?null:""+m,children:r,containerInfo:a,implementation:h}}function o4(r){if(!r)return Hf;r=r._reactInternals;e:{if(zm(r)!==r||r.tag!==1)throw Error(Nt(170));var a=r;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(ua(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(Nt(171))}if(r.tag===1){var h=r.type;if(ua(h))return oL(r,h,a)}return a}function a4(r,a,h,m,b,M,P,V,o){return r=OE(h,m,!0,r,b,M,P,V,o),r.context=o4(null),h=r.current,m=Lo(),b=jf(h),M=nd(m,b),M.callback=a??null,Vf(h,M,b),r.current.lanes=b,J0(r,b,m),ca(r,m),r}function Aw(r,a,h,m){var b=a.current,M=Lo(),P=jf(b);return h=o4(h),a.context===null?a.context=h:a.pendingContext=h,a=nd(M,P),a.payload={element:r},m=m===void 0?null:m,m!==null&&(a.callback=m),r=Vf(b,a,P),r!==null&&(Mu(r,b,P,M),wv(r,b,P)),P}function iw(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function yI(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var h=r.retryLane;r.retryLane=h!==0&&h<a?h:a}}function BE(r,a){yI(r,a),(r=r.alternate)&&yI(r,a)}function kB(){return null}var l4=typeof reportError=="function"?reportError:function(r){console.error(r)};function FE(r){this._internalRoot=r}Mw.prototype.render=FE.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(Nt(409));Aw(r,a,null,null)};Mw.prototype.unmount=FE.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;Rm(function(){Aw(null,r,null,null)}),a[ad]=null}};function Mw(r){this._internalRoot=r}Mw.prototype.unstable_scheduleHydration=function(r){if(r){var a=NR();r={blockedOn:null,target:r,priority:a};for(var h=0;h<Lf.length&&a!==0&&a<Lf[h].priority;h++);Lf.splice(h,0,r),h===0&&UR(r)}};function NE(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Iw(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function xI(){}function OB(r,a,h,m,b){if(b){if(typeof m=="function"){var M=m;m=function(){var q=iw(P);M.call(q)}}var P=a4(a,m,r,0,null,!1,!1,"",xI);return r._reactRootContainer=P,r[ad]=P.current,O0(r.nodeType===8?r.parentNode:r),Rm(),P}for(;b=r.lastChild;)r.removeChild(b);if(typeof m=="function"){var V=m;m=function(){var q=iw(o);V.call(q)}}var o=OE(r,0,!1,null,null,!1,!1,"",xI);return r._reactRootContainer=o,r[ad]=o.current,O0(r.nodeType===8?r.parentNode:r),Rm(function(){Aw(a,o,h,m)}),o}function Pw(r,a,h,m,b){var M=h._reactRootContainer;if(M){var P=M;if(typeof b=="function"){var V=b;b=function(){var o=iw(P);V.call(o)}}Aw(a,P,r,b)}else P=OB(h,a,r,b,m);return iw(P)}BR=function(r){switch(r.tag){case 3:var a=r.stateNode;if(a.current.memoizedState.isDehydrated){var h=d0(a.pendingLanes);h!==0&&(iE(a,h|1),ca(a,Xi()),!(Pr&6)&&(mg=Xi()+500,Jf()))}break;case 13:Rm(function(){var m=ld(r,1);if(m!==null){var b=Lo();Mu(m,r,1,b)}}),BE(r,1)}};sE=function(r){if(r.tag===13){var a=ld(r,134217728);if(a!==null){var h=Lo();Mu(a,r,134217728,h)}BE(r,134217728)}};FR=function(r){if(r.tag===13){var a=jf(r),h=ld(r,a);if(h!==null){var m=Lo();Mu(h,r,a,m)}BE(r,a)}};NR=function(){return Hr};VR=function(r,a){var h=Hr;try{return Hr=r,a()}finally{Hr=h}};W3=function(r,a,h){switch(a){case"input":if(B3(r,h),a=h.name,h.type==="radio"&&a!=null){for(h=r;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<h.length;a++){var m=h[a];if(m!==r&&m.form===r.form){var b=vw(m);if(!b)throw Error(Nt(90));gR(m),B3(m,b)}}}break;case"textarea":xR(r,h);break;case"select":a=h.value,a!=null&&rg(r,!!h.multiple,a,!1)}};CR=LE;AR=Rm;var BB={usingClientEntryPoint:!1,Events:[ex,q_,vw,SR,ER,LE]},a0={findFiberByHostInstance:xm,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},FB={bundleType:a0.bundleType,version:a0.version,rendererPackageName:a0.rendererPackageName,rendererConfig:a0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:dd.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=PR(r),r===null?null:r.stateNode},findFiberByHostInstance:a0.findFiberByHostInstance||kB,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dv.isDisabled&&dv.supportsFiber)try{_w=dv.inject(FB),qc=dv}catch{}}Ua.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BB;Ua.createPortal=function(r,a){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!NE(a))throw Error(Nt(200));return zB(r,a,null,h)};Ua.createRoot=function(r,a){if(!NE(r))throw Error(Nt(299));var h=!1,m="",b=l4;return a!=null&&(a.unstable_strictMode===!0&&(h=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onRecoverableError!==void 0&&(b=a.onRecoverableError)),a=OE(r,1,!1,null,null,h,!1,m,b),r[ad]=a.current,O0(r.nodeType===8?r.parentNode:r),new FE(a)};Ua.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(Nt(188)):(r=Object.keys(r).join(","),Error(Nt(268,r)));return r=PR(a),r=r===null?null:r.stateNode,r};Ua.flushSync=function(r){return Rm(r)};Ua.hydrate=function(r,a,h){if(!Iw(a))throw Error(Nt(200));return Pw(null,r,a,!0,h)};Ua.hydrateRoot=function(r,a,h){if(!NE(r))throw Error(Nt(405));var m=h!=null&&h.hydratedSources||null,b=!1,M="",P=l4;if(h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(M=h.identifierPrefix),h.onRecoverableError!==void 0&&(P=h.onRecoverableError)),a=a4(a,null,r,1,h??null,b,!1,M,P),r[ad]=a.current,O0(r),m)for(r=0;r<m.length;r++)h=m[r],b=h._getVersion,b=b(h._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[h,b]:a.mutableSourceEagerHydrationData.push(h,b);return new Mw(a)};Ua.render=function(r,a,h){if(!Iw(a))throw Error(Nt(200));return Pw(null,r,a,!1,h)};Ua.unmountComponentAtNode=function(r){if(!Iw(r))throw Error(Nt(40));return r._reactRootContainer?(Rm(function(){Pw(null,null,r,!1,function(){r._reactRootContainer=null,r[ad]=null})}),!0):!1};Ua.unstable_batchedUpdates=LE;Ua.unstable_renderSubtreeIntoContainer=function(r,a,h,m){if(!Iw(h))throw Error(Nt(200));if(r==null||r._reactInternals===void 0)throw Error(Nt(38));return Pw(r,a,h,!1,m)};Ua.version="18.3.1-next-f1338f8080-20240426";function u4(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u4)}catch(r){console.error(r)}}u4(),uR.exports=Ua;var NB=uR.exports,c4,vI=NB;c4=P3.createRoot=vI.createRoot,P3.hydrateRoot=vI.hydrateRoot;function h4(r){var a,h,m="";if(typeof r=="string"||typeof r=="number")m+=r;else if(typeof r=="object")if(Array.isArray(r)){var b=r.length;for(a=0;a<b;a++)r[a]&&(h=h4(r[a]))&&(m&&(m+=" "),m+=h)}else for(h in r)r[h]&&(m&&(m+=" "),m+=h);return m}function cd(){for(var r,a,h=0,m="",b=arguments.length;h<b;h++)(r=arguments[h])&&(a=h4(r))&&(m&&(m+=" "),m+=a);return m}var VB={VITE_API_ENDPOINT_DEV:"http://localhost:8080",VITE_API_ENDPOINT_PROD:"https://lionfish-app-ndao4.ondigitalocean.app",VITE_MAPBOX_PUBLIC_TOKEN:"pk.eyJ1IjoibnZpY3RvcnkiLCJhIjoiY2xlNjJteTNsMGlyMzNybXIwcXQ5a2I5MSJ9.Limj9aCaV0bMS53BQlTq7A",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const wI=r=>{let a;const h=new Set,m=(J,Q)=>{const ae=typeof J=="function"?J(a):J;if(!Object.is(ae,a)){const xe=a;a=Q??(typeof ae!="object"||ae===null)?ae:Object.assign({},a,ae),h.forEach(Re=>Re(a,xe))}},b=()=>a,o={setState:m,getState:b,getInitialState:()=>q,subscribe:J=>(h.add(J),()=>h.delete(J)),destroy:()=>{(VB?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),h.clear()}},q=a=r(m,b,o);return o},UB=r=>r?wI(r):wI;var d4={exports:{}},f4={},p4={exports:{}},m4={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _g=on;function jB(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var GB=typeof Object.is=="function"?Object.is:jB,WB=_g.useState,$B=_g.useEffect,qB=_g.useLayoutEffect,HB=_g.useDebugValue;function ZB(r,a){var h=a(),m=WB({inst:{value:h,getSnapshot:a}}),b=m[0].inst,M=m[1];return qB(function(){b.value=h,b.getSnapshot=a,d3(b)&&M({inst:b})},[r,h,a]),$B(function(){return d3(b)&&M({inst:b}),r(function(){d3(b)&&M({inst:b})})},[r]),HB(h),h}function d3(r){var a=r.getSnapshot;r=r.value;try{var h=a();return!GB(r,h)}catch{return!0}}function XB(r,a){return a()}var YB=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?XB:ZB;m4.useSyncExternalStore=_g.useSyncExternalStore!==void 0?_g.useSyncExternalStore:YB;p4.exports=m4;var KB=p4.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rw=on,JB=KB;function QB(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var eF=typeof Object.is=="function"?Object.is:QB,tF=JB.useSyncExternalStore,nF=Rw.useRef,rF=Rw.useEffect,iF=Rw.useMemo,sF=Rw.useDebugValue;f4.useSyncExternalStoreWithSelector=function(r,a,h,m,b){var M=nF(null);if(M.current===null){var P={hasValue:!1,value:null};M.current=P}else P=M.current;M=iF(function(){function o(xe){if(!q){if(q=!0,J=xe,xe=m(xe),b!==void 0&&P.hasValue){var Re=P.value;if(b(Re,xe))return Q=Re}return Q=xe}if(Re=Q,eF(J,xe))return Re;var Ue=m(xe);return b!==void 0&&b(Re,Ue)?Re:(J=xe,Q=Ue)}var q=!1,J,Q,ae=h===void 0?null:h;return[function(){return o(a())},ae===null?void 0:function(){return o(ae())}]},[a,h,m,b]);var V=tF(r,M[0],M[1]);return rF(function(){P.hasValue=!0,P.value=V},[V]),sF(V),V};d4.exports=f4;var oF=d4.exports;const aF=pw(oF);var _4={VITE_API_ENDPOINT_DEV:"http://localhost:8080",VITE_API_ENDPOINT_PROD:"https://lionfish-app-ndao4.ondigitalocean.app",VITE_MAPBOX_PUBLIC_TOKEN:"pk.eyJ1IjoibnZpY3RvcnkiLCJhIjoiY2xlNjJteTNsMGlyMzNybXIwcXQ5a2I5MSJ9.Limj9aCaV0bMS53BQlTq7A",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{useDebugValue:lF}=aR,{useSyncExternalStoreWithSelector:uF}=aF;let bI=!1;const cF=r=>r;function hF(r,a=cF,h){(_4?"production":void 0)!=="production"&&h&&!bI&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),bI=!0);const m=uF(r.subscribe,r.getState,r.getServerState||r.getInitialState,a,h);return lF(m),m}const dF=r=>{(_4?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const a=typeof r=="function"?UB(r):r,h=(m,b)=>hF(a,m,b);return Object.assign(h,a),h},VE=r=>dF,$c=VE()(r=>({provinces:[],setProvinces:a=>r(()=>({provinces:a})),clubs:{},setClubs:a=>r(()=>({clubs:a})),addClubs:(a,h)=>r(m=>{const b={...m.clubs};return b[a]=[...h],{clubs:b}}),loading:!0,setLoading:a=>r(()=>({loading:a}))})),ts=VE()(r=>({query:"",setQuery:a=>r(()=>({query:a})),searchStatus:"none",setSearchStatus:a=>r(()=>({searchStatus:a})),selectedProvince:null,setSelectedProvince:a=>r(()=>({selectedProvince:a})),searchedClubs:[],setSearchedClubs:a=>r(()=>({searchedClubs:a}))})),Ui=VE()(r=>({location:{lat:0,lng:0},setLocation:a=>r(()=>({location:a})),locale:"en",setLocale:a=>r(()=>({locale:a})),mapOpened:!1,setMapOpened:a=>r(()=>({mapOpened:a})),filterBoxOpened:!1,setFilterBoxOpened:a=>r(()=>({filterBoxOpened:a})),filteredClubs:[],setFilteredClubs:a=>r(()=>({filteredClubs:a})),selectedSort:"auto",setSelectedSort:a=>r(()=>({selectedSort:a})),selectedProgramFilter:"all",setSelectedProgramFilter:a=>r(()=>({selectedProgramFilter:a})),selectedProvinceFilter:"all",setSelectedProvinceFilter:a=>r(()=>({selectedProvinceFilter:a}))}));function Yh(r){return at.jsx("button",{...r.buttonProps,className:cd("Chip",r.isActive&&"active",r.buttonProps.className),children:r.children})}function fF(r){const a=$c(M=>M.provinces),h=Ui(M=>M.locale),m=ts(M=>M.selectedProvince),b=ts(M=>M.setSelectedProvince);return at.jsx("ul",{className:cd("ProvinceChips",r.className),children:a.map(M=>at.jsx(Yh,{buttonProps:{onClick:()=>b(M)},isActive:(m==null?void 0:m.slug)===M.slug,children:M.name[h]},M.slug))})}var sw={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */sw.exports;(function(r,a){(function(){var h,m="4.17.21",b=200,M="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",P="Expected a function",V="Invalid `variable` option passed into `_.template`",o="__lodash_hash_undefined__",q=500,J="__lodash_placeholder__",Q=1,ae=2,xe=4,Re=1,Ue=2,Tt=1,Te=2,Ee=4,Me=8,et=16,pt=32,Ct=64,Ot=128,zt=256,Zn=512,wn=30,xn="...",rs=800,bn=16,xo=1,Jr=2,Pi=3,Cn=1/0,Gt=9007199254740991,_n=17976931348623157e292,zn=NaN,lr=4294967295,Br=lr-1,jn=lr>>>1,ps=[["ary",Ot],["bind",Tt],["bindKey",Te],["curry",Me],["curryRight",et],["flip",Zn],["partial",pt],["partialRight",Ct],["rearg",zt]],Fr="[object Arguments]",is="[object Array]",da="[object AsyncFunction]",Ga="[object Boolean]",en="[object Date]",Lu="[object DOMException]",pr="[object Error]",Rl="[object Function]",Xc="[object GeneratorFunction]",ms="[object Map]",fa="[object Number]",Du="[object Null]",wi="[object Object]",Ks="[object Promise]",Yc="[object Proxy]",Qt="[object RegExp]",Zt="[object Set]",ko="[object String]",ji="[object Symbol]",Ll="[object Undefined]",Oo="[object WeakMap]",zu="[object WeakSet]",pa="[object ArrayBuffer]",Ls="[object DataView]",ma="[object Float32Array]",Wa="[object Float64Array]",Dl="[object Int8Array]",$a="[object Int16Array]",qa="[object Int32Array]",_s="[object Uint8Array]",ku="[object Uint8ClampedArray]",rn="[object Uint16Array]",zl="[object Uint32Array]",Nr=/\b__p \+= '';/g,Ou=/\b(__p \+=) '' \+/g,kl=/(__e\(.*?\)|\b__t\)) \+\n'';/g,vo=/&(?:amp|lt|gt|quot|#39);/g,wo=/[&<>"']/g,Kc=RegExp(vo.source),Ha=RegExp(wo.source),Za=/<%-([\s\S]+?)%>/g,Bu=/<%([\s\S]+?)%>/g,Ol=/<%=([\s\S]+?)%>/g,fd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Fu=/^\w*$/,Js=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Bo=/[\\^$.*+?()[\]{}|]/g,Qs=RegExp(Bo.source),fi=/^\s+/,pd=/\s/,Bl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Nu=/\{\n\/\* \[wrapped with (.+)\] \*/,Jc=/,? & /,Vu=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ce=/[()=,{}\[\]\/\s]/,$=/\\(\\)?/g,K=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,he=/\w*$/,ve=/^[-+]0x[0-9a-f]+$/i,we=/^0b[01]+$/i,De=/^\[object .+?Constructor\]$/,Ge=/^0o[0-7]+$/i,Ie=/^(?:0|[1-9]\d*)$/,We=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,gt=/($^)/,ft=/['\n\r\u2028\u2029\\]/g,Ft="\\ud800-\\udfff",Yt="\\u0300-\\u036f",gn="\\ufe20-\\ufe2f",Tn="\\u20d0-\\u20ff",un=Yt+gn+Tn,Rn="\\u2700-\\u27bf",Bt="a-z\\xdf-\\xf6\\xf8-\\xff",Ar="\\xac\\xb1\\xd7\\xf7",rr="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Fn="\\u2000-\\u206f",Zr=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",br="A-Z\\xc0-\\xd6\\xd8-\\xde",Qr="\\ufe0e\\ufe0f",Ri=Ar+rr+Fn+Zr,bi="['’]",Fl="["+Ft+"]",md="["+Ri+"]",Qc="["+un+"]",Uu="\\d+",fn="["+Rn+"]",_d="["+Bt+"]",_a="[^"+Ft+Ri+Uu+Rn+Bt+br+"]",eh="\\ud83c[\\udffb-\\udfff]",tp="(?:"+Qc+"|"+eh+")",gd="[^"+Ft+"]",th="(?:\\ud83c[\\udde6-\\uddff]){2}",nh="[\\ud800-\\udbff][\\udc00-\\udfff]",Xa="["+br+"]",yd="\\u200d",xd="(?:"+_d+"|"+_a+")",np="(?:"+Xa+"|"+_a+")",rp="(?:"+bi+"(?:d|ll|m|re|s|t|ve))?",Nl="(?:"+bi+"(?:D|LL|M|RE|S|T|VE))?",rh=tp+"?",ih="["+Qr+"]?",km="(?:"+yd+"(?:"+[gd,th,nh].join("|")+")"+ih+rh+")*",Om="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Bm="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Vl=ih+rh+km,Ln="(?:"+[fn,th,nh].join("|")+")"+Vl,Eg="(?:"+[gd+Qc+"?",Qc,th,nh,Fl].join("|")+")",Cg=RegExp(bi,"g"),Ag=RegExp(Qc,"g"),sh=RegExp(eh+"(?="+eh+")|"+Eg+Vl,"g"),Fo=RegExp([Xa+"?"+_d+"+"+rp+"(?="+[md,Xa,"$"].join("|")+")",np+"+"+Nl+"(?="+[md,Xa+xd,"$"].join("|")+")",Xa+"?"+xd+"+"+rp,Xa+"+"+Nl,Bm,Om,Uu,Ln].join("|"),"g"),ip=RegExp("["+yd+Ft+un+Qr+"]"),oh=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ah=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],vd=-1,yr={};yr[ma]=yr[Wa]=yr[Dl]=yr[$a]=yr[qa]=yr[_s]=yr[ku]=yr[rn]=yr[zl]=!0,yr[Fr]=yr[is]=yr[pa]=yr[Ga]=yr[Ls]=yr[en]=yr[pr]=yr[Rl]=yr[ms]=yr[fa]=yr[wi]=yr[Qt]=yr[Zt]=yr[ko]=yr[Oo]=!1;var lt={};lt[Fr]=lt[is]=lt[pa]=lt[Ls]=lt[Ga]=lt[en]=lt[ma]=lt[Wa]=lt[Dl]=lt[$a]=lt[qa]=lt[ms]=lt[fa]=lt[wi]=lt[Qt]=lt[Zt]=lt[ko]=lt[ji]=lt[_s]=lt[ku]=lt[rn]=lt[zl]=!0,lt[pr]=lt[Rl]=lt[Oo]=!1;var Fm={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},lh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},kn={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Gi={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Nm=parseFloat,sp=parseInt,ju=typeof V_=="object"&&V_&&V_.Object===Object&&V_,Gu=typeof self=="object"&&self&&self.Object===Object&&self,Xt=ju||Gu||Function("return this")(),ga=a&&!a.nodeType&&a,Ds=ga&&!0&&r&&!r.nodeType&&r,Ul=Ds&&Ds.exports===ga,gs=Ul&&ju.process,Rr=function(){try{var He=Ds&&Ds.require&&Ds.require("util").types;return He||gs&&gs.binding&&gs.binding("util")}catch{}}(),Vm=Rr&&Rr.isArrayBuffer,uh=Rr&&Rr.isDate,ch=Rr&&Rr.isMap,wd=Rr&&Rr.isRegExp,bd=Rr&&Rr.isSet,hh=Rr&&Rr.isTypedArray;function Wi(He,vt,ct){switch(ct.length){case 0:return He.call(vt);case 1:return He.call(vt,ct[0]);case 2:return He.call(vt,ct[0],ct[1]);case 3:return He.call(vt,ct[0],ct[1],ct[2])}return He.apply(vt,ct)}function Wu(He,vt,ct,Kt){for(var An=-1,_r=He==null?0:He.length;++An<_r;){var pi=He[An];vt(Kt,pi,ct(pi),He)}return Kt}function Li(He,vt){for(var ct=-1,Kt=He==null?0:He.length;++ct<Kt&&vt(He[ct],ct,He)!==!1;);return He}function No(He,vt){for(var ct=He==null?0:He.length;ct--&&vt(He[ct],ct,He)!==!1;);return He}function Td(He,vt){for(var ct=-1,Kt=He==null?0:He.length;++ct<Kt;)if(!vt(He[ct],ct,He))return!1;return!0}function xr(He,vt){for(var ct=-1,Kt=He==null?0:He.length,An=0,_r=[];++ct<Kt;){var pi=He[ct];vt(pi,ct,He)&&(_r[An++]=pi)}return _r}function zs(He,vt){var ct=He==null?0:He.length;return!!ct&&eo(He,vt,0)>-1}function Di(He,vt,ct){for(var Kt=-1,An=He==null?0:He.length;++Kt<An;)if(ct(vt,He[Kt]))return!0;return!1}function mr(He,vt){for(var ct=-1,Kt=He==null?0:He.length,An=Array(Kt);++ct<Kt;)An[ct]=vt(He[ct],ct,He);return An}function jr(He,vt){for(var ct=-1,Kt=vt.length,An=He.length;++ct<Kt;)He[An+ct]=vt[ct];return He}function dh(He,vt,ct,Kt){var An=-1,_r=He==null?0:He.length;for(Kt&&_r&&(ct=He[++An]);++An<_r;)ct=vt(ct,He[An],An,He);return ct}function op(He,vt,ct,Kt){var An=He==null?0:He.length;for(Kt&&An&&(ct=He[--An]);An--;)ct=vt(ct,He[An],An,He);return ct}function $u(He,vt){for(var ct=-1,Kt=He==null?0:He.length;++ct<Kt;)if(vt(He[ct],ct,He))return!0;return!1}var qu=Zu("length");function fh(He){return He.split("")}function ya(He){return He.match(Vu)||[]}function Hu(He,vt,ct){var Kt;return ct(He,function(An,_r,pi){if(vt(An,_r,pi))return Kt=_r,!1}),Kt}function jl(He,vt,ct,Kt){for(var An=He.length,_r=ct+(Kt?1:-1);Kt?_r--:++_r<An;)if(vt(He[_r],_r,He))return _r;return-1}function eo(He,vt,ct){return vt===vt?Gm(He,vt,ct):jl(He,Sd,ct)}function ph(He,vt,ct,Kt){for(var An=ct-1,_r=He.length;++An<_r;)if(Kt(He[An],vt))return An;return-1}function Sd(He){return He!==He}function ap(He,vt){var ct=He==null?0:He.length;return ct?Yu(He,vt)/ct:zn}function Zu(He){return function(vt){return vt==null?h:vt[He]}}function Xu(He){return function(vt){return He==null?h:He[vt]}}function Gl(He,vt,ct,Kt,An){return An(He,function(_r,pi,zr){ct=Kt?(Kt=!1,_r):vt(ct,_r,pi,zr)}),ct}function zi(He,vt){var ct=He.length;for(He.sort(vt);ct--;)He[ct]=He[ct].value;return He}function Yu(He,vt){for(var ct,Kt=-1,An=He.length;++Kt<An;){var _r=vt(He[Kt]);_r!==h&&(ct=ct===h?_r:ct+_r)}return ct}function mh(He,vt){for(var ct=-1,Kt=Array(He);++ct<He;)Kt[ct]=vt(ct);return Kt}function Um(He,vt){return mr(vt,function(ct){return[ct,He[ct]]})}function Ed(He){return He&&He.slice(0,xa(He)+1).replace(fi,"")}function ss(He){return function(vt){return He(vt)}}function bo(He,vt){return mr(vt,function(ct){return He[ct]})}function Ya(He,vt){return He.has(vt)}function lp(He,vt){for(var ct=-1,Kt=He.length;++ct<Kt&&eo(vt,He[ct],0)>-1;);return ct}function Ku(He,vt){for(var ct=He.length;ct--&&eo(vt,He[ct],0)>-1;);return ct}function Cd(He,vt){for(var ct=He.length,Kt=0;ct--;)He[ct]===vt&&++Kt;return Kt}var Ad=Xu(Fm),Ju=Xu(lh);function Qu(He){return"\\"+Gi[He]}function up(He,vt){return He==null?h:He[vt]}function Ka(He){return ip.test(He)}function cp(He){return oh.test(He)}function jm(He){for(var vt,ct=[];!(vt=He.next()).done;)ct.push(vt.value);return ct}function ec(He){var vt=-1,ct=Array(He.size);return He.forEach(function(Kt,An){ct[++vt]=[An,Kt]}),ct}function Md(He,vt){return function(ct){return He(vt(ct))}}function To(He,vt){for(var ct=-1,Kt=He.length,An=0,_r=[];++ct<Kt;){var pi=He[ct];(pi===vt||pi===J)&&(He[ct]=J,_r[An++]=ct)}return _r}function Ja(He){var vt=-1,ct=Array(He.size);return He.forEach(function(Kt){ct[++vt]=Kt}),ct}function Wl(He){var vt=-1,ct=Array(He.size);return He.forEach(function(Kt){ct[++vt]=[Kt,Kt]}),ct}function Gm(He,vt,ct){for(var Kt=ct-1,An=He.length;++Kt<An;)if(He[Kt]===vt)return Kt;return-1}function hp(He,vt,ct){for(var Kt=ct+1;Kt--;)if(He[Kt]===vt)return Kt;return Kt}function Vo(He){return Ka(He)?fp(He):qu(He)}function os(He){return Ka(He)?Mg(He):fh(He)}function xa(He){for(var vt=He.length;vt--&&pd.test(He.charAt(vt)););return vt}var dp=Xu(kn);function fp(He){for(var vt=sh.lastIndex=0;sh.test(He);)++vt;return vt}function Mg(He){return He.match(sh)||[]}function So(He){return He.match(Fo)||[]}var tc=function He(vt){vt=vt==null?Xt:va.defaults(Xt.Object(),vt,va.pick(Xt,ah));var ct=vt.Array,Kt=vt.Date,An=vt.Error,_r=vt.Function,pi=vt.Math,zr=vt.Object,nc=vt.RegExp,Ig=vt.String,$i=vt.TypeError,$l=ct.prototype,_h=_r.prototype,to=zr.prototype,gh=vt["__core-js_shared__"],Id=_h.toString,Tr=to.hasOwnProperty,pp=0,ql=function(){var g=/[^.]+$/.exec(gh&&gh.keys&&gh.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),rc=to.toString,ic=Id.call(zr),as=Xt._,Pd=nc("^"+Id.call(Tr).replace(Bo,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Uo=Ul?vt.Buffer:h,wa=vt.Symbol,Hl=vt.Uint8Array,Rd=Uo?Uo.allocUnsafe:h,Qa=Md(zr.getPrototypeOf,zr),sc=zr.create,Gn=to.propertyIsEnumerable,Ld=$l.splice,Ht=wa?wa.isConcatSpreadable:h,oc=wa?wa.iterator:h,jo=wa?wa.toStringTag:h,ac=function(){try{var g=er(zr,"defineProperty");return g({},"",{}),g}catch{}}(),Go=vt.clearTimeout!==Xt.clearTimeout&&vt.clearTimeout,mp=Kt&&Kt.now!==Xt.Date.now&&Kt.now,lc=vt.setTimeout!==Xt.setTimeout&&vt.setTimeout,Rt=pi.ceil,On=pi.floor,Nn=zr.getOwnPropertySymbols,ls=Uo?Uo.isBuffer:h,Zl=vt.isFinite,Wn=$l.join,Eo=Md(zr.keys,zr),Xr=pi.max,Gr=pi.min,ys=Kt.now,Yr=vt.parseInt,Wm=pi.random,yh=$l.reverse,xh=er(vt,"DataView"),Wo=er(vt,"Map"),Xl=er(vt,"Promise"),no=er(vt,"Set"),oi=er(vt,"WeakMap"),Ti=er(zr,"create"),vh=oi&&new oi,mi={},ni=so(xh),ro=so(Wo),ba=so(Xl),_i=so(no),_p=so(oi),xs=wa?wa.prototype:h,Ta=xs?xs.valueOf:h,uc=xs?xs.toString:h;function fe(g){if(ei(g)&&!$n(g)&&!(g instanceof or)){if(g instanceof ks)return g;if(Tr.call(g,"__wrapped__"))return e_(g)}return new ks(g)}var cc=function(){function g(){}return function(T){if(!Wr(T))return{};if(sc)return sc(T);g.prototype=T;var D=new g;return g.prototype=h,D}}();function vs(){}function ks(g,T){this.__wrapped__=g,this.__actions__=[],this.__chain__=!!T,this.__index__=0,this.__values__=h}fe.templateSettings={escape:Za,evaluate:Bu,interpolate:Ol,variable:"",imports:{_:fe}},fe.prototype=vs.prototype,fe.prototype.constructor=fe,ks.prototype=cc(vs.prototype),ks.prototype.constructor=ks;function or(g){this.__wrapped__=g,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=lr,this.__views__=[]}function Yi(){var g=new or(this.__wrapped__);return g.__actions__=R(this.__actions__),g.__dir__=this.__dir__,g.__filtered__=this.__filtered__,g.__iteratees__=R(this.__iteratees__),g.__takeCount__=this.__takeCount__,g.__views__=R(this.__views__),g}function gp(){if(this.__filtered__){var g=new or(this);g.__dir__=-1,g.__filtered__=!0}else g=this.clone(),g.__dir__*=-1;return g}function el(){var g=this.__wrapped__.value(),T=this.__dir__,D=$n(g),G=T<0,re=D?g.length:0,ye=vr(0,re,this.__views__),Le=ye.start,Ne=ye.end,Xe=Ne-Le,It=G?Ne:Le-1,Mt=this.__iteratees__,Dt=Mt.length,$t=0,hn=Gr(Xe,this.__takeCount__);if(!D||!G&&re==Xe&&hn==Xe)return ul(g,this.__actions__);var Mn=[];e:for(;Xe--&&$t<hn;){It+=T;for(var ir=-1,In=g[It];++ir<Dt;){var ur=Mt[ir],dr=ur.iteratee,Io=ur.type,qs=dr(In);if(Io==Jr)In=qs;else if(!qs){if(Io==xo)continue e;break e}}Mn[$t++]=In}return Mn}or.prototype=cc(vs.prototype),or.prototype.constructor=or;function Sa(g){var T=-1,D=g==null?0:g.length;for(this.clear();++T<D;){var G=g[T];this.set(G[0],G[1])}}function Pg(){this.__data__=Ti?Ti(null):{},this.size=0}function Rg(g){var T=this.has(g)&&delete this.__data__[g];return this.size-=T?1:0,T}function wh(g){var T=this.__data__;if(Ti){var D=T[g];return D===o?h:D}return Tr.call(T,g)?T[g]:h}function hc(g){var T=this.__data__;return Ti?T[g]!==h:Tr.call(T,g)}function Lg(g,T){var D=this.__data__;return this.size+=this.has(g)?0:1,D[g]=Ti&&T===h?o:T,this}Sa.prototype.clear=Pg,Sa.prototype.delete=Rg,Sa.prototype.get=wh,Sa.prototype.has=hc,Sa.prototype.set=Lg;function ws(g){var T=-1,D=g==null?0:g.length;for(this.clear();++T<D;){var G=g[T];this.set(G[0],G[1])}}function yp(){this.__data__=[],this.size=0}function Vn(g){var T=this.__data__,D=mc(T,g);if(D<0)return!1;var G=T.length-1;return D==G?T.pop():Ld.call(T,D,1),--this.size,!0}function Ea(g){var T=this.__data__,D=mc(T,g);return D<0?h:T[D][1]}function $m(g){return mc(this.__data__,g)>-1}function Dg(g,T){var D=this.__data__,G=mc(D,g);return G<0?(++this.size,D.push([g,T])):D[G][1]=T,this}ws.prototype.clear=yp,ws.prototype.delete=Vn,ws.prototype.get=Ea,ws.prototype.has=$m,ws.prototype.set=Dg;function Ca(g){var T=-1,D=g==null?0:g.length;for(this.clear();++T<D;){var G=g[T];this.set(G[0],G[1])}}function bh(){this.size=0,this.__data__={hash:new Sa,map:new(Wo||ws),string:new Sa}}function Dd(g){var T=tn(this,g).delete(g);return this.size-=T?1:0,T}function dc(g){return tn(this,g).get(g)}function qm(g){return tn(this,g).has(g)}function xp(g,T){var D=tn(this,g),G=D.size;return D.set(g,T),this.size+=D.size==G?0:1,this}Ca.prototype.clear=bh,Ca.prototype.delete=Dd,Ca.prototype.get=dc,Ca.prototype.has=qm,Ca.prototype.set=xp;function qi(g){var T=-1,D=g==null?0:g.length;for(this.__data__=new Ca;++T<D;)this.add(g[T])}function Hm(g){return this.__data__.set(g,o),this}function tl(g){return this.__data__.has(g)}qi.prototype.add=qi.prototype.push=Hm,qi.prototype.has=tl;function ki(g){var T=this.__data__=new ws(g);this.size=T.size}function zd(){this.__data__=new ws,this.size=0}function Zm(g){var T=this.__data__,D=T.delete(g);return this.size=T.size,D}function Th(g){return this.__data__.get(g)}function Sh(g){return this.__data__.has(g)}function vp(g,T){var D=this.__data__;if(D instanceof ws){var G=D.__data__;if(!Wo||G.length<b-1)return G.push([g,T]),this.size=++D.size,this;D=this.__data__=new Ca(G)}return D.set(g,T),this.size=D.size,this}ki.prototype.clear=zd,ki.prototype.delete=Zm,ki.prototype.get=Th,ki.prototype.has=Sh,ki.prototype.set=vp;function fc(g,T){var D=$n(g),G=!D&&Qo(g),re=!D&&!G&&pl(g),ye=!D&&!G&&!re&&_l(g),Le=D||G||re||ye,Ne=Le?mh(g.length,Ig):[],Xe=Ne.length;for(var It in g)(T||Tr.call(g,It))&&!(Le&&(It=="length"||re&&(It=="offset"||It=="parent")||ye&&(It=="buffer"||It=="byteLength"||It=="byteOffset")||Vr(It,Xe)))&&Ne.push(It);return Ne}function Os(g){var T=g.length;return T?g[Lh(0,T-1)]:h}function Eh(g,T){return Bp(R(g),Bs(T,0,g.length))}function wp(g){return Bp(R(g))}function xt(g,T,D){(D!==h&&!La(g[T],D)||D===h&&!(T in g))&&Oi(g,T,D)}function pc(g,T,D){var G=g[T];(!(Tr.call(g,T)&&La(G,D))||D===h&&!(T in g))&&Oi(g,T,D)}function mc(g,T){for(var D=g.length;D--;)if(La(g[D][0],T))return D;return-1}function bp(g,T,D,G){return rl(g,function(re,ye,Le){T(G,re,D(re),Le)}),G}function Tp(g,T){return g&&L(T,Ki(T),g)}function kd(g,T){return g&&L(T,lo(T),g)}function Oi(g,T,D){T=="__proto__"&&ac?ac(g,T,{configurable:!0,enumerable:!0,value:D,writable:!0}):g[T]=D}function $o(g,T){for(var D=-1,G=T.length,re=ct(G),ye=g==null;++D<G;)re[D]=ye?h:by(g,T[D]);return re}function Bs(g,T,D){return g===g&&(D!==h&&(g=g<=D?g:D),T!==h&&(g=g>=T?g:T)),g}function us(g,T,D,G,re,ye){var Le,Ne=T&Q,Xe=T&ae,It=T&xe;if(D&&(Le=re?D(g,G,re,ye):D(g)),Le!==h)return Le;if(!Wr(g))return g;var Mt=$n(g);if(Mt){if(Le=At(g),!Ne)return R(g,Le)}else{var Dt=Dn(g),$t=Dt==Rl||Dt==Xc;if(pl(g))return Oh(g,Ne);if(Dt==wi||Dt==Fr||$t&&!re){if(Le=Xe||$t?{}:Mr(g),!Ne)return Xe?F(g,kd(Le,g)):O(g,Tp(Le,g))}else{if(!lt[Dt])return re?g:{};Le=Kn(g,Dt,Ne)}}ye||(ye=new ki);var hn=ye.get(g);if(hn)return hn;ye.set(g,Le),hf(g)?g.forEach(function(In){Le.add(us(In,T,D,In,g,ye))}):Px(g)&&g.forEach(function(In,ur){Le.set(ur,us(In,T,D,ur,g,ye))});var Mn=It?Xe?cn:kt:Xe?lo:Ki,ir=Mt?h:Mn(g);return Li(ir||g,function(In,ur){ir&&(ur=In,In=g[ur]),pc(Le,ur,us(In,T,D,ur,g,ye))}),Le}function nl(g){var T=Ki(g);return function(D){return Xm(D,g,T)}}function Xm(g,T,D){var G=D.length;if(g==null)return!G;for(g=zr(g);G--;){var re=D[G],ye=T[re],Le=g[re];if(Le===h&&!(re in g)||!ye(Le))return!1}return!0}function Ym(g,T,D){if(typeof g!="function")throw new $i(P);return iu(function(){g.apply(h,D)},T)}function Yl(g,T,D,G){var re=-1,ye=zs,Le=!0,Ne=g.length,Xe=[],It=T.length;if(!Ne)return Xe;D&&(T=mr(T,ss(D))),G?(ye=Di,Le=!1):T.length>=b&&(ye=Ya,Le=!1,T=new qi(T));e:for(;++re<Ne;){var Mt=g[re],Dt=D==null?Mt:D(Mt);if(Mt=G||Mt!==0?Mt:0,Le&&Dt===Dt){for(var $t=It;$t--;)if(T[$t]===Dt)continue e;Xe.push(Mt)}else ye(T,Dt,G)||Xe.push(Mt)}return Xe}var rl=H(qo),Sp=H(Kl,!0);function il(g,T){var D=!0;return rl(g,function(G,re,ye){return D=!!T(G,re,ye),D}),D}function _c(g,T,D){for(var G=-1,re=g.length;++G<re;){var ye=g[G],Le=T(ye);if(Le!=null&&(Ne===h?Le===Le&&!ao(Le):D(Le,Ne)))var Ne=Le,Xe=ye}return Xe}function zg(g,T,D,G){var re=g.length;for(D=tr(D),D<0&&(D=-D>re?0:re+D),G=G===h||G>re?re:tr(G),G<0&&(G+=re),G=D>G?0:kx(G);D<G;)g[D++]=T;return g}function Ep(g,T){var D=[];return rl(g,function(G,re,ye){T(G,re,ye)&&D.push(G)}),D}function Bi(g,T,D,G,re){var ye=-1,Le=g.length;for(D||(D=Vs),re||(re=[]);++ye<Le;){var Ne=g[ye];T>0&&D(Ne)?T>1?Bi(Ne,T-1,D,G,re):jr(re,Ne):G||(re[re.length]=Ne)}return re}var Fs=Z(),Od=Z(!0);function qo(g,T){return g&&Fs(g,T,Ki)}function Kl(g,T){return g&&Od(g,T,Ki)}function Jl(g,T){return xr(T,function(D){return cu(g[D])})}function sl(g,T){T=Ss(T,g);for(var D=0,G=T.length;g!=null&&D<G;)g=g[Ao(T[D++])];return D&&D==G?g:h}function Bd(g,T,D){var G=T(g);return $n(g)?G:jr(G,D(g))}function Fi(g){return g==null?g===h?Ll:Du:jo&&jo in zr(g)?nr(g):nu(g)}function Ch(g,T){return g>T}function Ql(g,T){return g!=null&&Tr.call(g,T)}function gc(g,T){return g!=null&&T in zr(g)}function Ah(g,T,D){return g>=Gr(T,D)&&g<Xr(T,D)}function gi(g,T,D){for(var G=D?Di:zs,re=g[0].length,ye=g.length,Le=ye,Ne=ct(ye),Xe=1/0,It=[];Le--;){var Mt=g[Le];Le&&T&&(Mt=mr(Mt,ss(T))),Xe=Gr(Mt.length,Xe),Ne[Le]=!D&&(T||re>=120&&Mt.length>=120)?new qi(Le&&Mt):h}Mt=g[0];var Dt=-1,$t=Ne[0];e:for(;++Dt<re&&It.length<Xe;){var hn=Mt[Dt],Mn=T?T(hn):hn;if(hn=D||hn!==0?hn:0,!($t?Ya($t,Mn):G(It,Mn,D))){for(Le=ye;--Le;){var ir=Ne[Le];if(!(ir?Ya(ir,Mn):G(g[Le],Mn,D)))continue e}$t&&$t.push(Mn),It.push(hn)}}return It}function ol(g,T,D,G){return qo(g,function(re,ye,Le){T(G,D(re),ye,Le)}),G}function al(g,T,D){T=Ss(T,g),g=Bh(g,T);var G=g==null?g:g[Ao(oo(T))];return G==null?h:Wi(G,g,D)}function Fd(g){return ei(g)&&Fi(g)==Fr}function Mh(g){return ei(g)&&Fi(g)==pa}function Nd(g){return ei(g)&&Fi(g)==en}function Aa(g,T,D,G,re){return g===T?!0:g==null||T==null||!ei(g)&&!ei(T)?g!==g&&T!==T:Km(g,T,D,G,Aa,re)}function Km(g,T,D,G,re,ye){var Le=$n(g),Ne=$n(T),Xe=Le?is:Dn(g),It=Ne?is:Dn(T);Xe=Xe==Fr?wi:Xe,It=It==Fr?wi:It;var Mt=Xe==wi,Dt=It==wi,$t=Xe==It;if($t&&pl(g)){if(!pl(T))return!1;Le=!0,Mt=!1}if($t&&!Mt)return ye||(ye=new ki),Le||_l(g)?Pt(g,T,D,G,re,ye):Et(g,T,Xe,D,G,re,ye);if(!(D&Re)){var hn=Mt&&Tr.call(g,"__wrapped__"),Mn=Dt&&Tr.call(T,"__wrapped__");if(hn||Mn){var ir=hn?g.value():g,In=Mn?T.value():T;return ye||(ye=new ki),re(ir,In,D,G,ye)}}return $t?(ye||(ye=new ki),ot(g,T,D,G,re,ye)):!1}function Ih(g){return ei(g)&&Dn(g)==ms}function yc(g,T,D,G){var re=D.length,ye=re,Le=!G;if(g==null)return!ye;for(g=zr(g);re--;){var Ne=D[re];if(Le&&Ne[2]?Ne[1]!==g[Ne[0]]:!(Ne[0]in g))return!1}for(;++re<ye;){Ne=D[re];var Xe=Ne[0],It=g[Xe],Mt=Ne[1];if(Le&&Ne[2]){if(It===h&&!(Xe in g))return!1}else{var Dt=new ki;if(G)var $t=G(It,Mt,Xe,g,T,Dt);if(!($t===h?Aa(Mt,It,Re|Ue,G,Dt):$t))return!1}}return!0}function xc(g){if(!Wr(g)||js(g))return!1;var T=cu(g)?Pd:De;return T.test(so(g))}function Vd(g){return ei(g)&&Fi(g)==Qt}function Jm(g){return ei(g)&&Dn(g)==Zt}function Cp(g){return ei(g)&&Kp(g.length)&&!!yr[Fi(g)]}function ll(g){return typeof g=="function"?g:g==null?$s:typeof g=="object"?$n(g)?Ph(g[0],g[1]):jd(g):fu(g)}function Ud(g){if(!io(g))return Eo(g);var T=[];for(var D in zr(g))Tr.call(g,D)&&D!="constructor"&&T.push(D);return T}function Ap(g){if(!Wr(g))return Cc(g);var T=io(g),D=[];for(var G in g)G=="constructor"&&(T||!Tr.call(g,G))||D.push(G);return D}function vc(g,T){return g<T}function Mp(g,T){var D=-1,G=Ws(g)?ct(g.length):[];return rl(g,function(re,ye,Le){G[++D]=T(re,ye,Le)}),G}function jd(g){var T=Hn(g);return T.length==1&&T[0][2]?Co(T[0][0],T[0][1]):function(D){return D===g||yc(D,g,T)}}function Ph(g,T){return ri(g)&&Xo(T)?Co(Ao(g),T):function(D){var G=by(D,g);return G===h&&G===T?Wh(D,g):Aa(T,G,Re|Ue)}}function wc(g,T,D,G,re){g!==T&&Fs(T,function(ye,Le){if(re||(re=new ki),Wr(ye))Rh(g,T,Le,D,wc,G,re);else{var Ne=G?G(Fh(g,Le),ye,Le+"",g,T,re):h;Ne===h&&(Ne=ye),xt(g,Le,Ne)}},lo)}function Rh(g,T,D,G,re,ye,Le){var Ne=Fh(g,D),Xe=Fh(T,D),It=Le.get(Xe);if(It){xt(g,D,It);return}var Mt=ye?ye(Ne,Xe,D+"",g,T,Le):h,Dt=Mt===h;if(Dt){var $t=$n(Xe),hn=!$t&&pl(Xe),Mn=!$t&&!hn&&_l(Xe);Mt=Xe,$t||hn||Mn?$n(Ne)?Mt=Ne:Ei(Ne)?Mt=R(Ne):hn?(Dt=!1,Mt=Oh(Xe,!0)):Mn?(Dt=!1,Mt=p(Xe,!0)):Mt=[]:uf(Xe)||Qo(Xe)?(Mt=Ne,Qo(Ne)?Mt=Ox(Ne):(!Wr(Ne)||cu(Ne))&&(Mt=Mr(Xe))):Dt=!1}Dt&&(Le.set(Xe,Mt),re(Mt,Xe,G,ye,Le),Le.delete(Xe)),xt(g,D,Mt)}function Ip(g,T){var D=g.length;if(D)return T+=T<0?D:0,Vr(T,D)?g[T]:h}function Pp(g,T,D){T.length?T=mr(T,function(ye){return $n(ye)?function(Le){return sl(Le,ye.length===1?ye[0]:ye)}:ye}):T=[$s];var G=-1;T=mr(T,ss(Vt()));var re=Mp(g,function(ye,Le,Ne){var Xe=mr(T,function(It){return It(ye)});return{criteria:Xe,index:++G,value:ye}});return zi(re,function(ye,Le){return v(ye,Le,D)})}function kg(g,T){return bc(g,T,function(D,G){return Wh(g,G)})}function bc(g,T,D){for(var G=-1,re=T.length,ye={};++G<re;){var Le=T[G],Ne=sl(g,Le);D(Ne,Le)&&Ho(ye,Ss(Le,g),Ne)}return ye}function Tc(g){return function(T){return sl(T,g)}}function Gd(g,T,D,G){var re=G?ph:eo,ye=-1,Le=T.length,Ne=g;for(g===T&&(T=R(T)),D&&(Ne=mr(g,ss(D)));++ye<Le;)for(var Xe=0,It=T[ye],Mt=D?D(It):It;(Xe=re(Ne,Mt,Xe,G))>-1;)Ne!==g&&Ld.call(Ne,Xe,1),Ld.call(g,Xe,1);return g}function bs(g,T){for(var D=g?T.length:0,G=D-1;D--;){var re=T[D];if(D==G||re!==ye){var ye=re;Vr(re)?Ld.call(g,re,1):tu(g,re)}}return g}function Lh(g,T){return g+On(Wm()*(T-g+1))}function Wd(g,T,D,G){for(var re=-1,ye=Xr(Rt((T-g)/(D||1)),0),Le=ct(ye);ye--;)Le[G?ye:++re]=g,g+=D;return Le}function Sc(g,T){var D="";if(!g||T<1||T>Gt)return D;do T%2&&(D+=g),T=On(T/2),T&&(g+=g);while(T);return D}function Yn(g,T){return hl(ru(g,T,$s),g+"")}function Rp(g){return Os(gl(g))}function $d(g,T){var D=gl(g);return Bp(D,Bs(T,0,D.length))}function Ho(g,T,D,G){if(!Wr(g))return g;T=Ss(T,g);for(var re=-1,ye=T.length,Le=ye-1,Ne=g;Ne!=null&&++re<ye;){var Xe=Ao(T[re]),It=D;if(Xe==="__proto__"||Xe==="constructor"||Xe==="prototype")return g;if(re!=Le){var Mt=Ne[Xe];It=G?G(Mt,Xe,Ne):h,It===h&&(It=Wr(Mt)?Mt:Vr(T[re+1])?[]:{})}pc(Ne,Xe,It),Ne=Ne[Xe]}return g}var qd=vh?function(g,T){return vh.set(g,T),g}:$s,Hd=ac?function(g,T){return ac(g,"toString",{configurable:!0,enumerable:!1,value:pf(T),writable:!0})}:$s;function Dh(g){return Bp(gl(g))}function Ns(g,T,D){var G=-1,re=g.length;T<0&&(T=-T>re?0:re+T),D=D>re?re:D,D<0&&(D+=re),re=T>D?0:D-T>>>0,T>>>=0;for(var ye=ct(re);++G<re;)ye[G]=g[G+T];return ye}function eu(g,T){var D;return rl(g,function(G,re,ye){return D=T(G,re,ye),!D}),!!D}function Zd(g,T,D){var G=0,re=g==null?G:g.length;if(typeof T=="number"&&T===T&&re<=jn){for(;G<re;){var ye=G+re>>>1,Le=g[ye];Le!==null&&!ao(Le)&&(D?Le<=T:Le<T)?G=ye+1:re=ye}return re}return Xd(g,T,$s,D)}function Xd(g,T,D,G){var re=0,ye=g==null?0:g.length;if(ye===0)return 0;T=D(T);for(var Le=T!==T,Ne=T===null,Xe=ao(T),It=T===h;re<ye;){var Mt=On((re+ye)/2),Dt=D(g[Mt]),$t=Dt!==h,hn=Dt===null,Mn=Dt===Dt,ir=ao(Dt);if(Le)var In=G||Mn;else It?In=Mn&&(G||$t):Ne?In=Mn&&$t&&(G||!hn):Xe?In=Mn&&$t&&!hn&&(G||!ir):hn||ir?In=!1:In=G?Dt<=T:Dt<T;In?re=Mt+1:ye=Mt}return Gr(ye,Br)}function Lp(g,T){for(var D=-1,G=g.length,re=0,ye=[];++D<G;){var Le=g[D],Ne=T?T(Le):Le;if(!D||!La(Ne,Xe)){var Xe=Ne;ye[re++]=Le===0?0:Le}}return ye}function Dp(g){return typeof g=="number"?g:ao(g)?zn:+g}function Ts(g){if(typeof g=="string")return g;if($n(g))return mr(g,Ts)+"";if(ao(g))return uc?uc.call(g):"";var T=g+"";return T=="0"&&1/g==-Cn?"-0":T}function Zo(g,T,D){var G=-1,re=zs,ye=g.length,Le=!0,Ne=[],Xe=Ne;if(D)Le=!1,re=Di;else if(ye>=b){var It=T?null:Qe(g);if(It)return Ja(It);Le=!1,re=Ya,Xe=new qi}else Xe=T?[]:Ne;e:for(;++G<ye;){var Mt=g[G],Dt=T?T(Mt):Mt;if(Mt=D||Mt!==0?Mt:0,Le&&Dt===Dt){for(var $t=Xe.length;$t--;)if(Xe[$t]===Dt)continue e;T&&Xe.push(Dt),Ne.push(Mt)}else re(Xe,Dt,D)||(Xe!==Ne&&Xe.push(Dt),Ne.push(Mt))}return Ne}function tu(g,T){return T=Ss(T,g),g=Bh(g,T),g==null||delete g[Ao(oo(T))]}function Yd(g,T,D,G){return Ho(g,T,D(sl(g,T)),G)}function zh(g,T,D,G){for(var re=g.length,ye=G?re:-1;(G?ye--:++ye<re)&&T(g[ye],ye,g););return D?Ns(g,G?0:ye,G?ye+1:re):Ns(g,G?ye+1:0,G?re:ye)}function ul(g,T){var D=g;return D instanceof or&&(D=D.value()),dh(T,function(G,re){return re.func.apply(re.thisArg,jr([G],re.args))},D)}function Kd(g,T,D){var G=g.length;if(G<2)return G?Zo(g[0]):[];for(var re=-1,ye=ct(G);++re<G;)for(var Le=g[re],Ne=-1;++Ne<G;)Ne!=re&&(ye[re]=Yl(ye[re]||Le,g[Ne],T,D));return Zo(Bi(ye,1),T,D)}function zp(g,T,D){for(var G=-1,re=g.length,ye=T.length,Le={};++G<re;){var Ne=G<ye?T[G]:h;D(Le,g[G],Ne)}return Le}function Jd(g){return Ei(g)?g:[]}function kh(g){return typeof g=="function"?g:$s}function Ss(g,T){return $n(g)?g:ri(g,T)?[g]:Yo(Ir(g))}var Qm=Yn;function Es(g,T,D){var G=g.length;return D=D===h?G:D,!T&&D>=G?g:Ns(g,T,D)}var kp=Go||function(g){return Xt.clearTimeout(g)};function Oh(g,T){if(T)return g.slice();var D=g.length,G=Rd?Rd(D):new g.constructor(D);return g.copy(G),G}function Op(g){var T=new g.constructor(g.byteLength);return new Hl(T).set(new Hl(g)),T}function f(g,T){var D=T?Op(g.buffer):g.buffer;return new g.constructor(D,g.byteOffset,g.byteLength)}function i(g){var T=new g.constructor(g.source,he.exec(g));return T.lastIndex=g.lastIndex,T}function u(g){return Ta?zr(Ta.call(g)):{}}function p(g,T){var D=T?Op(g.buffer):g.buffer;return new g.constructor(D,g.byteOffset,g.length)}function x(g,T){if(g!==T){var D=g!==h,G=g===null,re=g===g,ye=ao(g),Le=T!==h,Ne=T===null,Xe=T===T,It=ao(T);if(!Ne&&!It&&!ye&&g>T||ye&&Le&&Xe&&!Ne&&!It||G&&Le&&Xe||!D&&Xe||!re)return 1;if(!G&&!ye&&!It&&g<T||It&&D&&re&&!G&&!ye||Ne&&D&&re||!Le&&re||!Xe)return-1}return 0}function v(g,T,D){for(var G=-1,re=g.criteria,ye=T.criteria,Le=re.length,Ne=D.length;++G<Le;){var Xe=x(re[G],ye[G]);if(Xe){if(G>=Ne)return Xe;var It=D[G];return Xe*(It=="desc"?-1:1)}}return g.index-T.index}function S(g,T,D,G){for(var re=-1,ye=g.length,Le=D.length,Ne=-1,Xe=T.length,It=Xr(ye-Le,0),Mt=ct(Xe+It),Dt=!G;++Ne<Xe;)Mt[Ne]=T[Ne];for(;++re<Le;)(Dt||re<ye)&&(Mt[D[re]]=g[re]);for(;It--;)Mt[Ne++]=g[re++];return Mt}function C(g,T,D,G){for(var re=-1,ye=g.length,Le=-1,Ne=D.length,Xe=-1,It=T.length,Mt=Xr(ye-Ne,0),Dt=ct(Mt+It),$t=!G;++re<Mt;)Dt[re]=g[re];for(var hn=re;++Xe<It;)Dt[hn+Xe]=T[Xe];for(;++Le<Ne;)($t||re<ye)&&(Dt[hn+D[Le]]=g[re++]);return Dt}function R(g,T){var D=-1,G=g.length;for(T||(T=ct(G));++D<G;)T[D]=g[D];return T}function L(g,T,D,G){var re=!D;D||(D={});for(var ye=-1,Le=T.length;++ye<Le;){var Ne=T[ye],Xe=G?G(D[Ne],g[Ne],Ne,D,g):h;Xe===h&&(Xe=g[Ne]),re?Oi(D,Ne,Xe):pc(D,Ne,Xe)}return D}function O(g,T){return L(g,En(g),T)}function F(g,T){return L(g,ln(g),T)}function U(g,T){return function(D,G){var re=$n(D)?Wu:bp,ye=T?T():{};return re(D,g,Vt(G,2),ye)}}function j(g){return Yn(function(T,D){var G=-1,re=D.length,ye=re>1?D[re-1]:h,Le=re>2?D[2]:h;for(ye=g.length>3&&typeof ye=="function"?(re--,ye):h,Le&&Sr(D[0],D[1],Le)&&(ye=re<3?h:ye,re=1),T=zr(T);++G<re;){var Ne=D[G];Ne&&g(T,Ne,G,ye)}return T})}function H(g,T){return function(D,G){if(D==null)return D;if(!Ws(D))return g(D,G);for(var re=D.length,ye=T?re:-1,Le=zr(D);(T?ye--:++ye<re)&&G(Le[ye],ye,Le)!==!1;);return D}}function Z(g){return function(T,D,G){for(var re=-1,ye=zr(T),Le=G(T),Ne=Le.length;Ne--;){var Xe=Le[g?Ne:++re];if(D(ye[Xe],Xe,ye)===!1)break}return T}}function X(g,T,D){var G=T&Tt,re=oe(g);function ye(){var Le=this&&this!==Xt&&this instanceof ye?re:g;return Le.apply(G?D:this,arguments)}return ye}function Y(g){return function(T){T=Ir(T);var D=Ka(T)?os(T):h,G=D?D[0]:T.charAt(0),re=D?Es(D,1).join(""):T.slice(1);return G[g]()+re}}function ie(g){return function(T){return dh(Oc(qx(T).replace(Cg,"")),g,"")}}function oe(g){return function(){var T=arguments;switch(T.length){case 0:return new g;case 1:return new g(T[0]);case 2:return new g(T[0],T[1]);case 3:return new g(T[0],T[1],T[2]);case 4:return new g(T[0],T[1],T[2],T[3]);case 5:return new g(T[0],T[1],T[2],T[3],T[4]);case 6:return new g(T[0],T[1],T[2],T[3],T[4],T[5]);case 7:return new g(T[0],T[1],T[2],T[3],T[4],T[5],T[6])}var D=cc(g.prototype),G=g.apply(D,T);return Wr(G)?G:D}}function ue(g,T,D){var G=oe(g);function re(){for(var ye=arguments.length,Le=ct(ye),Ne=ye,Xe=Sn(re);Ne--;)Le[Ne]=arguments[Ne];var It=ye<3&&Le[0]!==Xe&&Le[ye-1]!==Xe?[]:To(Le,Xe);if(ye-=It.length,ye<D)return tt(g,T,se,re.placeholder,h,Le,It,h,h,D-ye);var Mt=this&&this!==Xt&&this instanceof re?G:g;return Wi(Mt,this,Le)}return re}function ge(g){return function(T,D,G){var re=zr(T);if(!Ws(T)){var ye=Vt(D,3);T=Ki(T),D=function(Ne){return ye(re[Ne],Ne,re)}}var Le=g(T,D,G);return Le>-1?re[ye?T[Le]:Le]:h}}function _e(g){return Ze(function(T){var D=T.length,G=D,re=ks.prototype.thru;for(g&&T.reverse();G--;){var ye=T[G];if(typeof ye!="function")throw new $i(P);if(re&&!Le&&yn(ye)=="wrapper")var Le=new ks([],!0)}for(G=Le?G:D;++G<D;){ye=T[G];var Ne=yn(ye),Xe=Ne=="wrapper"?sn(ye):h;Xe&&Us(Xe[0])&&Xe[1]==(Ot|Me|pt|zt)&&!Xe[4].length&&Xe[9]==1?Le=Le[yn(Xe[0])].apply(Le,Xe[3]):Le=ye.length==1&&Us(ye)?Le[Ne]():Le.thru(ye)}return function(){var It=arguments,Mt=It[0];if(Le&&It.length==1&&$n(Mt))return Le.plant(Mt).value();for(var Dt=0,$t=D?T[Dt].apply(this,It):Mt;++Dt<D;)$t=T[Dt].call(this,$t);return $t}})}function se(g,T,D,G,re,ye,Le,Ne,Xe,It){var Mt=T&Ot,Dt=T&Tt,$t=T&Te,hn=T&(Me|et),Mn=T&Zn,ir=$t?h:oe(g);function In(){for(var ur=arguments.length,dr=ct(ur),Io=ur;Io--;)dr[Io]=arguments[Io];if(hn)var qs=Sn(In),Po=Cd(dr,qs);if(G&&(dr=S(dr,G,re,hn)),ye&&(dr=C(dr,ye,Le,hn)),ur-=Po,hn&&ur<It){var ui=To(dr,qs);return tt(g,T,se,In.placeholder,D,dr,ui,Ne,Xe,It-ur)}var ta=Dt?D:this,pu=$t?ta[g]:g;return ur=dr.length,Ne?dr=Qd(dr,Ne):Mn&&ur>1&&dr.reverse(),Mt&&Xe<ur&&(dr.length=Xe),this&&this!==Xt&&this instanceof In&&(pu=ir||oe(pu)),pu.apply(ta,dr)}return In}function le(g,T){return function(D,G){return ol(D,g,T(G),{})}}function ce(g,T){return function(D,G){var re;if(D===h&&G===h)return T;if(D!==h&&(re=D),G!==h){if(re===h)return G;typeof D=="string"||typeof G=="string"?(D=Ts(D),G=Ts(G)):(D=Dp(D),G=Dp(G)),re=g(D,G)}return re}}function Se(g){return Ze(function(T){return T=mr(T,ss(Vt())),Yn(function(D){var G=this;return g(T,function(re){return Wi(re,G,D)})})})}function Oe(g,T){T=T===h?" ":Ts(T);var D=T.length;if(D<2)return D?Sc(T,g):T;var G=Sc(T,Rt(g/Vo(T)));return Ka(T)?Es(os(G),0,g).join(""):G.slice(0,g)}function pe(g,T,D,G){var re=T&Tt,ye=oe(g);function Le(){for(var Ne=-1,Xe=arguments.length,It=-1,Mt=G.length,Dt=ct(Mt+Xe),$t=this&&this!==Xt&&this instanceof Le?ye:g;++It<Mt;)Dt[It]=G[It];for(;Xe--;)Dt[It++]=arguments[++Ne];return Wi($t,re?D:this,Dt)}return Le}function Be(g){return function(T,D,G){return G&&typeof G!="number"&&Sr(T,D,G)&&(D=G=h),T=Da(T),D===h?(D=T,T=0):D=Da(D),G=G===h?T<D?1:-1:Da(G),Wd(T,D,G,g)}}function Fe(g){return function(T,D){return typeof T=="string"&&typeof D=="string"||(T=ea(T),D=ea(D)),g(T,D)}}function tt(g,T,D,G,re,ye,Le,Ne,Xe,It){var Mt=T&Me,Dt=Mt?Le:h,$t=Mt?h:Le,hn=Mt?ye:h,Mn=Mt?h:ye;T|=Mt?pt:Ct,T&=~(Mt?Ct:pt),T&Ee||(T&=~(Tt|Te));var ir=[g,T,re,hn,Dt,Mn,$t,Ne,Xe,It],In=D.apply(h,ir);return Us(g)&&ii(In,ir),In.placeholder=G,Er(In,g,T)}function rt(g){var T=pi[g];return function(D,G){if(D=ea(D),G=G==null?0:Gr(tr(G),292),G&&Zl(D)){var re=(Ir(D)+"e").split("e"),ye=T(re[0]+"e"+(+re[1]+G));return re=(Ir(ye)+"e").split("e"),+(re[0]+"e"+(+re[1]-G))}return T(D)}}var Qe=no&&1/Ja(new no([,-0]))[1]==Cn?function(g){return new no(g)}:v_;function Pe(g){return function(T){var D=Dn(T);return D==ms?ec(T):D==Zt?Wl(T):Um(T,g(T))}}function je(g,T,D,G,re,ye,Le,Ne){var Xe=T&Te;if(!Xe&&typeof g!="function")throw new $i(P);var It=G?G.length:0;if(It||(T&=~(pt|Ct),G=re=h),Le=Le===h?Le:Xr(tr(Le),0),Ne=Ne===h?Ne:tr(Ne),It-=re?re.length:0,T&Ct){var Mt=G,Dt=re;G=re=h}var $t=Xe?h:sn(g),hn=[g,T,D,G,re,Mt,Dt,ye,Le,Ne];if($t&&Ec(hn,$t),g=hn[0],T=hn[1],D=hn[2],G=hn[3],re=hn[4],Ne=hn[9]=hn[9]===h?Xe?0:g.length:Xr(hn[9]-It,0),!Ne&&T&(Me|et)&&(T&=~(Me|et)),!T||T==Tt)var Mn=X(g,T,D);else T==Me||T==et?Mn=ue(g,T,Ne):(T==pt||T==(Tt|pt))&&!re.length?Mn=pe(g,T,D,G):Mn=se.apply(h,hn);var ir=$t?qd:ii;return Er(ir(Mn,hn),g,T)}function Ke(g,T,D,G){return g===h||La(g,to[D])&&!Tr.call(G,D)?T:g}function bt(g,T,D,G,re,ye){return Wr(g)&&Wr(T)&&(ye.set(T,g),wc(g,T,h,bt,ye),ye.delete(T)),g}function St(g){return uf(g)?h:g}function Pt(g,T,D,G,re,ye){var Le=D&Re,Ne=g.length,Xe=T.length;if(Ne!=Xe&&!(Le&&Xe>Ne))return!1;var It=ye.get(g),Mt=ye.get(T);if(It&&Mt)return It==T&&Mt==g;var Dt=-1,$t=!0,hn=D&Ue?new qi:h;for(ye.set(g,T),ye.set(T,g);++Dt<Ne;){var Mn=g[Dt],ir=T[Dt];if(G)var In=Le?G(ir,Mn,Dt,T,g,ye):G(Mn,ir,Dt,g,T,ye);if(In!==h){if(In)continue;$t=!1;break}if(hn){if(!$u(T,function(ur,dr){if(!Ya(hn,dr)&&(Mn===ur||re(Mn,ur,D,G,ye)))return hn.push(dr)})){$t=!1;break}}else if(!(Mn===ir||re(Mn,ir,D,G,ye))){$t=!1;break}}return ye.delete(g),ye.delete(T),$t}function Et(g,T,D,G,re,ye,Le){switch(D){case Ls:if(g.byteLength!=T.byteLength||g.byteOffset!=T.byteOffset)return!1;g=g.buffer,T=T.buffer;case pa:return!(g.byteLength!=T.byteLength||!ye(new Hl(g),new Hl(T)));case Ga:case en:case fa:return La(+g,+T);case pr:return g.name==T.name&&g.message==T.message;case Qt:case ko:return g==T+"";case ms:var Ne=ec;case Zt:var Xe=G&Re;if(Ne||(Ne=Ja),g.size!=T.size&&!Xe)return!1;var It=Le.get(g);if(It)return It==T;G|=Ue,Le.set(g,T);var Mt=Pt(Ne(g),Ne(T),G,re,ye,Le);return Le.delete(g),Mt;case ji:if(Ta)return Ta.call(g)==Ta.call(T)}return!1}function ot(g,T,D,G,re,ye){var Le=D&Re,Ne=kt(g),Xe=Ne.length,It=kt(T),Mt=It.length;if(Xe!=Mt&&!Le)return!1;for(var Dt=Xe;Dt--;){var $t=Ne[Dt];if(!(Le?$t in T:Tr.call(T,$t)))return!1}var hn=ye.get(g),Mn=ye.get(T);if(hn&&Mn)return hn==T&&Mn==g;var ir=!0;ye.set(g,T),ye.set(T,g);for(var In=Le;++Dt<Xe;){$t=Ne[Dt];var ur=g[$t],dr=T[$t];if(G)var Io=Le?G(dr,ur,$t,T,g,ye):G(ur,dr,$t,g,T,ye);if(!(Io===h?ur===dr||re(ur,dr,D,G,ye):Io)){ir=!1;break}In||(In=$t=="constructor")}if(ir&&!In){var qs=g.constructor,Po=T.constructor;qs!=Po&&"constructor"in g&&"constructor"in T&&!(typeof qs=="function"&&qs instanceof qs&&typeof Po=="function"&&Po instanceof Po)&&(ir=!1)}return ye.delete(g),ye.delete(T),ir}function Ze(g){return hl(ru(g,h,i_),g+"")}function kt(g){return Bd(g,Ki,En)}function cn(g){return Bd(g,lo,ln)}var sn=vh?function(g){return vh.get(g)}:v_;function yn(g){for(var T=g.name+"",D=mi[T],G=Tr.call(mi,T)?D.length:0;G--;){var re=D[G],ye=re.func;if(ye==null||ye==g)return re.name}return T}function Sn(g){var T=Tr.call(fe,"placeholder")?fe:g;return T.placeholder}function Vt(){var g=fe.iteratee||Dy;return g=g===Dy?ll:g,arguments.length?g(arguments[0],arguments[1]):g}function tn(g,T){var D=g.__data__;return cs(T)?D[typeof T=="string"?"string":"hash"]:D.map}function Hn(g){for(var T=Ki(g),D=T.length;D--;){var G=T[D],re=g[G];T[D]=[G,re,Xo(re)]}return T}function er(g,T){var D=up(g,T);return xc(D)?D:h}function nr(g){var T=Tr.call(g,jo),D=g[jo];try{g[jo]=h;var G=!0}catch{}var re=rc.call(g);return G&&(T?g[jo]=D:delete g[jo]),re}var En=Nn?function(g){return g==null?[]:(g=zr(g),xr(Nn(g),function(T){return Gn.call(g,T)}))}:mf,ln=Nn?function(g){for(var T=[];g;)jr(T,En(g)),g=Qa(g);return T}:mf,Dn=Fi;(xh&&Dn(new xh(new ArrayBuffer(1)))!=Ls||Wo&&Dn(new Wo)!=ms||Xl&&Dn(Xl.resolve())!=Ks||no&&Dn(new no)!=Zt||oi&&Dn(new oi)!=Oo)&&(Dn=function(g){var T=Fi(g),D=T==wi?g.constructor:h,G=D?so(D):"";if(G)switch(G){case ni:return Ls;case ro:return ms;case ba:return Ks;case _i:return Zt;case _p:return Oo}return T});function vr(g,T,D){for(var G=-1,re=D.length;++G<re;){var ye=D[G],Le=ye.size;switch(ye.type){case"drop":g+=Le;break;case"dropRight":T-=Le;break;case"take":T=Gr(T,g+Le);break;case"takeRight":g=Xr(g,T-Le);break}}return{start:g,end:T}}function ar(g){var T=g.match(Nu);return T?T[1].split(Jc):[]}function nt(g,T,D){T=Ss(T,g);for(var G=-1,re=T.length,ye=!1;++G<re;){var Le=Ao(T[G]);if(!(ye=g!=null&&D(g,Le)))break;g=g[Le]}return ye||++G!=re?ye:(re=g==null?0:g.length,!!re&&Kp(re)&&Vr(Le,re)&&($n(g)||Qo(g)))}function At(g){var T=g.length,D=new g.constructor(T);return T&&typeof g[0]=="string"&&Tr.call(g,"index")&&(D.index=g.index,D.input=g.input),D}function Mr(g){return typeof g.constructor=="function"&&!io(g)?cc(Qa(g)):{}}function Kn(g,T,D){var G=g.constructor;switch(T){case pa:return Op(g);case Ga:case en:return new G(+g);case Ls:return f(g,D);case ma:case Wa:case Dl:case $a:case qa:case _s:case ku:case rn:case zl:return p(g,D);case ms:return new G;case fa:case ko:return new G(g);case Qt:return i(g);case Zt:return new G;case ji:return u(g)}}function ke(g,T){var D=T.length;if(!D)return g;var G=D-1;return T[G]=(D>1?"& ":"")+T[G],T=T.join(D>2?", ":" "),g.replace(Bl,`{
/* [wrapped with `+T+`] */
`)}function Vs(g){return $n(g)||Qo(g)||!!(Ht&&g&&g[Ht])}function Vr(g,T){var D=typeof g;return T=T??Gt,!!T&&(D=="number"||D!="symbol"&&Ie.test(g))&&g>-1&&g%1==0&&g<T}function Sr(g,T,D){if(!Wr(D))return!1;var G=typeof T;return(G=="number"?Ws(D)&&Vr(T,D.length):G=="string"&&T in D)?La(D[T],g):!1}function ri(g,T){if($n(g))return!1;var D=typeof g;return D=="number"||D=="symbol"||D=="boolean"||g==null||ao(g)?!0:Fu.test(g)||!fd.test(g)||T!=null&&g in zr(T)}function cs(g){var T=typeof g;return T=="string"||T=="number"||T=="symbol"||T=="boolean"?g!=="__proto__":g===null}function Us(g){var T=yn(g),D=fe[T];if(typeof D!="function"||!(T in or.prototype))return!1;if(g===D)return!0;var G=sn(D);return!!G&&g===G[0]}function js(g){return!!ql&&ql in g}var cl=gh?cu:Bc;function io(g){var T=g&&g.constructor,D=typeof T=="function"&&T.prototype||to;return g===D}function Xo(g){return g===g&&!Wr(g)}function Co(g,T){return function(D){return D==null?!1:D[g]===T&&(T!==h||g in zr(D))}}function Ma(g){var T=qp(g,function(G){return D.size===q&&D.clear(),G}),D=T.cache;return T}function Ec(g,T){var D=g[1],G=T[1],re=D|G,ye=re<(Tt|Te|Ot),Le=G==Ot&&D==Me||G==Ot&&D==zt&&g[7].length<=T[8]||G==(Ot|zt)&&T[7].length<=T[8]&&D==Me;if(!(ye||Le))return g;G&Tt&&(g[2]=T[2],re|=D&Tt?0:Ee);var Ne=T[3];if(Ne){var Xe=g[3];g[3]=Xe?S(Xe,Ne,T[4]):Ne,g[4]=Xe?To(g[3],J):T[4]}return Ne=T[5],Ne&&(Xe=g[5],g[5]=Xe?C(Xe,Ne,T[6]):Ne,g[6]=Xe?To(g[5],J):T[6]),Ne=T[7],Ne&&(g[7]=Ne),G&Ot&&(g[8]=g[8]==null?T[8]:Gr(g[8],T[8])),g[9]==null&&(g[9]=T[9]),g[0]=T[0],g[1]=re,g}function Cc(g){var T=[];if(g!=null)for(var D in zr(g))T.push(D);return T}function nu(g){return rc.call(g)}function ru(g,T,D){return T=Xr(T===h?g.length-1:T,0),function(){for(var G=arguments,re=-1,ye=Xr(G.length-T,0),Le=ct(ye);++re<ye;)Le[re]=G[T+re];re=-1;for(var Ne=ct(T+1);++re<T;)Ne[re]=G[re];return Ne[T]=D(Le),Wi(g,this,Ne)}}function Bh(g,T){return T.length<2?g:sl(g,Ns(T,0,-1))}function Qd(g,T){for(var D=g.length,G=Gr(T.length,D),re=R(g);G--;){var ye=T[G];g[G]=Vr(ye,D)?re[ye]:h}return g}function Fh(g,T){if(!(T==="constructor"&&typeof g[T]=="function")&&T!="__proto__")return g[T]}var ii=Xn(qd),iu=lc||function(g,T){return Xt.setTimeout(g,T)},hl=Xn(Hd);function Er(g,T,D){var G=T+"";return hl(g,ke(G,Og(ar(G),D)))}function Xn(g){var T=0,D=0;return function(){var G=ys(),re=bn-(G-D);if(D=G,re>0){if(++T>=rs)return arguments[0]}else T=0;return g.apply(h,arguments)}}function Bp(g,T){var D=-1,G=g.length,re=G-1;for(T=T===h?G:T;++D<T;){var ye=Lh(D,re),Le=g[ye];g[ye]=g[D],g[D]=Le}return g.length=T,g}var Yo=Ma(function(g){var T=[];return g.charCodeAt(0)===46&&T.push(""),g.replace(Js,function(D,G,re,ye){T.push(re?ye.replace($,"$1"):G||D)}),T});function Ao(g){if(typeof g=="string"||ao(g))return g;var T=g+"";return T=="0"&&1/g==-Cn?"-0":T}function so(g){if(g!=null){try{return Id.call(g)}catch{}try{return g+""}catch{}}return""}function Og(g,T){return Li(ps,function(D){var G="_."+D[0];T&D[1]&&!zs(g,G)&&g.push(G)}),g.sort()}function e_(g){if(g instanceof or)return g.clone();var T=new ks(g.__wrapped__,g.__chain__);return T.__actions__=R(g.__actions__),T.__index__=g.__index__,T.__values__=g.__values__,T}function Ac(g,T,D){(D?Sr(g,T,D):T===h)?T=1:T=Xr(tr(T),0);var G=g==null?0:g.length;if(!G||T<1)return[];for(var re=0,ye=0,Le=ct(Rt(G/T));re<G;)Le[ye++]=Ns(g,re,re+=T);return Le}function Mc(g){for(var T=-1,D=g==null?0:g.length,G=0,re=[];++T<D;){var ye=g[T];ye&&(re[G++]=ye)}return re}function Ic(){var g=arguments.length;if(!g)return[];for(var T=ct(g-1),D=arguments[0],G=g;G--;)T[G-1]=arguments[G];return jr($n(D)?R(D):[D],Bi(T,1))}var t_=Yn(function(g,T){return Ei(g)?Yl(g,Bi(T,1,Ei,!0)):[]}),n_=Yn(function(g,T){var D=oo(T);return Ei(D)&&(D=h),Ei(g)?Yl(g,Bi(T,1,Ei,!0),Vt(D,2)):[]}),Bg=Yn(function(g,T){var D=oo(T);return Ei(D)&&(D=h),Ei(g)?Yl(g,Bi(T,1,Ei,!0),h,D):[]});function Fg(g,T,D){var G=g==null?0:g.length;return G?(T=D||T===h?1:tr(T),Ns(g,T<0?0:T,G)):[]}function Ng(g,T,D){var G=g==null?0:g.length;return G?(T=D||T===h?1:tr(T),T=G-T,Ns(g,0,T<0?0:T)):[]}function Nh(g,T){return g&&g.length?zh(g,Vt(T,3),!0,!0):[]}function Pc(g,T){return g&&g.length?zh(g,Vt(T,3),!0):[]}function Vg(g,T,D,G){var re=g==null?0:g.length;return re?(D&&typeof D!="number"&&Sr(g,T,D)&&(D=0,G=re),zg(g,T,D,G)):[]}function Fp(g,T,D){var G=g==null?0:g.length;if(!G)return-1;var re=D==null?0:tr(D);return re<0&&(re=Xr(G+re,0)),jl(g,Vt(T,3),re)}function r_(g,T,D){var G=g==null?0:g.length;if(!G)return-1;var re=G-1;return D!==h&&(re=tr(D),re=D<0?Xr(G+re,0):Gr(re,G-1)),jl(g,Vt(T,3),re,!0)}function i_(g){var T=g==null?0:g.length;return T?Bi(g,1):[]}function Si(g){var T=g==null?0:g.length;return T?Bi(g,Cn):[]}function Ug(g,T){var D=g==null?0:g.length;return D?(T=T===h?1:tr(T),Bi(g,T)):[]}function jg(g){for(var T=-1,D=g==null?0:g.length,G={};++T<D;){var re=g[T];G[re[0]]=re[1]}return G}function Rc(g){return g&&g.length?g[0]:h}function Gg(g,T,D){var G=g==null?0:g.length;if(!G)return-1;var re=D==null?0:tr(D);return re<0&&(re=Xr(G+re,0)),eo(g,T,re)}function ef(g){var T=g==null?0:g.length;return T?Ns(g,0,-1):[]}var Wg=Yn(function(g){var T=mr(g,Jd);return T.length&&T[0]===g[0]?gi(T):[]}),Np=Yn(function(g){var T=oo(g),D=mr(g,Jd);return T===oo(D)?T=h:D.pop(),D.length&&D[0]===g[0]?gi(D,Vt(T,2)):[]}),$g=Yn(function(g){var T=oo(g),D=mr(g,Jd);return T=typeof T=="function"?T:h,T&&D.pop(),D.length&&D[0]===g[0]?gi(D,h,T):[]});function s_(g,T){return g==null?"":Wn.call(g,T)}function oo(g){var T=g==null?0:g.length;return T?g[T-1]:h}function qg(g,T,D){var G=g==null?0:g.length;if(!G)return-1;var re=G;return D!==h&&(re=tr(D),re=re<0?Xr(G+re,0):Gr(re,G-1)),T===T?hp(g,T,re):jl(g,Sd,re,!0)}function lx(g,T){return g&&g.length?Ip(g,tr(T)):h}var Hg=Yn(Zg);function Zg(g,T){return g&&g.length&&T&&T.length?Gd(g,T):g}function ux(g,T,D){return g&&g.length&&T&&T.length?Gd(g,T,Vt(D,2)):g}function cx(g,T,D){return g&&g.length&&T&&T.length?Gd(g,T,h,D):g}var hx=Ze(function(g,T){var D=g==null?0:g.length,G=$o(g,T);return bs(g,mr(T,function(re){return Vr(re,D)?+re:re}).sort(x)),G});function dx(g,T){var D=[];if(!(g&&g.length))return D;var G=-1,re=[],ye=g.length;for(T=Vt(T,3);++G<ye;){var Le=g[G];T(Le,G,g)&&(D.push(Le),re.push(G))}return bs(g,re),D}function o_(g){return g==null?g:yh.call(g)}function fx(g,T,D){var G=g==null?0:g.length;return G?(D&&typeof D!="number"&&Sr(g,T,D)?(T=0,D=G):(T=T==null?0:tr(T),D=D===h?G:tr(D)),Ns(g,T,D)):[]}function px(g,T){return Zd(g,T)}function mx(g,T,D){return Xd(g,T,Vt(D,2))}function $w(g,T){var D=g==null?0:g.length;if(D){var G=Zd(g,T);if(G<D&&La(g[G],T))return G}return-1}function qw(g,T){return Zd(g,T,!0)}function Lr(g,T,D){return Xd(g,T,Vt(D,2),!0)}function _x(g,T){var D=g==null?0:g.length;if(D){var G=Zd(g,T,!0)-1;if(La(g[G],T))return G}return-1}function Hw(g){return g&&g.length?Lp(g):[]}function Zw(g,T){return g&&g.length?Lp(g,Vt(T,2)):[]}function Vp(g){var T=g==null?0:g.length;return T?Ns(g,1,T):[]}function gx(g,T,D){return g&&g.length?(T=D||T===h?1:tr(T),Ns(g,0,T<0?0:T)):[]}function Xg(g,T,D){var G=g==null?0:g.length;return G?(T=D||T===h?1:tr(T),T=G-T,Ns(g,T<0?0:T,G)):[]}function a_(g,T){return g&&g.length?zh(g,Vt(T,3),!1,!0):[]}function su(g,T){return g&&g.length?zh(g,Vt(T,3)):[]}var l_=Yn(function(g){return Zo(Bi(g,1,Ei,!0))}),Cs=Yn(function(g){var T=oo(g);return Ei(T)&&(T=h),Zo(Bi(g,1,Ei,!0),Vt(T,2))}),ou=Yn(function(g){var T=oo(g);return T=typeof T=="function"?T:h,Zo(Bi(g,1,Ei,!0),h,T)});function Yg(g){return g&&g.length?Zo(g):[]}function Kg(g,T){return g&&g.length?Zo(g,Vt(T,2)):[]}function yx(g,T){return T=typeof T=="function"?T:h,g&&g.length?Zo(g,h,T):[]}function Jg(g){if(!(g&&g.length))return[];var T=0;return g=xr(g,function(D){if(Ei(D))return T=Xr(D.length,T),!0}),mh(T,function(D){return mr(g,Zu(D))})}function tf(g,T){if(!(g&&g.length))return[];var D=Jg(g);return T==null?D:mr(D,function(G){return Wi(T,h,G)})}var Xw=Yn(function(g,T){return Ei(g)?Yl(g,T):[]}),Yw=Yn(function(g){return Kd(xr(g,Ei))}),Qg=Yn(function(g){var T=oo(g);return Ei(T)&&(T=h),Kd(xr(g,Ei),Vt(T,2))}),ey=Yn(function(g){var T=oo(g);return T=typeof T=="function"?T:h,Kd(xr(g,Ei),h,T)}),Up=Yn(Jg);function nf(g,T){return zp(g||[],T||[],pc)}function au(g,T){return zp(g||[],T||[],Ho)}var Ia=Yn(function(g){var T=g.length,D=T>1?g[T-1]:h;return D=typeof D=="function"?(g.pop(),D):h,tf(g,D)});function lu(g){var T=fe(g);return T.__chain__=!0,T}function Vh(g,T){return T(g),g}function Pa(g,T){return T(g)}var Kw=Ze(function(g){var T=g.length,D=T?g[0]:0,G=this.__wrapped__,re=function(ye){return $o(ye,g)};return T>1||this.__actions__.length||!(G instanceof or)||!Vr(D)?this.thru(re):(G=G.slice(D,+D+(T?1:0)),G.__actions__.push({func:Pa,args:[re],thisArg:h}),new ks(G,this.__chain__).thru(function(ye){return T&&!ye.length&&ye.push(h),ye}))});function Jw(){return lu(this)}function Qw(){return new ks(this.value(),this.__chain__)}function eb(){this.__values__===h&&(this.__values__=xy(this.value()));var g=this.__index__>=this.__values__.length,T=g?h:this.__values__[this.__index__++];return{done:g,value:T}}function xx(){return this}function As(g){for(var T,D=this;D instanceof vs;){var G=e_(D);G.__index__=0,G.__values__=h,T?re.__wrapped__=G:T=G;var re=G;D=D.__wrapped__}return re.__wrapped__=g,T}function ty(){var g=this.__wrapped__;if(g instanceof or){var T=g;return this.__actions__.length&&(T=new or(this)),T=T.reverse(),T.__actions__.push({func:Pa,args:[o_],thisArg:h}),new ks(T,this.__chain__)}return this.thru(o_)}function vx(){return ul(this.__wrapped__,this.__actions__)}var tb=U(function(g,T,D){Tr.call(g,D)?++g[D]:Oi(g,D,1)});function rf(g,T,D){var G=$n(g)?Td:il;return D&&Sr(g,T,D)&&(T=h),G(g,Vt(T,3))}function ny(g,T){var D=$n(g)?xr:Ep;return D(g,Vt(T,3))}var Ko=ge(Fp),Jo=ge(r_);function sf(g,T){return Bi(jp(g,T),1)}function Uh(g,T){return Bi(jp(g,T),Cn)}function of(g,T,D){return D=D===h?1:tr(D),Bi(jp(g,T),D)}function u_(g,T){var D=$n(g)?Li:rl;return D(g,Vt(T,3))}function Un(g,T){var D=$n(g)?No:Sp;return D(g,Vt(T,3))}var Lc=U(function(g,T,D){Tr.call(g,D)?g[D].push(T):Oi(g,D,[T])});function wx(g,T,D,G){g=Ws(g)?g:gl(g),D=D&&!G?tr(D):0;var re=g.length;return D<0&&(D=Xr(re+D,0)),Gh(g)?D<=re&&g.indexOf(T,D)>-1:!!re&&eo(g,T,D)>-1}var nb=Yn(function(g,T,D){var G=-1,re=typeof T=="function",ye=Ws(g)?ct(g.length):[];return rl(g,function(Le){ye[++G]=re?Wi(T,Le,D):al(Le,T,D)}),ye}),jh=U(function(g,T,D){Oi(g,D,T)});function jp(g,T){var D=$n(g)?mr:Mp;return D(g,Vt(T,3))}function ai(g,T,D,G){return g==null?[]:($n(T)||(T=T==null?[]:[T]),D=G?h:D,$n(D)||(D=D==null?[]:[D]),Pp(g,T,D))}var Gp=U(function(g,T,D){g[D?0:1].push(T)},function(){return[[],[]]});function rb(g,T,D){var G=$n(g)?dh:Gl,re=arguments.length<3;return G(g,Vt(T,4),D,re,rl)}function ib(g,T,D){var G=$n(g)?op:Gl,re=arguments.length<3;return G(g,Vt(T,4),D,re,Sp)}function sb(g,T){var D=$n(g)?xr:Ep;return D(g,d_(Vt(T,3)))}function ry(g){var T=$n(g)?Os:Rp;return T(g)}function dl(g,T,D){(D?Sr(g,T,D):T===h)?T=1:T=tr(T);var G=$n(g)?Eh:$d;return G(g,T)}function fl(g){var T=$n(g)?wp:Dh;return T(g)}function Ms(g){if(g==null)return 0;if(Ws(g))return Gh(g)?Vo(g):g.length;var T=Dn(g);return T==ms||T==Zt?g.size:Ud(g).length}function Gs(g,T,D){var G=$n(g)?$u:eu;return D&&Sr(g,T,D)&&(T=h),G(g,Vt(T,3))}var Ni=Yn(function(g,T){if(g==null)return[];var D=T.length;return D>1&&Sr(g,T[0],T[1])?T=[]:D>2&&Sr(T[0],T[1],T[2])&&(T=[T[0]]),Pp(g,Bi(T,1),[])}),Wp=mp||function(){return Xt.Date.now()};function Kr(g,T){if(typeof T!="function")throw new $i(P);return g=tr(g),function(){if(--g<1)return T.apply(this,arguments)}}function iy(g,T,D){return T=D?h:T,T=g&&T==null?g.length:T,je(g,Ot,h,h,h,h,T)}function Dc(g,T){var D;if(typeof T!="function")throw new $i(P);return g=tr(g),function(){return--g>0&&(D=T.apply(this,arguments)),g<=1&&(T=h),D}}var c_=Yn(function(g,T,D){var G=Tt;if(D.length){var re=To(D,Sn(c_));G|=pt}return je(g,G,T,D,re)}),$p=Yn(function(g,T,D){var G=Tt|Te;if(D.length){var re=To(D,Sn($p));G|=pt}return je(T,G,g,D,re)});function Hi(g,T,D){T=D?h:T;var G=je(g,Me,h,h,h,h,h,T);return G.placeholder=Hi.placeholder,G}function h_(g,T,D){T=D?h:T;var G=je(g,et,h,h,h,h,h,T);return G.placeholder=h_.placeholder,G}function sy(g,T,D){var G,re,ye,Le,Ne,Xe,It=0,Mt=!1,Dt=!1,$t=!0;if(typeof g!="function")throw new $i(P);T=ea(T)||0,Wr(D)&&(Mt=!!D.leading,Dt="maxWait"in D,ye=Dt?Xr(ea(D.maxWait)||0,T):ye,$t="trailing"in D?!!D.trailing:$t);function hn(ui){var ta=G,pu=re;return G=re=h,It=ui,Le=g.apply(pu,ta),Le}function Mn(ui){return It=ui,Ne=iu(ur,T),Mt?hn(ui):Le}function ir(ui){var ta=ui-Xe,pu=ui-It,g1=T-ta;return Dt?Gr(g1,ye-pu):g1}function In(ui){var ta=ui-Xe,pu=ui-It;return Xe===h||ta>=T||ta<0||Dt&&pu>=ye}function ur(){var ui=Wp();if(In(ui))return dr(ui);Ne=iu(ur,ir(ui))}function dr(ui){return Ne=h,$t&&G?hn(ui):(G=re=h,Le)}function Io(){Ne!==h&&kp(Ne),It=0,G=Xe=re=Ne=h}function qs(){return Ne===h?Le:dr(Wp())}function Po(){var ui=Wp(),ta=In(ui);if(G=arguments,re=this,Xe=ui,ta){if(Ne===h)return Mn(Xe);if(Dt)return kp(Ne),Ne=iu(ur,T),hn(Xe)}return Ne===h&&(Ne=iu(ur,T)),Le}return Po.cancel=Io,Po.flush=qs,Po}var oy=Yn(function(g,T){return Ym(g,1,T)}),ob=Yn(function(g,T,D){return Ym(g,ea(T)||0,D)});function ay(g){return je(g,Zn)}function qp(g,T){if(typeof g!="function"||T!=null&&typeof T!="function")throw new $i(P);var D=function(){var G=arguments,re=T?T.apply(this,G):G[0],ye=D.cache;if(ye.has(re))return ye.get(re);var Le=g.apply(this,G);return D.cache=ye.set(re,Le)||ye,Le};return D.cache=new(qp.Cache||Ca),D}qp.Cache=Ca;function d_(g){if(typeof g!="function")throw new $i(P);return function(){var T=arguments;switch(T.length){case 0:return!g.call(this);case 1:return!g.call(this,T[0]);case 2:return!g.call(this,T[0],T[1]);case 3:return!g.call(this,T[0],T[1],T[2])}return!g.apply(this,T)}}function Ra(g){return Dc(2,g)}var uu=Qm(function(g,T){T=T.length==1&&$n(T[0])?mr(T[0],ss(Vt())):mr(Bi(T,1),ss(Vt()));var D=T.length;return Yn(function(G){for(var re=-1,ye=Gr(G.length,D);++re<ye;)G[re]=T[re].call(this,G[re]);return Wi(g,this,G)})}),af=Yn(function(g,T){var D=To(T,Sn(af));return je(g,pt,h,T,D)}),Hp=Yn(function(g,T){var D=To(T,Sn(Hp));return je(g,Ct,h,T,D)}),ly=Ze(function(g,T){return je(g,zt,h,h,h,T)});function uy(g,T){if(typeof g!="function")throw new $i(P);return T=T===h?T:tr(T),Yn(g,T)}function ab(g,T){if(typeof g!="function")throw new $i(P);return T=T==null?0:Xr(tr(T),0),Yn(function(D){var G=D[T],re=Es(D,0,T);return G&&jr(re,G),Wi(g,this,re)})}function bx(g,T,D){var G=!0,re=!0;if(typeof g!="function")throw new $i(P);return Wr(D)&&(G="leading"in D?!!D.leading:G,re="trailing"in D?!!D.trailing:re),sy(g,T,{leading:G,maxWait:T,trailing:re})}function lb(g){return iy(g,1)}function cy(g,T){return af(kh(T),g)}function ub(){if(!arguments.length)return[];var g=arguments[0];return $n(g)?g:[g]}function hy(g){return us(g,xe)}function Tx(g,T){return T=typeof T=="function"?T:h,us(g,xe,T)}function Sx(g){return us(g,Q|xe)}function zc(g,T){return T=typeof T=="function"?T:h,us(g,Q|xe,T)}function Ex(g,T){return T==null||Xm(g,T,Ki(T))}function La(g,T){return g===T||g!==g&&T!==T}var lf=Fe(Ch),dy=Fe(function(g,T){return g>=T}),Qo=Fd(function(){return arguments}())?Fd:function(g){return ei(g)&&Tr.call(g,"callee")&&!Gn.call(g,"callee")},$n=ct.isArray,Cx=Vm?ss(Vm):Mh;function Ws(g){return g!=null&&Kp(g.length)&&!cu(g)}function Ei(g){return ei(g)&&Ws(g)}function cb(g){return g===!0||g===!1||ei(g)&&Fi(g)==Ga}var pl=ls||Bc,fy=uh?ss(uh):Nd;function Zp(g){return ei(g)&&g.nodeType===1&&!uf(g)}function Ax(g){if(g==null)return!0;if(Ws(g)&&($n(g)||typeof g=="string"||typeof g.splice=="function"||pl(g)||_l(g)||Qo(g)))return!g.length;var T=Dn(g);if(T==ms||T==Zt)return!g.size;if(io(g))return!Ud(g).length;for(var D in g)if(Tr.call(g,D))return!1;return!0}function Mx(g,T){return Aa(g,T)}function Ix(g,T,D){D=typeof D=="function"?D:h;var G=D?D(g,T):h;return G===h?Aa(g,T,h,D):!!G}function Xp(g){if(!ei(g))return!1;var T=Fi(g);return T==pr||T==Lu||typeof g.message=="string"&&typeof g.name=="string"&&!uf(g)}function Dr(g){return typeof g=="number"&&Zl(g)}function cu(g){if(!Wr(g))return!1;var T=Fi(g);return T==Rl||T==Xc||T==da||T==Yc}function Yp(g){return typeof g=="number"&&g==tr(g)}function Kp(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=Gt}function Wr(g){var T=typeof g;return g!=null&&(T=="object"||T=="function")}function ei(g){return g!=null&&typeof g=="object"}var Px=ch?ss(ch):Ih;function Rx(g,T){return g===T||yc(g,T,Hn(T))}function hb(g,T,D){return D=typeof D=="function"?D:h,yc(g,T,Hn(T),D)}function py(g){return my(g)&&g!=+g}function ml(g){if(cl(g))throw new An(M);return xc(g)}function hu(g){return g===null}function Lx(g){return g==null}function my(g){return typeof g=="number"||ei(g)&&Fi(g)==fa}function uf(g){if(!ei(g)||Fi(g)!=wi)return!1;var T=Qa(g);if(T===null)return!0;var D=Tr.call(T,"constructor")&&T.constructor;return typeof D=="function"&&D instanceof D&&Id.call(D)==ic}var cf=wd?ss(wd):Vd;function _y(g){return Yp(g)&&g>=-Gt&&g<=Gt}var hf=bd?ss(bd):Jm;function Gh(g){return typeof g=="string"||!$n(g)&&ei(g)&&Fi(g)==ko}function ao(g){return typeof g=="symbol"||ei(g)&&Fi(g)==ji}var _l=hh?ss(hh):Cp;function gy(g){return g===h}function yy(g){return ei(g)&&Dn(g)==Oo}function Dx(g){return ei(g)&&Fi(g)==zu}var zx=Fe(vc),du=Fe(function(g,T){return g<=T});function xy(g){if(!g)return[];if(Ws(g))return Gh(g)?os(g):R(g);if(oc&&g[oc])return jm(g[oc]());var T=Dn(g),D=T==ms?ec:T==Zt?Ja:gl;return D(g)}function Da(g){if(!g)return g===0?g:0;if(g=ea(g),g===Cn||g===-Cn){var T=g<0?-1:1;return T*_n}return g===g?g:0}function tr(g){var T=Da(g),D=T%1;return T===T?D?T-D:T:0}function kx(g){return g?Bs(tr(g),0,lr):0}function ea(g){if(typeof g=="number")return g;if(ao(g))return zn;if(Wr(g)){var T=typeof g.valueOf=="function"?g.valueOf():g;g=Wr(T)?T+"":T}if(typeof g!="string")return g===0?g:+g;g=Ed(g);var D=we.test(g);return D||Ge.test(g)?sp(g.slice(2),D?2:8):ve.test(g)?zn:+g}function Ox(g){return L(g,lo(g))}function Bx(g){return g?Bs(tr(g),-Gt,Gt):g===0?g:0}function Ir(g){return g==null?"":Ts(g)}var db=j(function(g,T){if(io(T)||Ws(T)){L(T,Ki(T),g);return}for(var D in T)Tr.call(T,D)&&pc(g,D,T[D])}),vy=j(function(g,T){L(T,lo(T),g)}),f_=j(function(g,T,D,G){L(T,lo(T),g,G)}),fb=j(function(g,T,D,G){L(T,Ki(T),g,G)}),Fx=Ze($o);function Nx(g,T){var D=cc(g);return T==null?D:Tp(D,T)}var Vx=Yn(function(g,T){g=zr(g);var D=-1,G=T.length,re=G>2?T[2]:h;for(re&&Sr(T[0],T[1],re)&&(G=1);++D<G;)for(var ye=T[D],Le=lo(ye),Ne=-1,Xe=Le.length;++Ne<Xe;){var It=Le[Ne],Mt=g[It];(Mt===h||La(Mt,to[It])&&!Tr.call(g,It))&&(g[It]=ye[It])}return g}),wy=Yn(function(g){return g.push(h,bt),Wi(Gx,h,g)});function kc(g,T){return Hu(g,Vt(T,3),qo)}function Mo(g,T){return Hu(g,Vt(T,3),Kl)}function Ux(g,T){return g==null?g:Fs(g,Vt(T,3),lo)}function pb(g,T){return g==null?g:Od(g,Vt(T,3),lo)}function mb(g,T){return g&&qo(g,Vt(T,3))}function Jp(g,T){return g&&Kl(g,Vt(T,3))}function _b(g){return g==null?[]:Jl(g,Ki(g))}function gb(g){return g==null?[]:Jl(g,lo(g))}function by(g,T,D){var G=g==null?h:sl(g,T);return G===h?D:G}function yb(g,T){return g!=null&&nt(g,T,Ql)}function Wh(g,T){return g!=null&&nt(g,T,gc)}var jx=le(function(g,T,D){T!=null&&typeof T.toString!="function"&&(T=rc.call(T)),g[T]=D},pf($s)),$h=le(function(g,T,D){T!=null&&typeof T.toString!="function"&&(T=rc.call(T)),Tr.call(g,T)?g[T].push(D):g[T]=[D]},Vt),Qp=Yn(al);function Ki(g){return Ws(g)?fc(g):Ud(g)}function lo(g){return Ws(g)?fc(g,!0):Ap(g)}function xb(g,T){var D={};return T=Vt(T,3),qo(g,function(G,re,ye){Oi(D,T(G,re,ye),G)}),D}function vb(g,T){var D={};return T=Vt(T,3),qo(g,function(G,re,ye){Oi(D,re,T(G,re,ye))}),D}var wb=j(function(g,T,D){wc(g,T,D)}),Gx=j(function(g,T,D,G){wc(g,T,D,G)}),bb=Ze(function(g,T){var D={};if(g==null)return D;var G=!1;T=mr(T,function(ye){return ye=Ss(ye,g),G||(G=ye.length>1),ye}),L(g,cn(g),D),G&&(D=us(D,Q|ae|xe,St));for(var re=T.length;re--;)tu(D,T[re]);return D});function Ty(g,T){return qh(g,d_(Vt(T)))}var Tb=Ze(function(g,T){return g==null?{}:kg(g,T)});function qh(g,T){if(g==null)return{};var D=mr(cn(g),function(G){return[G]});return T=Vt(T),bc(g,D,function(G,re){return T(G,re[0])})}function Sb(g,T,D){T=Ss(T,g);var G=-1,re=T.length;for(re||(re=1,g=h);++G<re;){var ye=g==null?h:g[Ao(T[G])];ye===h&&(G=re,ye=D),g=cu(ye)?ye.call(g):ye}return g}function li(g,T,D){return g==null?g:Ho(g,T,D)}function p_(g,T,D,G){return G=typeof G=="function"?G:h,g==null?g:Ho(g,T,D,G)}var Sy=Pe(Ki),em=Pe(lo);function m_(g,T,D){var G=$n(g),re=G||pl(g)||_l(g);if(T=Vt(T,4),D==null){var ye=g&&g.constructor;re?D=G?new ye:[]:Wr(g)?D=cu(ye)?cc(Qa(g)):{}:D={}}return(re?Li:qo)(g,function(Le,Ne,Xe){return T(D,Le,Ne,Xe)}),D}function tm(g,T){return g==null?!0:tu(g,T)}function Wx(g,T,D){return g==null?g:Yd(g,T,kh(D))}function $x(g,T,D,G){return G=typeof G=="function"?G:h,g==null?g:Yd(g,T,kh(D),G)}function gl(g){return g==null?[]:bo(g,Ki(g))}function Ey(g){return g==null?[]:bo(g,lo(g))}function __(g,T,D){return D===h&&(D=T,T=h),D!==h&&(D=ea(D),D=D===D?D:0),T!==h&&(T=ea(T),T=T===T?T:0),Bs(ea(g),T,D)}function Eb(g,T,D){return T=Da(T),D===h?(D=T,T=0):D=Da(D),g=ea(g),Ah(g,T,D)}function Cy(g,T,D){if(D&&typeof D!="boolean"&&Sr(g,T,D)&&(T=D=h),D===h&&(typeof T=="boolean"?(D=T,T=h):typeof g=="boolean"&&(D=g,g=h)),g===h&&T===h?(g=0,T=1):(g=Da(g),T===h?(T=g,g=0):T=Da(T)),g>T){var G=g;g=T,T=G}if(D||g%1||T%1){var re=Wm();return Gr(g+re*(T-g+Nm("1e-"+((re+"").length-1))),T)}return Lh(g,T)}var Ay=ie(function(g,T,D){return T=T.toLowerCase(),g+(D?nm(T):T)});function nm(g){return ff(Ir(g).toLowerCase())}function qx(g){return g=Ir(g),g&&g.replace(We,Ad).replace(Ag,"")}function Cb(g,T,D){g=Ir(g),T=Ts(T);var G=g.length;D=D===h?G:Bs(tr(D),0,G);var re=D;return D-=T.length,D>=0&&g.slice(D,re)==T}function My(g){return g=Ir(g),g&&Ha.test(g)?g.replace(wo,Ju):g}function yl(g){return g=Ir(g),g&&Qs.test(g)?g.replace(Bo,"\\$&"):g}var Hx=ie(function(g,T,D){return g+(D?"-":"")+T.toLowerCase()}),Ab=ie(function(g,T,D){return g+(D?" ":"")+T.toLowerCase()}),Mb=Y("toLowerCase");function Ib(g,T,D){g=Ir(g),T=tr(T);var G=T?Vo(g):0;if(!T||G>=T)return g;var re=(T-G)/2;return Oe(On(re),D)+g+Oe(Rt(re),D)}function Pb(g,T,D){g=Ir(g),T=tr(T);var G=T?Vo(g):0;return T&&G<T?g+Oe(T-G,D):g}function Rb(g,T,D){g=Ir(g),T=tr(T);var G=T?Vo(g):0;return T&&G<T?Oe(T-G,D)+g:g}function Lb(g,T,D){return D||T==null?T=0:T&&(T=+T),Yr(Ir(g).replace(fi,""),T||0)}function Db(g,T,D){return(D?Sr(g,T,D):T===h)?T=1:T=tr(T),Sc(Ir(g),T)}function zb(){var g=arguments,T=Ir(g[0]);return g.length<3?T:T.replace(g[1],g[2])}var g_=ie(function(g,T,D){return g+(D?"_":"")+T.toLowerCase()});function kb(g,T,D){return D&&typeof D!="number"&&Sr(g,T,D)&&(T=D=h),D=D===h?lr:D>>>0,D?(g=Ir(g),g&&(typeof T=="string"||T!=null&&!cf(T))&&(T=Ts(T),!T&&Ka(g))?Es(os(g),0,D):g.split(T,D)):[]}var Zx=ie(function(g,T,D){return g+(D?" ":"")+ff(T)});function df(g,T,D){return g=Ir(g),D=D==null?0:Bs(tr(D),0,g.length),T=Ts(T),g.slice(D,D+T.length)==T}function Ob(g,T,D){var G=fe.templateSettings;D&&Sr(g,T,D)&&(T=h),g=Ir(g),T=f_({},T,G,Ke);var re=f_({},T.imports,G.imports,Ke),ye=Ki(re),Le=bo(re,ye),Ne,Xe,It=0,Mt=T.interpolate||gt,Dt="__p += '",$t=nc((T.escape||gt).source+"|"+Mt.source+"|"+(Mt===Ol?K:gt).source+"|"+(T.evaluate||gt).source+"|$","g"),hn="//# sourceURL="+(Tr.call(T,"sourceURL")?(T.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++vd+"]")+`
`;g.replace($t,function(In,ur,dr,Io,qs,Po){return dr||(dr=Io),Dt+=g.slice(It,Po).replace(ft,Qu),ur&&(Ne=!0,Dt+=`' +
__e(`+ur+`) +
'`),qs&&(Xe=!0,Dt+=`';
`+qs+`;
__p += '`),dr&&(Dt+=`' +
((__t = (`+dr+`)) == null ? '' : __t) +
'`),It=Po+In.length,In}),Dt+=`';
`;var Mn=Tr.call(T,"variable")&&T.variable;if(!Mn)Dt=`with (obj) {
`+Dt+`
}
`;else if(Ce.test(Mn))throw new An(V);Dt=(Xe?Dt.replace(Nr,""):Dt).replace(Ou,"$1").replace(kl,"$1;"),Dt="function("+(Mn||"obj")+`) {
`+(Mn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ne?", __e = _.escape":"")+(Xe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Dt+`return __p
}`;var ir=Py(function(){return _r(ye,hn+"return "+Dt).apply(h,Le)});if(ir.source=Dt,Xp(ir))throw ir;return ir}function Bb(g){return Ir(g).toLowerCase()}function Fb(g){return Ir(g).toUpperCase()}function Xx(g,T,D){if(g=Ir(g),g&&(D||T===h))return Ed(g);if(!g||!(T=Ts(T)))return g;var G=os(g),re=os(T),ye=lp(G,re),Le=Ku(G,re)+1;return Es(G,ye,Le).join("")}function Yx(g,T,D){if(g=Ir(g),g&&(D||T===h))return g.slice(0,xa(g)+1);if(!g||!(T=Ts(T)))return g;var G=os(g),re=Ku(G,os(T))+1;return Es(G,0,re).join("")}function Nb(g,T,D){if(g=Ir(g),g&&(D||T===h))return g.replace(fi,"");if(!g||!(T=Ts(T)))return g;var G=os(g),re=lp(G,os(T));return Es(G,re).join("")}function Vb(g,T){var D=wn,G=xn;if(Wr(T)){var re="separator"in T?T.separator:re;D="length"in T?tr(T.length):D,G="omission"in T?Ts(T.omission):G}g=Ir(g);var ye=g.length;if(Ka(g)){var Le=os(g);ye=Le.length}if(D>=ye)return g;var Ne=D-Vo(G);if(Ne<1)return G;var Xe=Le?Es(Le,0,Ne).join(""):g.slice(0,Ne);if(re===h)return Xe+G;if(Le&&(Ne+=Xe.length-Ne),cf(re)){if(g.slice(Ne).search(re)){var It,Mt=Xe;for(re.global||(re=nc(re.source,Ir(he.exec(re))+"g")),re.lastIndex=0;It=re.exec(Mt);)var Dt=It.index;Xe=Xe.slice(0,Dt===h?Ne:Dt)}}else if(g.indexOf(Ts(re),Ne)!=Ne){var $t=Xe.lastIndexOf(re);$t>-1&&(Xe=Xe.slice(0,$t))}return Xe+G}function Ub(g){return g=Ir(g),g&&Kc.test(g)?g.replace(vo,dp):g}var Iy=ie(function(g,T,D){return g+(D?" ":"")+T.toUpperCase()}),ff=Y("toUpperCase");function Oc(g,T,D){return g=Ir(g),T=D?h:T,T===h?cp(g)?So(g):ya(g):g.match(T)||[]}var Py=Yn(function(g,T){try{return Wi(g,h,T)}catch(D){return Xp(D)?D:new An(D)}}),y_=Ze(function(g,T){return Li(T,function(D){D=Ao(D),Oi(g,D,c_(g[D],g))}),g});function Kx(g){var T=g==null?0:g.length,D=Vt();return g=T?mr(g,function(G){if(typeof G[1]!="function")throw new $i(P);return[D(G[0]),G[1]]}):[],Yn(function(G){for(var re=-1;++re<T;){var ye=g[re];if(Wi(ye[0],this,G))return Wi(ye[1],this,G)}})}function Jx(g){return nl(us(g,Q))}function pf(g){return function(){return g}}function Qx(g,T){return g==null||g!==g?T:g}var Ry=_e(),Ly=_e(!0);function $s(g){return g}function Dy(g){return ll(typeof g=="function"?g:us(g,Q))}function e1(g){return jd(us(g,Q))}function t1(g,T){return Ph(g,us(T,Q))}var n1=Yn(function(g,T){return function(D){return al(D,g,T)}}),r1=Yn(function(g,T){return function(D){return al(g,D,T)}});function x_(g,T,D){var G=Ki(T),re=Jl(T,G);D==null&&!(Wr(T)&&(re.length||!G.length))&&(D=T,T=g,g=this,re=Jl(T,Ki(T)));var ye=!(Wr(D)&&"chain"in D)||!!D.chain,Le=cu(g);return Li(re,function(Ne){var Xe=T[Ne];g[Ne]=Xe,Le&&(g.prototype[Ne]=function(){var It=this.__chain__;if(ye||It){var Mt=g(this.__wrapped__),Dt=Mt.__actions__=R(this.__actions__);return Dt.push({func:Xe,args:arguments,thisArg:g}),Mt.__chain__=It,Mt}return Xe.apply(g,jr([this.value()],arguments))})}),g}function i1(){return Xt._===this&&(Xt._=as),this}function v_(){}function s1(g){return g=tr(g),Yn(function(T){return Ip(T,g)})}var o1=Se(mr),a1=Se(Td),l1=Se($u);function fu(g){return ri(g)?Zu(Ao(g)):Tc(g)}function jb(g){return function(T){return g==null?h:sl(g,T)}}var Gb=Be(),Wb=Be(!0);function mf(){return[]}function Bc(){return!1}function u1(){return{}}function $b(){return""}function qb(){return!0}function Hb(g,T){if(g=tr(g),g<1||g>Gt)return[];var D=lr,G=Gr(g,lr);T=Vt(T),g-=lr;for(var re=mh(G,T);++D<g;)T(D);return re}function Zb(g){return $n(g)?mr(g,Ao):ao(g)?[g]:R(Yo(Ir(g)))}function Xb(g){var T=++pp;return Ir(g)+T}var c1=ce(function(g,T){return g+T},0),Fc=rt("ceil"),rm=ce(function(g,T){return g/T},1),w_=rt("floor");function im(g){return g&&g.length?_c(g,$s,Ch):h}function h1(g,T){return g&&g.length?_c(g,Vt(T,2),Ch):h}function d1(g){return ap(g,$s)}function f1(g,T){return ap(g,Vt(T,2))}function p1(g){return g&&g.length?_c(g,$s,vc):h}function Yb(g,T){return g&&g.length?_c(g,Vt(T,2),vc):h}var Kb=ce(function(g,T){return g*T},1),m1=rt("round"),b_=ce(function(g,T){return g-T},0);function _1(g){return g&&g.length?Yu(g,$s):0}function Jb(g,T){return g&&g.length?Yu(g,Vt(T,2)):0}return fe.after=Kr,fe.ary=iy,fe.assign=db,fe.assignIn=vy,fe.assignInWith=f_,fe.assignWith=fb,fe.at=Fx,fe.before=Dc,fe.bind=c_,fe.bindAll=y_,fe.bindKey=$p,fe.castArray=ub,fe.chain=lu,fe.chunk=Ac,fe.compact=Mc,fe.concat=Ic,fe.cond=Kx,fe.conforms=Jx,fe.constant=pf,fe.countBy=tb,fe.create=Nx,fe.curry=Hi,fe.curryRight=h_,fe.debounce=sy,fe.defaults=Vx,fe.defaultsDeep=wy,fe.defer=oy,fe.delay=ob,fe.difference=t_,fe.differenceBy=n_,fe.differenceWith=Bg,fe.drop=Fg,fe.dropRight=Ng,fe.dropRightWhile=Nh,fe.dropWhile=Pc,fe.fill=Vg,fe.filter=ny,fe.flatMap=sf,fe.flatMapDeep=Uh,fe.flatMapDepth=of,fe.flatten=i_,fe.flattenDeep=Si,fe.flattenDepth=Ug,fe.flip=ay,fe.flow=Ry,fe.flowRight=Ly,fe.fromPairs=jg,fe.functions=_b,fe.functionsIn=gb,fe.groupBy=Lc,fe.initial=ef,fe.intersection=Wg,fe.intersectionBy=Np,fe.intersectionWith=$g,fe.invert=jx,fe.invertBy=$h,fe.invokeMap=nb,fe.iteratee=Dy,fe.keyBy=jh,fe.keys=Ki,fe.keysIn=lo,fe.map=jp,fe.mapKeys=xb,fe.mapValues=vb,fe.matches=e1,fe.matchesProperty=t1,fe.memoize=qp,fe.merge=wb,fe.mergeWith=Gx,fe.method=n1,fe.methodOf=r1,fe.mixin=x_,fe.negate=d_,fe.nthArg=s1,fe.omit=bb,fe.omitBy=Ty,fe.once=Ra,fe.orderBy=ai,fe.over=o1,fe.overArgs=uu,fe.overEvery=a1,fe.overSome=l1,fe.partial=af,fe.partialRight=Hp,fe.partition=Gp,fe.pick=Tb,fe.pickBy=qh,fe.property=fu,fe.propertyOf=jb,fe.pull=Hg,fe.pullAll=Zg,fe.pullAllBy=ux,fe.pullAllWith=cx,fe.pullAt=hx,fe.range=Gb,fe.rangeRight=Wb,fe.rearg=ly,fe.reject=sb,fe.remove=dx,fe.rest=uy,fe.reverse=o_,fe.sampleSize=dl,fe.set=li,fe.setWith=p_,fe.shuffle=fl,fe.slice=fx,fe.sortBy=Ni,fe.sortedUniq=Hw,fe.sortedUniqBy=Zw,fe.split=kb,fe.spread=ab,fe.tail=Vp,fe.take=gx,fe.takeRight=Xg,fe.takeRightWhile=a_,fe.takeWhile=su,fe.tap=Vh,fe.throttle=bx,fe.thru=Pa,fe.toArray=xy,fe.toPairs=Sy,fe.toPairsIn=em,fe.toPath=Zb,fe.toPlainObject=Ox,fe.transform=m_,fe.unary=lb,fe.union=l_,fe.unionBy=Cs,fe.unionWith=ou,fe.uniq=Yg,fe.uniqBy=Kg,fe.uniqWith=yx,fe.unset=tm,fe.unzip=Jg,fe.unzipWith=tf,fe.update=Wx,fe.updateWith=$x,fe.values=gl,fe.valuesIn=Ey,fe.without=Xw,fe.words=Oc,fe.wrap=cy,fe.xor=Yw,fe.xorBy=Qg,fe.xorWith=ey,fe.zip=Up,fe.zipObject=nf,fe.zipObjectDeep=au,fe.zipWith=Ia,fe.entries=Sy,fe.entriesIn=em,fe.extend=vy,fe.extendWith=f_,x_(fe,fe),fe.add=c1,fe.attempt=Py,fe.camelCase=Ay,fe.capitalize=nm,fe.ceil=Fc,fe.clamp=__,fe.clone=hy,fe.cloneDeep=Sx,fe.cloneDeepWith=zc,fe.cloneWith=Tx,fe.conformsTo=Ex,fe.deburr=qx,fe.defaultTo=Qx,fe.divide=rm,fe.endsWith=Cb,fe.eq=La,fe.escape=My,fe.escapeRegExp=yl,fe.every=rf,fe.find=Ko,fe.findIndex=Fp,fe.findKey=kc,fe.findLast=Jo,fe.findLastIndex=r_,fe.findLastKey=Mo,fe.floor=w_,fe.forEach=u_,fe.forEachRight=Un,fe.forIn=Ux,fe.forInRight=pb,fe.forOwn=mb,fe.forOwnRight=Jp,fe.get=by,fe.gt=lf,fe.gte=dy,fe.has=yb,fe.hasIn=Wh,fe.head=Rc,fe.identity=$s,fe.includes=wx,fe.indexOf=Gg,fe.inRange=Eb,fe.invoke=Qp,fe.isArguments=Qo,fe.isArray=$n,fe.isArrayBuffer=Cx,fe.isArrayLike=Ws,fe.isArrayLikeObject=Ei,fe.isBoolean=cb,fe.isBuffer=pl,fe.isDate=fy,fe.isElement=Zp,fe.isEmpty=Ax,fe.isEqual=Mx,fe.isEqualWith=Ix,fe.isError=Xp,fe.isFinite=Dr,fe.isFunction=cu,fe.isInteger=Yp,fe.isLength=Kp,fe.isMap=Px,fe.isMatch=Rx,fe.isMatchWith=hb,fe.isNaN=py,fe.isNative=ml,fe.isNil=Lx,fe.isNull=hu,fe.isNumber=my,fe.isObject=Wr,fe.isObjectLike=ei,fe.isPlainObject=uf,fe.isRegExp=cf,fe.isSafeInteger=_y,fe.isSet=hf,fe.isString=Gh,fe.isSymbol=ao,fe.isTypedArray=_l,fe.isUndefined=gy,fe.isWeakMap=yy,fe.isWeakSet=Dx,fe.join=s_,fe.kebabCase=Hx,fe.last=oo,fe.lastIndexOf=qg,fe.lowerCase=Ab,fe.lowerFirst=Mb,fe.lt=zx,fe.lte=du,fe.max=im,fe.maxBy=h1,fe.mean=d1,fe.meanBy=f1,fe.min=p1,fe.minBy=Yb,fe.stubArray=mf,fe.stubFalse=Bc,fe.stubObject=u1,fe.stubString=$b,fe.stubTrue=qb,fe.multiply=Kb,fe.nth=lx,fe.noConflict=i1,fe.noop=v_,fe.now=Wp,fe.pad=Ib,fe.padEnd=Pb,fe.padStart=Rb,fe.parseInt=Lb,fe.random=Cy,fe.reduce=rb,fe.reduceRight=ib,fe.repeat=Db,fe.replace=zb,fe.result=Sb,fe.round=m1,fe.runInContext=He,fe.sample=ry,fe.size=Ms,fe.snakeCase=g_,fe.some=Gs,fe.sortedIndex=px,fe.sortedIndexBy=mx,fe.sortedIndexOf=$w,fe.sortedLastIndex=qw,fe.sortedLastIndexBy=Lr,fe.sortedLastIndexOf=_x,fe.startCase=Zx,fe.startsWith=df,fe.subtract=b_,fe.sum=_1,fe.sumBy=Jb,fe.template=Ob,fe.times=Hb,fe.toFinite=Da,fe.toInteger=tr,fe.toLength=kx,fe.toLower=Bb,fe.toNumber=ea,fe.toSafeInteger=Bx,fe.toString=Ir,fe.toUpper=Fb,fe.trim=Xx,fe.trimEnd=Yx,fe.trimStart=Nb,fe.truncate=Vb,fe.unescape=Ub,fe.uniqueId=Xb,fe.upperCase=Iy,fe.upperFirst=ff,fe.each=u_,fe.eachRight=Un,fe.first=Rc,x_(fe,function(){var g={};return qo(fe,function(T,D){Tr.call(fe.prototype,D)||(g[D]=T)}),g}(),{chain:!1}),fe.VERSION=m,Li(["bind","bindKey","curry","curryRight","partial","partialRight"],function(g){fe[g].placeholder=fe}),Li(["drop","take"],function(g,T){or.prototype[g]=function(D){D=D===h?1:Xr(tr(D),0);var G=this.__filtered__&&!T?new or(this):this.clone();return G.__filtered__?G.__takeCount__=Gr(D,G.__takeCount__):G.__views__.push({size:Gr(D,lr),type:g+(G.__dir__<0?"Right":"")}),G},or.prototype[g+"Right"]=function(D){return this.reverse()[g](D).reverse()}}),Li(["filter","map","takeWhile"],function(g,T){var D=T+1,G=D==xo||D==Pi;or.prototype[g]=function(re){var ye=this.clone();return ye.__iteratees__.push({iteratee:Vt(re,3),type:D}),ye.__filtered__=ye.__filtered__||G,ye}}),Li(["head","last"],function(g,T){var D="take"+(T?"Right":"");or.prototype[g]=function(){return this[D](1).value()[0]}}),Li(["initial","tail"],function(g,T){var D="drop"+(T?"":"Right");or.prototype[g]=function(){return this.__filtered__?new or(this):this[D](1)}}),or.prototype.compact=function(){return this.filter($s)},or.prototype.find=function(g){return this.filter(g).head()},or.prototype.findLast=function(g){return this.reverse().find(g)},or.prototype.invokeMap=Yn(function(g,T){return typeof g=="function"?new or(this):this.map(function(D){return al(D,g,T)})}),or.prototype.reject=function(g){return this.filter(d_(Vt(g)))},or.prototype.slice=function(g,T){g=tr(g);var D=this;return D.__filtered__&&(g>0||T<0)?new or(D):(g<0?D=D.takeRight(-g):g&&(D=D.drop(g)),T!==h&&(T=tr(T),D=T<0?D.dropRight(-T):D.take(T-g)),D)},or.prototype.takeRightWhile=function(g){return this.reverse().takeWhile(g).reverse()},or.prototype.toArray=function(){return this.take(lr)},qo(or.prototype,function(g,T){var D=/^(?:filter|find|map|reject)|While$/.test(T),G=/^(?:head|last)$/.test(T),re=fe[G?"take"+(T=="last"?"Right":""):T],ye=G||/^find/.test(T);re&&(fe.prototype[T]=function(){var Le=this.__wrapped__,Ne=G?[1]:arguments,Xe=Le instanceof or,It=Ne[0],Mt=Xe||$n(Le),Dt=function(ur){var dr=re.apply(fe,jr([ur],Ne));return G&&$t?dr[0]:dr};Mt&&D&&typeof It=="function"&&It.length!=1&&(Xe=Mt=!1);var $t=this.__chain__,hn=!!this.__actions__.length,Mn=ye&&!$t,ir=Xe&&!hn;if(!ye&&Mt){Le=ir?Le:new or(this);var In=g.apply(Le,Ne);return In.__actions__.push({func:Pa,args:[Dt],thisArg:h}),new ks(In,$t)}return Mn&&ir?g.apply(this,Ne):(In=this.thru(Dt),Mn?G?In.value()[0]:In.value():In)})}),Li(["pop","push","shift","sort","splice","unshift"],function(g){var T=$l[g],D=/^(?:push|sort|unshift)$/.test(g)?"tap":"thru",G=/^(?:pop|shift)$/.test(g);fe.prototype[g]=function(){var re=arguments;if(G&&!this.__chain__){var ye=this.value();return T.apply($n(ye)?ye:[],re)}return this[D](function(Le){return T.apply($n(Le)?Le:[],re)})}}),qo(or.prototype,function(g,T){var D=fe[T];if(D){var G=D.name+"";Tr.call(mi,G)||(mi[G]=[]),mi[G].push({name:T,func:D})}}),mi[se(h,Te).name]=[{name:"wrapper",func:h}],or.prototype.clone=Yi,or.prototype.reverse=gp,or.prototype.value=el,fe.prototype.at=Kw,fe.prototype.chain=Jw,fe.prototype.commit=Qw,fe.prototype.next=eb,fe.prototype.plant=As,fe.prototype.reverse=ty,fe.prototype.toJSON=fe.prototype.valueOf=fe.prototype.value=vx,fe.prototype.first=fe.prototype.head,oc&&(fe.prototype[oc]=xx),fe},va=tc();Ds?((Ds.exports=va)._=va,ga._=va):Xt._=va}).call(V_)})(sw,sw.exports);var pF=sw.exports;const xi=pw(pF);function mF(){return at.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:at.jsx("path",{d:"M10 0.555538V7.77754C10 7.92487 9.94147 8.06618 9.83729 8.17036C9.7331 8.27455 9.5918 8.33308 9.44446 8.33308C9.29712 8.33308 9.15582 8.27455 9.05164 8.17036C8.94745 8.06618 8.88892 7.92487 8.88892 7.77754V1.89647L0.948891 9.8372C0.844649 9.94144 0.703267 10 0.555847 10C0.408427 10 0.267045 9.94144 0.162804 9.8372C0.0585623 9.73295 0 9.59157 0 9.44415C0 9.29673 0.0585623 9.15535 0.162804 9.05111L8.10353 1.11108H2.22246C2.07512 1.11108 1.93382 1.05255 1.82964 0.948363C1.72545 0.84418 1.66692 0.702876 1.66692 0.555538C1.66692 0.4082 1.72545 0.266897 1.82964 0.162714C1.93382 0.0585299 2.07512 0 2.22246 0H9.44446C9.5918 0 9.7331 0.0585299 9.83729 0.162714C9.94147 0.266897 10 0.4082 10 0.555538Z",fill:"currentColor"})})}const _F={en:{SEARCH_BOX_TITLE:"Find Clubs Near You",SEARCH_BOX_INPUT_PLACEHOLDER:"Enter club’s name, city, province or postal code",SEARCH_BOX_BUTTON_LABEL:"Search",SEARCH_BOX_HELPER:"Use My Current Location",ALL_CLUBS_EMPTY:"There is no clubs available in this province. Check back later!",VERIFIED:"Verified by Canada Basketball",JR_NBA:"Has Jr. NBA and Jr. WNBA Programs",FILTER_BOX_SORT_BY:"Sort By",FILTER_BOX_FILTER_PROVINCE:"Filter By Province",FILTER_BOX_FILTER_PROGRAMS:"Filter By Programs",SORT_AUTO:"All",SORT_ALPHA:"Alphabetically",SORT_DISTANCE:"Distance",ALL_FILTER_COPY:"All"},fr:{SEARCH_BOX_TITLE:"Trouvez des clubs près de chez vous",SEARCH_BOX_INPUT_PLACEHOLDER:"Entrez le nom du club, la ville, la province ou le code postal",SEARCH_BOX_BUTTON_LABEL:"Recherche",SEARCH_BOX_HELPER:"Utiliser ma position actuelle",ALL_CLUBS_EMPTY:"Il n'y a aucun club disponible dans cette province. Revenez plus tard!",VERIFIED:"Vérifié par Canada Basketball",JR_NBA:"A des programmes Jr. NBA et Jr. WNBA",FILTER_BOX_SORT_BY:"Trier par",FILTER_BOX_FILTER_PROVINCE:"Filtrer par province",FILTER_BOX_FILTER_PROGRAMS:"Filtrer par programmes",SORT_AUTO:"Auto",SORT_ALPHA:"Alphabétiquement",SORT_DISTANCE:"Distance",ALL_FILTER_COPY:"Tout",ALL_PROGRAM_FILTER_COPY:"Tout"}};function po(r){const a=window.location.href.includes("/fr")?"fr":"en",h=Ui(m=>m.setLocale);return on.useEffect(()=>{h(a)},[a]),_F[a][r]}function TI(r){const a=Ui(ae=>ae.locale),h=po("VERIFIED"),m=po("JR_NBA"),b=on.useMemo(()=>xi.get(r,`club.province.name["${a}"]`,""),[r,a]),M=on.useMemo(()=>xi.get(r,"club.slug",""),[r]),P=on.useMemo(()=>xi.get(r,"club.name",""),[r]),V=on.useMemo(()=>{const ae=xi.get(r,"club.addressLine1",""),xe=xi.get(r,"club.addressLine2","");return cd(ae&&ae,xe&&`, ${xe}`)},[r,b]),o=on.useMemo(()=>{const ae=xi.get(r,"club.city",""),xe=xi.get(r,"club.postalCode","");return cd(ae&&`${ae}, `,b&&`${b}`,xe&&`${xe}`)},[r,b]),q=on.useMemo(()=>xi.get(r,"club.logo",{}),[r]),J=on.useMemo(()=>xi.get(r,"club.isVerified",!1),[r]),Q=on.useMemo(()=>xi.get(r,"club.hasJrNBAPrograms",!1),[r]);return at.jsxs("a",{className:"ClubCard",href:`/clubs/${M}`,target:"_blank",children:[at.jsxs("p",{className:"ClubCard__top",children:[at.jsx("span",{className:"ClubCard__province",children:b}),at.jsx("span",{className:"ClubCard__link-arrow",children:at.jsx(mF,{})})]}),at.jsxs("div",{className:"ClubCard__info",children:[at.jsxs("div",{className:"ClubCard__info-left",children:[at.jsx("p",{className:"ClubCard__info-name",children:P}),at.jsxs("p",{className:"ClubCard__info-address",children:[V&&at.jsxs("span",{children:[V,at.jsx("br",{})]}),o]})]}),at.jsx("div",{className:"ClubCard__info-right",children:q.src&&at.jsx("img",{src:q.src,alt:q.alt,className:"ClubCard__info-logo"})})]}),(J||Q)&&at.jsx("div",{className:"ClubCard__bottom",children:at.jsxs("div",{className:"ClubCard__bottom-icon",children:[J&&at.jsx("img",{src:"https://uploads-ssl.webflow.com/5d24fc966ad064837947a33b/668f3c91c744505a4eb7f655_Canada%20Basketball%20Verified%201.png",alt:h}),Q&&at.jsx("img",{src:"https://uploads-ssl.webflow.com/5d24fc966ad064837947a33b/668f3c91b04ed39f763e27db_Jr%20NBA%20WNBA%20Logo.png",alt:m})]})})]})}function gF(){const r=po("ALL_CLUBS_EMPTY"),a=ts(ae=>ae.selectedProvince),h=ts(ae=>ae.searchedClubs),m=ts(ae=>ae.searchStatus),b=$c(ae=>ae.clubs),M=$c(ae=>ae.loading),P=Ui(ae=>ae.selectedSort),V=Ui(ae=>ae.selectedProgramFilter),o=Ui(ae=>ae.selectedProvinceFilter),q=a&&a.slug,J=on.useMemo(()=>q&&Object.keys(b).length>0&&b[a.slug],[q,b,a]),Q=on.useMemo(()=>{let ae=[...h];return P==="alpha"&&(ae=xi.sortBy(ae,"name")),P==="distance"&&(ae=xi.sortBy(ae,"distanceFromUser")),o!=="all"&&(ae=ae.filter(xe=>xe.province.slug===o)),V==="verified"&&(ae=ae.filter(xe=>xe.isVerified)),V==="jr-nba"&&(ae=ae.filter(xe=>xe.hasJrNBAPrograms)),ae},[h,P,V,o]);return Q.length>0?at.jsx("ul",{className:"ClubCards",children:Q.map(ae=>at.jsx(TI,{club:ae},ae.slug))}):q&&J&&m!=="done"&&b[a.slug].length>0?at.jsx("ul",{className:"ClubCards",children:b[a.slug].map(ae=>at.jsx(TI,{club:ae},ae.slug))}):(m!=="in-progress"||Q.length===0)&&!M?at.jsx("p",{className:"ClubCards__no-results",children:r}):null}function yF(){return at.jsxs("div",{className:"SearchLoader",children:[at.jsx("div",{}),at.jsx("div",{}),at.jsx("div",{}),at.jsx("div",{})]})}function g4(r){const a=xi.get(r,"buttonProps.className","");return at.jsxs("button",{...r.buttonProps,className:cd("Button",a,r.fullWidth&&"cl-full-width"),children:[r.icon&&at.jsx("span",{className:"Button__icon",children:r.icon}),r.children]})}function xF(){return at.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:at.jsx("path",{d:"M13.9999 8.00003C13.9999 8.13264 13.9472 8.25982 13.8535 8.35359C13.7597 8.44736 13.6325 8.50003 13.4999 8.50003H3.70678L7.35365 12.1463C7.40011 12.1927 7.43696 12.2479 7.4621 12.3086C7.48724 12.3693 7.50018 12.4343 7.50018 12.5C7.50018 12.5657 7.48724 12.6308 7.4621 12.6915C7.43696 12.7522 7.40011 12.8073 7.35365 12.8538C7.3072 12.9002 7.25205 12.9371 7.19135 12.9622C7.13066 12.9874 7.0656 13.0003 6.9999 13.0003C6.93421 13.0003 6.86915 12.9874 6.80846 12.9622C6.74776 12.9371 6.69261 12.9002 6.64615 12.8538L2.14615 8.35378C2.09967 8.30735 2.06279 8.2522 2.03763 8.1915C2.01246 8.1308 1.99951 8.06574 1.99951 8.00003C1.99951 7.93433 2.01246 7.86926 2.03763 7.80856C2.06279 7.74786 2.09967 7.69272 2.14615 7.64628L6.64615 3.14628C6.73997 3.05246 6.86722 2.99976 6.9999 2.99976C7.13259 2.99976 7.25983 3.05246 7.35365 3.14628C7.44747 3.2401 7.50018 3.36735 7.50018 3.50003C7.50018 3.63272 7.44747 3.75996 7.35365 3.85378L3.70678 7.50003H13.4999C13.6325 7.50003 13.7597 7.55271 13.8535 7.64648C13.9472 7.74025 13.9999 7.86743 13.9999 8.00003Z",fill:"currentColor"})})}function vF(){return at.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 19 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:at.jsxs("g",{children:[at.jsx("path",{d:"M18.5119 3.58001H6.23326C5.97041 3.58001 5.74512 3.34001 5.74512 3.06001C5.74512 2.78001 5.97041 2.54001 6.23326 2.54001H18.5119C18.7748 2.54001 19.0001 2.78001 19.0001 3.06001C19.0001 3.34001 18.7748 3.58001 18.5119 3.58001Z",fill:"currentColor"}),at.jsx("path",{d:"M2.40316 3.58001H0.488142C0.225296 3.58001 0 3.34001 0 3.06001C0 2.78001 0.225296 2.54001 0.488142 2.54001H2.40316C2.66601 2.54001 2.8913 2.78001 2.8913 3.06001C2.8913 3.34001 2.70356 3.58001 2.40316 3.58001Z",fill:"currentColor"}),at.jsx("path",{d:"M18.5118 8.49999H15.2826C15.0197 8.49999 14.7944 8.25999 14.7944 7.97999C14.7944 7.69999 15.0197 7.45999 15.2826 7.45999H18.5118C18.7747 7.45999 19 7.69999 19 7.97999C19 8.25999 18.7747 8.49999 18.5118 8.49999Z",fill:"currentColor"}),at.jsx("path",{d:"M11.4526 8.49999H0.488142C0.225296 8.49999 0 8.25999 0 7.97999C0 7.69999 0.225296 7.45999 0.488142 7.45999H11.4526C11.7154 7.45999 11.9407 7.69999 11.9407 7.97999C11.9407 8.25999 11.7154 8.49999 11.4526 8.49999Z",fill:"currentColor"}),at.jsx("path",{d:"M18.5119 13.46H6.23326C5.97041 13.46 5.74512 13.22 5.74512 12.94C5.74512 12.66 5.97041 12.42 6.23326 12.42H18.5119C18.7748 12.42 19.0001 12.66 19.0001 12.94C19.0001 13.22 18.7748 13.46 18.5119 13.46Z",fill:"currentColor"}),at.jsx("path",{d:"M2.40316 13.46H0.488142C0.225296 13.46 0 13.22 0 12.94C0 12.62 0.225296 12.38 0.488142 12.38H2.40316C2.66601 12.38 2.8913 12.62 2.8913 12.9C2.92885 13.22 2.70356 13.46 2.40316 13.46Z",fill:"currentColor"}),at.jsx("path",{d:"M4.3182 5.62C3.00397 5.62 1.91504 4.46 1.91504 3.06C1.91504 1.66 3.00397 0.5 4.3182 0.5C5.63243 0.5 6.72136 1.66 6.72136 3.06C6.72136 4.46 5.66998 5.62 4.3182 5.62ZM4.3182 1.54C3.52966 1.54 2.89132 2.22 2.89132 3.06C2.89132 3.9 3.52966 4.58 4.3182 4.58C5.10674 4.58 5.74508 3.9 5.74508 3.06C5.74508 2.22 5.10674 1.54 4.3182 1.54Z",fill:"currentColor"}),at.jsx("path",{d:"M13.3675 10.54C12.0533 10.54 10.9644 9.38001 10.9644 7.98001C10.9644 6.58001 12.0533 5.42001 13.3675 5.42001C14.6817 5.42001 15.7707 6.58001 15.7707 7.98001C15.7707 9.38001 14.7193 10.54 13.3675 10.54ZM13.3675 6.46001C12.579 6.46001 11.9406 7.14001 11.9406 7.98001C11.9406 8.82001 12.579 9.50001 13.3675 9.50001C14.1561 9.50001 14.7944 8.82001 14.7944 7.98001C14.7944 7.14001 14.1561 6.46001 13.3675 6.46001Z",fill:"currentColor"}),at.jsx("path",{d:"M4.3182 15.5C3.00397 15.5 1.91504 14.34 1.91504 12.94C1.91504 11.54 3.00397 10.38 4.3182 10.38C5.63243 10.38 6.72136 11.54 6.72136 12.94C6.75891 14.34 5.66998 15.5 4.3182 15.5ZM4.3182 11.42C3.52966 11.42 2.89132 12.1 2.89132 12.94C2.89132 13.78 3.52966 14.46 4.3182 14.46C5.10674 14.46 5.74508 13.78 5.74508 12.94C5.74508 12.1 5.10674 11.42 4.3182 11.42Z",fill:"currentColor"})]})})}function wF(){return at.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 16 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:at.jsx("g",{children:at.jsx("path",{d:"M15.2 0L10.4952 1.74V11.865L15.2 10.125V0ZM4.70476 0.135L0 1.875V12L4.70476 10.26V0.135ZM5.42857 0.135V10.26L9.77143 11.865V1.74L5.42857 0.135Z",fill:"currentColor"})})})}function SI(){return at.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 15 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:at.jsx("path",{d:"M14.7802 14.219C14.8499 14.2887 14.9052 14.3714 14.9429 14.4625C14.9806 14.5535 15 14.6511 15 14.7496C15 14.8482 14.9806 14.9457 14.9429 15.0368C14.9052 15.1278 14.8499 15.2105 14.7802 15.2802C14.7105 15.3499 14.6278 15.4052 14.5368 15.4429C14.4457 15.4806 14.3482 15.5 14.2496 15.5C14.1511 15.5 14.0535 15.4806 13.9625 15.4429C13.8714 15.4052 13.7887 15.3499 13.719 15.2802L7.5 9.06025L1.28097 15.2802C1.14025 15.4209 0.949387 15.5 0.750375 15.5C0.551363 15.5 0.360502 15.4209 0.21978 15.2802C0.0790571 15.1395 3.923e-09 14.9486 0 14.7496C-3.923e-09 14.5506 0.0790571 14.3598 0.21978 14.219L6.43975 8L0.21978 1.78097C0.0790571 1.64025 0 1.44939 0 1.25038C0 1.05136 0.0790571 0.860502 0.21978 0.71978C0.360502 0.579057 0.551363 0.5 0.750375 0.5C0.949387 0.5 1.14025 0.579057 1.28097 0.71978L7.5 6.93975L13.719 0.71978C13.8598 0.579057 14.0506 0.5 14.2496 0.5C14.4486 0.5 14.6395 0.579057 14.7802 0.71978C14.9209 0.860502 15 1.05136 15 1.25038C15 1.44939 14.9209 1.64025 14.7802 1.78097L8.56025 8L14.7802 14.219Z",fill:"currentColor"})})}function bF(){const r=ts(M=>M.searchedClubs),a=Ui(M=>M.mapOpened),h=Ui(M=>M.setMapOpened),m=Ui(M=>M.filterBoxOpened),b=Ui(M=>M.setFilterBoxOpened);return at.jsxs("div",{className:"FilterBar",children:[at.jsxs("p",{className:"FilterBar__results",children:[r.length," Results"]}),at.jsxs("button",{className:"FilterBar__map-btn",onClick:()=>h(!a),children:[at.jsx("span",{className:"FilterBar__map-icon",children:a?at.jsx(SI,{}):at.jsx(wF,{})}),at.jsx("span",{children:a?"Close Map":"View Map"})]}),at.jsxs("button",{className:"FilterBar__filter-btn",onClick:()=>b(!m),children:[at.jsx("span",{children:m?"Close":"Sort & Filter"}),at.jsx("span",{className:"FilterBar__filter-icon",children:m?at.jsx(SI,{}):at.jsx(vF,{})})]})]})}var y4={exports:{}};(function(r,a){var h={};(function(m,b){r.exports=b()})(V_,function(){var m,b,M;function P(o,q){if(!m)m=q;else if(!b)b=q;else{var J="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+m+")(sharedChunk); ("+b+")(sharedChunk); self.onerror = null;",Q={};m(Q),M=q(Q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(M.workerUrl=window.URL.createObjectURL(new Blob([J],{type:"text/javascript"})))}}P(["exports"],function(o){var q="3.5.1";let J;const Q={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(J==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{J=h.API_URL_REGEX!=null?new RegExp(h.API_URL_REGEX):t}catch{J=t}}return J},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Q.API_URL)return null;try{const t=new URL(Q.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ae(t){return Q.API_URL_REGEX.test(t)}function xe(t){return t.indexOf("mapbox:")===0}function Re(t){return Q.API_CDN_URL_REGEX.test(t)}function Ue(t){return Q.API_SPRITE_REGEX.test(t)}function Tt(t){return Q.API_STYLE_REGEX.test(t)&&!Ue(t)}const Te={create:"create",load:"load",fullLoad:"fullLoad"},Ee={mark(t){performance.mark(t)},measure(t,e,n){performance.measure(t,e,n)}};function Me(t){const e=t.name.split("?")[0];return Re(e)&&e.includes("mapbox-gl.js")?"javascript":Re(e)&&e.includes("mapbox-gl.css")?"css":function(n){return Q.API_FONTS_REGEX.test(n)}(e)?"fontRange":Ue(e)?"sprite":Tt(e)?"style":function(n){return Q.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function et(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var pt={},Ct={};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.setMatrixArrayType=function(t){Ct.ARRAY_TYPE=zt=t},Ct.toRadian=function(t){return t*wn},Ct.equals=function(t,e){return Math.abs(t-e)<=Ot*Math.max(1,Math.abs(t),Math.abs(e))},Ct.RANDOM=Ct.ARRAY_TYPE=Ct.EPSILON=void 0;var Ot=1e-6;Ct.EPSILON=Ot;var zt=typeof Float32Array<"u"?Float32Array:Array;Ct.ARRAY_TYPE=zt;var Zn=Math.random;Ct.RANDOM=Zn;var wn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var xn={};function rs(t){return rs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rs(t)}Object.defineProperty(xn,"__esModule",{value:!0}),xn.create=function(){var t=new bn.ARRAY_TYPE(4);return bn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},xn.clone=function(t){var e=new bn.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},xn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},xn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},xn.fromValues=function(t,e,n,s){var l=new bn.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=n,l[3]=s,l},xn.set=function(t,e,n,s,l){return t[0]=e,t[1]=n,t[2]=s,t[3]=l,t},xn.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},xn.invert=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=n*c-l*s;return d?(t[0]=c*(d=1/d),t[1]=-s*d,t[2]=-l*d,t[3]=n*d,t):null},xn.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},xn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},xn.multiply=Jr,xn.rotate=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=s*y+c*_,t[1]=l*y+d*_,t[2]=s*-_+c*y,t[3]=l*-_+d*y,t},xn.scale=function(t,e,n){var s=e[1],l=e[2],c=e[3],d=n[0],_=n[1];return t[0]=e[0]*d,t[1]=s*d,t[2]=l*_,t[3]=c*_,t},xn.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=-n,t[3]=s,t},xn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},xn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},xn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},xn.LDU=function(t,e,n,s){return t[2]=s[2]/s[0],n[0]=s[0],n[1]=s[1],n[3]=s[3]-t[2]*n[1],[t,e,n]},xn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},xn.subtract=Pi,xn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},xn.equals=function(t,e){var n=t[0],s=t[1],l=t[2],c=t[3],d=e[0],_=e[1],y=e[2],w=e[3];return Math.abs(n-d)<=bn.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-_)<=bn.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-y)<=bn.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-w)<=bn.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))},xn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},xn.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t},xn.sub=xn.mul=void 0;var bn=function(t,e){if(t&&t.__esModule)return t;if(t===null||rs(t)!=="object"&&typeof t!="function")return{default:t};var n=xo(void 0);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}(Ct);function xo(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(xo=function(s){return s?n:e})(t)}function Jr(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=n[0],y=n[1],w=n[2],E=n[3];return t[0]=s*_+c*y,t[1]=l*_+d*y,t[2]=s*w+c*E,t[3]=l*w+d*E,t}function Pi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}xn.mul=Jr,xn.sub=Pi;var Cn={};function Gt(t){return Gt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gt(t)}Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.create=function(){var t=new _n.ARRAY_TYPE(6);return _n.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Cn.clone=function(t){var e=new _n.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Cn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Cn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Cn.fromValues=function(t,e,n,s,l,c){var d=new _n.ARRAY_TYPE(6);return d[0]=t,d[1]=e,d[2]=n,d[3]=s,d[4]=l,d[5]=c,d},Cn.set=function(t,e,n,s,l,c,d){return t[0]=e,t[1]=n,t[2]=s,t[3]=l,t[4]=c,t[5]=d,t},Cn.invert=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=e[4],_=e[5],y=n*c-s*l;return y?(t[0]=c*(y=1/y),t[1]=-s*y,t[2]=-l*y,t[3]=n*y,t[4]=(l*_-c*d)*y,t[5]=(s*d-n*_)*y,t):null},Cn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Cn.multiply=lr,Cn.rotate=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=e[4],y=e[5],w=Math.sin(n),E=Math.cos(n);return t[0]=s*E+c*w,t[1]=l*E+d*w,t[2]=s*-w+c*E,t[3]=l*-w+d*E,t[4]=_,t[5]=y,t},Cn.scale=function(t,e,n){var s=e[1],l=e[2],c=e[3],d=e[4],_=e[5],y=n[0],w=n[1];return t[0]=e[0]*y,t[1]=s*y,t[2]=l*w,t[3]=c*w,t[4]=d,t[5]=_,t},Cn.translate=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=e[4],y=e[5],w=n[0],E=n[1];return t[0]=s,t[1]=l,t[2]=c,t[3]=d,t[4]=s*w+c*E+_,t[5]=l*w+d*E+y,t},Cn.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=-n,t[3]=s,t[4]=0,t[5]=0,t},Cn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Cn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Cn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Cn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Cn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},Cn.subtract=Br,Cn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},Cn.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t[4]=e[4]+n[4]*s,t[5]=e[5]+n[5]*s,t},Cn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Cn.equals=function(t,e){var n=t[0],s=t[1],l=t[2],c=t[3],d=t[4],_=t[5],y=e[0],w=e[1],E=e[2],A=e[3],I=e[4],z=e[5];return Math.abs(n-y)<=_n.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-w)<=_n.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-E)<=_n.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-A)<=_n.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(d-I)<=_n.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(_-z)<=_n.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))},Cn.sub=Cn.mul=void 0;var _n=function(t,e){if(t&&t.__esModule)return t;if(t===null||Gt(t)!=="object"&&typeof t!="function")return{default:t};var n=zn(void 0);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}(Ct);function zn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(zn=function(s){return s?n:e})(t)}function lr(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=e[4],y=e[5],w=n[0],E=n[1],A=n[2],I=n[3],z=n[4],k=n[5];return t[0]=s*w+c*E,t[1]=l*w+d*E,t[2]=s*A+c*I,t[3]=l*A+d*I,t[4]=s*z+c*k+_,t[5]=l*z+d*k+y,t}function Br(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}Cn.mul=lr,Cn.sub=Br;var jn={};function ps(t){return ps=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ps(t)}Object.defineProperty(jn,"__esModule",{value:!0}),jn.create=function(){var t=new Fr.ARRAY_TYPE(9);return Fr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},jn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},jn.clone=function(t){var e=new Fr.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},jn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},jn.fromValues=function(t,e,n,s,l,c,d,_,y){var w=new Fr.ARRAY_TYPE(9);return w[0]=t,w[1]=e,w[2]=n,w[3]=s,w[4]=l,w[5]=c,w[6]=d,w[7]=_,w[8]=y,w},jn.set=function(t,e,n,s,l,c,d,_,y,w){return t[0]=e,t[1]=n,t[2]=s,t[3]=l,t[4]=c,t[5]=d,t[6]=_,t[7]=y,t[8]=w,t},jn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},jn.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},jn.invert=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=e[4],_=e[5],y=e[6],w=e[7],E=e[8],A=E*d-_*w,I=-E*c+_*y,z=w*c-d*y,k=n*A+s*I+l*z;return k?(t[0]=A*(k=1/k),t[1]=(-E*s+l*w)*k,t[2]=(_*s-l*d)*k,t[3]=I*k,t[4]=(E*n-l*y)*k,t[5]=(-_*n+l*c)*k,t[6]=z*k,t[7]=(-w*n+s*y)*k,t[8]=(d*n-s*c)*k,t):null},jn.adjoint=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=e[4],_=e[5],y=e[6],w=e[7],E=e[8];return t[0]=d*E-_*w,t[1]=l*w-s*E,t[2]=s*_-l*d,t[3]=_*y-c*E,t[4]=n*E-l*y,t[5]=l*c-n*_,t[6]=c*w-d*y,t[7]=s*y-n*w,t[8]=n*d-s*c,t},jn.determinant=function(t){var e=t[3],n=t[4],s=t[5],l=t[6],c=t[7],d=t[8];return t[0]*(d*n-s*c)+t[1]*(-d*e+s*l)+t[2]*(c*e-n*l)},jn.multiply=da,jn.translate=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=e[4],y=e[5],w=e[6],E=e[7],A=e[8],I=n[0],z=n[1];return t[0]=s,t[1]=l,t[2]=c,t[3]=d,t[4]=_,t[5]=y,t[6]=I*s+z*d+w,t[7]=I*l+z*_+E,t[8]=I*c+z*y+A,t},jn.rotate=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=e[4],y=e[5],w=e[6],E=e[7],A=e[8],I=Math.sin(n),z=Math.cos(n);return t[0]=z*s+I*d,t[1]=z*l+I*_,t[2]=z*c+I*y,t[3]=z*d-I*s,t[4]=z*_-I*l,t[5]=z*y-I*c,t[6]=w,t[7]=E,t[8]=A,t},jn.scale=function(t,e,n){var s=n[0],l=n[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=l*e[3],t[4]=l*e[4],t[5]=l*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},jn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},jn.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},jn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},jn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},jn.fromQuat=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=n+n,_=s+s,y=l+l,w=n*d,E=s*d,A=s*_,I=l*d,z=l*_,k=l*y,B=c*d,N=c*_,W=c*y;return t[0]=1-A-k,t[3]=E-W,t[6]=I+N,t[1]=E+W,t[4]=1-w-k,t[7]=z-B,t[2]=I-N,t[5]=z+B,t[8]=1-w-A,t},jn.normalFromMat4=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=e[4],_=e[5],y=e[6],w=e[7],E=e[8],A=e[9],I=e[10],z=e[11],k=e[12],B=e[13],N=e[14],W=e[15],ee=n*_-s*d,te=n*y-l*d,ne=n*w-c*d,me=s*y-l*_,de=s*w-c*_,be=l*w-c*y,Ae=E*B-A*k,ze=E*N-I*k,$e=E*W-z*k,Ve=A*N-I*B,Je=A*W-z*B,ht=I*W-z*N,Ye=ee*ht-te*Je+ne*Ve+me*$e-de*ze+be*Ae;return Ye?(t[0]=(_*ht-y*Je+w*Ve)*(Ye=1/Ye),t[1]=(y*$e-d*ht-w*ze)*Ye,t[2]=(d*Je-_*$e+w*Ae)*Ye,t[3]=(l*Je-s*ht-c*Ve)*Ye,t[4]=(n*ht-l*$e+c*ze)*Ye,t[5]=(s*$e-n*Je-c*Ae)*Ye,t[6]=(B*be-N*de+W*me)*Ye,t[7]=(N*ne-k*be-W*te)*Ye,t[8]=(k*de-B*ne+W*ee)*Ye,t):null},jn.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},jn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},jn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},jn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},jn.subtract=Ga,jn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},jn.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t[4]=e[4]+n[4]*s,t[5]=e[5]+n[5]*s,t[6]=e[6]+n[6]*s,t[7]=e[7]+n[7]*s,t[8]=e[8]+n[8]*s,t},jn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},jn.equals=function(t,e){var n=t[0],s=t[1],l=t[2],c=t[3],d=t[4],_=t[5],y=t[6],w=t[7],E=t[8],A=e[0],I=e[1],z=e[2],k=e[3],B=e[4],N=e[5],W=e[6],ee=e[7],te=e[8];return Math.abs(n-A)<=Fr.EPSILON*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(s-I)<=Fr.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-z)<=Fr.EPSILON*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(c-k)<=Fr.EPSILON*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(d-B)<=Fr.EPSILON*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(_-N)<=Fr.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(y-W)<=Fr.EPSILON*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(w-ee)<=Fr.EPSILON*Math.max(1,Math.abs(w),Math.abs(ee))&&Math.abs(E-te)<=Fr.EPSILON*Math.max(1,Math.abs(E),Math.abs(te))},jn.sub=jn.mul=void 0;var Fr=function(t,e){if(t&&t.__esModule)return t;if(t===null||ps(t)!=="object"&&typeof t!="function")return{default:t};var n=is(void 0);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}(Ct);function is(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(is=function(s){return s?n:e})(t)}function da(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=e[4],y=e[5],w=e[6],E=e[7],A=e[8],I=n[0],z=n[1],k=n[2],B=n[3],N=n[4],W=n[5],ee=n[6],te=n[7],ne=n[8];return t[0]=I*s+z*d+k*w,t[1]=I*l+z*_+k*E,t[2]=I*c+z*y+k*A,t[3]=B*s+N*d+W*w,t[4]=B*l+N*_+W*E,t[5]=B*c+N*y+W*A,t[6]=ee*s+te*d+ne*w,t[7]=ee*l+te*_+ne*E,t[8]=ee*c+te*y+ne*A,t}function Ga(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}jn.mul=da,jn.sub=Ga;var en={};function Lu(t){return Lu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lu(t)}Object.defineProperty(en,"__esModule",{value:!0}),en.create=function(){var t=new pr.ARRAY_TYPE(16);return pr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},en.clone=function(t){var e=new pr.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},en.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},en.fromValues=function(t,e,n,s,l,c,d,_,y,w,E,A,I,z,k,B){var N=new pr.ARRAY_TYPE(16);return N[0]=t,N[1]=e,N[2]=n,N[3]=s,N[4]=l,N[5]=c,N[6]=d,N[7]=_,N[8]=y,N[9]=w,N[10]=E,N[11]=A,N[12]=I,N[13]=z,N[14]=k,N[15]=B,N},en.set=function(t,e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N){return t[0]=e,t[1]=n,t[2]=s,t[3]=l,t[4]=c,t[5]=d,t[6]=_,t[7]=y,t[8]=w,t[9]=E,t[10]=A,t[11]=I,t[12]=z,t[13]=k,t[14]=B,t[15]=N,t},en.identity=Xc,en.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],l=e[3],c=e[6],d=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=c,t[11]=e[14],t[12]=l,t[13]=d,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},en.invert=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=e[4],_=e[5],y=e[6],w=e[7],E=e[8],A=e[9],I=e[10],z=e[11],k=e[12],B=e[13],N=e[14],W=e[15],ee=n*_-s*d,te=n*y-l*d,ne=n*w-c*d,me=s*y-l*_,de=s*w-c*_,be=l*w-c*y,Ae=E*B-A*k,ze=E*N-I*k,$e=E*W-z*k,Ve=A*N-I*B,Je=A*W-z*B,ht=I*W-z*N,Ye=ee*ht-te*Je+ne*Ve+me*$e-de*ze+be*Ae;return Ye?(t[0]=(_*ht-y*Je+w*Ve)*(Ye=1/Ye),t[1]=(l*Je-s*ht-c*Ve)*Ye,t[2]=(B*be-N*de+W*me)*Ye,t[3]=(I*de-A*be-z*me)*Ye,t[4]=(y*$e-d*ht-w*ze)*Ye,t[5]=(n*ht-l*$e+c*ze)*Ye,t[6]=(N*ne-k*be-W*te)*Ye,t[7]=(E*be-I*ne+z*te)*Ye,t[8]=(d*Je-_*$e+w*Ae)*Ye,t[9]=(s*$e-n*Je-c*Ae)*Ye,t[10]=(k*de-B*ne+W*ee)*Ye,t[11]=(A*ne-E*de-z*ee)*Ye,t[12]=(_*ze-d*Ve-y*Ae)*Ye,t[13]=(n*Ve-s*ze+l*Ae)*Ye,t[14]=(B*te-k*me-N*ee)*Ye,t[15]=(E*me-A*te+I*ee)*Ye,t):null},en.adjoint=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=e[4],_=e[5],y=e[6],w=e[7],E=e[8],A=e[9],I=e[10],z=e[11],k=e[12],B=e[13],N=e[14],W=e[15];return t[0]=_*(I*W-z*N)-A*(y*W-w*N)+B*(y*z-w*I),t[1]=-(s*(I*W-z*N)-A*(l*W-c*N)+B*(l*z-c*I)),t[2]=s*(y*W-w*N)-_*(l*W-c*N)+B*(l*w-c*y),t[3]=-(s*(y*z-w*I)-_*(l*z-c*I)+A*(l*w-c*y)),t[4]=-(d*(I*W-z*N)-E*(y*W-w*N)+k*(y*z-w*I)),t[5]=n*(I*W-z*N)-E*(l*W-c*N)+k*(l*z-c*I),t[6]=-(n*(y*W-w*N)-d*(l*W-c*N)+k*(l*w-c*y)),t[7]=n*(y*z-w*I)-d*(l*z-c*I)+E*(l*w-c*y),t[8]=d*(A*W-z*B)-E*(_*W-w*B)+k*(_*z-w*A),t[9]=-(n*(A*W-z*B)-E*(s*W-c*B)+k*(s*z-c*A)),t[10]=n*(_*W-w*B)-d*(s*W-c*B)+k*(s*w-c*_),t[11]=-(n*(_*z-w*A)-d*(s*z-c*A)+E*(s*w-c*_)),t[12]=-(d*(A*N-I*B)-E*(_*N-y*B)+k*(_*I-y*A)),t[13]=n*(A*N-I*B)-E*(s*N-l*B)+k*(s*I-l*A),t[14]=-(n*(_*N-y*B)-d*(s*N-l*B)+k*(s*y-l*_)),t[15]=n*(_*I-y*A)-d*(s*I-l*A)+E*(s*y-l*_),t},en.determinant=function(t){var e=t[0],n=t[1],s=t[2],l=t[3],c=t[4],d=t[5],_=t[6],y=t[7],w=t[8],E=t[9],A=t[10],I=t[11],z=t[12],k=t[13],B=t[14],N=t[15];return(e*d-n*c)*(A*N-I*B)-(e*_-s*c)*(E*N-I*k)+(e*y-l*c)*(E*B-A*k)+(n*_-s*d)*(w*N-I*z)-(n*y-l*d)*(w*B-A*z)+(s*y-l*_)*(w*k-E*z)},en.multiply=ms,en.translate=function(t,e,n){var s,l,c,d,_,y,w,E,A,I,z,k,B=n[0],N=n[1],W=n[2];return e===t?(t[12]=e[0]*B+e[4]*N+e[8]*W+e[12],t[13]=e[1]*B+e[5]*N+e[9]*W+e[13],t[14]=e[2]*B+e[6]*N+e[10]*W+e[14],t[15]=e[3]*B+e[7]*N+e[11]*W+e[15]):(l=e[1],c=e[2],d=e[3],_=e[4],y=e[5],w=e[6],E=e[7],A=e[8],I=e[9],z=e[10],k=e[11],t[0]=s=e[0],t[1]=l,t[2]=c,t[3]=d,t[4]=_,t[5]=y,t[6]=w,t[7]=E,t[8]=A,t[9]=I,t[10]=z,t[11]=k,t[12]=s*B+_*N+A*W+e[12],t[13]=l*B+y*N+I*W+e[13],t[14]=c*B+w*N+z*W+e[14],t[15]=d*B+E*N+k*W+e[15]),t},en.scale=function(t,e,n){var s=n[0],l=n[1],c=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},en.rotate=function(t,e,n,s){var l,c,d,_,y,w,E,A,I,z,k,B,N,W,ee,te,ne,me,de,be,Ae,ze,$e,Ve,Je=s[0],ht=s[1],Ye=s[2],it=Math.hypot(Je,ht,Ye);return it<pr.EPSILON?null:(Je*=it=1/it,ht*=it,Ye*=it,l=Math.sin(n),c=Math.cos(n),y=e[1],w=e[2],E=e[3],I=e[5],z=e[6],k=e[7],N=e[9],W=e[10],ee=e[11],te=Je*Je*(d=1-c)+c,de=Je*ht*d-Ye*l,be=ht*ht*d+c,Ae=Ye*ht*d+Je*l,ze=Je*Ye*d+ht*l,$e=ht*Ye*d-Je*l,Ve=Ye*Ye*d+c,t[0]=(_=e[0])*te+(A=e[4])*(ne=ht*Je*d+Ye*l)+(B=e[8])*(me=Ye*Je*d-ht*l),t[1]=y*te+I*ne+N*me,t[2]=w*te+z*ne+W*me,t[3]=E*te+k*ne+ee*me,t[4]=_*de+A*be+B*Ae,t[5]=y*de+I*be+N*Ae,t[6]=w*de+z*be+W*Ae,t[7]=E*de+k*be+ee*Ae,t[8]=_*ze+A*$e+B*Ve,t[9]=y*ze+I*$e+N*Ve,t[10]=w*ze+z*$e+W*Ve,t[11]=E*ze+k*$e+ee*Ve,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},en.rotateX=function(t,e,n){var s=Math.sin(n),l=Math.cos(n),c=e[4],d=e[5],_=e[6],y=e[7],w=e[8],E=e[9],A=e[10],I=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*l+w*s,t[5]=d*l+E*s,t[6]=_*l+A*s,t[7]=y*l+I*s,t[8]=w*l-c*s,t[9]=E*l-d*s,t[10]=A*l-_*s,t[11]=I*l-y*s,t},en.rotateY=function(t,e,n){var s=Math.sin(n),l=Math.cos(n),c=e[0],d=e[1],_=e[2],y=e[3],w=e[8],E=e[9],A=e[10],I=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*l-w*s,t[1]=d*l-E*s,t[2]=_*l-A*s,t[3]=y*l-I*s,t[8]=c*s+w*l,t[9]=d*s+E*l,t[10]=_*s+A*l,t[11]=y*s+I*l,t},en.rotateZ=function(t,e,n){var s=Math.sin(n),l=Math.cos(n),c=e[0],d=e[1],_=e[2],y=e[3],w=e[4],E=e[5],A=e[6],I=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*l+w*s,t[1]=d*l+E*s,t[2]=_*l+A*s,t[3]=y*l+I*s,t[4]=w*l-c*s,t[5]=E*l-d*s,t[6]=A*l-_*s,t[7]=I*l-y*s,t},en.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},en.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},en.fromRotation=function(t,e,n){var s,l,c,d=n[0],_=n[1],y=n[2],w=Math.hypot(d,_,y);return w<pr.EPSILON?null:(d*=w=1/w,_*=w,y*=w,s=Math.sin(e),l=Math.cos(e),t[0]=d*d*(c=1-l)+l,t[1]=_*d*c+y*s,t[2]=y*d*c-_*s,t[3]=0,t[4]=d*_*c-y*s,t[5]=_*_*c+l,t[6]=y*_*c+d*s,t[7]=0,t[8]=d*y*c+_*s,t[9]=_*y*c-d*s,t[10]=y*y*c+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},en.fromXRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},en.fromYRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},en.fromZRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},en.fromRotationTranslation=fa,en.fromQuat2=function(t,e){var n=new pr.ARRAY_TYPE(3),s=-e[0],l=-e[1],c=-e[2],d=e[3],_=e[4],y=e[5],w=e[6],E=e[7],A=s*s+l*l+c*c+d*d;return A>0?(n[0]=2*(_*d+E*s+y*c-w*l)/A,n[1]=2*(y*d+E*l+w*s-_*c)/A,n[2]=2*(w*d+E*c+_*l-y*s)/A):(n[0]=2*(_*d+E*s+y*c-w*l),n[1]=2*(y*d+E*l+w*s-_*c),n[2]=2*(w*d+E*c+_*l-y*s)),fa(t,e,n),t},en.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},en.getScaling=Du,en.getRotation=function(t,e){var n=new pr.ARRAY_TYPE(3);Du(n,e);var s=1/n[0],l=1/n[1],c=1/n[2],d=e[0]*s,_=e[1]*l,y=e[2]*c,w=e[4]*s,E=e[5]*l,A=e[6]*c,I=e[8]*s,z=e[9]*l,k=e[10]*c,B=d+E+k,N=0;return B>0?(N=2*Math.sqrt(B+1),t[3]=.25*N,t[0]=(A-z)/N,t[1]=(I-y)/N,t[2]=(_-w)/N):d>E&&d>k?(N=2*Math.sqrt(1+d-E-k),t[3]=(A-z)/N,t[0]=.25*N,t[1]=(_+w)/N,t[2]=(I+y)/N):E>k?(N=2*Math.sqrt(1+E-d-k),t[3]=(I-y)/N,t[0]=(_+w)/N,t[1]=.25*N,t[2]=(A+z)/N):(N=2*Math.sqrt(1+k-d-E),t[3]=(_-w)/N,t[0]=(I+y)/N,t[1]=(A+z)/N,t[2]=.25*N),t},en.fromRotationTranslationScale=function(t,e,n,s){var l=e[0],c=e[1],d=e[2],_=e[3],y=l+l,w=c+c,E=d+d,A=l*y,I=l*w,z=l*E,k=c*w,B=c*E,N=d*E,W=_*y,ee=_*w,te=_*E,ne=s[0],me=s[1],de=s[2];return t[0]=(1-(k+N))*ne,t[1]=(I+te)*ne,t[2]=(z-ee)*ne,t[3]=0,t[4]=(I-te)*me,t[5]=(1-(A+N))*me,t[6]=(B+W)*me,t[7]=0,t[8]=(z+ee)*de,t[9]=(B-W)*de,t[10]=(1-(A+k))*de,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},en.fromRotationTranslationScaleOrigin=function(t,e,n,s,l){var c=e[0],d=e[1],_=e[2],y=e[3],w=c+c,E=d+d,A=_+_,I=c*w,z=c*E,k=c*A,B=d*E,N=d*A,W=_*A,ee=y*w,te=y*E,ne=y*A,me=s[0],de=s[1],be=s[2],Ae=l[0],ze=l[1],$e=l[2],Ve=(1-(B+W))*me,Je=(z+ne)*me,ht=(k-te)*me,Ye=(z-ne)*de,it=(1-(I+W))*de,qe=(N+ee)*de,st=(k+te)*be,mt=(N-ee)*be,ut=(1-(I+B))*be;return t[0]=Ve,t[1]=Je,t[2]=ht,t[3]=0,t[4]=Ye,t[5]=it,t[6]=qe,t[7]=0,t[8]=st,t[9]=mt,t[10]=ut,t[11]=0,t[12]=n[0]+Ae-(Ve*Ae+Ye*ze+st*$e),t[13]=n[1]+ze-(Je*Ae+it*ze+mt*$e),t[14]=n[2]+$e-(ht*Ae+qe*ze+ut*$e),t[15]=1,t},en.fromQuat=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=n+n,_=s+s,y=l+l,w=n*d,E=s*d,A=s*_,I=l*d,z=l*_,k=l*y,B=c*d,N=c*_,W=c*y;return t[0]=1-A-k,t[1]=E+W,t[2]=I-N,t[3]=0,t[4]=E-W,t[5]=1-w-k,t[6]=z+B,t[7]=0,t[8]=I+N,t[9]=z-B,t[10]=1-w-A,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},en.frustum=function(t,e,n,s,l,c,d){var _=1/(n-e),y=1/(l-s),w=1/(c-d);return t[0]=2*c*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*c*y,t[6]=0,t[7]=0,t[8]=(n+e)*_,t[9]=(l+s)*y,t[10]=(d+c)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*c*2*w,t[15]=0,t},en.perspectiveNO=wi,en.perspectiveZO=function(t,e,n,s,l){var c,d=1/Math.tan(e/2);return t[0]=d/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=l*(c=1/(s-l)),t[14]=l*s*c):(t[10]=-1,t[14]=-s),t},en.perspectiveFromFieldOfView=function(t,e,n,s){var l=Math.tan(e.upDegrees*Math.PI/180),c=Math.tan(e.downDegrees*Math.PI/180),d=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),y=2/(d+_),w=2/(l+c);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=-(d-_)*y*.5,t[9]=(l-c)*w*.5,t[10]=s/(n-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*n/(n-s),t[15]=0,t},en.orthoNO=Ks,en.orthoZO=function(t,e,n,s,l,c,d){var _=1/(e-n),y=1/(s-l),w=1/(c-d);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=w,t[11]=0,t[12]=(e+n)*_,t[13]=(l+s)*y,t[14]=c*w,t[15]=1,t},en.lookAt=function(t,e,n,s){var l,c,d,_,y,w,E,A,I,z,k=e[0],B=e[1],N=e[2],W=s[0],ee=s[1],te=s[2],ne=n[0],me=n[1],de=n[2];return Math.abs(k-ne)<pr.EPSILON&&Math.abs(B-me)<pr.EPSILON&&Math.abs(N-de)<pr.EPSILON?Xc(t):(E=k-ne,A=B-me,I=N-de,l=ee*(I*=z=1/Math.hypot(E,A,I))-te*(A*=z),c=te*(E*=z)-W*I,d=W*A-ee*E,(z=Math.hypot(l,c,d))?(l*=z=1/z,c*=z,d*=z):(l=0,c=0,d=0),_=A*d-I*c,y=I*l-E*d,w=E*c-A*l,(z=Math.hypot(_,y,w))?(_*=z=1/z,y*=z,w*=z):(_=0,y=0,w=0),t[0]=l,t[1]=_,t[2]=E,t[3]=0,t[4]=c,t[5]=y,t[6]=A,t[7]=0,t[8]=d,t[9]=w,t[10]=I,t[11]=0,t[12]=-(l*k+c*B+d*N),t[13]=-(_*k+y*B+w*N),t[14]=-(E*k+A*B+I*N),t[15]=1,t)},en.targetTo=function(t,e,n,s){var l=e[0],c=e[1],d=e[2],_=s[0],y=s[1],w=s[2],E=l-n[0],A=c-n[1],I=d-n[2],z=E*E+A*A+I*I;z>0&&(E*=z=1/Math.sqrt(z),A*=z,I*=z);var k=y*I-w*A,B=w*E-_*I,N=_*A-y*E;return(z=k*k+B*B+N*N)>0&&(k*=z=1/Math.sqrt(z),B*=z,N*=z),t[0]=k,t[1]=B,t[2]=N,t[3]=0,t[4]=A*N-I*B,t[5]=I*k-E*N,t[6]=E*B-A*k,t[7]=0,t[8]=E,t[9]=A,t[10]=I,t[11]=0,t[12]=l,t[13]=c,t[14]=d,t[15]=1,t},en.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},en.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},en.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},en.subtract=Yc,en.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},en.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t[4]=e[4]+n[4]*s,t[5]=e[5]+n[5]*s,t[6]=e[6]+n[6]*s,t[7]=e[7]+n[7]*s,t[8]=e[8]+n[8]*s,t[9]=e[9]+n[9]*s,t[10]=e[10]+n[10]*s,t[11]=e[11]+n[11]*s,t[12]=e[12]+n[12]*s,t[13]=e[13]+n[13]*s,t[14]=e[14]+n[14]*s,t[15]=e[15]+n[15]*s,t},en.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},en.equals=function(t,e){var n=t[0],s=t[1],l=t[2],c=t[3],d=t[4],_=t[5],y=t[6],w=t[7],E=t[8],A=t[9],I=t[10],z=t[11],k=t[12],B=t[13],N=t[14],W=t[15],ee=e[0],te=e[1],ne=e[2],me=e[3],de=e[4],be=e[5],Ae=e[6],ze=e[7],$e=e[8],Ve=e[9],Je=e[10],ht=e[11],Ye=e[12],it=e[13],qe=e[14],st=e[15];return Math.abs(n-ee)<=pr.EPSILON*Math.max(1,Math.abs(n),Math.abs(ee))&&Math.abs(s-te)<=pr.EPSILON*Math.max(1,Math.abs(s),Math.abs(te))&&Math.abs(l-ne)<=pr.EPSILON*Math.max(1,Math.abs(l),Math.abs(ne))&&Math.abs(c-me)<=pr.EPSILON*Math.max(1,Math.abs(c),Math.abs(me))&&Math.abs(d-de)<=pr.EPSILON*Math.max(1,Math.abs(d),Math.abs(de))&&Math.abs(_-be)<=pr.EPSILON*Math.max(1,Math.abs(_),Math.abs(be))&&Math.abs(y-Ae)<=pr.EPSILON*Math.max(1,Math.abs(y),Math.abs(Ae))&&Math.abs(w-ze)<=pr.EPSILON*Math.max(1,Math.abs(w),Math.abs(ze))&&Math.abs(E-$e)<=pr.EPSILON*Math.max(1,Math.abs(E),Math.abs($e))&&Math.abs(A-Ve)<=pr.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ve))&&Math.abs(I-Je)<=pr.EPSILON*Math.max(1,Math.abs(I),Math.abs(Je))&&Math.abs(z-ht)<=pr.EPSILON*Math.max(1,Math.abs(z),Math.abs(ht))&&Math.abs(k-Ye)<=pr.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ye))&&Math.abs(B-it)<=pr.EPSILON*Math.max(1,Math.abs(B),Math.abs(it))&&Math.abs(N-qe)<=pr.EPSILON*Math.max(1,Math.abs(N),Math.abs(qe))&&Math.abs(W-st)<=pr.EPSILON*Math.max(1,Math.abs(W),Math.abs(st))},en.sub=en.mul=en.ortho=en.perspective=void 0;var pr=function(t,e){if(t&&t.__esModule)return t;if(t===null||Lu(t)!=="object"&&typeof t!="function")return{default:t};var n=Rl(void 0);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}(Ct);function Rl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Rl=function(s){return s?n:e})(t)}function Xc(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ms(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=e[4],y=e[5],w=e[6],E=e[7],A=e[8],I=e[9],z=e[10],k=e[11],B=e[12],N=e[13],W=e[14],ee=e[15],te=n[0],ne=n[1],me=n[2],de=n[3];return t[0]=te*s+ne*_+me*A+de*B,t[1]=te*l+ne*y+me*I+de*N,t[2]=te*c+ne*w+me*z+de*W,t[3]=te*d+ne*E+me*k+de*ee,t[4]=(te=n[4])*s+(ne=n[5])*_+(me=n[6])*A+(de=n[7])*B,t[5]=te*l+ne*y+me*I+de*N,t[6]=te*c+ne*w+me*z+de*W,t[7]=te*d+ne*E+me*k+de*ee,t[8]=(te=n[8])*s+(ne=n[9])*_+(me=n[10])*A+(de=n[11])*B,t[9]=te*l+ne*y+me*I+de*N,t[10]=te*c+ne*w+me*z+de*W,t[11]=te*d+ne*E+me*k+de*ee,t[12]=(te=n[12])*s+(ne=n[13])*_+(me=n[14])*A+(de=n[15])*B,t[13]=te*l+ne*y+me*I+de*N,t[14]=te*c+ne*w+me*z+de*W,t[15]=te*d+ne*E+me*k+de*ee,t}function fa(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=s+s,y=l+l,w=c+c,E=s*_,A=s*y,I=s*w,z=l*y,k=l*w,B=c*w,N=d*_,W=d*y,ee=d*w;return t[0]=1-(z+B),t[1]=A+ee,t[2]=I-W,t[3]=0,t[4]=A-ee,t[5]=1-(E+B),t[6]=k+N,t[7]=0,t[8]=I+W,t[9]=k-N,t[10]=1-(E+z),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Du(t,e){var n=e[4],s=e[5],l=e[6],c=e[8],d=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,s,l),t[2]=Math.hypot(c,d,_),t}function wi(t,e,n,s,l){var c,d=1/Math.tan(e/2);return t[0]=d/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+s)*(c=1/(s-l)),t[14]=2*l*s*c):(t[10]=-1,t[14]=-2*s),t}function Ks(t,e,n,s,l,c,d){var _=1/(e-n),y=1/(s-l),w=1/(c-d);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*_,t[13]=(l+s)*y,t[14]=(d+c)*w,t[15]=1,t}function Yc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}en.perspective=wi,en.ortho=Ks,en.mul=ms,en.sub=Yc;var Qt={},Zt={};function ko(t){return ko=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ko(t)}Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=Oo,Zt.clone=function(t){var e=new ji.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Zt.length=zu,Zt.fromValues=function(t,e,n){var s=new ji.ARRAY_TYPE(3);return s[0]=t,s[1]=e,s[2]=n,s},Zt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Zt.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},Zt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Zt.subtract=pa,Zt.multiply=Ls,Zt.divide=ma,Zt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Zt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Zt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Zt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Zt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Zt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Zt.scaleAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t},Zt.distance=Wa,Zt.squaredDistance=Dl,Zt.squaredLength=$a,Zt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Zt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Zt.normalize=function(t,e){var n=e[0],s=e[1],l=e[2],c=n*n+s*s+l*l;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t},Zt.dot=qa,Zt.cross=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=n[0],_=n[1],y=n[2];return t[0]=l*y-c*_,t[1]=c*d-s*y,t[2]=s*_-l*d,t},Zt.lerp=function(t,e,n,s){var l=e[0],c=e[1],d=e[2];return t[0]=l+s*(n[0]-l),t[1]=c+s*(n[1]-c),t[2]=d+s*(n[2]-d),t},Zt.hermite=function(t,e,n,s,l,c){var d=c*c,_=d*(2*c-3)+1,y=d*(c-2)+c,w=d*(c-1),E=d*(3-2*c);return t[0]=e[0]*_+n[0]*y+s[0]*w+l[0]*E,t[1]=e[1]*_+n[1]*y+s[1]*w+l[1]*E,t[2]=e[2]*_+n[2]*y+s[2]*w+l[2]*E,t},Zt.bezier=function(t,e,n,s,l,c){var d=1-c,_=d*d,y=c*c,w=_*d,E=3*c*_,A=3*y*d,I=y*c;return t[0]=e[0]*w+n[0]*E+s[0]*A+l[0]*I,t[1]=e[1]*w+n[1]*E+s[1]*A+l[1]*I,t[2]=e[2]*w+n[2]*E+s[2]*A+l[2]*I,t},Zt.random=function(t,e){e=e||1;var n=2*ji.RANDOM()*Math.PI,s=2*ji.RANDOM()-1,l=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(n)*l,t[1]=Math.sin(n)*l,t[2]=s*e,t},Zt.transformMat4=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=n[3]*s+n[7]*l+n[11]*c+n[15];return t[0]=(n[0]*s+n[4]*l+n[8]*c+n[12])/(d=d||1),t[1]=(n[1]*s+n[5]*l+n[9]*c+n[13])/d,t[2]=(n[2]*s+n[6]*l+n[10]*c+n[14])/d,t},Zt.transformMat3=function(t,e,n){var s=e[0],l=e[1],c=e[2];return t[0]=s*n[0]+l*n[3]+c*n[6],t[1]=s*n[1]+l*n[4]+c*n[7],t[2]=s*n[2]+l*n[5]+c*n[8],t},Zt.transformQuat=function(t,e,n){var s=n[0],l=n[1],c=n[2],d=e[0],_=e[1],y=e[2],w=l*y-c*_,E=c*d-s*y,A=s*_-l*d,I=l*A-c*E,z=c*w-s*A,k=s*E-l*w,B=2*n[3];return E*=B,A*=B,z*=2,k*=2,t[0]=d+(w*=B)+(I*=2),t[1]=_+E+z,t[2]=y+A+k,t},Zt.rotateX=function(t,e,n,s){var l=[],c=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],c[0]=l[0],c[1]=l[1]*Math.cos(s)-l[2]*Math.sin(s),c[2]=l[1]*Math.sin(s)+l[2]*Math.cos(s),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t},Zt.rotateY=function(t,e,n,s){var l=[],c=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],c[0]=l[2]*Math.sin(s)+l[0]*Math.cos(s),c[1]=l[1],c[2]=l[2]*Math.cos(s)-l[0]*Math.sin(s),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t},Zt.rotateZ=function(t,e,n,s){var l=[],c=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],c[0]=l[0]*Math.cos(s)-l[1]*Math.sin(s),c[1]=l[0]*Math.sin(s)+l[1]*Math.cos(s),c[2]=l[2],t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t},Zt.angle=function(t,e){var n=t[0],s=t[1],l=t[2],c=e[0],d=e[1],_=e[2],y=Math.sqrt(n*n+s*s+l*l)*Math.sqrt(c*c+d*d+_*_),w=y&&qa(t,e)/y;return Math.acos(Math.min(Math.max(w,-1),1))},Zt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Zt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Zt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Zt.equals=function(t,e){var n=t[0],s=t[1],l=t[2],c=e[0],d=e[1],_=e[2];return Math.abs(n-c)<=ji.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-d)<=ji.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(l-_)<=ji.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))},Zt.forEach=Zt.sqrLen=Zt.len=Zt.sqrDist=Zt.dist=Zt.div=Zt.mul=Zt.sub=void 0;var ji=function(t,e){if(t&&t.__esModule)return t;if(t===null||ko(t)!=="object"&&typeof t!="function")return{default:t};var n=Ll(void 0);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}(Ct);function Ll(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ll=function(s){return s?n:e})(t)}function Oo(){var t=new ji.ARRAY_TYPE(3);return ji.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function zu(t){return Math.hypot(t[0],t[1],t[2])}function pa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ls(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ma(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Wa(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Dl(t,e){var n=e[0]-t[0],s=e[1]-t[1],l=e[2]-t[2];return n*n+s*s+l*l}function $a(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s}function qa(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Zt.sub=pa,Zt.mul=Ls,Zt.div=ma,Zt.dist=Wa,Zt.sqrDist=Dl,Zt.len=zu,Zt.sqrLen=$a;var _s,ku=(_s=Oo(),function(t,e,n,s,l,c){var d,_;for(e||(e=3),n||(n=0),_=s?Math.min(s*e+n,t.length):t.length,d=n;d<_;d+=e)_s[0]=t[d],_s[1]=t[d+1],_s[2]=t[d+2],l(_s,_s,c),t[d]=_s[0],t[d+1]=_s[1],t[d+2]=_s[2];return t});Zt.forEach=ku;var rn={};function zl(t){return zl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zl(t)}Object.defineProperty(rn,"__esModule",{value:!0}),rn.create=kl,rn.clone=function(t){var e=new Nr.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},rn.fromValues=function(t,e,n,s){var l=new Nr.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=n,l[3]=s,l},rn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},rn.set=function(t,e,n,s,l){return t[0]=e,t[1]=n,t[2]=s,t[3]=l,t},rn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},rn.subtract=vo,rn.multiply=wo,rn.divide=Kc,rn.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},rn.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},rn.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},rn.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},rn.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},rn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},rn.scaleAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t},rn.distance=Ha,rn.squaredDistance=Za,rn.length=Bu,rn.squaredLength=Ol,rn.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},rn.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},rn.normalize=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=n*n+s*s+l*l+c*c;return d>0&&(d=1/Math.sqrt(d)),t[0]=n*d,t[1]=s*d,t[2]=l*d,t[3]=c*d,t},rn.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},rn.cross=function(t,e,n,s){var l=n[0]*s[1]-n[1]*s[0],c=n[0]*s[2]-n[2]*s[0],d=n[0]*s[3]-n[3]*s[0],_=n[1]*s[2]-n[2]*s[1],y=n[1]*s[3]-n[3]*s[1],w=n[2]*s[3]-n[3]*s[2],E=e[0],A=e[1],I=e[2],z=e[3];return t[0]=A*w-I*y+z*_,t[1]=-E*w+I*d-z*c,t[2]=E*y-A*d+z*l,t[3]=-E*_+A*c-I*l,t},rn.lerp=function(t,e,n,s){var l=e[0],c=e[1],d=e[2],_=e[3];return t[0]=l+s*(n[0]-l),t[1]=c+s*(n[1]-c),t[2]=d+s*(n[2]-d),t[3]=_+s*(n[3]-_),t},rn.random=function(t,e){var n,s,l,c,d,_;e=e||1;do d=(n=2*Nr.RANDOM()-1)*n+(s=2*Nr.RANDOM()-1)*s;while(d>=1);do _=(l=2*Nr.RANDOM()-1)*l+(c=2*Nr.RANDOM()-1)*c;while(_>=1);var y=Math.sqrt((1-d)/_);return t[0]=e*n,t[1]=e*s,t[2]=e*l*y,t[3]=e*c*y,t},rn.transformMat4=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3];return t[0]=n[0]*s+n[4]*l+n[8]*c+n[12]*d,t[1]=n[1]*s+n[5]*l+n[9]*c+n[13]*d,t[2]=n[2]*s+n[6]*l+n[10]*c+n[14]*d,t[3]=n[3]*s+n[7]*l+n[11]*c+n[15]*d,t},rn.transformQuat=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=n[0],_=n[1],y=n[2],w=n[3],E=w*s+_*c-y*l,A=w*l+y*s-d*c,I=w*c+d*l-_*s,z=-d*s-_*l-y*c;return t[0]=E*w+z*-d+A*-y-I*-_,t[1]=A*w+z*-_+I*-d-E*-y,t[2]=I*w+z*-y+E*-_-A*-d,t[3]=e[3],t},rn.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},rn.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},rn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},rn.equals=function(t,e){var n=t[0],s=t[1],l=t[2],c=t[3],d=e[0],_=e[1],y=e[2],w=e[3];return Math.abs(n-d)<=Nr.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-_)<=Nr.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-y)<=Nr.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-w)<=Nr.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))},rn.forEach=rn.sqrLen=rn.len=rn.sqrDist=rn.dist=rn.div=rn.mul=rn.sub=void 0;var Nr=function(t,e){if(t&&t.__esModule)return t;if(t===null||zl(t)!=="object"&&typeof t!="function")return{default:t};var n=Ou(void 0);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}(Ct);function Ou(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ou=function(s){return s?n:e})(t)}function kl(){var t=new Nr.ARRAY_TYPE(4);return Nr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function vo(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function wo(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Kc(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Ha(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Za(t,e){var n=e[0]-t[0],s=e[1]-t[1],l=e[2]-t[2],c=e[3]-t[3];return n*n+s*s+l*l+c*c}function Bu(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Ol(t){var e=t[0],n=t[1],s=t[2],l=t[3];return e*e+n*n+s*s+l*l}rn.sub=vo,rn.mul=wo,rn.div=Kc,rn.dist=Ha,rn.sqrDist=Za,rn.len=Bu,rn.sqrLen=Ol;var fd=function(){var t=kl();return function(e,n,s,l,c,d){var _,y;for(n||(n=4),s||(s=0),y=l?Math.min(l*n+s,e.length):e.length,_=s;_<y;_+=n)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],c(t,t,d),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function Fu(t){return Fu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fu(t)}rn.forEach=fd,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.create=Nu,Qt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Qt.setAxisAngle=Jc,Qt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),s=Math.sin(n/2);return s>Js.EPSILON?(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s):(t[0]=1,t[1]=0,t[2]=0),n},Qt.getAngle=function(t,e){var n=we(t,e);return Math.acos(2*n*n-1)},Qt.multiply=Vu,Qt.rotateX=function(t,e,n){n*=.5;var s=e[0],l=e[1],c=e[2],d=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=s*y+d*_,t[1]=l*y+c*_,t[2]=c*y-l*_,t[3]=d*y-s*_,t},Qt.rotateY=function(t,e,n){n*=.5;var s=e[0],l=e[1],c=e[2],d=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=s*y-c*_,t[1]=l*y+d*_,t[2]=c*y+s*_,t[3]=d*y-l*_,t},Qt.rotateZ=function(t,e,n){n*=.5;var s=e[0],l=e[1],c=e[2],d=e[3],_=Math.sin(n),y=Math.cos(n);return t[0]=s*y+l*_,t[1]=l*y-s*_,t[2]=c*y+d*_,t[3]=d*y-c*_,t},Qt.calculateW=function(t,e){var n=e[0],s=e[1],l=e[2];return t[0]=n,t[1]=s,t[2]=l,t[3]=Math.sqrt(Math.abs(1-n*n-s*s-l*l)),t},Qt.exp=Ce,Qt.ln=$,Qt.pow=function(t,e,n){return $(t,e),ve(t,t,n),Ce(t,t),t},Qt.slerp=K,Qt.random=function(t){var e=Js.RANDOM(),n=Js.RANDOM(),s=Js.RANDOM(),l=Math.sqrt(1-e),c=Math.sqrt(e);return t[0]=l*Math.sin(2*Math.PI*n),t[1]=l*Math.cos(2*Math.PI*n),t[2]=c*Math.sin(2*Math.PI*s),t[3]=c*Math.cos(2*Math.PI*s),t},Qt.invert=function(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=n*n+s*s+l*l+c*c,_=d?1/d:0;return t[0]=-n*_,t[1]=-s*_,t[2]=-l*_,t[3]=c*_,t},Qt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Qt.fromMat3=he,Qt.fromEuler=function(t,e,n,s){var l=.5*Math.PI/180;e*=l,n*=l,s*=l;var c=Math.sin(e),d=Math.cos(e),_=Math.sin(n),y=Math.cos(n),w=Math.sin(s),E=Math.cos(s);return t[0]=c*y*E-d*_*w,t[1]=d*_*E+c*y*w,t[2]=d*y*w-c*_*E,t[3]=d*y*E+c*_*w,t},Qt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Qt.setAxes=Qt.sqlerp=Qt.rotationTo=Qt.equals=Qt.exactEquals=Qt.normalize=Qt.sqrLen=Qt.squaredLength=Qt.len=Qt.length=Qt.lerp=Qt.dot=Qt.scale=Qt.mul=Qt.add=Qt.set=Qt.copy=Qt.fromValues=Qt.clone=void 0;var Js=Bl(Ct),Bo=Bl(jn),Qs=Bl(Zt),fi=Bl(rn);function pd(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(pd=function(s){return s?n:e})(t)}function Bl(t,e){if(t&&t.__esModule)return t;if(t===null||Fu(t)!=="object"&&typeof t!="function")return{default:t};var n=pd(e);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}function Nu(){var t=new Js.ARRAY_TYPE(4);return Js.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Jc(t,e,n){n*=.5;var s=Math.sin(n);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(n),t}function Vu(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=n[0],y=n[1],w=n[2],E=n[3];return t[0]=s*E+d*_+l*w-c*y,t[1]=l*E+d*y+c*_-s*w,t[2]=c*E+d*w+s*y-l*_,t[3]=d*E-s*_-l*y-c*w,t}function Ce(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=Math.sqrt(n*n+s*s+l*l),_=Math.exp(c),y=d>0?_*Math.sin(d)/d:0;return t[0]=n*y,t[1]=s*y,t[2]=l*y,t[3]=_*Math.cos(d),t}function $(t,e){var n=e[0],s=e[1],l=e[2],c=e[3],d=Math.sqrt(n*n+s*s+l*l),_=d>0?Math.atan2(d,c)/d:0;return t[0]=n*_,t[1]=s*_,t[2]=l*_,t[3]=.5*Math.log(n*n+s*s+l*l+c*c),t}function K(t,e,n,s){var l,c,d,_,y,w=e[0],E=e[1],A=e[2],I=e[3],z=n[0],k=n[1],B=n[2],N=n[3];return(c=w*z+E*k+A*B+I*N)<0&&(c=-c,z=-z,k=-k,B=-B,N=-N),1-c>Js.EPSILON?(l=Math.acos(c),d=Math.sin(l),_=Math.sin((1-s)*l)/d,y=Math.sin(s*l)/d):(_=1-s,y=s),t[0]=_*w+y*z,t[1]=_*E+y*k,t[2]=_*A+y*B,t[3]=_*I+y*N,t}function he(t,e){var n,s=e[0]+e[4]+e[8];if(s>0)n=Math.sqrt(s+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var l=0;e[4]>e[0]&&(l=1),e[8]>e[3*l+l]&&(l=2);var c=(l+1)%3,d=(l+2)%3;n=Math.sqrt(e[3*l+l]-e[3*c+c]-e[3*d+d]+1),t[l]=.5*n,t[3]=(e[3*c+d]-e[3*d+c])*(n=.5/n),t[c]=(e[3*c+l]+e[3*l+c])*n,t[d]=(e[3*d+l]+e[3*l+d])*n}return t}Qt.clone=fi.clone,Qt.fromValues=fi.fromValues,Qt.copy=fi.copy,Qt.set=fi.set,Qt.add=fi.add,Qt.mul=Vu;var ve=fi.scale;Qt.scale=ve;var we=fi.dot;Qt.dot=we,Qt.lerp=fi.lerp;var De=fi.length;Qt.length=De,Qt.len=De;var Ge=fi.squaredLength;Qt.squaredLength=Ge,Qt.sqrLen=Ge;var Ie=fi.normalize;Qt.normalize=Ie,Qt.exactEquals=fi.exactEquals,Qt.equals=fi.equals;var We,gt,ft,Ft=(We=Qs.create(),gt=Qs.fromValues(1,0,0),ft=Qs.fromValues(0,1,0),function(t,e,n){var s=Qs.dot(e,n);return s<-.999999?(Qs.cross(We,gt,e),Qs.len(We)<1e-6&&Qs.cross(We,ft,e),Qs.normalize(We,We),Jc(t,We,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Qs.cross(We,e,n),t[0]=We[0],t[1]=We[1],t[2]=We[2],t[3]=1+s,Ie(t,t))});Qt.rotationTo=Ft;var Yt,gn,Tn=(Yt=Nu(),gn=Nu(),function(t,e,n,s,l,c){return K(Yt,e,l,c),K(gn,n,s,c),K(t,Yt,gn,2*c*(1-c)),t});Qt.sqlerp=Tn;var un,Rn=(un=Bo.create(),function(t,e,n,s){return un[0]=n[0],un[3]=n[1],un[6]=n[2],un[1]=s[0],un[4]=s[1],un[7]=s[2],un[2]=-e[0],un[5]=-e[1],un[8]=-e[2],Ie(t,he(t,un))});Qt.setAxes=Rn;var Bt={};function Ar(t){return Ar=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ar(t)}Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.create=function(){var t=new rr.ARRAY_TYPE(8);return rr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Bt.clone=function(t){var e=new rr.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Bt.fromValues=function(t,e,n,s,l,c,d,_){var y=new rr.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=s,y[4]=l,y[5]=c,y[6]=d,y[7]=_,y},Bt.fromRotationTranslationValues=function(t,e,n,s,l,c,d){var _=new rr.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=n,_[3]=s;var y=.5*l,w=.5*c,E=.5*d;return _[4]=y*s+w*n-E*e,_[5]=w*s+E*t-y*n,_[6]=E*s+y*e-w*t,_[7]=-y*t-w*e-E*n,_},Bt.fromRotationTranslation=Ri,Bt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Bt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Bt.fromMat4=function(t,e){var n=Fn.create();Zr.getRotation(n,e);var s=new rr.ARRAY_TYPE(3);return Zr.getTranslation(s,e),Ri(t,n,s),t},Bt.copy=bi,Bt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Bt.set=function(t,e,n,s,l,c,d,_,y){return t[0]=e,t[1]=n,t[2]=s,t[3]=l,t[4]=c,t[5]=d,t[6]=_,t[7]=y,t},Bt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Bt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Bt.getTranslation=function(t,e){var n=e[4],s=e[5],l=e[6],c=e[7],d=-e[0],_=-e[1],y=-e[2],w=e[3];return t[0]=2*(n*w+c*d+s*y-l*_),t[1]=2*(s*w+c*_+l*d-n*y),t[2]=2*(l*w+c*y+n*_-s*d),t},Bt.translate=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=.5*n[0],y=.5*n[1],w=.5*n[2],E=e[4],A=e[5],I=e[6],z=e[7];return t[0]=s,t[1]=l,t[2]=c,t[3]=d,t[4]=d*_+l*w-c*y+E,t[5]=d*y+c*_-s*w+A,t[6]=d*w+s*y-l*_+I,t[7]=-s*_-l*y-c*w+z,t},Bt.rotateX=function(t,e,n){var s=-e[0],l=-e[1],c=-e[2],d=e[3],_=e[4],y=e[5],w=e[6],E=e[7],A=_*d+E*s+y*c-w*l,I=y*d+E*l+w*s-_*c,z=w*d+E*c+_*l-y*s,k=E*d-_*s-y*l-w*c;return Fn.rotateX(t,e,n),t[4]=A*(d=t[3])+k*(s=t[0])+I*(c=t[2])-z*(l=t[1]),t[5]=I*d+k*l+z*s-A*c,t[6]=z*d+k*c+A*l-I*s,t[7]=k*d-A*s-I*l-z*c,t},Bt.rotateY=function(t,e,n){var s=-e[0],l=-e[1],c=-e[2],d=e[3],_=e[4],y=e[5],w=e[6],E=e[7],A=_*d+E*s+y*c-w*l,I=y*d+E*l+w*s-_*c,z=w*d+E*c+_*l-y*s,k=E*d-_*s-y*l-w*c;return Fn.rotateY(t,e,n),t[4]=A*(d=t[3])+k*(s=t[0])+I*(c=t[2])-z*(l=t[1]),t[5]=I*d+k*l+z*s-A*c,t[6]=z*d+k*c+A*l-I*s,t[7]=k*d-A*s-I*l-z*c,t},Bt.rotateZ=function(t,e,n){var s=-e[0],l=-e[1],c=-e[2],d=e[3],_=e[4],y=e[5],w=e[6],E=e[7],A=_*d+E*s+y*c-w*l,I=y*d+E*l+w*s-_*c,z=w*d+E*c+_*l-y*s,k=E*d-_*s-y*l-w*c;return Fn.rotateZ(t,e,n),t[4]=A*(d=t[3])+k*(s=t[0])+I*(c=t[2])-z*(l=t[1]),t[5]=I*d+k*l+z*s-A*c,t[6]=z*d+k*c+A*l-I*s,t[7]=k*d-A*s-I*l-z*c,t},Bt.rotateByQuatAppend=function(t,e,n){var s=n[0],l=n[1],c=n[2],d=n[3],_=e[0],y=e[1],w=e[2],E=e[3];return t[0]=_*d+E*s+y*c-w*l,t[1]=y*d+E*l+w*s-_*c,t[2]=w*d+E*c+_*l-y*s,t[3]=E*d-_*s-y*l-w*c,t[4]=(_=e[4])*d+(E=e[7])*s+(y=e[5])*c-(w=e[6])*l,t[5]=y*d+E*l+w*s-_*c,t[6]=w*d+E*c+_*l-y*s,t[7]=E*d-_*s-y*l-w*c,t},Bt.rotateByQuatPrepend=function(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=n[0],y=n[1],w=n[2],E=n[3];return t[0]=s*E+d*_+l*w-c*y,t[1]=l*E+d*y+c*_-s*w,t[2]=c*E+d*w+s*y-l*_,t[3]=d*E-s*_-l*y-c*w,t[4]=s*(E=n[7])+d*(_=n[4])+l*(w=n[6])-c*(y=n[5]),t[5]=l*E+d*y+c*_-s*w,t[6]=c*E+d*w+s*y-l*_,t[7]=d*E-s*_-l*y-c*w,t},Bt.rotateAroundAxis=function(t,e,n,s){if(Math.abs(s)<rr.EPSILON)return bi(t,e);var l=Math.hypot(n[0],n[1],n[2]);s*=.5;var c=Math.sin(s),d=c*n[0]/l,_=c*n[1]/l,y=c*n[2]/l,w=Math.cos(s),E=e[0],A=e[1],I=e[2],z=e[3];t[0]=E*w+z*d+A*y-I*_,t[1]=A*w+z*_+I*d-E*y,t[2]=I*w+z*y+E*_-A*d,t[3]=z*w-E*d-A*_-I*y;var k=e[4],B=e[5],N=e[6],W=e[7];return t[4]=k*w+W*d+B*y-N*_,t[5]=B*w+W*_+N*d-k*y,t[6]=N*w+W*y+k*_-B*d,t[7]=W*w-k*d-B*_-N*y,t},Bt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},Bt.multiply=Fl,Bt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},Bt.lerp=function(t,e,n,s){var l=1-s;return md(e,n)<0&&(s=-s),t[0]=e[0]*l+n[0]*s,t[1]=e[1]*l+n[1]*s,t[2]=e[2]*l+n[2]*s,t[3]=e[3]*l+n[3]*s,t[4]=e[4]*l+n[4]*s,t[5]=e[5]*l+n[5]*s,t[6]=e[6]*l+n[6]*s,t[7]=e[7]*l+n[7]*s,t},Bt.invert=function(t,e){var n=Uu(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},Bt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Bt.normalize=function(t,e){var n=Uu(e);if(n>0){n=Math.sqrt(n);var s=e[0]/n,l=e[1]/n,c=e[2]/n,d=e[3]/n,_=e[4],y=e[5],w=e[6],E=e[7],A=s*_+l*y+c*w+d*E;t[0]=s,t[1]=l,t[2]=c,t[3]=d,t[4]=(_-s*A)/n,t[5]=(y-l*A)/n,t[6]=(w-c*A)/n,t[7]=(E-d*A)/n}return t},Bt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Bt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Bt.equals=function(t,e){var n=t[0],s=t[1],l=t[2],c=t[3],d=t[4],_=t[5],y=t[6],w=t[7],E=e[0],A=e[1],I=e[2],z=e[3],k=e[4],B=e[5],N=e[6],W=e[7];return Math.abs(n-E)<=rr.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(s-A)<=rr.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(l-I)<=rr.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-z)<=rr.EPSILON*Math.max(1,Math.abs(c),Math.abs(z))&&Math.abs(d-k)<=rr.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(_-B)<=rr.EPSILON*Math.max(1,Math.abs(_),Math.abs(B))&&Math.abs(y-N)<=rr.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(w-W)<=rr.EPSILON*Math.max(1,Math.abs(w),Math.abs(W))},Bt.sqrLen=Bt.squaredLength=Bt.len=Bt.length=Bt.dot=Bt.mul=Bt.setReal=Bt.getReal=void 0;var rr=Qr(Ct),Fn=Qr(Qt),Zr=Qr(en);function br(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(br=function(s){return s?n:e})(t)}function Qr(t,e){if(t&&t.__esModule)return t;if(t===null||Ar(t)!=="object"&&typeof t!="function")return{default:t};var n=br(e);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}function Ri(t,e,n){var s=.5*n[0],l=.5*n[1],c=.5*n[2],d=e[0],_=e[1],y=e[2],w=e[3];return t[0]=d,t[1]=_,t[2]=y,t[3]=w,t[4]=s*w+l*y-c*_,t[5]=l*w+c*d-s*y,t[6]=c*w+s*_-l*d,t[7]=-s*d-l*_-c*y,t}function bi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Fl(t,e,n){var s=e[0],l=e[1],c=e[2],d=e[3],_=n[4],y=n[5],w=n[6],E=n[7],A=e[4],I=e[5],z=e[6],k=e[7],B=n[0],N=n[1],W=n[2],ee=n[3];return t[0]=s*ee+d*B+l*W-c*N,t[1]=l*ee+d*N+c*B-s*W,t[2]=c*ee+d*W+s*N-l*B,t[3]=d*ee-s*B-l*N-c*W,t[4]=s*E+d*_+l*w-c*y+A*ee+k*B+I*W-z*N,t[5]=l*E+d*y+c*_-s*w+I*ee+k*N+z*B-A*W,t[6]=c*E+d*w+s*y-l*_+z*ee+k*W+A*N-I*B,t[7]=d*E-s*_-l*y-c*w+k*ee-A*B-I*N-z*W,t}Bt.getReal=Fn.copy,Bt.setReal=Fn.copy,Bt.mul=Fl;var md=Fn.dot;Bt.dot=md;var Qc=Fn.length;Bt.length=Qc,Bt.len=Qc;var Uu=Fn.squaredLength;Bt.squaredLength=Uu,Bt.sqrLen=Uu;var fn={};function _d(t){return _d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_d(t)}Object.defineProperty(fn,"__esModule",{value:!0}),fn.create=tp,fn.clone=function(t){var e=new _a.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},fn.fromValues=function(t,e){var n=new _a.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},fn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},fn.set=function(t,e,n){return t[0]=e,t[1]=n,t},fn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},fn.subtract=gd,fn.multiply=th,fn.divide=nh,fn.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},fn.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},fn.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},fn.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},fn.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},fn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},fn.scaleAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t},fn.distance=Xa,fn.squaredDistance=yd,fn.length=xd,fn.squaredLength=np,fn.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},fn.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},fn.normalize=function(t,e){var n=e[0],s=e[1],l=n*n+s*s;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t},fn.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},fn.cross=function(t,e,n){var s=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=s,t},fn.lerp=function(t,e,n,s){var l=e[0],c=e[1];return t[0]=l+s*(n[0]-l),t[1]=c+s*(n[1]-c),t},fn.random=function(t,e){e=e||1;var n=2*_a.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},fn.transformMat2=function(t,e,n){var s=e[0],l=e[1];return t[0]=n[0]*s+n[2]*l,t[1]=n[1]*s+n[3]*l,t},fn.transformMat2d=function(t,e,n){var s=e[0],l=e[1];return t[0]=n[0]*s+n[2]*l+n[4],t[1]=n[1]*s+n[3]*l+n[5],t},fn.transformMat3=function(t,e,n){var s=e[0],l=e[1];return t[0]=n[0]*s+n[3]*l+n[6],t[1]=n[1]*s+n[4]*l+n[7],t},fn.transformMat4=function(t,e,n){var s=e[0],l=e[1];return t[0]=n[0]*s+n[4]*l+n[12],t[1]=n[1]*s+n[5]*l+n[13],t},fn.rotate=function(t,e,n,s){var l=e[0]-n[0],c=e[1]-n[1],d=Math.sin(s),_=Math.cos(s);return t[0]=l*_-c*d+n[0],t[1]=l*d+c*_+n[1],t},fn.angle=function(t,e){var n=t[0],s=t[1],l=e[0],c=e[1],d=Math.sqrt(n*n+s*s)*Math.sqrt(l*l+c*c);return Math.acos(Math.min(Math.max(d&&(n*l+s*c)/d,-1),1))},fn.zero=function(t){return t[0]=0,t[1]=0,t},fn.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},fn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},fn.equals=function(t,e){var n=t[0],s=t[1],l=e[0],c=e[1];return Math.abs(n-l)<=_a.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=_a.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},fn.forEach=fn.sqrLen=fn.sqrDist=fn.dist=fn.div=fn.mul=fn.sub=fn.len=void 0;var _a=function(t,e){if(t&&t.__esModule)return t;if(t===null||_d(t)!=="object"&&typeof t!="function")return{default:t};var n=eh(void 0);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}(Ct);function eh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(eh=function(s){return s?n:e})(t)}function tp(){var t=new _a.ARRAY_TYPE(2);return _a.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function gd(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function th(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function nh(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Xa(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function yd(t,e){var n=e[0]-t[0],s=e[1]-t[1];return n*n+s*s}function xd(t){return Math.hypot(t[0],t[1])}function np(t){var e=t[0],n=t[1];return e*e+n*n}fn.len=xd,fn.sub=gd,fn.mul=th,fn.div=nh,fn.dist=Xa,fn.sqrDist=yd,fn.sqrLen=np;var rp=function(){var t=tp();return function(e,n,s,l,c,d){var _,y;for(n||(n=2),s||(s=0),y=l?Math.min(l*n+s,e.length):e.length,_=s;_<y;_+=n)t[0]=e[_],t[1]=e[_+1],c(t,t,d),e[_]=t[0],e[_+1]=t[1];return e}}();function Nl(t){return Nl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nl(t)}fn.forEach=rp,Object.defineProperty(pt,"__esModule",{value:!0}),o.aA=pt.vec4=o._=pt.vec3=pt.vec2=pt.quat2=o.av=pt.quat=o.ad=pt.mat4=o.bC=pt.mat3=pt.mat2d=o.aC=pt.mat2=pt.glMatrix=void 0;var rh=Fo(Ct);pt.glMatrix=rh;var ih=Fo(xn);o.aC=pt.mat2=ih;var km=Fo(Cn);pt.mat2d=km;var Om=Fo(jn);o.bC=pt.mat3=Om;var Bm=Fo(en);o.ad=pt.mat4=Bm;var Vl=Fo(Qt);o.av=pt.quat=Vl;var Ln=Fo(Bt);pt.quat2=Ln;var Eg=Fo(fn);pt.vec2=Eg;var Cg=Fo(Zt);o._=pt.vec3=Cg;var Ag=Fo(rn);function sh(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(sh=function(s){return s?n:e})(t)}function Fo(t,e){if(t&&t.__esModule)return t;if(t===null||Nl(t)!=="object"&&typeof t!="function")return{default:t};var n=sh(e);if(n&&n.has(t))return n.get(t);var s={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=l?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(s,c,d):s[c]=t[c]}return s.default=t,n&&n.set(t,s),s}o.aA=pt.vec4=Ag;var ip=oh;function oh(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}oh.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var l=this.sampleCurveX(n)-t;if(Math.abs(l)<e)return n;var c=this.sampleCurveDerivativeX(n);if(Math.abs(c)<1e-6)break;n-=l/c}var d=0,_=1;for(n=t,s=0;s<20&&(l=this.sampleCurveX(n),!(Math.abs(l-t)<e));s++)t>l?d=n:_=n,n=.5*(_-d)+d;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var ah=et(ip),vd=yr;function yr(t,e){this.x=t,this.y=e}yr.prototype={clone:function(){return new yr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),l=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yr.convert=function(t){return t instanceof yr?t:Array.isArray(t)?new yr(t[0],t[1]):t};var lt=et(vd);const Fm=Math.PI/180,lh=180/Math.PI;function kn(t){return t*Fm}function Gi(t){return t*lh}const Nm=[[0,0],[1,0],[1,1],[0,1]];function sp(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function ju(t,e,n,s){const l=new ah(t,e,n,s);return function(c){return l.solve(c)}}const Gu=ju(.25,.1,.25,1);function Xt(t,e,n){return Math.min(n,Math.max(e,t))}function ga(t,e,n){return(n=Xt((n-t)/(e-t),0,1))*n*(3-2*n)}function Ds(t,e,n){const s=n-e,l=((t-e)%s+s)%s+e;return l===e?n:l}function Ul(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const l=new Array(t.length);let c=null;t.forEach((d,_)=>{e(d,(y,w)=>{y&&(c=y),l[_]=w,--s==0&&n(c,l)})})}function gs(t){const e=[];for(const n in t)e.push(t[n]);return e}function Rr(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let Vm=1;function uh(){return Vm++}function ch(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function wd(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function bd(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function hh(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Wi(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Wu(t,e,n){const s={};for(const l in t)s[l]=e.call(this,t[l],l,t);return s}function Li(t,e,n){const s={};for(const l in t)e.call(this,t[l],l,t)&&(s[l]=t[l]);return s}function No(t){return Array.isArray(t)?t.map(No):typeof t=="object"&&t?Wu(t,No):t}const Td={};function xr(t){Td[t]||(typeof console<"u"&&console.warn(t),Td[t]=!0)}function zs(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Di(t){let e=0;for(let n,s,l=0,c=t.length,d=c-1;l<c;d=l++)n=t[l],s=t[d],e+=(s.x-n.x)*(n.y+s.y);return e}function mr([t,e,n]){const s=kn(e+90),l=kn(n);return{x:t*Math.cos(s)*Math.sin(l),y:t*Math.sin(s)*Math.sin(l),z:t*Math.cos(l),azimuthal:e,polar:n}}function jr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function dh(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,l,c)=>{const d=l||c;return e[s]=!d||d.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let op,$u,qu,fh,ya,Hu,jl=null;function eo(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ph(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Sd(t,e,n,s){for(;e<n;){const l=e+n>>1;t[l]<s?e=l+1:n=l}return e}function ap(t,e,n,s){for(;e<n;){const l=e+n>>1;t[l]<=s?e=l+1:n=l}return e}function Zu(t){return t>0?1/(1.001-t):1+t}function Xu(t){return t>0?1-1/(1.001-t):-t}function Gl(){return op==null&&(op=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),op}const zi={now:()=>fh!==void 0?fh:performance.now(),setNow(t){fh=t},restoreNow(){fh=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:s}=t;ya||(ya=document.createElement("canvas"));const l=ya.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(n>ya.width||s>ya.height)&&(ya.width=n,ya.height=s),l.clearRect(-e,-e,n+2*e,s+2*e),l.drawImage(t,0,0,n,s),l.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>($u||($u=document.createElement("a")),$u.href=t,$u.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(qu==null&&(qu=window.matchMedia("(prefers-reduced-motion: reduce)")),qu.matches)},hasCanvasFingerprintNoise(){if(Hu!==void 0)return Hu;if(!Gl())return Hu=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let n=0;for(let l=0;l<t.width;++l)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(l,0,1,1);const s=e.getImageData(0,0,t.width,t.height);n=0;for(let l=0;l<s.data.length;++l)if(l%4!=3&&n++!==s.data[l])return Hu=!0,!0;return Hu=!1,!1}};function Yu(t,e){const n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(t.slice(n));for(const l in e)s.set(l,e[l]);return`${t.slice(0,n)}?${s.toString()}`}function mh(t,e={persistentParams:[]}){const n=t.indexOf("?");if(n<0)return t;const s=new URLSearchParams,l=new URLSearchParams(t.slice(n));for(const d of e.persistentParams){const _=l.get(d);_&&s.set(d,_)}const c=s.toString();return`${t.slice(0,n)}${c.length>0?`?${c}`:""}`}const Um="mapbox-tiles";let Ed=500,ss=50,bo,Ya;function lp(){try{return caches}catch{}}function Ku(){const t=lp();t&&!bo&&(bo=t.open(Um))}let Cd=1/0;const Ad={supported:!1,testSupport:function(t){!up&&Qu&&(Ka?jm(t):Ju=t)}};let Ju,Qu,up=!1,Ka=!1;const cp=typeof self<"u"?self:{};function jm(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Qu),t.isContextLost())return;Ad.supported=!0}catch{}t.deleteTexture(e),up=!0}cp.document&&(Qu=cp.document.createElement("img"),Qu.onload=function(){Ju&&jm(Ju),Ju=null,Ka=!0},Qu.onerror=function(){up=!0,Ju=null},Qu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ec={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ec);class Md extends Error{constructor(e,n,s){n===401&&ae(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const To=jr()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ja=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(To())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,l){const c=new AbortController,d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:To(),referrerPolicy:s.referrerPolicy,signal:c.signal});let _=!1,y=!1;const w=(E=d.url).indexOf("sku=")>0&&ae(E);var E;s.type==="json"&&d.headers.set("Accept","application/json");const A=(z,k,B)=>{if(y)return;if(z&&z.message!=="SecurityError"&&xr(z.toString()),k&&B)return I(k);const N=Date.now();fetch(d).then(W=>{if(W.ok){const ee=w?W.clone():null;return I(W,ee,N)}return l(new Md(W.statusText,W.status,s.url))}).catch(W=>{W.name!=="AbortError"&&l(new Error(`${W.message} ${s.url}`))})},I=(z,k,B)=>{(s.type==="arrayBuffer"?z.arrayBuffer():s.type==="json"?z.json():z.text()).then(N=>{y||(k&&B&&function(W,ee,te){if(Ku(),!bo)return;const ne=dh(ee.headers.get("Cache-Control")||"");if(ne["no-store"])return;const me={status:ee.status,statusText:ee.statusText,headers:new Headers};ee.headers.forEach((Ae,ze)=>me.headers.set(ze,Ae)),ne["max-age"]&&me.headers.set("Expires",new Date(te+1e3*ne["max-age"]).toUTCString());const de=me.headers.get("Expires");if(!de||new Date(de).getTime()-te<42e4)return;let be=mh(W.url,{persistentParams:["language","worldview"]});if(ee.status===206){const Ae=W.headers.get("Range");if(!Ae)return;me.status=200,be=Yu(be,{range:Ae})}(function(Ae,ze){if(Ya===void 0)try{new Response(new ReadableStream),Ya=!0}catch{Ya=!1}Ya?ze(Ae.body):Ae.blob().then(ze)})(ee,Ae=>{const ze=new Response(($e=ee.status)!==200&&$e!==404&&[101,103,204,205,304].includes($e)?null:Ae,me);var $e;Ku(),bo&&bo.then(Ve=>Ve.put(be,ze)).catch(Ve=>xr(Ve.message))})}(d,k,B),_=!0,l(null,N,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(N=>{y||l(new Error(N.message))})};return w?function(z,k){if(Ku(),!bo)return k(null);bo.then(B=>{let N=mh(z.url,{persistentParams:["language","worldview"]});const W=z.headers.get("Range");W&&(N=Yu(N,{range:W})),B.match(N).then(ee=>{const te=function(ne){if(!ne)return!1;const me=new Date(ne.headers.get("Expires")||0),de=dh(ne.headers.get("Cache-Control")||"");return me>Date.now()&&!de["no-cache"]}(ee);B.delete(N),te&&B.put(N,ee.clone()),k(null,ee,te)}).catch(k)}).catch(k)}(d,A):A(null,null),{cancel:()=>{y=!0,_||c.abort()}}}(t,e);if(jr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,l){const c=new XMLHttpRequest;c.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const d in s.headers)c.setRequestHeader(d,s.headers[d]);return s.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=s.credentials==="include",c.onerror=()=>{l(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let d=c.response;if(s.type==="json")try{d=JSON.parse(c.response)}catch(_){return l(_)}l(null,d,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else l(new Md(c.statusText,c.status,s.url))},c.send(s.body),{cancel:()=>c.abort()}}(t,e)},Wl=function(t,e){return Ja(Rr(t,{type:"arrayBuffer"}),e)};function Gm(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const hp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Vo,os;Vo=[],os=0;const xa=function(t,e){if(Ad.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),os>=Q.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Vo.push(c),c}os++;let n=!1;const s=()=>{if(!n)for(n=!0,os--;Vo.length&&os<Q.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Vo.shift(),{requestParameters:d,callback:_,cancelled:y}=c;y||(c.cancel=xa(d,_).cancel)}},l=Wl(t,(c,d,_,y)=>{s(),c?e(c):d&&(self.createImageBitmap?function(w,E){const A=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(A).then(I=>{E(null,I)}).catch(I=>{E(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(w,E)=>e(w,E,_,y)):function(w,E){const A=new Image;A.onload=()=>{E(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=hp})},A.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(w)],{type:"image/png"});A.src=w.byteLength?URL.createObjectURL(I):hp}(d,(w,E)=>e(w,E,_,y)))});return{cancel:()=>{l.cancel(),s()}}},dp="01",fp="NO_ACCESS_TOKEN",Mg=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function So(t){const e=t.match(Mg);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function tc(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const va="mapbox.eventData";function He(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class vt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=He(Q.ACCESS_TOKEN);let s="";return s=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(l,c)=>String.fromCharCode(+("0x"+c)))):Q.ACCESS_TOKEN||"",e?`${va}.${e}:${s}`:`${va}:${s}`}fetchEventData(){const e=eo("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const l=localStorage.getItem(n);l&&(this.eventData=JSON.parse(l));const c=localStorage.getItem(s);c&&(this.anonId=c)}catch{xr("Unable to read from LocalStorage")}}saveEventData(){const e=eo("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid"),l=this.anonId;if(e&&l)try{localStorage.setItem(s,l),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{xr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,l){if(!Q.EVENTS_URL)return;const c=So(Q.EVENTS_URL);c.params.push(`access_token=${l||Q.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(e).toISOString()},_=n?Rr(d,n):d,y={url:tc(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(w,E){return Ja(Rr(w,{method:"POST"}),E)}(y,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(l)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const ct=new class extends vt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Q.EVENTS_URL&&Q.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>xe(n)||ae(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=He(Q.ACCESS_TOKEN),n=e?e.u:Q.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;bd(this.anonId)||(this.anonId=ch(),s=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),d=new Date(l),_=(l-this.eventData.lastSuccess)/864e5;s=s||_>=1||_<-1||c.getDate()!==d.getDate()}else s=!0;s?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:dp,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=l,this.eventData.tokenU=n)},t):this.processRequests()}},Kt=ct.postTurnstileEvent.bind(ct),An=new class extends vt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,Q.EVENTS_URL&&(n||Q.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(fp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),bd(this.anonId)||(this.anonId=ch()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:dp,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},_r=An.postMapLoadEvent.bind(An),pi=new class extends vt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=ch(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){const e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){const{map:n,style:s,importedStyles:l}=e;if(!Q.EVENTS_URL||!t&&!Q.ACCESS_TOKEN)return;const c=this.getMapInstanceId(n),d={mapInstanceId:c,eventId:this.getEventId(c),style:s};l.length&&(d.importedStyles=l),this.queueRequest({timestamp:Date.now(),payload:d},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},zr=pi.postStyleLoadEvent.bind(pi),nc=new class extends vt{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Q.EVENTS_URL&&(t||Q.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(l){const c=performance.getEntriesByType("resource"),d=performance.getEntriesByType("mark"),_=function(z){const k={};if(z){for(const B in z)if(B!=="other")for(const N of z[B]){const W=`${B}ResolveRangeMin`,ee=`${B}ResolveRangeMax`,te=`${B}RequestCount`,ne=`${B}RequestCachedCount`;k[W]=Math.min(k[W]||1/0,N.startTime),k[ee]=Math.max(k[ee]||-1/0,N.responseEnd);const me=de=>{k[de]===void 0&&(k[de]=0),++k[de]};N.transferSize!==void 0&&N.transferSize===0&&me(ne),me(te)}}return k}(function(z,k){const B={};if(z)for(const N of z){const W=k(N);B[W]===void 0&&(B[W]=[]),B[W].push(N)}return B}(c,Me)),y=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=w?w.effectiveType:void 0,A={counters:[],metadata:[],attributes:[]},I=(z,k,B)=>{B!=null&&z.push({name:k,value:B.toString()})};for(const z in _)I(A.counters,z,_[z]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(I(A.counters,"interactionRangeMin",l.interactionRange[0]),I(A.counters,"interactionRangeMax",l.interactionRange[1])),d)for(const z of Object.keys(Te)){const k=Te[z],B=d.find(N=>N.name===k);B&&I(A.counters,k,B.startTime)}return I(A.counters,"visibilityHidden",l.visibilityHidden),I(A.attributes,"style",function(z){if(z)for(const k of z){const B=k.name.split("?")[0];if(Tt(B)){const N=B.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(c)),I(A.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),I(A.attributes,"fogEnabled",l.fogEnabled?"true":"false"),I(A.attributes,"projection",l.projection),I(A.attributes,"zoom",l.zoom),I(A.metadata,"devicePixelRatio",y),I(A.metadata,"connectionEffectiveType",E),I(A.metadata,"navigatorUserAgent",navigator.userAgent),I(A.metadata,"screenWidth",window.screen.width),I(A.metadata,"screenHeight",window.screen.height),I(A.metadata,"windowWidth",window.innerWidth),I(A.metadata,"windowHeight",window.innerHeight),I(A.metadata,"mapWidth",l.width/y),I(A.metadata,"mapHeight",l.height/y),I(A.metadata,"webglRenderer",l.renderer),I(A.metadata,"webglVendor",l.vendor),I(A.metadata,"sdkVersion",q),I(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(n);for(const l of s.metadata);for(const l of s.counters);for(const l of s.attributes);this.postEvent(e,s,()=>{},t)}},Ig=nc.postPerformanceEvent.bind(nc),$i=new class extends vt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!Q.API_URL||!Q.SESSION_PATH)return;const l=So(Q.API_URL+Q.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${s||Q.ACCESS_TOKEN||""}`);const c={url:tc(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(d,_){return Ja(Rr(d,{method:"GET"}),_)}(c,d=>{this.pendingRequest=null,n(d),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,Q.SESSION_PATH&&Q.API_URL&&(n||Q.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(fp)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},$l=$i.getSessionAPI.bind($i),_h=new Set;var to={exports:{}},gh={exports:function(t,e){var n,s,l,c,d,_,y,w;for(s=t.length-(n=3&t.length),l=e,d=3432918353,_=461845907,w=0;w<s;)y=255&t.charCodeAt(w)|(255&t.charCodeAt(++w))<<8|(255&t.charCodeAt(++w))<<16|(255&t.charCodeAt(++w))<<24,++w,l=27492+(65535&(c=5*(65535&(l=(l^=y=(65535&(y=(y=(65535&y)*d+(((y>>>16)*d&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&t.charCodeAt(w+2))<<16;case 2:y^=(255&t.charCodeAt(w+1))<<8;case 1:l^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(w)))*d+(((y>>>16)*d&65535)<<16)&4294967295)<<15|y>>>17))*_+(((y>>>16)*_&65535)<<16)&4294967295}return l^=t.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}},Id={exports:function(t,e){for(var n,s=t.length,l=e^s,c=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24))+((1540483477*(n>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++c;switch(s){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:l=1540483477*(65535&(l^=255&t.charCodeAt(c)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0}},Tr=gh.exports,pp=Id.exports;to.exports=Tr,to.exports.murmur3=Tr,to.exports.murmur2=pp;var ql=et(to.exports);function rc(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function ic(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);s!==-1&&n[t].splice(s,1)}}class as{constructor(e,n={}){Rr(this,n),this.type=e}}class Pd extends as{constructor(e,n={}){super("error",Rr({error:e},n))}}class Uo{on(e,n){return this._listeners=this._listeners||{},rc(e,n,this._listeners),this}off(e,n){return ic(e,n,this._listeners),ic(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},rc(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){typeof e=="string"&&(e=new as(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const _ of l)_.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const _ of c)ic(s,_,this._oneTimeListeners),_.call(this,e);const d=this._eventedParent;d&&(Rr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof Pd&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}o.F=void 0;var wa={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Hl(t){return(t=Math.round(t))<0?0:t>255?255:t}function Rd(t){return Hl(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Qa(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function sc(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{o.F={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in wa)return wa[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),l=n.indexOf(")");if(s!==-1&&l+1===n.length){var c=n.substr(0,s),d=n.substr(s+1,l-(s+1)).split(","),_=1;switch(c){case"rgba":if(d.length!==4)return null;_=Qa(d.pop());case"rgb":return d.length!==3?null:[Rd(d[0]),Rd(d[1]),Rd(d[2]),_];case"hsla":if(d.length!==4)return null;_=Qa(d.pop());case"hsl":if(d.length!==3)return null;var y=(parseFloat(d[0])%360+360)%360/360,w=Qa(d[1]),E=Qa(d[2]),A=E<=.5?E*(w+1):E+w-E*w,I=2*E-A;return[Hl(255*sc(I,A,y+1/3)),Hl(255*sc(I,A,y)),Hl(255*sc(I,A,y-1/3)),_];default:return null}}return null}}catch{}class Gn{constructor(e,n,s,l=1){this.r=e,this.g=n,this.b=s,this.a=l}static parse(e){if(!e)return;if(e instanceof Gn)return e;if(typeof e!="string")return;const n=o.F(e);return n?new Gn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,l]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${l})`}toRenderColor(e){const{r:n,g:s,b:l,a:c}=this;return new Ld(e,n,s,l,c)}}class Ld{constructor(e,n,s,l,c){if(e){const d=e.image.height,_=d*d;n=c===0?0:n/c*(d-1),s=c===0?0:s/c*(d-1),l=c===0?0:l/c*(d-1);const y=Math.floor(n),w=Math.floor(s),E=Math.floor(l),A=Math.ceil(n),I=Math.ceil(s),z=Math.ceil(l),k=n-y,B=s-w,N=l-E,W=e.image.data,ee=4*(y+w*_+E*d),te=4*(y+w*_+z*d),ne=4*(y+I*_+E*d),me=4*(y+I*_+z*d),de=4*(A+w*_+E*d),be=4*(A+w*_+z*d),Ae=4*(A+I*_+E*d),ze=4*(A+I*_+z*d);if(ee<0||ze>=W.length)throw new Error("out of range");this.r=Ht(Ht(Ht(W[ee],W[te],N),Ht(W[ne],W[me],N),B),Ht(Ht(W[de],W[be],N),Ht(W[Ae],W[ze],N),B),k)/255*c,this.g=Ht(Ht(Ht(W[ee+1],W[te+1],N),Ht(W[ne+1],W[me+1],N),B),Ht(Ht(W[de+1],W[be+1],N),Ht(W[Ae+1],W[ze+1],N),B),k)/255*c,this.b=Ht(Ht(Ht(W[ee+2],W[te+2],N),Ht(W[ne+2],W[me+2],N),B),Ht(Ht(W[de+2],W[be+2],N),Ht(W[Ae+2],W[ze+2],N),B),k)/255*c,this.a=c}else this.r=n,this.g=s,this.b=l,this.a=c}toArray(){const{r:e,g:n,b:s,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*n/l,255*s/l,l]}toArray01(){const{r:e,g:n,b:s,a:l}=this;return l===0?[0,0,0,0]:[e/l,n/l,s/l,l]}toArray01Scaled(e){const{r:n,g:s,b:l,a:c}=this;return c===0?[0,0,0]:[n/c*e,s/c*e,l/c*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a:l}=this;return[e,n,s,l]}toArray01Linear(){const{r:e,g:n,b:s,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(n/l,2.2),Math.pow(s/l,2.2),l]}}function Ht(t,e,n){return t*(1-n)+e*n}function oc(t,e,n){return t.map((s,l)=>Ht(s,e[l],n))}Gn.black=new Gn(0,0,0,1),Gn.white=new Gn(1,1,1,1),Gn.transparent=new Gn(0,0,0,0),Gn.red=new Gn(1,0,0,1),Gn.blue=new Gn(0,0,1,1);var jo=Object.freeze({__proto__:null,array:oc,color:function(t,e,n){return new Gn(Ht(t.r,e.r,n),Ht(t.g,e.g,n),Ht(t.b,e.b,n),Ht(t.a,e.a,n))},number:Ht});function ac(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}class Go extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class mp{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,l]of n)this.bindings[s]=l}concat(e){return new mp(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const lc={kind:"null"},Rt={kind:"number"},On={kind:"string"},Nn={kind:"boolean"},ls={kind:"color"},Zl={kind:"object"},Wn={kind:"value"},Eo={kind:"collator"},Xr={kind:"formatted"},Gr={kind:"resolvedImage"};function ys(t,e){return{kind:"array",itemType:t,N:e}}function Yr(t){if(t.kind==="array"){const e=Yr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Wm=[lc,Rt,On,Nn,ls,Xr,Zl,ys(Wn),Gr];function yh(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!yh(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const n of Wm)if(!yh(n,e))return null}}return`Expected ${Yr(t)} but found ${Yr(e)} instead.`}function xh(t,e){return e.some(n=>n.kind===t.kind)}function Wo(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class Xl{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class no{constructor(e,n,s,l,c){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=l,this.textColor=c}}class oi{constructor(e){this.sections=e}static fromString(e){return new oi([new no(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof oi?e:oi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(s)}return e}}class Ti{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new Ti({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function vh(t,e,n,s){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mi(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Gn||t instanceof Xl||t instanceof oi||t instanceof Ti)return!0;if(Array.isArray(t)){for(const e of t)if(!mi(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!mi(t[e]))return!1;return!0}return!1}function ni(t){if(t===null)return lc;if(typeof t=="string")return On;if(typeof t=="boolean")return Nn;if(typeof t=="number")return Rt;if(t instanceof Gn)return ls;if(t instanceof Xl)return Eo;if(t instanceof oi)return Xr;if(t instanceof Ti)return Gr;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const l=ni(s);if(n){if(n===l)continue;n=Wn;break}n=l}return ys(n||Wn,e)}return Zl}function ro(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Gn||t instanceof oi||t instanceof Ti?t.toString():JSON.stringify(t)}class ba{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!mi(e[1]))return n.error("invalid value");const s=e[1];let l=ni(s);const c=n.expectedType;return l.kind!=="array"||l.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(l=c),new ba(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof oi?this.value.serialize():this.value}}class _i{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const _p={string:On,number:Rt,boolean:Nn,object:Zl};class xs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,l=1;const c=e[0];if(c==="array"){let _,y;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in _p)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=_p[w],l++}else _=Wn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],l++}s=ys(_,y)}else s=_p[c];const d=[];for(;l<e.length;l++){const _=n.parse(e[l],l,Wn);if(!_)return null;d.push(_)}return new xs(s,d)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!yh(this.type,ni(s)))return s;if(n===this.args.length-1)throw new _i(`Expected value to be of type ${Yr(this.type)}, but found ${Yr(ni(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){n.push(s.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&n.push(l)}}return n.concat(this.args.map(s=>s.serialize()))}}class Ta{constructor(e){this.type=Xr,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return n.error("First argument must be an image or text section.");const l=[];let c=!1;for(let d=1;d<=e.length-1;++d){const _=e[d];if(c&&typeof _=="object"&&!Array.isArray(_)){c=!1;let y=null;if(_["font-scale"]&&(y=n.parse(_["font-scale"],1,Rt),!y))return null;let w=null;if(_["text-font"]&&(w=n.parse(_["text-font"],1,ys(On)),!w))return null;let E=null;if(_["text-color"]&&(E=n.parse(_["text-color"],1,ls),!E))return null;const A=l[l.length-1];A.scale=y,A.font=w,A.textColor=E}else{const y=n.parse(e[d],1,Wn);if(!y)return null;const w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,l.push({content:y,scale:null,font:null,textColor:null})}}return new Ta(l)}evaluate(e){return new oi(this.sections.map(n=>{const s=n.content.evaluate(e);return ni(s)===Gr?new no("",s,null,null,null):new no(ro(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class uc{constructor(e,n){this.type=Gr,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");const s=n.parse(e[1],1,On);if(!s)return n.error("No image name provided.");if(e.length===2)return new uc(s);const l=n.parse(e[2],1,On);return l?new uc(s,l):n.error("Secondary image variant is not a string.")}evaluate(e){const n=Ti.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function fe(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const cc={"to-boolean":Nn,"to-color":ls,"to-number":Rt,"to-string":On};class vs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0],l=[];let c=lc;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);c=ys(n.expectedType.itemType,d)}else{if(!(d>0&&mi(e[1][0])))return null;c=ys(ni(e[1][0]),d)}for(let _=0;_<d;_++){const y=e[1][_];let w;if(fe(y)==="array")w=n.parse(y,void 0,c.itemType);else{const E=fe(y);if(E!==c.itemType.kind)return n.error(`Expected ${c.itemType.kind} but found ${E}.`);w=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!w)return null;l.push(w)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return n.error("Expected one argument.");c=cc[s];for(let d=1;d<e.length;d++){const _=n.parse(e[d],d,Wn);if(!_)return null;l.push(_)}}return new vs(c,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,s;for(const l of this.args){if(n=l.evaluate(e),s=null,n instanceof Gn)return n;if(typeof n=="string"){const c=e.parseColor(n);if(c)return c}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:vh(n[0],n[1],n[2],n[3]),!s))return new Gn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new _i(s||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const s of this.args){if(n=s.evaluate(e),n===null)return 0;const l=Number(n);if(!isNaN(l))return l}throw new _i(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?oi.fromString(ro(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ti.fromString(ro(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):ro(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ta([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new uc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const ks=["Unknown","Point","LineString","Polygon"];class or{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ks[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:s,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*n-e[0])+this.featureDistanceData.bearing[1]*(l*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Gn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Yi{constructor(e,n,s,l,c){this.name=e,this.type=n,this._evaluate=s,this.args=l,this._overloadIndex=c}evaluate(e){if(!this._evaluate){const n=Yi.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],l=Yi.definitions[s];if(!l)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(l)?l[0]:l.type,d=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,_=[];let y=null,w=-1;for(const[E,A]of d){if(Array.isArray(E)&&E.length!==e.length-1)continue;_.push(E),w++,y=new Km(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const I=[];let z=!1;for(let k=1;k<e.length;k++){const B=e[k],N=Array.isArray(E)?E[k-1]:E.type,W=y.parse(B,1+I.length,N);if(!W){z=!0;break}I.push(W)}if(!z)if(Array.isArray(E)&&E.length!==I.length)y.error(`Expected ${E.length} arguments, but found ${I.length} instead.`);else{for(let k=0;k<I.length;k++){const B=Array.isArray(E)?E[k]:E.type,N=I[k];y.concat(k+1).checkSubtype(B,N.type)}if(y.errors.length===0)return new Yi(s,c,A,I,w)}}if(_.length===1)n.errors.push(...y.errors);else{const E=(_.length?_:d.map(([I])=>I)).map(gp).join(" | "),A=[];for(let I=1;I<e.length;I++){const z=n.parse(e[I],1+A.length);if(!z)return null;A.push(Yr(z.type))}n.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(e,n){Yi.definitions=n;for(const s in n)e[s]=Yi}}function gp(t){return Array.isArray(t)?`(${t.map(Yr).join(", ")})`:`(${Yr(t.type)}...)`}class el{constructor(e,n,s){this.type=Eo,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return n.error("Collator options argument must be an object.");const l=n.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Nn);if(!l)return null;const c=n.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Nn);if(!c)return null;let d=null;return s.locale&&(d=n.parse(s.locale,1,On),!d)?null:new el(l,c,d)}evaluate(e){return new Xl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Sa={exports:{}};Sa.exports=function(){function t(s,l,c,d,_){for(;d>c;){if(d-c>600){var y=d-c+1,w=l-c+1,E=Math.log(y),A=.5*Math.exp(2*E/3),I=.5*Math.sqrt(E*A*(y-A)/y)*(w-y/2<0?-1:1);t(s,l,Math.max(c,Math.floor(l-w*A/y+I)),Math.min(d,Math.floor(l+(y-w)*A/y+I)),_)}var z=s[l],k=c,B=d;for(e(s,c,l),_(s[d],z)>0&&e(s,c,d);k<B;){for(e(s,k,B),k++,B--;_(s[k],z)<0;)k++;for(;_(s[B],z)>0;)B--}_(s[c],z)===0?e(s,c,B):e(s,++B,d),B<=l&&(c=B+1),l<=B&&(d=B-1)}}function e(s,l,c){var d=s[l];s[l]=s[c],s[c]=d}function n(s,l){return s<l?-1:s>l?1:0}return function(s,l,c,d,_){t(s,l,c||0,d||s.length-1,_||n)}}();var Pg=et(Sa.exports);function Rg(t){let e=0;for(let n,s,l=0,c=t.length,d=c-1;l<c;d=l++)n=t[l],s=t[d],e+=(s.x-n.x)*(n.y+s.y);return e}function wh(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function hc(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Lg(t,e,n){const s=t[0]-e[0],l=t[1]-e[1],c=t[0]-n[0],d=t[1]-n[1];return s*d-c*l==0&&s*c<=0&&l*d<=0}function ws(t,e,n=!1){let s=!1;for(let _=0,y=e.length;_<y;_++){const w=e[_];for(let E=0,A=w.length,I=A-1;E<A;I=E++){const z=w[I],k=w[E];if(Lg(t,z,k))return n;(c=z)[1]>(l=t)[1]!=(d=k)[1]>l[1]&&l[0]<(d[0]-c[0])*(l[1]-c[1])/(d[1]-c[1])+c[0]&&(s=!s)}}var l,c,d;return s}function yp(t,e,n,s){const l=s[0]-n[0],c=s[1]-n[1],d=(t[0]-n[0])*c-l*(t[1]-n[1]),_=(e[0]-n[0])*c-l*(e[1]-n[1]);return d>0&&_<0||d<0&&_>0}function Vn(t,e,n,s){return(l=[s[0]-n[0],s[1]-n[1]])[0]*(c=[e[0]-t[0],e[1]-t[1]])[1]-l[1]*c[0]!=0&&!(!yp(t,e,n,s)||!yp(n,s,t,e));var l,c}const Ea=8192;function $m(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(n*l*Ea),Math.round(s*l*Ea)]}function Dg(t,e){for(let n=0;n<e.length;n++)if(ws(t,e[n]))return!0;return!1}function Ca(t,e,n){for(const s of n)for(let l=0,c=s.length,d=c-1;l<c;d=l++)if(Vn(t,e,s[d],s[l]))return!0;return!1}function bh(t,e){for(let n=0;n<t.length;++n)if(!ws(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Ca(t[n],t[n+1],e))return!1;return!0}function Dd(t,e){for(let n=0;n<e.length;n++)if(bh(t,e[n]))return!0;return!1}function dc(t,e,n){const s=[];for(let l=0;l<t.length;l++){const c=[];for(let d=0;d<t[l].length;d++){const _=$m(t[l][d],n);wh(e,_),c.push(_)}s.push(c)}return s}function qm(t,e,n){const s=[];for(let l=0;l<t.length;l++){const c=dc(t[l],e,n);s.push(c)}return s}function xp(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const l=.5*s;let c=t[0]-n[0]>l?-s:n[0]-t[0]>l?s:0;c===0&&(c=t[0]-n[2]>l?-s:n[2]-t[0]>l?s:0),t[0]+=c}wh(e,t)}function qi(t,e,n,s){const l=Math.pow(2,s.z)*Ea,c=[s.x*Ea,s.y*Ea],d=[];if(!t)return d;for(const _ of t)for(const y of _){const w=[y.x+c[0],y.y+c[1]];xp(w,e,n,l),d.push(w)}return d}function Hm(t,e,n,s){const l=Math.pow(2,s.z)*Ea,c=[s.x*Ea,s.y*Ea],d=[];if(!t)return d;for(const y of t){const w=[];for(const E of y){const A=[E.x+c[0],E.y+c[1]];wh(e,A),w.push(A)}d.push(w)}if(e[2]-e[0]<=l/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const y of d)for(const w of y)xp(w,e,n,l)}var _;return d}class tl{constructor(e,n){this.type=Nn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(mi(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const c=s.features[l].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new tl(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new tl(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new tl(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,s){const l=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=n.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const _=dc(s.coordinates,c,d),y=qi(n.geometry(),l,c,d);if(!hc(l,c))return!1;for(const w of y)if(!ws(w,_))return!1}if(s.type==="MultiPolygon"){const _=qm(s.coordinates,c,d),y=qi(n.geometry(),l,c,d);if(!hc(l,c))return!1;for(const w of y)if(!Dg(w,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,s){const l=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=n.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const _=dc(s.coordinates,c,d),y=Hm(n.geometry(),l,c,d);if(!hc(l,c))return!1;for(const w of y)if(!bh(w,_))return!1}if(s.type==="MultiPolygon"){const _=qm(s.coordinates,c,d),y=Hm(n.geometry(),l,c,d);if(!hc(l,c))return!1;for(const w of y)if(!Dd(w,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ki={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},zd=1/298.257223563,Zm=zd*(2-zd),Th=Math.PI/180;class Sh{static fromTile(e,n,s){const l=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),c=Math.atan(.5*(Math.exp(l)-Math.exp(-l)))/Th;return new Sh(c,s)}static get units(){return ki}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!ki[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(ki).join(", ")}`);const s=6378.137*Th*(n?ki[n]:1),l=Math.cos(e*Th),c=1/(1-Zm*(1-l*l)),d=Math.sqrt(c);this.kx=s*d*l,this.ky=s*d*c*(1-Zm)}distance(e,n){const s=Os(e[0]-n[0])*this.kx,l=(e[1]-n[1])*this.ky;return Math.sqrt(s*s+l*l)}bearing(e,n){const s=Os(n[0]-e[0])*this.kx;return Math.atan2(s,(n[1]-e[1])*this.ky)/Th}destination(e,n,s){const l=s*Th;return this.offset(e,Math.sin(l)*n,Math.cos(l)*n)}offset(e,n,s){return[e[0]+n/this.kx,e[1]+s/this.ky]}lineDistance(e){let n=0;for(let s=0;s<e.length-1;s++)n+=this.distance(e[s],e[s+1]);return n}area(e){let n=0;for(let s=0;s<e.length;s++){const l=e[s];for(let c=0,d=l.length,_=d-1;c<d;_=c++)n+=Os(l[c][0]-l[_][0])*(l[c][1]+l[_][1])*(s?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let s=0;if(n<=0)return e[0];for(let l=0;l<e.length-1;l++){const c=e[l],d=e[l+1],_=this.distance(c,d);if(s+=_,s>n)return fc(c,d,(n-(s-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,n,s){let[l,c]=n,d=Os(s[0]-l)*this.kx,_=(s[1]-c)*this.ky;if(d!==0||_!==0){const y=(Os(e[0]-l)*this.kx*d+(e[1]-c)*this.ky*_)/(d*d+_*_);y>1?(l=s[0],c=s[1]):y>0&&(l+=d/this.kx*y,c+=_/this.ky*y)}return d=Os(e[0]-l)*this.kx,_=(e[1]-c)*this.ky,Math.sqrt(d*d+_*_)}pointOnLine(e,n){let s=1/0,l=e[0][0],c=e[0][1],d=0,_=0;for(let y=0;y<e.length-1;y++){let w=e[y][0],E=e[y][1],A=Os(e[y+1][0]-w)*this.kx,I=(e[y+1][1]-E)*this.ky,z=0;A===0&&I===0||(z=(Os(n[0]-w)*this.kx*A+(n[1]-E)*this.ky*I)/(A*A+I*I),z>1?(w=e[y+1][0],E=e[y+1][1]):z>0&&(w+=A/this.kx*z,E+=I/this.ky*z)),A=Os(n[0]-w)*this.kx,I=(n[1]-E)*this.ky;const k=A*A+I*I;k<s&&(s=k,l=w,c=E,d=y,_=z)}return{point:[l,c],index:d,t:Math.max(0,Math.min(1,_))}}lineSlice(e,n,s){let l=this.pointOnLine(s,e),c=this.pointOnLine(s,n);if(l.index>c.index||l.index===c.index&&l.t>c.t){const w=l;l=c,c=w}const d=[l.point],_=l.index+1,y=c.index;!vp(s[_],d[0])&&_<=y&&d.push(s[_]);for(let w=_+1;w<=y;w++)d.push(s[w]);return vp(s[y],c.point)||d.push(c.point),d}lineSliceAlong(e,n,s){let l=0;const c=[];for(let d=0;d<s.length-1;d++){const _=s[d],y=s[d+1],w=this.distance(_,y);if(l+=w,l>e&&c.length===0&&c.push(fc(_,y,(e-(l-w))/w)),l>=n)return c.push(fc(_,y,(n-(l-w))/w)),c;l>e&&c.push(y)}return c}bufferPoint(e,n){const s=n/this.ky,l=n/this.kx;return[e[0]-l,e[1]-s,e[0]+l,e[1]+s]}bufferBBox(e,n){const s=n/this.ky,l=n/this.kx;return[e[0]-l,e[1]-s,e[2]+l,e[3]+s]}insideBBox(e,n){return Os(e[0]-n[0])>=0&&Os(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function vp(t,e){return t[0]===e[0]&&t[1]===e[1]}function fc(t,e,n){const s=Os(e[0]-t[0]);return[t[0]+s*n,t[1]+(e[1]-t[1])*n]}function Os(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}var Eh={exports:{}};(function(t,e){t.exports=function(){var n=function(l,c){if(l===void 0&&(l=[]),c===void 0&&(c=s),this.data=l,this.length=this.data.length,this.compare=c,this.length>0)for(var d=(this.length>>1)-1;d>=0;d--)this._down(d)};function s(l,c){return l<c?-1:l>c?1:0}return n.prototype.push=function(l){this.data.push(l),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var l=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),l}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(l){for(var c=this.data,d=this.compare,_=c[l];l>0;){var y=l-1>>1,w=c[y];if(d(_,w)>=0)break;c[l]=w,l=y}c[l]=_},n.prototype._down=function(l){for(var c=this.data,d=this.compare,_=this.length>>1,y=c[l];l<_;){var w=1+(l<<1),E=c[w],A=w+1;if(A<this.length&&d(c[A],E)<0&&(w=A,E=c[A]),d(E,y)>=0)break;c[l]=E,l=w}c[l]=y},n}()})(Eh);var wp=et(Eh.exports),xt=8192;function pc(t,e){return e.dist-t.dist}const mc=100,bp=50;function Tp(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function kd(t){return t[1]-t[0]+1}function Oi(t,e){const n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function $o(t,e){if(t[0]>t[1])return[null,null];const n=kd(t);if(e){if(n===2)return[t,null];const s=Math.floor(n/2);return[[t[0],t[0]+s],[t[0]+s,t[1]]]}{if(n===1)return[t,null];const s=Math.floor(n/2)-1;return[[t[0],t[0]+s],[t[0]+s+1,t[1]]]}}function Bs(t,e){const n=[1/0,1/0,-1/0,-1/0];if(!Oi(e,t.length))return n;for(let s=e[0];s<=e[1];++s)wh(n,t[s]);return n}function us(t){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)wh(e,t[n][s]);return e}function nl(t,e,n){if(Tp(t)||Tp(e))return NaN;let s=0,l=0;return t[2]<e[0]&&(s=e[0]-t[2]),t[0]>e[2]&&(s=t[0]-e[2]),t[1]>e[3]&&(l=t[1]-e[3]),t[3]<e[1]&&(l=e[1]-t[3]),n.distance([0,0],[s,l])}function Xm(t){return 360*t-180}function Ym(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Yl(t,e){const n=Math.pow(2,e.z),s=(t.y/xt+e.y)/n;return[Xm((t.x/xt+e.x)/n),Ym(s)]}function rl(t,e){const n=[];for(let s=0;s<t.length;++s)n.push(Yl(t[s],e));return n}function Sp(t,e,n){const s=n.pointOnLine(e,t).point;return n.distance(t,s)}function il(t,e,n,s,l){const c=n.slice(s[0],s[1]+1);let d=1/0;for(let _=e[0];_<=e[1];++_)if((d=Math.min(d,Sp(t[_],c,l)))===0)return 0;return d}function _c(t,e,n,s,l){const c=Math.min(l.pointToSegmentDistance(t,n,s),l.pointToSegmentDistance(e,n,s)),d=Math.min(l.pointToSegmentDistance(n,t,e),l.pointToSegmentDistance(s,t,e));return Math.min(c,d)}function zg(t,e,n,s,l){if(!Oi(e,t.length)||!Oi(s,n.length))return NaN;let c=1/0;for(let d=e[0];d<e[1];++d)for(let _=s[0];_<s[1];++_){if(Vn(t[d],t[d+1],n[_],n[_+1]))return 0;c=Math.min(c,_c(t[d],t[d+1],n[_],n[_+1],l))}return c}function Ep(t,e,n,s,l){if(!Oi(e,t.length)||!Oi(s,n.length))return NaN;let c=1/0;for(let d=e[0];d<=e[1];++d)for(let _=s[0];_<=s[1];++_)if((c=Math.min(c,l.distance(t[d],n[_])))===0)return c;return c}function Bi(t,e,n){if(ws(t,e,!0))return 0;let s=1/0;for(const l of e){const c=l.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[c-1]&&(s=Math.min(s,n.pointToSegmentDistance(t,l[c-1],l[0])))===0||(s=Math.min(s,Sp(t,l,n)))===0)return s}return s}function Fs(t,e,n,s){if(!Oi(e,t.length))return NaN;for(let c=e[0];c<=e[1];++c)if(ws(t[c],n,!0))return 0;let l=1/0;for(let c=e[0];c<e[1];++c)for(const d of n)for(let _=0,y=d.length,w=y-1;_<y;w=_++){if(Vn(t[c],t[c+1],d[w],d[_]))return 0;l=Math.min(l,_c(t[c],t[c+1],d[w],d[_],s))}return l}function Od(t,e){for(const n of t)for(let s=0;s<=n.length-1;++s)if(ws(n[s],e,!0))return!0;return!1}function qo(t,e,n,s=1/0){const l=us(t),c=us(e);if(s!==1/0&&nl(l,c,n)>=s)return s;if(hc(l,c)){if(Od(t,e))return 0}else if(Od(e,t))return 0;let d=s;for(const _ of t)for(let y=0,w=_.length,E=w-1;y<w;E=y++)for(const A of e)for(let I=0,z=A.length,k=z-1;I<z;k=I++){if(Vn(_[E],_[y],A[k],A[I]))return 0;d=Math.min(d,_c(_[E],_[y],A[k],A[I],n))}return d}function Kl(t,e,n,s,l,c,d){if(c===null||d===null)return;const _=nl(Bs(s,c),Bs(l,d),n);_<e&&t.push({dist:_,range1:c,range2:d})}function Jl(t,e,n,s,l=1/0){let c=Math.min(s.distance(t[0],n[0][0]),l);if(c===0)return c;const d=new wp([{dist:0,range1:[0,t.length-1],range2:[0,0]}],pc),_=e?bp:mc,y=us(n);for(;d.length;){const w=d.pop();if(w.dist>=c)continue;const E=w.range1;if(kd(E)<=_){if(!Oi(E,t.length))return NaN;if(e){const A=Fs(t,E,n,s);if((c=Math.min(c,A))===0)return c}else for(let A=E[0];A<=E[1];++A){const I=Bi(t[A],n,s);if((c=Math.min(c,I))===0)return c}}else{const A=$o(E,e);if(A[0]!==null){const I=nl(Bs(t,A[0]),y,s);I<c&&d.push({dist:I,range1:A[0],range2:[0,0]})}if(A[1]!==null){const I=nl(Bs(t,A[1]),y,s);I<c&&d.push({dist:I,range1:A[1],range2:[0,0]})}}}return c}function sl(t,e,n,s,l,c=1/0){let d=Math.min(c,l.distance(t[0],n[0]));if(d===0)return d;const _=new wp([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],pc),y=e?bp:mc,w=s?bp:mc;for(;_.length;){const E=_.pop();if(E.dist>=d)continue;const A=E.range1,I=E.range2;if(kd(A)<=y&&kd(I)<=w){if(!Oi(A,t.length)||!Oi(I,n.length))return NaN;if(e&&s?d=Math.min(d,zg(t,A,n,I,l)):e||s?e&&!s?d=Math.min(d,il(n,I,t,A,l)):!e&&s&&(d=Math.min(d,il(t,A,n,I,l))):d=Math.min(d,Ep(t,A,n,I,l)),d===0)return d}else{const z=$o(A,e),k=$o(I,s);Kl(_,d,l,t,n,z[0],k[0]),Kl(_,d,l,t,n,z[0],k[1]),Kl(_,d,l,t,n,z[1],k[0]),Kl(_,d,l,t,n,z[1],k[1])}}return d}function Bd(t,e,n,s,l=1/0){let c=l;const d=Bs(t,[0,t.length-1]);for(const _ of n)if(!(c!==1/0&&nl(d,Bs(_,[0,_.length-1]),s)>=c)&&(c=Math.min(c,sl(t,e,_,!0,s,c)),c===0))return c;return c}function Fi(t,e,n,s,l=1/0){let c=l;const d=Bs(t,[0,t.length-1]);for(const _ of n){if(c!==1/0&&nl(d,us(_),s)>=c)continue;const y=Jl(t,e,_,s,c);if(isNaN(y))return y;if((c=Math.min(c,y))===0)return c}return c}function Ch(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ql{constructor(e,n){this.type=Rt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(mi(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let l=0;l<s.features.length;++l)if(Ch(s.features[l].geometry.type))return new Ql(s,s.features[l].geometry)}else if(s.type==="Feature"){if(Ch(s.geometry.type))return new Ql(s,s.geometry)}else if(Ch(s.type))return new Ql(s,s)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),s=e.canonicalID();if(n!=null&&s!=null){if(e.geometryType()==="Point")return function(l,c,d){const _=[];for(const w of l)for(const E of w)_.push(Yl(E,c));const y=new Sh(_[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?sl(_,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",y):d.type==="MultiLineString"?Bd(_,!1,d.coordinates,y):d.type==="Polygon"||d.type==="MultiPolygon"?Fi(_,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,y):null}(n,s,this.geometries);if(e.geometryType()==="LineString")return function(l,c,d){const _=[];for(const w of l){const E=[];for(const A of w)E.push(Yl(A,c));_.push(E)}const y=new Sh(_[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Bd(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",_,y);if(d.type==="MultiLineString"){let w=1/0;for(let E=0;E<d.coordinates.length;E++){const A=Bd(d.coordinates[E],!0,_,y,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}if(d.type==="Polygon"||d.type==="MultiPolygon"){let w=1/0;for(let E=0;E<_.length;E++){const A=Fi(_[E],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,y,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return null}(n,s,this.geometries);if(e.geometryType()==="Polygon")return function(l,c,d){const _=[];for(const w of function(E,A){const I=E.length;if(I<=1)return[E];const z=[];let k,B;for(let N=0;N<I;N++){const W=Rg(E[N]);W!==0&&(E[N].area=Math.abs(W),B===void 0&&(B=W<0),B===W<0?(k&&z.push(k),k=[E[N]]):k.push(E[N]))}return k&&z.push(k),z}(l)){const E=[];for(let A=0;A<w.length;++A)E.push(rl(w[A],c));_.push(E)}const y=new Sh(_[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Fi(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",_,y);if(d.type==="MultiLineString"){let w=1/0;for(let E=0;E<d.coordinates.length;E++){const A=Fi(d.coordinates[E],!0,_,y,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return d.type==="Polygon"||d.type==="MultiPolygon"?function(w,E,A){let I=1/0;for(const z of w)for(const k of E){const B=qo(z,k,A,I);if(isNaN(B))return B;if((I=Math.min(I,B))===0)return I}return I}(d.type==="Polygon"?[d.coordinates]:d.coordinates,_,y):null}(n,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function gc(t,e){switch(t){case"string":return ro(e);case"number":return+e;case"boolean":return!!e;case"color":return Gn.parse(e);case"formatted":return oi.fromString(ro(e));case"resolvedImage":return Ti.fromString(ro(e))}return e}function Ah(t,e,n,s){return s!==void 0&&(t=s*Math.round(t/s)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class gi{constructor(e,n,s){this.type=e,this.key=n,this.scope=s}static parse(e,n){let s=n.expectedType;if(s==null&&(s=Wn),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const l=n.parse(e[1],1);if(!(l instanceof ba))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const c=n.parse(e[2],2);return c instanceof ba?new gi(s,ro(l.value),ro(c.value)):n.error("Scope of 'config' expression must be a string literal.")}return new gi(s,ro(l.value))}evaluate(e){const n=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(n);if(!s)return null;const{type:l,value:c,values:d,minValue:_,maxValue:y,stepValue:w}=s,E=s.default.evaluate(e);let A=E;if(c){const I=e.scope;e.scope=(I||"").split("").slice(1).join(""),A=c.evaluate(e),e.scope=I}return l&&(A=gc(l,A)),A===void 0||_===void 0&&y===void 0&&w===void 0||(typeof A=="number"?A=Ah(A,_,y,w):Array.isArray(A)&&(A=A.map(I=>typeof I=="number"?Ah(I,_,y,w):I))),c!==void 0&&A!==void 0&&d&&!d.includes(A)&&(A=E,l&&(A=gc(l,A))),(l&&l!==this.type||A!==void 0&&ni(A)!==this.type)&&(A=gc(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function ol(t){if(t instanceof Yi&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof tl||t instanceof Ql)return!1;let e=!0;return t.eachChild(n=>{e&&!ol(n)&&(e=!1)}),e}function al(t){if(t instanceof Yi&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!al(n)&&(e=!1)}),e}function Fd(t){if(t instanceof gi)return!1;let e=!0;return t.eachChild(n=>{e&&!Fd(n)&&(e=!1)}),e}function Mh(t,e){if(t instanceof Yi&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!Mh(s,e)&&(n=!1)}),n}class Nd{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Nd(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Aa{constructor(e,n=[],s,l=new mp,c=[],d,_){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=l,this.errors=c,this.expectedType=s,this._scope=d,this.options=_}parse(e,n,s,l,c={}){return n||s?this.concat(n,s,l)._parse(e,c):this._parse(e,c)}_parse(e,n){function s(l,c,d){return d==="assert"?new xs(c,[l]):d==="coerce"?new vs(c,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let c=l.parse(e,this);if(!c)return null;if(this.expectedType){const d=this.expectedType,_=c.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||_.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(d,_))return null}else c=s(c,d,n.typeAnnotation||"coerce");else c=s(c,d,n.typeAnnotation||"assert")}if(!(c instanceof ba)&&c.type.kind!=="resolvedImage"&&Ih(c)){const d=new or(this._scope,this.options);try{c=new ba(c.type,c.evaluate(d))}catch(_){return this.error(_.message),null}}return c}return vs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const l=typeof e=="number"?this.path.concat(e):this.path,c=s?this.scope.concat(s):this.scope;return new Aa(this.registry,l,n||null,c,this.errors,this._scope,this.options)}error(e,...n){const s=`${this.key}${n.map(l=>`[${l}]`).join("")}`;this.errors.push(new Go(s,e))}checkSubtype(e,n){const s=yh(e,n);return s&&this.error(s),s}}var Km=Aa;function Ih(t){if(t instanceof Nd)return Ih(t.boundExpression);if(t instanceof Yi&&t.name==="error"||t instanceof el||t instanceof tl||t instanceof Ql||t instanceof gi)return!1;const e=t instanceof vs||t instanceof xs;let n=!0;return t.eachChild(s=>{n=e?n&&Ih(s):n&&s instanceof ba}),!!n&&ol(t)&&Mh(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function yc(t,e){const n=t.length-1;let s,l,c=0,d=n,_=0;for(;c<=d;)if(_=Math.floor((c+d)/2),s=t[_],l=t[_+1],s<=e){if(_===n||e<l)return _;c=_+1}else{if(!(s>e))throw new _i("Input is not a number.");d=_-1}return 0}class xc{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[l,c]of s)this.labels.push(l),this.outputs.push(c)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,Rt);if(!s)return null;const l=[];let c=null;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);for(let d=1;d<e.length;d+=2){const _=d===1?-1/0:e[d],y=e[d+1],w=d,E=d+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const A=n.parse(y,E,c);if(!A)return null;c=c||A.type,l.push([_,A])}return new xc(c,s,l)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=n[0])return s[0].evaluate(e);const c=n.length;return l>=n[c-1]?s[c-1].evaluate(e):s[yc(n,l)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const Vd=.95047,Jm=1.08883,Cp=4/29,ll=6/29,Ud=3*ll*ll,Ap=ll*ll*ll,vc=Math.PI/180,Mp=180/Math.PI;function jd(t){return t>Ap?Math.pow(t,1/3):t/Ud+Cp}function Ph(t){return t>ll?t*t*t:Ud*(t-Cp)}function wc(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Rh(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ip(t){const e=Rh(t.r),n=Rh(t.g),s=Rh(t.b),l=jd((.4124564*e+.3575761*n+.1804375*s)/Vd),c=jd((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*c-16,a:500*(l-c),b:200*(c-jd((.0193339*e+.119192*n+.9503041*s)/Jm)),alpha:t.a}}function Pp(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Ph(e),n=Vd*Ph(n),s=Jm*Ph(s),new Gn(wc(3.2404542*n-1.5371385*e-.4985314*s),wc(-.969266*n+1.8760108*e+.041556*s),wc(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function kg(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const bc={forward:Ip,reverse:Pp,interpolate:function(t,e,n){return{l:Ht(t.l,e.l,n),a:Ht(t.a,e.a,n),b:Ht(t.b,e.b,n),alpha:Ht(t.alpha,e.alpha,n)}}},Tc={forward:function(t){const{l:e,a:n,b:s}=Ip(t),l=Math.atan2(s,n)*Mp;return{h:l<0?l+360:l,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*vc,n=t.c;return Pp({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:kg(t.h,e.h,n),c:Ht(t.c,e.c,n),l:Ht(t.l,e.l,n),alpha:Ht(t.alpha,e.alpha,n)}}};var Gd=Object.freeze({__proto__:null,hcl:Tc,lab:bc});class bs{constructor(e,n,s,l,c){this.type=e,this.operator=n,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[d,_]of c)this.labels.push(d),this.outputs.push(_)}static interpolationFactor(e,n,s,l){let c=0;if(e.name==="exponential")c=Lh(n,e.base,s,l);else if(e.name==="linear")c=Lh(n,1,s,l);else if(e.name==="cubic-bezier"){const d=e.controlPoints;c=new ah(d[0],d[1],d[2],d[3]).solve(Lh(n,1,s,l))}return c}static parse(e,n){let[s,l,c,...d]=e;if(!Array.isArray(l)||l.length===0)return n.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(c=n.parse(c,2,Rt),!c)return null;const _=[];let y=null;s==="interpolate-hcl"||s==="interpolate-lab"?y=ls:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let w=0;w<d.length;w+=2){const E=d[w],A=d[w+1],I=w+3,z=w+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(_.length&&_[_.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const k=n.parse(A,z,y);if(!k)return null;y=y||k.type,_.push([E,k])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new bs(y,s,l,c,_):n.error(`Type ${Yr(y)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=n[0])return s[0].evaluate(e);const c=n.length;if(l>=n[c-1])return s[c-1].evaluate(e);const d=yc(n,l),_=bs.interpolationFactor(this.interpolation,l,n[d],n[d+1]),y=s[d].evaluate(e),w=s[d+1].evaluate(e);return this.operator==="interpolate"?jo[this.type.kind.toLowerCase()](y,w,_):this.operator==="interpolate-hcl"?Tc.reverse(Tc.interpolate(Tc.forward(y),Tc.forward(w),_)):bc.reverse(bc.interpolate(bc.forward(y),bc.forward(w),_))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Lh(t,e,n,s){const l=s-n,c=t-n;return l===0?0:e===1?c/l:(Math.pow(e,c)-1)/(Math.pow(e,l)-1)}class Wd{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const l=n.expectedType;l&&l.kind!=="value"&&(s=l);const c=[];for(const _ of e.slice(1)){const y=n.parse(_,1+c.length,s,void 0,{typeAnnotation:"omit"});if(!y)return null;s=s||y.type,c.push(y)}const d=l&&c.some(_=>yh(l,_.type));return new Wd(d?Wn:s,c)}evaluate(e){let n,s=null,l=0;for(const c of this.args){if(l++,s=c.evaluate(e),s&&s instanceof Ti&&!s.available&&(n||(n=s),s=null,l===this.args.length))return n;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Sc{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let c=1;c<e.length-1;c+=2){const d=e[c];if(typeof d!="string")return n.error(`Expected string, but found ${typeof d} instead.`,c);if(/[^a-zA-Z0-9_]/.test(d))return n.error("Variable names must contain only alphanumeric characters or '_'.",c);const _=n.parse(e[c+1],c+1);if(!_)return null;s.push([d,_])}const l=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return l?new Sc(s,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}class Yn{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Rt),l=n.parse(e[2],2,ys(n.expectedType||Wn));return s&&l?new Yn(l.type.itemType,s,l):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new _i(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new _i(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new _i(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Rp{constructor(e,n){this.type=Nn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Wn),l=n.parse(e[2],2,Wn);return s&&l?xh(s.type,[Nn,On,Rt,lc,Wn])?new Rp(s,l):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Wo(n,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(ni(n))} instead.`);if(!Wo(s,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Yr(ni(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class $d{constructor(e,n,s){this.type=Rt,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Wn),l=n.parse(e[2],2,Wn);if(!s||!l)return null;if(!xh(s.type,[Nn,On,Rt,lc,Wn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(s.type)} instead`);if(e.length===4){const c=n.parse(e[3],3,Rt);return c?new $d(s,l,c):null}return new $d(s,l)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Wo(n,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(ni(n))} instead.`);if(!Wo(s,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Yr(ni(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(n,l)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ho{constructor(e,n,s,l,c,d){this.inputType=e,this.type=n,this.input=s,this.cases=l,this.outputs=c,this.otherwise=d}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const c={},d=[];for(let w=2;w<e.length-1;w+=2){let E=e[w];const A=e[w+1];Array.isArray(E)||(E=[E]);const I=n.concat(w);if(E.length===0)return I.error("Expected at least one branch label.");for(const k of E){if(typeof k!="number"&&typeof k!="string")return I.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return I.error("Numeric branch labels must be integer values.");if(s){if(I.checkSubtype(s,ni(k)))return null}else s=ni(k);if(c[String(k)]!==void 0)return I.error("Branch labels must be unique.");c[String(k)]=d.length}const z=n.parse(A,w,l);if(!z)return null;l=l||z.type,d.push(z)}const _=n.parse(e[1],1,Wn);if(!_)return null;const y=n.parse(e[e.length-1],e.length-1,l);return y?_.type.kind!=="value"&&n.concat(1).checkSubtype(s,_.type)?null:new Ho(s,l,_,c,d,y):null}evaluate(e){const n=this.input.evaluate(e);return(ni(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],l={};for(const d of n){const _=l[this.cases[d]];_===void 0?(l[this.cases[d]]=s.length,s.push([this.cases[d],[d]])):s[_][1].push(d)}const c=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,_]of s)e.push(_.length===1?c(_[0]):_.map(c)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class qd{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);const l=[];for(let d=1;d<e.length-1;d+=2){const _=n.parse(e[d],d,Nn);if(!_)return null;const y=n.parse(e[d+1],d+1,s);if(!y)return null;l.push([_,y]),s=s||y.type}const c=n.parse(e[e.length-1],e.length-1,s);return c?new qd(s,l,c):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Hd{constructor(e,n,s,l){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Wn),l=n.parse(e[2],2,Rt);if(!s||!l)return null;if(!xh(s.type,[ys(Wn),On,Wn]))return n.error(`Expected first argument to be of type array or string, but found ${Yr(s.type)} instead`);if(e.length===4){const c=n.parse(e[3],3,Rt);return c?new Hd(s.type,s,l,c):null}return new Hd(s.type,s,l)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Wo(n,["string","array"]))throw new _i(`Expected first argument to be of type array or string, but found ${Yr(ni(n))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return n.slice(s,l)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Dh(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ns(t,e,n,s){return s.compare(e,n)===0}function eu(t,e,n){const s=t!=="=="&&t!=="!=";return class x4{constructor(c,d,_){this.type=Nn,this.lhs=c,this.rhs=d,this.collator=_,this.hasUntypedArgument=c.type.kind==="value"||d.type.kind==="value"}static parse(c,d){if(c.length!==3&&c.length!==4)return d.error("Expected two or three arguments.");const _=c[0];let y=d.parse(c[1],1,Wn);if(!y)return null;if(!Dh(_,y.type))return d.concat(1).error(`"${_}" comparisons are not supported for type '${Yr(y.type)}'.`);let w=d.parse(c[2],2,Wn);if(!w)return null;if(!Dh(_,w.type))return d.concat(2).error(`"${_}" comparisons are not supported for type '${Yr(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return d.error(`Cannot compare types '${Yr(y.type)}' and '${Yr(w.type)}'.`);s&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new xs(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new xs(y.type,[w])));let E=null;if(c.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(E=d.parse(c[3],3,Eo),!E)return null}return new x4(y,w,E)}evaluate(c){const d=this.lhs.evaluate(c),_=this.rhs.evaluate(c);if(s&&this.hasUntypedArgument){const y=ni(d),w=ni(_);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new _i(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const y=ni(d),w=ni(_);if(y.kind!=="string"||w.kind!=="string")return e(c,d,_)}return this.collator?n(c,d,_,this.collator.evaluate(c)):e(c,d,_)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(d=>{c.push(d.serialize())}),c}}}const Zd=eu("==",function(t,e,n){return e===n},Ns),Xd=eu("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!Ns(0,e,n,s)}),Lp=eu("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),Dp=eu(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),Ts=eu("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),Zo=eu(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class tu{constructor(e,n,s,l,c,d){this.type=On,this.number=e,this.locale=n,this.currency=s,this.unit=l,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Rt);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return n.error("NumberFormat options argument must be an object.");let c=null;if(l.locale&&(c=n.parse(l.locale,1,On),!c))return null;let d=null;if(l.currency&&(d=n.parse(l.currency,1,On),!d))return null;let _=null;if(l.unit&&(_=n.parse(l.unit,1,On),!_))return null;let y=null;if(l["min-fraction-digits"]&&(y=n.parse(l["min-fraction-digits"],1,Rt),!y))return null;let w=null;return l["max-fraction-digits"]&&(w=n.parse(l["max-fraction-digits"],1,Rt),!w)?null:new tu(s,c,d,_,y,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Yd{constructor(e){this.type=Rt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Yr(s.type)} instead.`):new Yd(s):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new _i(`Expected value to be of type string or array, but found ${Yr(ni(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function zh(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ul={"==":Zd,"!=":Xd,">":Dp,"<":Lp,">=":Zo,"<=":Ts,array:xs,at:Yn,boolean:xs,case:qd,coalesce:Wd,collator:el,format:Ta,image:uc,in:Rp,"index-of":$d,interpolate:bs,"interpolate-hcl":bs,"interpolate-lab":bs,length:Yd,let:Sc,literal:ba,match:Ho,number:xs,"number-format":tu,object:xs,slice:Hd,step:xc,string:xs,"to-boolean":vs,"to-color":vs,"to-number":vs,"to-string":vs,var:Nd,within:tl,distance:Ql,config:gi};function Kd(t,[e,n,s,l]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const c=l?l.evaluate(t):1,d=vh(e,n,s,c);if(d)throw new _i(d);return new Gn(e/255*c,n/255*c,s/255*c,c)}function zp(t,[e,n,s,l]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const c=l?l.evaluate(t):1,d=function(w,E,A,I){return typeof w=="number"&&w>=0&&w<=360?typeof E=="number"&&E>=0&&E<=100&&typeof A=="number"&&A>=0&&A<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[w,E,A,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[w,E,A,I]:[w,E,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[w,E,A,I]:[w,E,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,s,c);if(d)throw new _i(d);const _=`hsla(${e}, ${n}%, ${s}%, ${c})`,y=Gn.parse(_);if(!y)throw new _i(`Failed to parse HSLA color: ${_}`);return y}function Jd(t,e){return t in e}function kh(t,e){const n=e[t];return n===void 0?null:n}function Ss(t){return{type:t}}function Qm(t){return{result:"success",value:t}}function Es(t){return{result:"error",value:t}}function kp(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Oh(t){return t["property-type"]==="data-driven"}function Op(t){return kp(t.expression,"measure-light")}function f(t){return kp(t.expression,"zoom")}function i(t){return!!t.expression&&t.expression.interpolated}function u(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function p(t){return t}function x(t,e){const n=e.type==="color",s=t.stops&&typeof t.stops[0][0]=="object",l=s||!(s||t.property!==void 0),c=t.type||(i(e)?"exponential":"interval");if(n&&((t=ac({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],Gn.parse(w[1])])),t.default=Gn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Gd[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let d,_,y;if(c==="exponential")d=R;else if(c==="interval")d=C;else if(c==="categorical"){d=S,_=Object.create(null);for(const w of t.stops)_[w[0]]=w[1];y=typeof t.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);d=L}if(s){const w={},E=[];for(let z=0;z<t.stops.length;z++){const k=t.stops[z],B=k[0].zoom;w[B]===void 0&&(w[B]={zoom:B,type:t.type,property:t.property,default:t.default,stops:[]},E.push(B)),w[B].stops.push([k[0].value,k[1]])}const A=[];for(const z of E)A.push([w[z].zoom,x(w[z],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:bs.interpolationFactor.bind(void 0,I),zoomStops:A.map(z=>z[0]),evaluate:({zoom:z},k)=>R({stops:A,base:t.base},e,z).evaluate(z,k)}}if(l){const w=c==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:bs.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(E=>E[0]),evaluate:({zoom:E})=>d(t,e,E,_,y)}}return{kind:"source",evaluate(w,E){const A=E&&E.properties?E.properties[t.property]:void 0;return A===void 0?v(t.default,e.default):d(t,e,A,_,y)}}}function v(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function S(t,e,n,s,l){return v(typeof n===l?s[n]:void 0,t.default,e.default)}function C(t,e,n){if(fe(n)!=="number")return v(t.default,e.default);const s=t.stops.length;if(s===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const l=yc(t.stops.map(c=>c[0]),n);return t.stops[l][1]}function R(t,e,n){const s=t.base!==void 0?t.base:1;if(fe(n)!=="number")return v(t.default,e.default);const l=t.stops.length;if(l===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[l-1][0])return t.stops[l-1][1];const c=yc(t.stops.map(E=>E[0]),n),d=function(E,A,I,z){const k=z-I,B=E-I;return k===0?0:A===1?B/k:(Math.pow(A,B)-1)/(Math.pow(A,k)-1)}(n,s,t.stops[c][0],t.stops[c+1][0]),_=t.stops[c][1],y=t.stops[c+1][1];let w=jo[e.type]||p;if(t.colorSpace&&t.colorSpace!=="rgb"){const E=Gd[t.colorSpace];w=(A,I)=>E.reverse(E.interpolate(E.forward(A),E.forward(I),d))}return typeof _.evaluate=="function"?{evaluate(...E){const A=_.evaluate.apply(void 0,E),I=y.evaluate.apply(void 0,E);if(A!==void 0&&I!==void 0)return w(A,I,d)}}:w(_,y,d)}function L(t,e,n){return e.type==="color"?n=Gn.parse(n):e.type==="formatted"?n=oi.fromString(n.toString()):e.type==="resolvedImage"?n=Ti.fromString(n.toString()):fe(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),v(n,t.default,e.default)}Yi.register(ul,{error:[{kind:"error"},[On],(t,[e])=>{throw new _i(e.evaluate(t))}],typeof:[On,[Wn],(t,[e])=>Yr(ni(e.evaluate(t)))],"to-rgba":[ys(Rt,4),[ls],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[ls,[Rt,Rt,Rt],Kd],rgba:[ls,[Rt,Rt,Rt,Rt],Kd],hsl:[ls,[Rt,Rt,Rt],zp],hsla:[ls,[Rt,Rt,Rt,Rt],zp],has:{type:Nn,overloads:[[[On],(t,[e])=>Jd(e.evaluate(t),t.properties())],[[On,Zl],(t,[e,n])=>Jd(e.evaluate(t),n.evaluate(t))]]},get:{type:Wn,overloads:[[[On],(t,[e])=>kh(e.evaluate(t),t.properties())],[[On,Zl],(t,[e,n])=>kh(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Wn,[On],(t,[e])=>kh(e.evaluate(t),t.featureState||{})],properties:[Zl,[],t=>t.properties()],"geometry-type":[On,[],t=>t.geometryType()],id:[Wn,[],t=>t.id()],zoom:[Rt,[],t=>t.globals.zoom],pitch:[Rt,[],t=>t.globals.pitch||0],"distance-from-center":[Rt,[],t=>t.distanceFromCenter()],"measure-light":[Rt,[On],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Rt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Rt,[],t=>t.globals.lineProgress||0],"raster-value":[Rt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[Rt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[Rt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Wn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Rt,Ss(Rt),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[Rt,Ss(Rt),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:Rt,overloads:[[[Rt,Rt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Rt],(t,[e])=>-e.evaluate(t)]]},"/":[Rt,[Rt,Rt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Rt,[Rt,Rt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Rt,[Rt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Rt,[Rt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Rt,[Rt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Rt,[Rt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Rt,[Rt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Rt,[Rt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Rt,[Rt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Rt,[Rt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Rt,[Rt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Rt,[Rt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Rt,Ss(Rt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Rt,Ss(Rt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Rt,[Rt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Rt,[Rt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Rt,[Rt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Rt,[Rt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Nn,[On,Wn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Nn,[Wn],(t,[e])=>t.id()===e.value],"filter-type-==":[Nn,[On],(t,[e])=>t.geometryType()===e.value],"filter-<":[Nn,[On,Wn],(t,[e,n])=>{const s=t.properties()[e.value],l=n.value;return typeof s==typeof l&&s<l}],"filter-id-<":[Nn,[Wn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[Nn,[On,Wn],(t,[e,n])=>{const s=t.properties()[e.value],l=n.value;return typeof s==typeof l&&s>l}],"filter-id->":[Nn,[Wn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[Nn,[On,Wn],(t,[e,n])=>{const s=t.properties()[e.value],l=n.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[Nn,[Wn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[Nn,[On,Wn],(t,[e,n])=>{const s=t.properties()[e.value],l=n.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[Nn,[Wn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[Nn,[Wn],(t,[e])=>e.value in t.properties()],"filter-has-id":[Nn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Nn,[ys(On)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Nn,[ys(Wn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Nn,[On,ys(Wn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Nn,[On,ys(Wn)],(t,[e,n])=>function(s,l,c,d){for(;c<=d;){const _=c+d>>1;if(l[_]===s)return!0;l[_]>s?d=_-1:c=_+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Nn,overloads:[[[Nn,Nn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Ss(Nn),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Nn,overloads:[[[Nn,Nn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Ss(Nn),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Nn,[Nn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Nn,[On],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[On,[On],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[On,[On],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[On,Ss(Wn),(t,e)=>e.map(n=>ro(n.evaluate(t))).join("")],"resolved-locale":[On,[Eo],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Rt,[Rt,Rt,Wn],(t,e)=>{const[n,s,l]=e.map(d=>d.evaluate(t));if(n>s||n===s)return n;let c;if(typeof l=="string")c=function(d){let _=0;if(d.length===0)return _;for(let y=0;y<d.length;y++)_=(_<<5)-_+d.charCodeAt(y),_|=0;return _}(l);else{if(typeof l!="number")throw new _i(`Invalid seed input: ${l}`);c=l}return n+zh(c)()*(s-n)}]});class O{constructor(e,n,s,l){this.expression=e,this._warningHistory={},this._evaluator=new or(s,l),this._defaultValue=n?function(c){return c.type==="color"&&(u(c.default)||Array.isArray(c.default))?new Gn(0,0,0,0):c.type==="color"?Gn.parse(c.default)||null:c.default===void 0?null:c.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,s,l,c,d,_,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=l||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,l,c,d,_,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new _i(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function F(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in ul}function U(t,e,n,s){const l=new Km(ul,[],e?function(d){const _={color:ls,string:On,number:Rt,enum:On,boolean:Nn,formatted:Xr,resolvedImage:Gr};return d.type==="array"?ys(_[d.value]||Wn,d.length):_[d.type]}(e):void 0,void 0,void 0,n,s),c=l.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Qm(new O(c,e,n,s)):Es(l.errors)}class j{constructor(e,n,s){this.kind=e,this._styleExpression=n,this.isLightConstant=s,this.isStateDependent=e!=="constant"&&!al(n.expression),this.isConfigDependent=!Fd(n.expression)}evaluateWithoutErrorHandling(e,n,s,l,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,l,c,d)}evaluate(e,n,s,l,c,d){return this._styleExpression.evaluate(e,n,s,l,c,d)}}class H{constructor(e,n,s,l,c){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!al(n.expression),this.isLightConstant=c,this.isConfigDependent=!Fd(n.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,n,s,l,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,l,c,d)}evaluate(e,n,s,l,c,d){return this._styleExpression.evaluate(e,n,s,l,c,d)}interpolationFactor(e,n,s){return this.interpolationType?bs.interpolationFactor(this.interpolationType,e,n,s):0}}function Z(t,e,n,s){if((t=U(t,e,n,s)).result==="error")return t;const l=t.value.expression,c=ol(l);if(!c&&!Oh(e))return Es([new Go("","data expressions not supported")]);const d=Mh(l,["zoom","pitch","distance-from-center"]);if(!d&&!f(e))return Es([new Go("","zoom expressions not supported")]);const _=Mh(l,["measure-light"]);if(!_&&!Op(e))return Es([new Go("","measure-light expression not supported")]);const y=e.expression&&e.expression.relaxZoomRestriction,w=Y(l);return w||d||y?w instanceof Go?Es([w]):w instanceof bs&&!i(e)?Es([new Go("",'"interpolate" expressions cannot be used with this property')]):Qm(w?new H(c?"camera":"composite",t.value,w.labels,w instanceof bs?w.interpolation:void 0,_):new j(c?"constant":"source",t.value,_)):Es([new Go("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class X{constructor(e,n){this._parameters=e,this._specification=n,ac(this,x(this._parameters,this._specification))}static deserialize(e){return new X(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Y(t){let e=null;if(t instanceof Sc)e=Y(t.result);else if(t instanceof Wd){for(const n of t.args)if(e=Y(n),e)break}else(t instanceof xc||t instanceof bs)&&t.input instanceof Yi&&t.input.name==="zoom"&&(e=t);return e instanceof Go||t.eachChild(n=>{const s=Y(n);s instanceof Go?e=s:e&&s&&e!==s&&(e=new Go("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var ie=ue,oe=3;function ue(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(n=l[2]);for(var c=0;c<this.d*this.d;c++){var d=l[oe+c],_=l[oe+c+1];s.push(d===_?null:l.subarray(d,_))}var y=l[oe+s.length+1];this.keys=l.subarray(l[oe+s.length],y),this.bboxes=l.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var E=n/e*t;this.min=-E,this.max=t+E}ue.prototype.insert=function(t,e,n,s,l){this._forEachCell(e,n,s,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(l)},ue.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ue.prototype._insertCell=function(t,e,n,s,l,c){this.cells[l].push(c)},ue.prototype.query=function(t,e,n,s,l){var c=this.min,d=this.max;if(t<=c&&e<=c&&d<=n&&d<=s&&!l)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,n,s,this._queryCell,_,{},l),_},ue.prototype._queryCell=function(t,e,n,s,l,c,d,_){var y=this.cells[l];if(y!==null)for(var w=this.keys,E=this.bboxes,A=0;A<y.length;A++){var I=y[A];if(d[I]===void 0){var z=4*I;(_?_(E[z+0],E[z+1],E[z+2],E[z+3]):t<=E[z+2]&&e<=E[z+3]&&n>=E[z+0]&&s>=E[z+1])?(d[I]=!0,c.push(w[I])):d[I]=!1}}},ue.prototype._forEachCell=function(t,e,n,s,l,c,d,_){for(var y=this._convertToCellCoord(t),w=this._convertToCellCoord(e),E=this._convertToCellCoord(n),A=this._convertToCellCoord(s),I=y;I<=E;I++)for(var z=w;z<=A;z++){var k=this.d*z+I;if((!_||_(this._convertFromCellCoord(I),this._convertFromCellCoord(z),this._convertFromCellCoord(I+1),this._convertFromCellCoord(z+1)))&&l.call(this,t,e,n,s,k,c,d,_))return}},ue.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ue.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ue.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=oe+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var l=new Int32Array(e+n+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var c=e,d=0;d<t.length;d++){var _=t[d];l[oe+d]=c,l.set(_,c),c+=_.length}return l[oe+t.length]=c,l.set(this.keys,c),l[oe+t.length+1]=c+=this.keys.length,l.set(this.bboxes,c),c+=this.bboxes.length,l.buffer};var ge=et(ie);const _e={};function se(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),_e[e]={klass:t,omit:n.omit||[]}}se(Object,"Object"),ge.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},ge.deserialize=function(t){return new ge(t.buffer)},Object.defineProperty(ge,"name",{value:"Grid"}),se(ge,"Grid"),se(Gn,"Color"),se(Error,"Error"),se(oi,"Formatted"),se(no,"FormattedSection"),se(Md,"AJAXError"),se(Ti,"ResolvedImage"),se(X,"StylePropertyFunction"),se(O,"StyleExpression",{omit:["_evaluator"]}),se(H,"ZoomDependentExpression"),se(j,"ZoomConstantExpression"),se(Yi,"CompoundExpression",{omit:["_evaluate"]});for(const t in ul)_e[ul[t]._classRegistryKey]||se(ul[t],`Expression${t}`);function le(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ce(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Se(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(le(t)||ce(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(Se(s,e));return n}if(t instanceof Map){const n={$name:"Map"};for(const[s,l]of t.entries())n[s]=Se(l);return n}if(typeof t=="object"){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const l=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const c in t)t.hasOwnProperty(c)&&(_e[s].omit.indexOf(c)>=0||(l[c]=Se(t[c],e)));t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof t)}function Oe(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||le(t)||ce(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Oe);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const l=new Map;for(const c of Object.keys(t))c!=="$name"&&l.set(c,Oe(t[c]));return l}const{klass:n}=_e[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const l of Object.keys(t))l!=="$name"&&(s[l]=Oe(t[l]));return s}throw new Error("can't deserialize object of type "+typeof t)}const pe={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Be(t){for(const e of t)if(rt(e.charCodeAt(0)))return!0;return!1}function Fe(t){for(const e of t)if(!tt(e.charCodeAt(0)))return!1;return!0}function tt(t){return!(pe.Arabic(t)||pe["Arabic Supplement"](t)||pe["Arabic Extended-A"](t)||pe["Arabic Presentation Forms-A"](t)||pe["Arabic Presentation Forms-B"](t))}function rt(t){return!(t!==746&&t!==747&&(t<4352||!(pe["Bopomofo Extended"](t)||pe.Bopomofo(t)||pe["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||pe["CJK Compatibility Ideographs"](t)||pe["CJK Compatibility"](t)||pe["CJK Radicals Supplement"](t)||pe["CJK Strokes"](t)||!(!pe["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||pe["CJK Unified Ideographs Extension A"](t)||pe["CJK Unified Ideographs"](t)||pe["Enclosed CJK Letters and Months"](t)||pe["Hangul Compatibility Jamo"](t)||pe["Hangul Jamo Extended-A"](t)||pe["Hangul Jamo Extended-B"](t)||pe["Hangul Jamo"](t)||pe["Hangul Syllables"](t)||pe.Hiragana(t)||pe["Ideographic Description Characters"](t)||pe.Kanbun(t)||pe["Kangxi Radicals"](t)||pe["Katakana Phonetic Extensions"](t)||pe.Katakana(t)&&t!==12540||!(!pe["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!pe["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||pe["Unified Canadian Aboriginal Syllabics"](t)||pe["Unified Canadian Aboriginal Syllabics Extended"](t)||pe["Vertical Forms"](t)||pe["Yijing Hexagram Symbols"](t)||pe["Yi Syllables"](t)||pe["Yi Radicals"](t))))}function Qe(t){return!(rt(t)||function(e){return!!(pe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||pe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||pe["Letterlike Symbols"](e)||pe["Number Forms"](e)||pe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||pe["Control Pictures"](e)&&e!==9251||pe["Optical Character Recognition"](e)||pe["Enclosed Alphanumerics"](e)||pe["Geometric Shapes"](e)||pe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||pe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||pe["CJK Symbols and Punctuation"](e)||pe.Katakana(e)||pe["Private Use Area"](e)||pe["CJK Compatibility Forms"](e)||pe["Small Form Variants"](e)||pe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Pe(t){return t>=1424&&t<=2303||pe["Arabic Presentation Forms-A"](t)||pe["Arabic Presentation Forms-B"](t)}function je(t,e){return!(!e&&Pe(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||pe.Khmer(t))}function Ke(t){for(const e of t)if(Pe(e.charCodeAt(0)))return!0;return!1}const bt="deferred",St="loading",Pt="loaded";let Et=null,ot="unavailable",Ze=null;const kt=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ot="error"),Et&&Et(t)};function cn(){sn.fire(new as("pluginStateChange",{pluginStatus:ot,pluginURL:Ze}))}const sn=new Uo,yn=function(){return ot},Sn=function(){if(ot!==bt||!Ze)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ot=St,cn(),Ze&&Wl({url:Ze},t=>{t?kt(t):(ot=Pt,cn())})},Vt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ot===Pt||Vt.applyArabicShaping!=null,isLoading:()=>ot===St,setState(t){ot=t.pluginStatus,Ze=t.pluginURL},isParsed:()=>Vt.applyArabicShaping!=null&&Vt.processBidirectionalText!=null&&Vt.processStyledBidirectionalText!=null,getPluginURL:()=>Ze};class tn{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,s){for(const l of n)if(!je(l.charCodeAt(0),s))return!1;return!0}(e,Vt.isLoaded())}}class Hn{constructor(e,n,s,l){this.property=e,this.value=n,this.expression=function(c,d,_,y){if(u(c))return new X(c,d);if(F(c)||Array.isArray(c)&&c.length>0){const w=Z(c,d,_,y);if(w.result==="error")throw new Error(w.value.map(E=>`${E.key}: ${E.message}`).join(", "));return w.value}{let w=c;return typeof c=="string"&&d.type==="color"&&(w=Gn.parse(c)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(n===void 0?e.specification.default:n,e.specification,s,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class er{constructor(e,n,s){this.property=e,this.value=new Hn(e,void 0,n,s)}transitioned(e,n){return new En(this.property,this.value,n,Rr({},e.transition,this.transition),e.now)}untransitioned(){return new En(this.property,this.value,null,{},0)}}class nr{constructor(e,n,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=s,this.isConfigDependent=!1}getValue(e){return No(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new er(this._values[e].property,this._scope,this._options)),this._values[e].value=new Hn(this._values[e].property,n===null?void 0:No(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);const s=this._properties.properties;if(e)for(const l in e){const c=e[l];if(Wi(l,"-transition")){const d=l.slice(0,-11);s[d]&&this.setTransition(d,c)}else s.hasOwnProperty(l)&&this.setValue(l,c)}}getTransition(e){return No(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new er(this._values[e].property)),this._values[e].transition=No(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s);const l=this.getTransition(n);l!==void 0&&(e[`${n}-transition`]=l)}return e}transitioned(e,n){const s=new ln(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,n._values[l]);return s}untransitioned(){const e=new ln(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class En{constructor(e,n,s,l,c){const d=l.delay||0,_=l.duration||0;c=c||0,this.property=e,this.value=n,this.begin=c+d,this.end=this.begin+_,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const l=e.now||0,c=this.value.possiblyEvaluate(e,n,s),d=this.prior;if(d){if(l>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(l<this.begin)return d.possiblyEvaluate(e,n,s);{const _=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,n,s),c,sp(_))}}return c}}class ln{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const l=new ar(this._properties);for(const c of Object.keys(this._values))l._values[c]=this._values[c].possiblyEvaluate(e,n,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Dn{constructor(e,n,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=s,this.isConfigDependent=!1}getValue(e){return No(this._values[e].value)}setValue(e,n){this._values[e]=new Hn(this._values[e].property,n===null?void 0:No(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const l=new ar(this._properties);for(const c of Object.keys(this._values))l._values[c]=this._values[c].possiblyEvaluate(e,n,s);return l}}class vr{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,s,l){return this.property.evaluate(this.value,this.parameters,e,n,s,l)}}class ar{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class nt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const l=jo[this.specification.type];return l?l(e,n,s):e}}class At{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,l){return new vr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},s,l)}:e.expression,n)}interpolate(e,n,s){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new vr(this,{kind:"constant",value:void 0},e.parameters);const l=jo[this.specification.type];return l?new vr(this,{kind:"constant",value:l(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,l,c,d){return e.kind==="constant"?e.value:e.evaluate(n,s,l,c,d)}}class Mr{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,l){return!!e.expression.evaluate(n,null,{},s,l)}interpolate(){return!1}}class Kn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new tn(0,{});for(const s in e){const l=e[s];l.specification.overridable&&this.overridableProperties.push(s);const c=this.defaultPropertyValues[s]=new Hn(l,void 0),d=this.defaultTransitionablePropertyValues[s]=new er(l);this.defaultTransitioningPropertyValues[s]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=c.possiblyEvaluate(n)}}}se(At,"DataDrivenProperty"),se(nt,"DataConstantProperty"),se(Mr,"ColorRampProperty");var ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Vs(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Vr(t){if(Array.isArray(t))return t.map(Vr);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=Vr(t[n]);return e}return Vs(t)}function Sr(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Sr(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ri(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Sr(t)||(t=Co(t));const n=t;let s=!0;try{s=function(w){if(!js(w))return w;let E=Vr(w);return Us(E),E=cs(E),E}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const l=ke[`filter_${e}`],c=U(s,l);let d=null;if(c.result==="error")throw new Error(c.value.map(w=>`${w.key}: ${w.message}`).join(", "));d=(w,E,A)=>c.value.evaluate(w,E,{},A);let _=null,y=null;if(s!==n){const w=U(n,l);if(w.result==="error")throw new Error(w.value.map(E=>`${E.key}: ${E.message}`).join(", "));_=(E,A,I,z,k)=>w.value.evaluate(E,A,{},I,void 0,void 0,z,k),y=!ol(w.value.expression)}return{filter:d,dynamicFilter:_||void 0,needGeometry:Xo(s),needFeature:!!y}}function cs(t){if(!Array.isArray(t))return t;const e=function(n){if(cl.has(n[0])){for(let s=1;s<n.length;s++)if(js(n[s]))return!0}return n}(t);return e===!0?e:e.map(n=>cs(n))}function Us(t){let e=!1;const n=[];if(t[0]==="case"){for(let s=1;s<t.length-1;s+=2)e=e||js(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||js(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||js(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)Us(t[s])}function js(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(js(t[n]))return!0;return!1}const cl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function io(t,e){return t<e?-1:t>e?1:0}function Xo(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Xo(t[e]))return!0;return!1}function Co(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Ma(t[1],t[2],"=="):e==="!="?nu(Ma(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ma(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Co))):e==="all"?["all"].concat(t.slice(1).map(Co)):e==="none"?["all"].concat(t.slice(1).map(Co).map(nu)):e==="in"?Ec(t[1],t.slice(2)):e==="!in"?nu(Ec(t[1],t.slice(2))):e==="has"?Cc(t[1]):e!=="!has"||nu(Cc(t[1]));var n}function Ma(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Ec(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(io)]]:["filter-in-small",t,["literal",e]]}}function Cc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function nu(t){return["!",t]}const ru="";function Bh(t,e){return e?`${t}${ru}${e}`:t}const Qd="-transition",Fh=new Set(["fill","line","background","hillshade","raster"]);class ii extends Uo{constructor(e,n,s,l,c){if(super(),this.id=e.id,this.fqid=Bh(this.id,s),this.type=e.type,this.scope=s,this.lut=l,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new Dn(n.layout,this.scope,c),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new nr(n.paint,this.scope,c);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ar(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return Fh.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Wi(e,Qd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){const s=this._transitionablePaint,l=s._properties.properties;if(Wi(e,Qd)){const A=e.slice(0,-11);return l[A]&&s.setTransition(A,n||void 0),!1}if(!l[e])return!1;const c=s._values[e],d=c.value.isDataDriven(),_=c.value;s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const y=s._values[e].value,w=y.isDataDriven(),E=Wi(e,"pattern")||e==="line-dasharray";return w||d||E||this._handleOverridablePaintPropertyUpdate(e,_,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,s){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Li({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof vr&&Oh(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ri(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,s,l,c,d,_,y,w){}queryIntersectsMatchingFeature(e,n,s,l){}}const iu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hl{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Er{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Xn(t,e=1){let n=0,s=0;return{members:t.map(l=>{const c=iu[l.type].BYTES_PER_ELEMENT,d=n=Bp(n,Math.max(e,c)),_=l.components||1;return s=Math.max(s,c),n+=c*_,{name:l.name,type:l.type,components:_,offset:d}}),size:Bp(n,Math.max(s,e)),alignment:e}}function Bp(t,e){return Math.ceil(t/e)*e}class Yo extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const l=2*e;return this.int16[l+0]=n,this.int16[l+1]=s,e}}Yo.prototype.bytesPerElement=4,se(Yo,"StructArrayLayout2i4");class Ao extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const c=3*e;return this.int16[c+0]=n,this.int16[c+1]=s,this.int16[c+2]=l,e}}Ao.prototype.bytesPerElement=6,se(Ao,"StructArrayLayout3i6");class so extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s,l)}emplace(e,n,s,l,c){const d=4*e;return this.int16[d+0]=n,this.int16[d+1]=s,this.int16[d+2]=l,this.int16[d+3]=c,e}}so.prototype.bytesPerElement=8,se(so,"StructArrayLayout4i8");class Og extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,l,c)}emplace(e,n,s,l,c,d){const _=5*e;return this.int16[_+0]=n,this.int16[_+1]=s,this.int16[_+2]=l,this.int16[_+3]=c,this.int16[_+4]=d,e}}Og.prototype.bytesPerElement=10,se(Og,"StructArrayLayout5i10");class e_ extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,l,c,d,_)}emplace(e,n,s,l,c,d,_,y){const w=6*e,E=12*e,A=3*e;return this.int16[w+0]=n,this.int16[w+1]=s,this.uint8[E+4]=l,this.uint8[E+5]=c,this.uint8[E+6]=d,this.uint8[E+7]=_,this.float32[A+2]=y,e}}e_.prototype.bytesPerElement=12,se(e_,"StructArrayLayout2i4ub1f12");class Ac extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s,l)}emplace(e,n,s,l,c){const d=4*e;return this.float32[d+0]=n,this.float32[d+1]=s,this.float32[d+2]=l,this.float32[d+3]=c,e}}Ac.prototype.bytesPerElement=16,se(Ac,"StructArrayLayout4f16");class Mc extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const c=3*e;return this.float32[c+0]=n,this.float32[c+1]=s,this.float32[c+2]=l,e}}Mc.prototype.bytesPerElement=12,se(Mc,"StructArrayLayout3f12");class Ic extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,l,c)}emplace(e,n,s,l,c,d){const _=6*e,y=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=s,this.uint16[_+2]=l,this.uint16[_+3]=c,this.float32[y+2]=d,e}}Ic.prototype.bytesPerElement=12,se(Ic,"StructArrayLayout4ui1f12");class t_ extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s,l)}emplace(e,n,s,l,c){const d=4*e;return this.uint16[d+0]=n,this.uint16[d+1]=s,this.uint16[d+2]=l,this.uint16[d+3]=c,e}}t_.prototype.bytesPerElement=8,se(t_,"StructArrayLayout4ui8");class n_ extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,l,c,d)}emplace(e,n,s,l,c,d,_){const y=6*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=l,this.int16[y+3]=c,this.int16[y+4]=d,this.int16[y+5]=_,e}}n_.prototype.bytesPerElement=12,se(n_,"StructArrayLayout6i12");class Bg extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d,_,y,w,E,A,I){const z=this.length;return this.resize(z+1),this.emplace(z,e,n,s,l,c,d,_,y,w,E,A,I)}emplace(e,n,s,l,c,d,_,y,w,E,A,I,z){const k=12*e;return this.int16[k+0]=n,this.int16[k+1]=s,this.int16[k+2]=l,this.int16[k+3]=c,this.uint16[k+4]=d,this.uint16[k+5]=_,this.uint16[k+6]=y,this.uint16[k+7]=w,this.int16[k+8]=E,this.int16[k+9]=A,this.int16[k+10]=I,this.int16[k+11]=z,e}}Bg.prototype.bytesPerElement=24,se(Bg,"StructArrayLayout4i4ui4i24");class Fg extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,l,c,d)}emplace(e,n,s,l,c,d,_){const y=10*e,w=5*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=l,this.float32[w+2]=c,this.float32[w+3]=d,this.float32[w+4]=_,e}}Fg.prototype.bytesPerElement=20,se(Fg,"StructArrayLayout3i3f20");class Ng extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Ng.prototype.bytesPerElement=4,se(Ng,"StructArrayLayout1ul4");class Nh extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Nh.prototype.bytesPerElement=4,se(Nh,"StructArrayLayout1f4");class Pc extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const l=2*e;return this.uint16[l+0]=n,this.uint16[l+1]=s,e}}Pc.prototype.bytesPerElement=4,se(Pc,"StructArrayLayout2ui4");class Vg extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d,_,y,w,E,A,I,z){const k=this.length;return this.resize(k+1),this.emplace(k,e,n,s,l,c,d,_,y,w,E,A,I,z)}emplace(e,n,s,l,c,d,_,y,w,E,A,I,z,k){const B=20*e,N=10*e;return this.int16[B+0]=n,this.int16[B+1]=s,this.int16[B+2]=l,this.int16[B+3]=c,this.int16[B+4]=d,this.float32[N+3]=_,this.float32[N+4]=y,this.float32[N+5]=w,this.float32[N+6]=E,this.int16[B+14]=A,this.uint32[N+8]=I,this.uint16[B+18]=z,this.uint16[B+19]=k,e}}Vg.prototype.bytesPerElement=40,se(Vg,"StructArrayLayout5i4f1i1ul2ui40");class Fp extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,l,c,d,_)}emplace(e,n,s,l,c,d,_,y){const w=8*e;return this.int16[w+0]=n,this.int16[w+1]=s,this.int16[w+2]=l,this.int16[w+4]=c,this.int16[w+5]=d,this.int16[w+6]=_,this.int16[w+7]=y,e}}Fp.prototype.bytesPerElement=16,se(Fp,"StructArrayLayout3i2i2i16");class r_ extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,l,c)}emplace(e,n,s,l,c,d){const _=4*e,y=8*e;return this.float32[_+0]=n,this.float32[_+1]=s,this.float32[_+2]=l,this.int16[y+6]=c,this.int16[y+7]=d,e}}r_.prototype.bytesPerElement=16,se(r_,"StructArrayLayout2f1f2i16");class i_ extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s,l)}emplace(e,n,s,l,c){const d=12*e,_=3*e;return this.uint8[d+0]=n,this.uint8[d+1]=s,this.float32[_+1]=l,this.float32[_+2]=c,e}}i_.prototype.bytesPerElement=12,se(i_,"StructArrayLayout2ub2f12");class Si extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,n,s)}emplace(e,n,s,l){const c=3*e;return this.uint16[c+0]=n,this.uint16[c+1]=s,this.uint16[c+2]=l,e}}Si.prototype.bytesPerElement=6,se(Si,"StructArrayLayout3ui6");class Ug extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N,W,ee,te,ne,me){const de=this.length;return this.resize(de+1),this.emplace(de,e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N,W,ee,te,ne,me)}emplace(e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N,W,ee,te,ne,me,de){const be=30*e,Ae=15*e,ze=60*e;return this.int16[be+0]=n,this.int16[be+1]=s,this.int16[be+2]=l,this.float32[Ae+2]=c,this.float32[Ae+3]=d,this.uint16[be+8]=_,this.uint16[be+9]=y,this.uint32[Ae+5]=w,this.uint32[Ae+6]=E,this.uint32[Ae+7]=A,this.uint16[be+16]=I,this.uint16[be+17]=z,this.uint16[be+18]=k,this.float32[Ae+10]=B,this.float32[Ae+11]=N,this.uint8[ze+48]=W,this.uint8[ze+49]=ee,this.uint8[ze+50]=te,this.uint32[Ae+13]=ne,this.int16[be+28]=me,this.uint8[ze+58]=de,e}}Ug.prototype.bytesPerElement=60,se(Ug,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class jg extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N,W,ee,te,ne,me,de,be,Ae,ze,$e,Ve,Je,ht,Ye,it,qe,st,mt){const ut=this.length;return this.resize(ut+1),this.emplace(ut,e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N,W,ee,te,ne,me,de,be,Ae,ze,$e,Ve,Je,ht,Ye,it,qe,st,mt)}emplace(e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N,W,ee,te,ne,me,de,be,Ae,ze,$e,Ve,Je,ht,Ye,it,qe,st,mt,ut){const Lt=22*e,dt=44*e,yt=88*e;return this.float32[Lt+0]=n,this.float32[Lt+1]=s,this.int16[dt+4]=l,this.int16[dt+5]=c,this.int16[dt+6]=d,this.int16[dt+7]=_,this.int16[dt+8]=y,this.int16[dt+9]=w,this.int16[dt+10]=E,this.int16[dt+11]=A,this.int16[dt+12]=I,this.uint16[dt+13]=z,this.uint16[dt+14]=k,this.uint16[dt+15]=B,this.uint16[dt+16]=N,this.uint16[dt+17]=W,this.uint16[dt+18]=ee,this.uint16[dt+19]=te,this.uint16[dt+20]=ne,this.uint16[dt+21]=me,this.uint16[dt+22]=de,this.uint16[dt+23]=be,this.uint16[dt+24]=Ae,this.uint16[dt+25]=ze,this.uint16[dt+26]=$e,this.uint16[dt+27]=Ve,this.uint32[Lt+14]=Je,this.float32[Lt+15]=ht,this.float32[Lt+16]=Ye,this.float32[Lt+17]=it,this.float32[Lt+18]=qe,this.float32[Lt+19]=st,this.float32[Lt+20]=mt,this.uint8[yt+84]=ut,e}}jg.prototype.bytesPerElement=88,se(jg,"StructArrayLayout2f9i15ui1ul6f1ub88");class Rc extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,s,l,c)}emplace(e,n,s,l,c,d){const _=5*e;return this.float32[_+0]=n,this.float32[_+1]=s,this.float32[_+2]=l,this.float32[_+3]=c,this.float32[_+4]=d,e}}Rc.prototype.bytesPerElement=20,se(Rc,"StructArrayLayout5f20");class Gg extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,l,c,d,_)}emplace(e,n,s,l,c,d,_,y){const w=7*e;return this.float32[w+0]=n,this.float32[w+1]=s,this.float32[w+2]=l,this.float32[w+3]=c,this.float32[w+4]=d,this.float32[w+5]=_,this.float32[w+6]=y,e}}Gg.prototype.bytesPerElement=28,se(Gg,"StructArrayLayout7f28");class ef extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const l=2*e;return this.float32[l+0]=n,this.float32[l+1]=s,e}}ef.prototype.bytesPerElement=8,se(ef,"StructArrayLayout2f8");class Wg extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s,l)}emplace(e,n,s,l,c){const d=6*e;return this.uint32[3*e+0]=n,this.uint16[d+2]=s,this.uint16[d+3]=l,this.uint16[d+4]=c,e}}Wg.prototype.bytesPerElement=12,se(Wg,"StructArrayLayout1ul3ui12");class Np extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Np.prototype.bytesPerElement=2,se(Np,"StructArrayLayout1ui2");class $g extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N){const W=this.length;return this.resize(W+1),this.emplace(W,e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N)}emplace(e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N,W){const ee=16*e;return this.float32[ee+0]=n,this.float32[ee+1]=s,this.float32[ee+2]=l,this.float32[ee+3]=c,this.float32[ee+4]=d,this.float32[ee+5]=_,this.float32[ee+6]=y,this.float32[ee+7]=w,this.float32[ee+8]=E,this.float32[ee+9]=A,this.float32[ee+10]=I,this.float32[ee+11]=z,this.float32[ee+12]=k,this.float32[ee+13]=B,this.float32[ee+14]=N,this.float32[ee+15]=W,e}}$g.prototype.bytesPerElement=64,se($g,"StructArrayLayout16f64");class s_ extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,l,c,d,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,l,c,d,_)}emplace(e,n,s,l,c,d,_,y){const w=10*e,E=5*e;return this.uint16[w+0]=n,this.uint16[w+1]=s,this.uint16[w+2]=l,this.uint16[w+3]=c,this.float32[E+2]=d,this.float32[E+3]=_,this.float32[E+4]=y,e}}s_.prototype.bytesPerElement=20,se(s_,"StructArrayLayout4ui3f20");class oo extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}oo.prototype.bytesPerElement=2,se(oo,"StructArrayLayout1i2");class qg extends Er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}qg.prototype.bytesPerElement=1,se(qg,"StructArrayLayout1ub1");class lx extends hl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}lx.prototype.size=40;class Hg extends Vg{get(e){return new lx(this,e)}}se(Hg,"CollisionBoxArray");class Zg extends hl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Zg.prototype.size=60;class ux extends Ug{get(e){return new Zg(this,e)}}se(ux,"PlacedSymbolArray");class cx extends hl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}cx.prototype.size=88;class hx extends jg{get(e){return new cx(this,e)}}se(hx,"SymbolInstanceArray");class dx extends Nh{getoffsetX(e){return this.float32[1*e+0]}}se(dx,"GlyphOffsetArray");class o_ extends Yo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}se(o_,"SymbolLineVertexArray");class fx extends hl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}fx.prototype.size=12;class px extends Wg{get(e){return new fx(this,e)}}se(px,"FeatureIndexArray");class mx extends Pc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}se(mx,"FillExtrusionCentroidArray");const $w=Xn([{name:"a_pos",components:2,type:"Int16"}],4),qw=Xn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Lr{constructor(e=[]){this.segments=e}_prepareSegment(e,n,s,l){let c=this.segments[this.segments.length-1];return e>Lr.MAX_VERTEX_ARRAY_LENGTH&&xr(`Max vertices per segment is ${Lr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>Lr.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==l)&&(c={vertexOffset:n,primitiveOffset:s,vertexLength:0,primitiveLength:0},l!==void 0&&(c.sortKey=l),this.segments.push(c)),c}prepareSegment(e,n,s,l){return this._prepareSegment(e,n.length,s.length,l)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,l){return new Lr([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function _x(t,e){return 256*(t=Xt(Math.floor(t),0,255))+Xt(Math.floor(e),0,255)}Lr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,se(Lr,"SegmentVector");const Hw=Xn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Zw=Xn([{name:"a_dash",components:4,type:"Uint16"}]);class Vp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,s,l){this.ids.push(gx(e)),this.positions.push(n,s,l)}eachPosition(e,n){const s=gx(e);let l=0,c=this.ids.length-1;for(;l<c;){const d=l+c>>1;this.ids[d]>=s?c=d:l=d+1}for(;this.ids[l]===s;)n(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,n){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Xg(s,l,0,s.length-1),n&&(n.add(s.buffer),n.add(l.buffer)),{ids:s,positions:l}}static deserialize(e){const n=new Vp;let s;n.ids=e.ids,n.positions=e.positions;for(const l of n.ids)l!==s&&n.uniqueIds.push(l),s=l;return n.indexed=!0,n}}function gx(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ql(String(t))}function Xg(t,e,n,s){for(;n<s;){const l=t[n+s>>1];let c=n-1,d=s+1;for(;;){do c++;while(t[c]<l);do d--;while(t[d]>l);if(c>=d)break;a_(t,c,d),a_(e,3*c,3*d),a_(e,3*c+1,3*d+1),a_(e,3*c+2,3*d+2)}d-n<s-d?(Xg(t,e,n,d),n=d+1):(Xg(t,e,d+1,s),s=d)}}function a_(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}se(Vp,"FeaturePositionMap");class su{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class l_ extends su{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Cs extends su{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class ou extends su{constructor(e){super(e),this.current=[0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Yg extends su{constructor(e){super(e),this.current=[0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Kg extends su{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class yx extends su{constructor(e){super(e),this.current=Gn.transparent.toRenderColor(null)}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Jg=new Float32Array(16);class tf extends su{constructor(e){super(e),this.current=Jg}set(e,n,s){if(this.fetchUniformLocation(e,n)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let l=1;l<16;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const Xw=new Float32Array(9),Yw=new Float32Array(4);class Qg extends su{constructor(e){super(e),this.current=Yw}set(e,n,s){if(this.fetchUniformLocation(e,n)){for(let l=0;l<4;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function ey(t){return[_x(255*t.r,255*t.g),_x(255*t.b,255*t.a)]}class Up{constructor(e,n,s,l){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=s,this.context=l}setUniform(e,n,s,l,c){const d=l.constantOr(this.value);n.set(e,c,d instanceof Gn?d.toRenderColor(this.context.lut):d)}getBinding(e,n){return this.type==="color"?new yx(e):new Cs(e)}}class nf{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,l,c){const d=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;d&&n.set(e,c,d)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Kg(e):new Cs(e)}}class au{constructor(e,n,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(c=>({name:`a_${c}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,n,s,l,c,d,_){const y=this.paintVertexArray.length,w=this.expression.evaluate(new tn(0,{brightness:d}),n,{},c,l,_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w,this.context)}updatePaintArray(e,n,s,l,c,d,_){const y=this.expression.evaluate({zoom:0,brightness:_},s,l,void 0,c);this._setPaintValue(e,n,y,this.context)}_setPaintValue(e,n,s,l){if(this.type==="color"){const c=ey(s.toRenderColor(l.lut));for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ia{constructor(e,n,s,l,c,d){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=s,this.useIntegerZoom=l,this.context=c,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,n,s,l,c,d,_){const y=this.expression.evaluate(new tn(this.context.zoom,{brightness:d}),n,{},c,l,_),w=this.expression.evaluate(new tn(this.context.zoom+1,{brightness:d}),n,{},c,l,_),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,y,w,this.context)}updatePaintArray(e,n,s,l,c,d,_){const y=this.expression.evaluate({zoom:this.context.zoom,brightness:_},s,l,void 0,c),w=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},s,l,void 0,c);this._setPaintValue(e,n,y,w,this.context)}_setPaintValue(e,n,s,l,c){if(this.type==="color"){const d=ey(s.toRenderColor(c.lut)),_=ey(s.toRenderColor(c.lut));for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,d[0],d[1],_[0],_[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,l,c){const d=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,_=Xt(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);n.set(e,c,_)}getBinding(e,n){return new Cs(e)}}class lu{constructor(e,n,s,l,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(s==="array"?Zw:Hw).members;for(let d=0;d<n.length;++d);this.paintVertexArray=new l}populatePaintArray(e,n,s,l){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,l,c,d,_){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(e,n,s,l){if(!l||!s)return;const c=l[s];if(!c)return;const{tl:d,br:_,pixelRatio:y}=c;for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,d[0],d[1],_[0],_[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vh{constructor(e,n,s=()=>!0){this.binders={},this._buffers=[],this.context=n;const l=[];for(const c in e.paint._values){const d=e.paint.get(c);if(!s(c)||!(d instanceof vr&&Oh(d.property.specification)))continue;const _=Jw(c,e.type),y=d.value,w=d.property.specification.type,E=!!d.property.useIntegerZoom,A=c==="line-dasharray"||c.endsWith("pattern"),I=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||I)if(y.kind==="source"||I||A){const z=xx(c,w,"source");this.binders[c]=A?new lu(y,_,w,z,e.id):new au(y,_,w,z),l.push(`/a_${c}`)}else{const z=xx(c,w,"composite");this.binders[c]=new Ia(y,_,w,E,n,z),l.push(`/z_${c}`)}else this.binders[c]=A?new nf(y.value,_):new Up(y.value,_,w,n),l.push(`/u_${c}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof au||n instanceof Ia?n.maxValue:0}populatePaintArrays(e,n,s,l,c,d,_){for(const y in this.binders){const w=this.binders[y];w.context=this.context,(w instanceof au||w instanceof Ia||w instanceof lu)&&w.populatePaintArray(e,n,s,l,c,d,_)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof nf&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,l,c,d,_,y){let w=!1;const E=Object.keys(e),A=E.length!==0,I=A?E:n.uniqueIds;this.context.lut=c.lut;for(const z in this.binders){const k=this.binders[z];if(k.context=this.context,(k instanceof au||k instanceof Ia||k instanceof lu)&&(k.expression.isStateDependent===!0||k.expression.isLightConstant===!1)){const B=c.paint.get(z);k.expression=B.value;for(const N of I){const W=e[N.toString()];n.eachPosition(N,(ee,te,ne)=>{const me=l.feature(ee);k.updatePaintArray(te,ne,me,W,d,_,y)})}if(!A)for(const N of s.uniqueIds){const W=e[N.toString()];s.eachPosition(N,(ee,te,ne)=>{const me=l.feature(ee);k.updatePaintArray(te,ne,me,W,d,_,y)})}w=!0}}return w}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof Up||s instanceof nf)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof au||s instanceof Ia||s instanceof lu)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Up||s instanceof nf||s instanceof Ia)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Up||l instanceof nf||l instanceof Ia)for(const c of l.uniformNames)n.push({name:c,property:s,binding:l.getBinding(e,c)})}return n}setUniforms(e,n,s,l,c){for(const{name:d,property:_,binding:y}of s)this.binders[_].setUniform(e,y,c,l.get(_),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof au||n instanceof Ia||n instanceof lu)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof au||s instanceof Ia||s instanceof lu)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof au||n instanceof Ia||n instanceof lu)&&n.destroy()}}}class Pa{constructor(e,n,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Vh(l,n,s);this.needsUpload=!1,this._featureMap=new Vp,this._featureMapWithoutIds=new Vp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,s,l,c,d,_,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,n,l,c,d,_,y);n.id!==void 0?this._featureMap.add(n.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,l,c,d){for(const _ of s)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,_,l,c,d||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Kw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Jw(t,e){return Kw[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Qw={"line-pattern":{source:Ic,composite:Ic},"fill-pattern":{source:Ic,composite:Ic},"fill-extrusion-pattern":{source:Ic,composite:Ic},"line-dasharray":{source:t_,composite:t_}},eb={color:{source:ef,composite:Ac},number:{source:Nh,composite:ef}};function xx(t,e,n){const s=Qw[t];return s&&s[n]||eb[e][n]}se(Up,"ConstantBinder"),se(nf,"PatternConstantBinder"),se(au,"SourceExpressionBinder"),se(lu,"PatternCompositeBinder"),se(Ia,"CompositeExpressionBinder"),se(Vh,"ProgramConfiguration",{omit:["_buffers"]}),se(Pa,"ProgramConfigurationSet");const As=xt/Math.PI/2,ty=5,vx=6,tb=16383,rf=64,ny=[rf,32,16],Ko=-As,Jo=As;function sf(t,e,n,s=As){return n=kn(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function Uh(t,e,n){return sf(Math.cos(kn(t)),Math.sin(kn(t)),e,n)}const of=63710088e-1,u_=2*Math.PI*of;class Un{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Un(Ds(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,l=e.lat*n,c=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*n);return of*Math.acos(Math.min(c,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Lc({lng:this.lng-s,lat:this.lat-n},{lng:this.lng+s,lat:this.lat+n})}toEcef(e){return Uh(this.lat,this.lng,As+e*As/of)}static convert(e){if(e instanceof Un)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Un(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Un(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Lc{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){const s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{const s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof Un?new Un(e.lng,e.lat):Un.convert(e),this}setSouthWest(e){return this._sw=e instanceof Un?new Un(e.lng,e.lat):Un.convert(e),this}extend(e){const n=this._sw,s=this._ne;let l,c;if(e instanceof Un)l=e,c=e;else{if(!(e instanceof Lc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Lc.convert(e)):this.extend(Un.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Un.convert(e)):this;if(l=e._sw,c=e._ne,!l||!c)return this}return n||s?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),s.lng=Math.max(c.lng,s.lng),s.lat=Math.max(c.lat,s.lat)):(this._sw=new Un(l.lng,l.lat),this._ne=new Un(c.lng,c.lat)),this}getCenter(){return new Un((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Un(this.getWest(),this.getNorth())}getSouthEast(){return new Un(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=Un.convert(e);let l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&l}static convert(e){return!e||e instanceof Lc?e:new Lc(e)}}var wx={};(function(t,e){(function(n){function s(c,d,_){var y=l(256*c,256*(d=Math.pow(2,_)-d-1),_),w=l(256*(c+1),256*(d+1),_);return y[0]+","+y[1]+","+w[0]+","+w[1]}function l(c,d,_){var y=2*Math.PI*6378137/256/Math.pow(2,_);return[c*y-2*Math.PI*6378137/2,d*y-2*Math.PI*6378137/2]}n.getURL=function(c,d,_,y,w,E){return E=E||{},c+"?"+["bbox="+s(_,y,w),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+d].join("&")},n.getTileBBox=s,n.getMercCoords=l,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,wx);var nb=wx;class jh{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=Gp(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=nb.getTileBBox(this.x,this.y,this.z),l=function(c,d,_){let y,w="";for(let E=c;E>0;E--)y=1<<E-1,w+=(d&y?1:0)+(_&y?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jp{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Gp(e,n.z,n.z,n.x,n.y)}}class ai{constructor(e,n,s,l,c){this.overscaledZ=e,this.wrap=n,this.canonical=new jh(s,+l,+c),this.key=n===0&&e===s?this.canonical.key:Gp(n,e,s,l,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new ai(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ai(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Gp(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Gp(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ai(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new ai(n,this.wrap,n,s,l),new ai(n,this.wrap,n,s+1,l),new ai(n,this.wrap,n,s,l+1),new ai(n,this.wrap,n,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ai(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ai(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gp(t,e,n,s,l){const c=1<<Math.min(n,22);let d=c*(l%c)+s%c;return t&&n<22&&(d+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*d+n)+(e-n)}const rb=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new ai(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new ai(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new ai(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new ai(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];se(jh,"CanonicalTileID"),se(ai,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ib=0,sb=25.5;function ry(t){return u_*Math.cos(t*Math.PI/180)}function dl(t){return(180+t)/360}function fl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Ms(t,e){return t/ry(e)}function Gs(t){return 360*t-180}function Ni(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Wp(t,e){return t*ry(Ni(e))}const Kr=85.051129;function iy(t){return Math.cos(kn(Xt(t,-Kr,Kr)))}function Dc(t,e){const n=Xt(e,ib,sb),s=Math.pow(2,n);return iy(t)*u_/(512*s)}function c_(t){return 1/Math.cos(t*Math.PI/180)}function $p(t,e=0){const n=Math.exp(Math.PI*(1-(t.y+e/xt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/xt/(1<<t.z)}class Hi{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Un.convert(e);return new Hi(dl(s.lng),fl(s.lat),Ms(n,s.lat))}toLngLat(){return new Un(Gs(this.x),Ni(this.y))}toAltitude(){return Wp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/u_*c_(Ni(this.y))}}function h_(t,e,n,s,l,c,d,_,y){const w=(e+s)/2,E=(n+l)/2,A=new lt(w,E);_(A),function(I,z,k,B,N,W){const ee=k-N,te=B-W;return Math.abs((B-z)*ee-(k-I)*te)/Math.hypot(ee,te)}(A.x,A.y,c.x,c.y,d.x,d.y)>=y?(h_(t,e,n,w,E,c,A,_,y),h_(t,w,E,s,l,A,d,_,y)):t.push(d)}function sy(t,e,n){let s=t[0],l=s.x,c=s.y;e(s);const d=[s];for(let _=1;_<t.length;_++){const y=t[_],{x:w,y:E}=y;e(y),h_(d,l,c,w,E,s,y,e,n),l=w,c=E,s=y}return d}function oy(t,e,n,s){if(s(e,n)){const l=e.add(n)._mult(.5);oy(t,e,l,s),oy(t,l,n,s)}else t.push(n)}function ob(t,e){let n=t[0];const s=[n];for(let l=1;l<t.length;l++){const c=t[l];oy(s,n,c,e),n=c}return s}const ay=Math.pow(2,14)-1,qp=-ay-1;function d_(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=Xt(n,qp,ay),t.y=Xt(s,qp,ay),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&xr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ra(t,e,n){const s=t.loadGeometry(),l=t.extent,c=xt/l;if(e&&n&&n.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:_,x:y,y:w,projection:E}=n,A=I=>{const z=Gs((e.x+I.x/l)/d),k=Ni((e.y+I.y/l)/d),B=E.project(z,k);I.x=(B.x*_-y)*l,I.y=(B.y*_-w)*l};for(let I=0;I<s.length;I++)if(t.type!==1)s[I]=sy(s[I],A,1);else{const z=[];for(const k of s[I])k.x<0||k.x>=l||k.y<0||k.y>=l||(A(k),z.push(k));s[I]=z}}for(const d of s)for(const _ of d)d_(_,c);return s}function uu(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ra(t):[]}}function af(t,e,n,s,l){t.emplaceBack(2*e+(s+1)/2,2*n+(l+1)/2)}function Hp(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class ly{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Yo,this.indexArray=new Si,this.segments=new Lr,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,s,l){const c=this.layers[0],d=[];let _=null;c.type==="circle"&&(_=c.layout.get("circle-sort-key"));for(const{feature:w,id:E,index:A,sourceLayerIndex:I}of e){const z=this.layers[0]._featureFilter.needGeometry,k=uu(w,z);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),k,s))continue;const B=_?_.evaluate(k,{},s):void 0,N={id:E,properties:w.properties,type:w.type,sourceLayerIndex:I,index:A,geometry:z?k.geometry:Ra(w,s,l),patterns:{},sortKey:B};d.push(N)}_&&d.sort((w,E)=>w.sortKey-E.sortKey);let y=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new n_,y=l.projection);for(const w of d){const{geometry:E,index:A,sourceLayerIndex:I}=w,z=e[A].feature;this.addFeature(w,E,A,n.availableImages,s,y,n.brightness),n.featureIndex.insert(z,E,A,I,this.index)}}update(e,n,s,l,c){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,d?this.stateDependentLayers:this.layers,s,l,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$w.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,qw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,l,c,d,_){for(const y of n)for(const w of y){const E=w.x,A=w.y;if(E<0||E>=xt||A<0||A>=xt)continue;if(d){const k=d.projectTilePoint(E,A,c),B=d.upVector(c,E,A),N=this.globeExtVertexArray;Hp(N,k,B),Hp(N,k,B),Hp(N,k,B),Hp(N,k,B)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),z=I.vertexLength;af(this.layoutVertexArray,E,A,-1,-1),af(this.layoutVertexArray,E,A,1,-1),af(this.layoutVertexArray,E,A,1,1),af(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l,c,_)}}function uy(t,e){for(let n=0;n<t.length;n++)if(zc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(zc(t,e[n]))return!0;return!!cy(t,e)}function ab(t,e,n){return!!zc(t,e)||!!hy(e,t,n)}function bx(t,e){if(t.length===1)return Sx(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let l=0;l<s.length;l++)if(zc(t,s[l]))return!0}for(let n=0;n<t.length;n++)if(Sx(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(cy(t,e[n]))return!0;return!1}function lb(t,e,n){if(t.length>1){if(cy(t,e))return!0;for(let s=0;s<e.length;s++)if(hy(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(hy(t[s],e,n))return!0;return!1}function cy(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],l=t[n+1];for(let c=0;c<e.length-1;c++)if(ub(s,l,e[c],e[c+1]))return!0}return!1}function ub(t,e,n,s){return zs(t,n,s)!==zs(e,n,s)&&zs(t,e,n)!==zs(t,e,s)}function hy(t,e,n){const s=n*n;if(e.length===1)return t.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(Tx(t,e[l-1],e[l])<s)return!0;return!1}function Tx(t,e,n){const s=e.distSqr(n);if(s===0)return t.distSqr(e);const l=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(l<0?e:l>1?n:n.sub(e)._mult(l)._add(e))}function Sx(t,e){let n,s,l,c=!1;for(let d=0;d<t.length;d++){n=t[d];for(let _=0,y=n.length-1;_<n.length;y=_++)s=n[_],l=n[y],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(c=!c)}return c}function zc(t,e){let n=!1;for(let s=0,l=t.length-1;s<t.length;l=s++){const c=t[s],d=t[l];c.y>e.y!=d.y>e.y&&e.x<(d.x-c.x)*(e.y-c.y)/(d.y-c.y)+c.x&&(n=!n)}return n}function Ex(t,e,n,s,l){for(const d of t)if(e<=d.x&&n<=d.y&&s>=d.x&&l>=d.y)return!0;const c=[new lt(e,n),new lt(e,l),new lt(s,l),new lt(s,n)];if(t.length>2){for(const d of c)if(zc(t,d))return!0}for(let d=0;d<t.length-1;d++)if(La(t[d],t[d+1],c))return!0;return!1}function La(t,e,n){const s=n[0],l=n[2];if(t.x<s.x&&e.x<s.x||t.x>l.x&&e.x>l.x||t.y<s.y&&e.y<s.y||t.y>l.y&&e.y>l.y)return!1;const c=zs(t,e,n[0]);return c!==zs(t,e,n[1])||c!==zs(t,e,n[2])||c!==zs(t,e,n[3])}function lf(t,e,n,s,l,c){let d=e.y-t.y,_=t.x-e.x;if(c=c||0){const y=d*d+_*_;if(y===0)return!0;const w=Math.sqrt(y);d/=w,_/=w}return!((n.x-t.x)*d+(n.y-t.y)*_-c<0||(s.x-t.x)*d+(s.y-t.y)*_-c<0||(l.x-t.x)*d+(l.y-t.y)*_-c<0)}function dy(t,e,n,s,l,c,d){return!(lf(t,e,s,l,c,d)||lf(e,n,s,l,c,d)||lf(n,t,s,l,c,d)||lf(s,l,t,e,n,d)||lf(l,c,t,e,n,d)||lf(c,s,t,e,n,d))}function Qo(t,e,n){const s=e.paint.get(t).value;return s.kind==="constant"?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function $n(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Cx(t,e,n,s,l){if(!e[0]&&!e[1])return t;const c=lt.convert(e)._mult(l);n==="viewport"&&c._rotate(-s);const d=[];for(let _=0;_<t.length;_++)d.push(t[_].sub(c));return d}function Ws(t,e,n,s){const l=lt.convert(t)._mult(s);return e==="viewport"&&l._rotate(-n),l}se(ly,"CircleBucket",{omit:["layers"]});const Ei=new Kn({"circle-sort-key":new At(ke.layout_circle["circle-sort-key"]),visibility:new nt(ke.layout_circle.visibility)});var cb={paint:new Kn({"circle-radius":new At(ke.paint_circle["circle-radius"]),"circle-color":new At(ke.paint_circle["circle-color"]),"circle-blur":new At(ke.paint_circle["circle-blur"]),"circle-opacity":new At(ke.paint_circle["circle-opacity"]),"circle-translate":new nt(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new nt(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nt(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nt(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new At(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new At(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new At(ke.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new nt(ke.paint_circle["circle-emissive-strength"])}),layout:Ei};class pl{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const l=o._.dot(n,this.dir);if(Math.abs(l)<1e-6)return!1;const c=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/l;return s[0]=this.pos[0]+this.dir[0]*c,s[1]=this.pos[1]+this.dir[1]*c,s[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,n,s){if(o._.equals(this.pos,e)||n===0)return s[0]=s[1]=s[2]=0,!1;const[l,c,d]=this.dir,_=this.pos[0]-e[0],y=this.pos[1]-e[1],w=this.pos[2]-e[2],E=l*l+c*c+d*d,A=2*(_*l+y*c+w*d),I=A*A-4*E*(_*_+y*y+w*w-n*n);if(I<0){const z=Math.max(-A/2,0),k=_+l*z,B=y+c*z,N=w+d*z,W=Math.hypot(k,B,N);return s[0]=k*n/W,s[1]=B*n/W,s[2]=N*n/W,!1}{const z=(-A-Math.sqrt(I))/(2*E);if(z<0){const k=Math.hypot(_,y,w);return s[0]=_*n/k,s[1]=y*n/k,s[2]=w*n/k,!1}return s[0]=_+l*z,s[1]=y+c*z,s[2]=w+d*z,!0}}}class fy{constructor(e,n,s,l,c){this.TL=e,this.TR=n,this.BR=s,this.BL=l,this.horizon=c}static fromInvProjectionMatrix(e,n,s){const l=[-1,1,1],c=[1,1,1],d=[1,-1,1],_=[-1,-1,1],y=o._.transformMat4(l,l,e),w=o._.transformMat4(c,c,e),E=o._.transformMat4(d,d,e),A=o._.transformMat4(_,_,e);return new fy(y,w,E,A,n/s)}}function Zp(t,e,n){let s=1/0,l=-1/0;const c=[];for(const d of t){o._.sub(c,d,e);const _=o._.dot(c,n);s=Math.min(s,_),l=Math.max(l,_)}return[s,l]}function Ax(t,e){let n=!0;for(let s=0;s<t.planes.length;s++){const l=t.planes[s];let c=0;for(let d=0;d<e.length;d++)c+=o._.dot(l,e[d])+l[3]>=0;if(c===0)return 0;c!==e.length&&(n=!1)}return n?2:1}function Mx(t,e){for(const n of t.projections){const s=Zp(e,t.points[0],n.axis);if(n.projection[1]<s[0]||n.projection[0]>s[1])return 0}return 1}function Ix(t,e){let n=0;const s=[0,0,0,0];for(let l=0;l<t.length;l++)s[0]=t[l][0],s[1]=t[l][1],s[2]=t[l][2],s[3]=1,o.aA.dot(s,e)>=0&&n++;return n}class Xp{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Dr.fromPoints(this.points),this.projections=[],this.frustumEdges=[o._.sub([],this.points[2],this.points[3]),o._.sub([],this.points[0],this.points[3]),o._.sub([],this.points[4],this.points[0]),o._.sub([],this.points[5],this.points[1]),o._.sub([],this.points[6],this.points[2]),o._.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const l=[0,-s[2],s[1]],c=[s[2],0,-s[0]];this.projections.push({axis:l,projection:Zp(this.points,this.points[0],l)}),this.projections.push({axis:c,projection:Zp(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,n,s,l){const c=Math.pow(2,s),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=o.aA.transformMat4([],w,e),A=1/E[3]/n*c;return o.aA.mul(E,E,[A,A,l?1/E[3]:A,A])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=o._.sub([],d[w[0]],d[w[1]]),A=o._.sub([],d[w[2]],d[w[1]]),I=o._.normalize([],o._.cross([],E,A)),z=-o._.dot(I,d[w[1]]);return I.concat(z)}),y=[];for(let w=0;w<d.length;w++)y.push([d[w][0],d[w][1],d[w][2]]);return new Xp(y,_)}intersectsPrecise(e,n,s){for(let l=0;l<n.length;l++)if(!Ix(e,n[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!Ix(e,this.planes[l]))return 0;for(const l of s)for(const c of this.frustumEdges){const d=o._.cross([],l,c),_=o._.length(d);if(_===0)continue;o._.scale(d,d,1/_);const y=Zp(this.points,this.points[0],d),w=Zp(e,this.points[0],d);if(y[0]>w[1]||w[0]>y[1])return 0}return 1}}class Dr{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const l of e)o._.min(n,n,l),o._.max(s,s,l);return new Dr(n,s)}static fromTileIdAndHeight(e,n,s){const l=1<<e.canonical.z,c=e.canonical.x,d=e.canonical.y;return new Dr([c/l,d/l,n],[(c+1)/l,(d+1)/l,s])}static applyTransform(e,n){const s=e.getCorners();for(let l=0;l<s.length;++l)o._.transformMat4(s[l],s[l],n);return Dr.fromPoints(s)}static projectAabbCorners(e,n){const s=e.getCorners();for(let l=0;l<s.length;++l)o._.transformMat4(s[l],s[l],n);return s}constructor(e,n){this.min=e,this.max=n,this.center=o._.scale([],o._.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=o._.clone(this.min),l=o._.clone(this.max);for(let c=0;c<n.length;c++)s[c]=n[c]?this.min[c]:this.center[c],l[c]=n[c]?this.center[c]:this.max[c];return l[2]=this.max[2],new Dr(s,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ax(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ax(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Mx(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Mx(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}se(Dr,"Aabb");const cu=Xn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Yp}=cu,Kp=Xn([{name:"a_pos_3",components:3,type:"Int16"}]);var Wr=Xn([{name:"a_pos",type:"Int16",components:2}]);function ei(t){return t*As/of}const Px=[new Dr([Ko,Ko,Ko],[Jo,Jo,Jo]),new Dr([Ko,Ko,Ko],[0,0,Jo]),new Dr([0,Ko,Ko],[Jo,0,Jo]),new Dr([Ko,0,Ko],[0,Jo,Jo]),new Dr([0,0,Ko],[Jo,Jo,Jo])];function Rx(t,e,n,s=!0){const l=o._.scale([],t._camera.position,t.worldSize),c=[e,n,1,1];o.aA.transformMat4(c,c,t.pixelMatrixInverse),o.aA.scale(c,c,1/c[3]);const d=o._.sub([],c,l),_=o._.normalize([],d),y=t.globeMatrix,w=[y[12],y[13],y[14]],E=o._.sub([],w,l),A=o._.length(E),I=o._.normalize([],E),z=t.worldSize/(2*Math.PI),k=o._.dot(I,_),B=Math.asin(z/A);if(B<Math.acos(k)){if(!s)return null;const Ve=[],Je=[];o._.scale(Ve,_,A/k),o._.normalize(Je,o._.sub(Je,Ve,E)),o._.normalize(_,o._.add(_,E,o._.scale(_,Je,Math.tan(B)*A)))}const N=[];new pl(l,_).closestPointOnSphere(w,z,N);const W=o._.normalize([],ph(y,0)),ee=o._.normalize([],ph(y,1)),te=o._.normalize([],ph(y,2)),ne=o._.dot(W,N),me=o._.dot(ee,N),de=o._.dot(te,N),be=Gi(Math.asin(-me/z));let Ae=Gi(Math.atan2(ne,de));Ae=t.center.lng+function(Ve,Je){const ht=(Je-Ve+180)%360-180;return ht<-180?ht+360:ht}(t.center.lng,Ae);const ze=dl(Ae),$e=Xt(fl(be),0,1);return new Hi(ze,$e)}class hb{constructor(e,n,s){this.a=o._.sub([],e,s),this.b=o._.sub([],n,s),this.center=s;const l=o._.normalize([],this.a),c=o._.normalize([],this.b);this.angle=Math.acos(o._.dot(l,c))}}function py(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,l,c,d){const _=Math.sin(c);return s*(Math.sin((1-d)*c)/_)+l*(Math.sin(d*c)/_)}(t.a[e],t.b[e],t.angle,Xt(n,0,1))+t.center[e]}function ml(t){if(t.z<=1)return Px[t.z+2*t.y+t.x];const e=_y(cf(t));return Dr.fromPoints(e)}function hu(t,e,n){return o._.scale(t,t,1-n),o._.scaleAndAdd(t,t,e,n)}function Lx(t,e){const n=du(e.zoom);if(n===0)return ml(t);const s=cf(t),l=_y(s),c=dl(s.getWest())*e.worldSize,d=dl(s.getEast())*e.worldSize,_=fl(s.getNorth())*e.worldSize,y=fl(s.getSouth())*e.worldSize,w=[c,_,0],E=[d,_,0],A=[c,y,0],I=[d,y,0],z=o.ad.invert([],e.globeMatrix);return o._.transformMat4(w,w,z),o._.transformMat4(E,E,z),o._.transformMat4(A,A,z),o._.transformMat4(I,I,z),l[0]=hu(l[0],A,n),l[1]=hu(l[1],I,n),l[2]=hu(l[2],E,n),l[3]=hu(l[3],w,n),Dr.fromPoints(l)}function my(t,e,n){for(const s of t)o._.transformMat4(s,s,e),o._.scale(s,s,n)}function uf(t,e,n,s){const l=e/t.worldSize,c=t.globeMatrix;if(n.z<=1){const ze=ml(n).getCorners();return my(ze,c,l),Dr.fromPoints(ze)}const d=cf(n,s),_=_y(d,As+ei(t._tileCoverLift));my(_,c,l);const y=Number.MAX_VALUE,w=[-y,-y,-y],E=[y,y,y];if(d.contains(t.center)){for(const Ve of _)o._.min(E,E,Ve),o._.max(w,w,Ve);w[2]=0;const ze=t.point,$e=[ze.x*l,ze.y*l,0];return o._.min(E,E,$e),o._.max(w,w,$e),new Dr(E,w)}if(t._tileCoverLift>0){for(const ze of _)o._.min(E,E,ze),o._.max(w,w,ze);return new Dr(E,w)}const A=[c[12]*l,c[13]*l,c[14]*l],I=d.getCenter(),z=Xt(t.center.lat,-Kr,Kr),k=Xt(I.lat,-Kr,Kr),B=dl(t.center.lng),N=fl(z);let W=B-dl(I.lng);const ee=N-fl(k);W>.5?W-=1:W<-.5&&(W+=1);let te=0;if(Math.abs(W)>Math.abs(ee))te=W>=0?1:3;else{te=ee>=0?0:2;const ze=[c[4]*l,c[5]*l,c[6]*l],$e=-Math.sin(kn(ee>=0?d.getSouth():d.getNorth()))*As;o._.scaleAndAdd(A,A,ze,$e)}const ne=_[te],me=_[(te+1)%4],de=new hb(ne,me,A),be=[py(de,0)||ne[0],py(de,1)||ne[1],py(de,2)||ne[2]],Ae=du(t.zoom);if(Ae>0){const ze=function({x:Ve,y:Je,z:ht},Ye,it,qe,st){const mt=1/(1<<ht);let ut=Ve*mt,Lt=ut+mt,dt=Je*mt,yt=dt+mt,Wt=0;const jt=(ut+Lt)/2-qe;return jt>.5?Wt=-1:jt<-.5&&(Wt=1),ut=((ut+Wt)*Ye-(qe*=Ye))*it+qe,Lt=((Lt+Wt)*Ye-qe)*it+qe,dt=(dt*Ye-(st*=Ye))*it+st,yt=(yt*Ye-st)*it+st,[[ut,yt,0],[Lt,yt,0],[Lt,dt,0],[ut,dt,0]]}(n,e,t._pixelsPerMercatorPixel,B,N);for(let Ve=0;Ve<_.length;Ve++)hu(_[Ve],ze[Ve],Ae);const $e=o._.add([],ze[te],ze[(te+1)%4]);o._.scale($e,$e,.5),hu(be,$e,Ae)}for(const ze of _)o._.min(E,E,ze),o._.max(w,w,ze);return E[2]=Math.min(ne[2],me[2]),o._.min(E,E,be),o._.max(w,w,be),new Dr(E,w)}function cf({x:t,y:e,z:n},s=!1){const l=1/(1<<n),c=new Un(Gs(t*l),e===(1<<n)-1&&s?-90:Ni((e+1)*l)),d=new Un(Gs((t+1)*l),e===0&&s?90:Ni(e*l));return new Lc(c,d)}function _y(t,e=As){const n=kn(t.getNorth()),s=kn(t.getSouth()),l=Math.cos(n),c=Math.cos(s),d=Math.sin(n),_=Math.sin(s),y=t.getWest(),w=t.getEast();return[sf(c,_,y,e),sf(c,_,w,e),sf(l,d,w,e),sf(l,d,y,e)]}function hf(t,e,n,s){const l=1<<n.z,c=(t/xt+n.x)/l;return Uh(Ni((e/xt+n.y)/l),Gs(c),s)}function Gh({min:t,max:e}){return tb/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const ao=new Float64Array(16);function _l(t){const e=Gh(t),n=o.ad.fromScaling(ao,[e,e,e]);return o.ad.translate(n,n,o._.negate([],t.min))}function gy(t){const e=o.ad.fromTranslation(ao,t.min),n=1/Gh(t);return o.ad.scale(e,e,[n,n,n])}function yy(t){const e=xt/(2*Math.PI);return t/(2*Math.PI)/e}function Dx(t,e){return xt/(512*Math.pow(2,t))*Gh(ml(e))}function zx(t,e,n,s,l){const c=yy(n),d=[t,e,-n/(2*Math.PI)],_=o.ad.identity(new Float64Array(16));return o.ad.translate(_,_,d),o.ad.scale(_,_,[c,c,c]),o.ad.rotateX(_,_,kn(-l)),o.ad.rotateY(_,_,kn(-s)),_}function du(t){return ga(ty,vx,t)}function xy(t,e){const n=Uh(e.lat,e.lng),s=function(c){const d=Uh(c._center.lat,c._center.lng),_=o._.fromValues(0,1,0);let y=o._.cross([],_,d);const w=o.ad.fromRotation([],-c.angle,d);y=o._.transformMat4(y,y,w),o.ad.fromRotation(w,-c._pitch,y);const E=o._.normalize([],d);return o._.scale(E,E,ei(c.cameraToCenterDistance/c.pixelsPerMeter)),o._.transformMat4(E,E,w),o._.add([],d,E)}(t),l=o._.subtract([],s,n);return o._.angle(l,n)}function Da(t,e){return xy(t,e)>Math.PI/2*1.01}const tr=kn(85),kx=Math.cos(tr),ea=Math.sin(tr),Ox=o.ad.create(),Bx=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ir(t,e,n,s,l,c,d,_,y){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(y*=t.pixelToTileUnitsFactor);const w=t.tileID.canonical,E=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(const A of e)for(const I of A){const z=I.add(_),k=l&&n.elevation?n.elevation.exaggeration()*l.getElevationAt(z.x,z.y,!0):0,B=n.projection.projectTilePoint(z.x,z.y,w);if(k>0){const te=n.projection.upVector(w,z.x,z.y);B.x+=te[0]*E*k,B.y+=te[1]*E*k,B.z+=te[2]*E*k}const N=c?z:db(B.x,B.y,B.z,s),W=c?t.tilespaceRays.map(te=>fb(te,k)):t.queryGeometry.screenGeometry,ee=o.aA.transformMat4([],[B.x,B.y,B.z,1],s);if(!d&&c?y*=ee[3]/n.cameraToCenterDistance:d&&!c&&(y*=n.cameraToCenterDistance/ee[3]),c){const te=Ni((I.y/xt+w.y)/(1<<w.z));y/=n.projection.pixelsPerMeter(te,1)/Ms(1,te)}if(ab(W,N,y))return!0}return!1}function db(t,e,n,s){const l=o.aA.transformMat4([],[t,e,n,1],s);return new lt(l[0]/l[3],l[1]/l[3])}const vy=o._.fromValues(0,0,0),f_=o._.fromValues(0,0,1);function fb(t,e){const n=o._.create();return vy[2]=e,t.intersectsPlane(vy,f_,n),new lt(n[0],n[1])}class Fx extends ly{}function Nx(t,{width:e,height:n},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*n*s)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=l,t}function Vx(t,e,n){const{width:s,height:l}=e;s===t.width&&l===t.height||(wy(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,l)},n,null),t.width=s,t.height=l,t.data=e.data)}function wy(t,e,n,s,l,c,d,_){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||n.x>t.width-l.width||n.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const y=t.data,w=e.data,E=c===4&&_;for(let A=0;A<l.height;A++){const I=((n.y+A)*t.width+n.x)*c,z=((s.y+A)*e.width+s.x)*c;if(E)for(let k=0;k<l.width;k++){const B=I+k*c+3,N=z+k*c;w[N+0]=255,w[N+1]=255,w[N+2]=255,w[N+3]=y[B]}else if(d)for(let k=0;k<l.width;k++){const B=I+k*c,N=z+k*c,W=y[B+3],ee=new Gn(y[B+0]/255*W,y[B+1]/255*W,y[B+2]/255*W,W).toRenderColor(d).toArray();w[N+0]=ee[0],w[N+1]=ee[1],w[N+2]=ee[2],w[N+3]=ee[3]}else for(let k=0;k<l.width*c;k++)w[z+k]=y[I+k]}return e}se(Fx,"HeatmapBucket",{omit:["layers"]});class kc{constructor(e,n){Nx(this,e,1,n)}resize(e){Vx(this,new kc(e),1)}clone(){return new kc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,l,c){wy(e,n,s,l,c,1,null)}}class Mo{constructor(e,n){Nx(this,e,4,n)}resize(e){Vx(this,new Mo(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,l,c,d,_){wy(e,n,s,l,c,4,d,_)}}class Ux{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}se(kc,"AlphaImage"),se(Mo,"RGBAImage");const pb=new Kn({visibility:new nt(ke.layout_heatmap.visibility)});var mb={paint:new Kn({"heatmap-radius":new At(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new At(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nt(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mr(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nt(ke.paint_heatmap["heatmap-opacity"])}),layout:pb};function Jp(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,l=t.image||new Mo({width:n,height:s}),c=(d,_,y)=>{e[t.evaluationKey]=y;const w=t.expression.evaluate(e);w&&(l.data[d+_+0]=Math.floor(255*w.r/w.a),l.data[d+_+1]=Math.floor(255*w.g/w.a),l.data[d+_+2]=Math.floor(255*w.b/w.a),l.data[d+_+3]=Math.floor(255*w.a))};if(t.clips)for(let d=0,_=0;d<s;++d,_+=4*n)for(let y=0,w=0;y<n;y++,w+=4){const E=y/(n-1),{start:A,end:I}=t.clips[d];c(_,w,A*(1-E)+I*E)}else for(let d=0,_=0;d<n;d++,_+=4)c(0,_,d/(n-1));return l}const _b=new Kn({visibility:new nt(ke.layout_hillshade.visibility)});var gb={paint:new Kn({"hillshade-illumination-direction":new nt(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nt(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nt(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nt(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nt(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nt(ke.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new nt(ke.paint_hillshade["hillshade-emissive-strength"])}),layout:_b};const by=Xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:yb}=by;function Wh(t,e,n=2){const s=e&&e.length,l=s?e[0]*n:t.length;let c=jx(t,0,l,n,!0);const d=[];if(!c||c.next===c.prev)return d;let _,y,w;if(s&&(c=function(E,A,I,z){const k=[];for(let B=0,N=A.length;B<N;B++){const W=jx(E,A[B]*z,B<N-1?A[B+1]*z:E.length,z,!1);W===W.next&&(W.steiner=!0),k.push(Tb(W))}k.sort(wb);for(let B=0;B<k.length;B++)I=Gx(k[B],I);return I}(t,e,c,n)),t.length>80*n){_=1/0,y=1/0;let E=-1/0,A=-1/0;for(let I=n;I<l;I+=n){const z=t[I],k=t[I+1];z<_&&(_=z),k<y&&(y=k),z>E&&(E=z),k>A&&(A=k)}w=Math.max(E-_,A-y),w=w!==0?32767/w:0}return Qp(c,d,n,_,y,w,0),d}function jx(t,e,n,s,l){let c;if(l===function(d,_,y,w){let E=0;for(let A=_,I=y-w;A<y;A+=w)E+=(d[I]-d[A])*(d[A+1]+d[I+1]),I=A;return E}(t,e,n,s)>0)for(let d=e;d<n;d+=s)c=$x(d/s|0,t[d],t[d+1],c);else for(let d=n-s;d>=e;d-=s)c=$x(d/s|0,t[d],t[d+1],c);return c&&p_(c,c.next)&&(gl(c),c=c.next),c}function $h(t,e){if(!t)return t;e||(e=t);let n,s=t;do if(n=!1,s.steiner||!p_(s,s.next)&&li(s.prev,s,s.next)!==0)s=s.next;else{if(gl(s),s=e=s.prev,s===s.next)break;n=!0}while(n||s!==e);return e}function Qp(t,e,n,s,l,c,d){if(!t)return;!d&&c&&function(y,w,E,A){let I=y;do I.z===0&&(I.z=Ty(I.x,I.y,w,E,A)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==y);I.prevZ.nextZ=null,I.prevZ=null,function(z){let k,B=1;do{let N,W=z;z=null;let ee=null;for(k=0;W;){k++;let te=W,ne=0;for(let de=0;de<B&&(ne++,te=te.nextZ,te);de++);let me=B;for(;ne>0||me>0&&te;)ne!==0&&(me===0||!te||W.z<=te.z)?(N=W,W=W.nextZ,ne--):(N=te,te=te.nextZ,me--),ee?ee.nextZ=N:z=N,N.prevZ=ee,ee=N;W=te}ee.nextZ=null,B*=2}while(k>1)}(I)}(t,s,l,c);let _=t;for(;t.prev!==t.next;){const y=t.prev,w=t.next;if(c?lo(t,s,l,c):Ki(t))e.push(y.i,t.i,w.i),gl(t),t=w.next,_=w.next;else if((t=w)===_){d?d===1?Qp(t=xb($h(t),e),e,n,s,l,c,2):d===2&&vb(t,e,n,s,l,c):Qp($h(t),e,n,s,l,c,1);break}}}function Ki(t){const e=t.prev,n=t,s=t.next;if(li(e,n,s)>=0)return!1;const l=e.x,c=n.x,d=s.x,_=e.y,y=n.y,w=s.y,E=l<c?l<d?l:d:c<d?c:d,A=_<y?_<w?_:w:y<w?y:w,I=l>c?l>d?l:d:c>d?c:d,z=_>y?_>w?_:w:y>w?y:w;let k=s.next;for(;k!==e;){if(k.x>=E&&k.x<=I&&k.y>=A&&k.y<=z&&qh(l,_,c,y,d,w,k.x,k.y)&&li(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function lo(t,e,n,s){const l=t.prev,c=t,d=t.next;if(li(l,c,d)>=0)return!1;const _=l.x,y=c.x,w=d.x,E=l.y,A=c.y,I=d.y,z=_<y?_<w?_:w:y<w?y:w,k=E<A?E<I?E:I:A<I?A:I,B=_>y?_>w?_:w:y>w?y:w,N=E>A?E>I?E:I:A>I?A:I,W=Ty(z,k,e,n,s),ee=Ty(B,N,e,n,s);let te=t.prevZ,ne=t.nextZ;for(;te&&te.z>=W&&ne&&ne.z<=ee;){if(te.x>=z&&te.x<=B&&te.y>=k&&te.y<=N&&te!==l&&te!==d&&qh(_,E,y,A,w,I,te.x,te.y)&&li(te.prev,te,te.next)>=0||(te=te.prevZ,ne.x>=z&&ne.x<=B&&ne.y>=k&&ne.y<=N&&ne!==l&&ne!==d&&qh(_,E,y,A,w,I,ne.x,ne.y)&&li(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;te&&te.z>=W;){if(te.x>=z&&te.x<=B&&te.y>=k&&te.y<=N&&te!==l&&te!==d&&qh(_,E,y,A,w,I,te.x,te.y)&&li(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;ne&&ne.z<=ee;){if(ne.x>=z&&ne.x<=B&&ne.y>=k&&ne.y<=N&&ne!==l&&ne!==d&&qh(_,E,y,A,w,I,ne.x,ne.y)&&li(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function xb(t,e){let n=t;do{const s=n.prev,l=n.next.next;!p_(s,l)&&Sy(s,n,n.next,l)&&tm(s,l)&&tm(l,s)&&(e.push(s.i,n.i,l.i),gl(n),gl(n.next),n=t=l),n=n.next}while(n!==t);return $h(n)}function vb(t,e,n,s,l,c){let d=t;do{let _=d.next.next;for(;_!==d.prev;){if(d.i!==_.i&&Sb(d,_)){let y=Wx(d,_);return d=$h(d,d.next),y=$h(y,y.next),Qp(d,e,n,s,l,c,0),void Qp(y,e,n,s,l,c,0)}_=_.next}d=d.next}while(d!==t)}function wb(t,e){return t.x-e.x}function Gx(t,e){const n=function(l,c){let d=c;const _=l.x,y=l.y;let w,E=-1/0;do{if(y<=d.y&&y>=d.next.y&&d.next.y!==d.y){const B=d.x+(y-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(B<=_&&B>E&&(E=B,w=d.x<d.next.x?d:d.next,B===_))return w}d=d.next}while(d!==c);if(!w)return null;const A=w,I=w.x,z=w.y;let k=1/0;d=w;do{if(_>=d.x&&d.x>=I&&_!==d.x&&qh(y<z?_:E,y,I,z,y<z?E:_,y,d.x,d.y)){const B=Math.abs(y-d.y)/(_-d.x);tm(d,l)&&(B<k||B===k&&(d.x>w.x||d.x===w.x&&bb(w,d)))&&(w=d,k=B)}d=d.next}while(d!==A);return w}(t,e);if(!n)return e;const s=Wx(n,t);return $h(s,s.next),$h(n,n.next)}function bb(t,e){return li(t.prev,t,e.prev)<0&&li(e.next,t,t.next)<0}function Ty(t,e,n,s,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tb(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function qh(t,e,n,s,l,c,d,_){return(l-d)*(e-_)>=(t-d)*(c-_)&&(t-d)*(s-_)>=(n-d)*(e-_)&&(n-d)*(c-_)>=(l-d)*(s-_)}function Sb(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){let l=n;do{if(l.i!==n.i&&l.next.i!==n.i&&l.i!==s.i&&l.next.i!==s.i&&Sy(l,l.next,n,s))return!0;l=l.next}while(l!==n);return!1}(t,e)&&(tm(t,e)&&tm(e,t)&&function(n,s){let l=n,c=!1;const d=(n.x+s.x)/2,_=(n.y+s.y)/2;do l.y>_!=l.next.y>_&&l.next.y!==l.y&&d<(l.next.x-l.x)*(_-l.y)/(l.next.y-l.y)+l.x&&(c=!c),l=l.next;while(l!==n);return c}(t,e)&&(li(t.prev,t,e.prev)||li(t,e.prev,e))||p_(t,e)&&li(t.prev,t,t.next)>0&&li(e.prev,e,e.next)>0)}function li(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function p_(t,e){return t.x===e.x&&t.y===e.y}function Sy(t,e,n,s){const l=m_(li(t,e,n)),c=m_(li(t,e,s)),d=m_(li(n,s,t)),_=m_(li(n,s,e));return l!==c&&d!==_||!(l!==0||!em(t,n,e))||!(c!==0||!em(t,s,e))||!(d!==0||!em(n,t,s))||!(_!==0||!em(n,e,s))}function em(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function m_(t){return t>0?1:t<0?-1:0}function tm(t,e){return li(t.prev,t,t.next)<0?li(t,e,t.next)>=0&&li(t,t.prev,e)>=0:li(t,e,t.prev)<0||li(t,t.next,e)<0}function Wx(t,e){const n=Ey(t.i,t.x,t.y),s=Ey(e.i,e.x,e.y),l=t.next,c=e.prev;return t.next=e,e.prev=t,n.next=l,l.prev=n,s.next=n,n.prev=s,c.next=s,s.prev=c,s}function $x(t,e,n,s){const l=Ey(t,e,n);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function gl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ey(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function __(t,e){const n=t.length;if(n<=1)return[t];const s=[];let l,c;for(let d=0;d<n;d++){const _=Di(t[d]);_!==0&&(t[d].area=Math.abs(_),c===void 0&&(c=_<0),c===_<0?(l&&s.push(l),l=[t[d]]):l.push(t[d]))}if(l&&s.push(l),e>1)for(let d=0;d<s.length;d++)s[d].length<=e||(Pg(s[d],e,1,s[d].length-1,Eb),s[d]=s[d].slice(0,e));return s}function Eb(t,e){return e.area-t.area}function Cy(t,e,n){const s=n.patternDependencies;let l=!1;for(const c of e){const d=c.paint.get(`${t}-pattern`);d.isConstant()||(l=!0);const _=d.constantOr(null);_&&(l=!0,s[_]=!0)}return l}function Ay(t,e,n,s,l){const c=l.patternDependencies;for(const d of e){const _=d.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let y=_.evaluate({zoom:s},n,{},l.availableImages);y=y&&y.name?y.name:y,c[y]=!0,n.patterns[d.id]=y}}return n}class nm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yo,this.indexArray=new Si,this.indexArray2=new Pc,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Lr,this.segments2=new Lr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,s,l){this.hasPattern=Cy("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:_,id:y,index:w,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,I=uu(_,A);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),I,s))continue;const z=c?c.evaluate(I,{},s,n.availableImages):void 0,k={id:y,properties:_.properties,type:_.type,sourceLayerIndex:E,index:w,geometry:A?I.geometry:Ra(_,s,l),patterns:{},sortKey:z};d.push(k)}c&&d.sort((_,y)=>_.sortKey-y.sortKey);for(const _ of d){const{geometry:y,index:w,sourceLayerIndex:E}=_;if(this.hasPattern){const A=Ay("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(A)}else this.addFeature(_,y,w,s,{},n.availableImages,n.brightness);n.featureIndex.insert(e[w].feature,y,w,E,this.index)}}update(e,n,s,l,c){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,d?this.stateDependentLayers:this.layers,s,l,c)}addFeatures(e,n,s,l,c,d){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,s,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,l,c,d=[],_){for(const y of __(n,500)){let w=0;for(const B of y)w+=B.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),A=E.vertexLength,I=[],z=[];for(const B of y){if(B.length===0)continue;B!==y[0]&&z.push(I.length/2);const N=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),W=N.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(W+B.length-1,W),I.push(B[0].x),I.push(B[0].y);for(let ee=1;ee<B.length;ee++)this.layoutVertexArray.emplaceBack(B[ee].x,B[ee].y),this.indexArray2.emplaceBack(W+ee-1,W+ee),I.push(B[ee].x),I.push(B[ee].y);N.vertexLength+=B.length,N.primitiveLength+=B.length}const k=Wh(I,z);for(let B=0;B<k.length;B+=3)this.indexArray.emplaceBack(A+k[B],A+k[B+1],A+k[B+2]);E.vertexLength+=w,E.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,c,d,l,_)}}se(nm,"FillBucket",{omit:["layers","patternFeatures"]});const qx=new Kn({"fill-sort-key":new At(ke.layout_fill["fill-sort-key"]),visibility:new nt(ke.layout_fill.visibility)});var Cb={paint:new Kn({"fill-antialias":new nt(ke.paint_fill["fill-antialias"]),"fill-opacity":new At(ke.paint_fill["fill-opacity"]),"fill-color":new At(ke.paint_fill["fill-color"]),"fill-outline-color":new At(ke.paint_fill["fill-outline-color"]),"fill-translate":new nt(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new nt(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new At(ke.paint_fill["fill-pattern"]),"fill-emissive-strength":new nt(ke.paint_fill["fill-emissive-strength"])}),layout:qx};class My{constructor(e,n,s,l){if(this.triangleCount=n.length/3,this.min=new lt(0,0),this.max=new lt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[c,d]=[e[0].clone(),e[0].clone()];for(let A=1;A<e.length;++A){const I=e[A];c.x=Math.min(c.x,I.x),c.y=Math.min(c.y,I.y),d.x=Math.max(d.x,I.x),d.y=Math.max(d.y,I.y)}if(l){const A=Math.ceil(Math.max(d.x-c.x,d.y-c.y)/l);s=Math.max(s,A)}if(s===0)return;this.min=c,this.max=d;const _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);const y=Math.max(_.x,_.y)/s;this.cellsX=Math.max(1,Math.ceil(_.x/y)),this.cellsY=Math.max(1,Math.ceil(_.y/y)),this.xScale=1/y,this.yScale=1/y;const w=[];for(let A=0;A<this.triangleCount;A++){const I=e[n[3*A+0]].sub(this.min),z=e[n[3*A+1]].sub(this.min),k=e[n[3*A+2]].sub(this.min),B=yl(Math.floor(Math.min(I.x,z.x,k.x)),this.xScale,this.cellsX),N=yl(Math.floor(Math.max(I.x,z.x,k.x)),this.xScale,this.cellsX),W=yl(Math.floor(Math.min(I.y,z.y,k.y)),this.yScale,this.cellsY),ee=yl(Math.floor(Math.max(I.y,z.y,k.y)),this.yScale,this.cellsY),te=new lt(0,0),ne=new lt(0,0),me=new lt(0,0),de=new lt(0,0);for(let be=W;be<=ee;++be){te.y=ne.y=be*y,me.y=de.y=(be+1)*y;for(let Ae=B;Ae<=N;++Ae)te.x=me.x=Ae*y,ne.x=de.x=(Ae+1)*y,(dy(I,z,k,te,ne,de)||dy(I,z,k,te,de,me))&&w.push({cellIdx:be*this.cellsX+Ae,triIdx:A})}}if(w.length===0)return;w.sort((A,I)=>A.cellIdx-I.cellIdx||A.triIdx-I.triIdx);let E=0;for(;E<w.length;){const A=w[E].cellIdx,I={start:this.payload.length,len:0};for(;E<w.length&&w[E].cellIdx===A;)++I.len,this.payload.push(w[E++].triIdx);this.cells[A]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=yl(e.x-this.min.x,this.xScale,this.cellsX),l=yl(e.y-this.min.y,this.yScale,this.cellsY),c=this.cells[l*this.cellsX+s];if(c){this._lazyInitLookup();for(let d=0;d<c.len;d++){const _=this.payload[c.start+d],y=Math.floor(_/8),w=1<<_%8;if(!(this.lookup[y]&w)&&(this.lookup[y]|=w,n.push(_),n.length===this.triangleCount))return}}}query(e,n,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const l=yl(e.x-this.min.x,this.xScale,this.cellsX),c=yl(n.x-this.min.x,this.xScale,this.cellsX),d=yl(e.y-this.min.y,this.yScale,this.cellsY),_=yl(n.y-this.min.y,this.yScale,this.cellsY);for(let y=d;y<=_;y++)for(let w=l;w<=c;w++){const E=this.cells[y*this.cellsX+w];if(E)for(let A=0;A<E.len;A++){const I=this.payload[E.start+A],z=Math.floor(I/8),k=1<<I%8;if(!(this.lookup[z]&k)&&(this.lookup[z]|=k,s.push(I),s.length===this.triangleCount))return}}}}function yl(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}se(My,"TriangleGridIndex");class Hx{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(const s of this.footprints)n.push({footprint:s,id:e})}populate(e,n,s,l){const c=[];for(const{feature:d,id:_,index:y,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,A=uu(d,E);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),A,s))continue;const I={id:_,properties:d.properties,type:d.type,sourceLayerIndex:w,index:y,geometry:E?A.geometry:Ra(d,s,l),patterns:{}};c.push(I)}for(const d of c){const{geometry:_,index:y,sourceLayerIndex:w}=d;this.addFeature(d,_,y,s,{},n.availableImages,n.brightness),n.featureIndex.insert(e[y].feature,_,y,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,s,l,c){}destroy(){}addFeature(e,n,s,l,c,d=[],_){for(const y of __(n,2)){const w=[],E=[],A=[],I=new lt(1/0,1/0),z=new lt(-1/0,-1/0);for(const N of y)if(N.length!==0){N!==y[0]&&A.push(E.length/2);for(let W=0;W<N.length;W++)E.push(N[W].x),E.push(N[W].y),w.push(N[W]),I.x=Math.min(I.x,N[W].x),I.y=Math.min(I.y,N[W].y),z.x=Math.max(z.x,N[W].x),z.y=Math.max(z.y,N[W].y)}const k=Wh(E,A),B=new My(w,k,8,256);this.footprints.push({vertices:w,indices:k,grid:B,min:I,max:z})}}}se(Hx,"ClipBucket",{omit:["layers"]});const Ab=new Kn({"clip-layer-types":new nt(ke.layout_clip["clip-layer-types"])});var Mb={paint:new Kn({}),layout:Ab};const Ib=Xn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Pb=Xn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Rb=Xn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Lb=Xn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Db=Xn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:zb}=Ib;var g_={},kb=vd,Zx=df;function df(t,e,n,s,l){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=l,t.readFields(Ob,this,e)}function Ob(t,e,n){t==1?e.id=n.readVarint():t==2?function(s,l){for(var c=s.readVarint()+s.pos;s.pos<c;){var d=l._keys[s.readVarint()],_=l._values[s.readVarint()];l.properties[d]=_}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function Bb(t){for(var e,n,s=0,l=0,c=t.length,d=c-1;l<c;d=l++)s+=((n=t[d]).x-(e=t[l]).x)*(e.y+n.y);return s}df.types=["Unknown","Point","LineString","Polygon"],df.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,l=0,c=0,d=0,_=[];t.pos<n;){if(l<=0){var y=t.readVarint();s=7&y,l=y>>3}if(l--,s===1||s===2)c+=t.readSVarint(),d+=t.readSVarint(),s===1&&(e&&_.push(e),e=[]),e.push(new kb(c,d));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&_.push(e),_},df.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,l=0,c=0,d=1/0,_=-1/0,y=1/0,w=-1/0;t.pos<e;){if(s<=0){var E=t.readVarint();n=7&E,s=E>>3}if(s--,n===1||n===2)(l+=t.readSVarint())<d&&(d=l),l>_&&(_=l),(c+=t.readSVarint())<y&&(y=c),c>w&&(w=c);else if(n!==7)throw new Error("unknown command "+n)}return[d,y,_,w]},df.prototype.toGeoJSON=function(t,e,n){var s,l,c=this.extent*Math.pow(2,n),d=this.extent*t,_=this.extent*e,y=this.loadGeometry(),w=df.types[this.type];function E(z){for(var k=0;k<z.length;k++){var B=z[k];z[k]=[360*(B.x+d)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+_)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(s=0;s<y.length;s++)A[s]=y[s][0];E(y=A);break;case 2:for(s=0;s<y.length;s++)E(y[s]);break;case 3:for(y=function(z){var k=z.length;if(k<=1)return[z];for(var B,N,W=[],ee=0;ee<k;ee++){var te=Bb(z[ee]);te!==0&&(N===void 0&&(N=te<0),N===te<0?(B&&W.push(B),B=[z[ee]]):B.push(z[ee]))}return B&&W.push(B),W}(y),s=0;s<y.length;s++)for(l=0;l<y[s].length;l++)E(y[s][l])}y.length===1?y=y[0]:w="Multi"+w;var I={type:"Feature",geometry:{type:w,coordinates:y},properties:this.properties};return"id"in this&&(I.id=this.id),I};var Fb=Zx,Xx=Yx;function Yx(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Nb,this,e),this.length=this._features.length}function Nb(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(s){for(var l=null,c=s.readVarint()+s.pos;s.pos<c;){var d=s.readVarint()>>3;l=d===1?s.readString():d===2?s.readFloat():d===3?s.readDouble():d===4?s.readVarint64():d===5?s.readVarint():d===6?s.readSVarint():d===7?s.readBoolean():null}return l}(n))}Yx.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Fb(this._pbf,e,this.extent,this._keys,this._values)};var Vb=Xx;function Ub(t,e,n){if(t===3){var s=new Vb(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var Iy=g_.VectorTile=function(t,e){this.layers=t.readFields(Ub,{},e)},ff=g_.VectorTileFeature=Zx;g_.VectorTileLayer=Xx;class Oc extends lt{constructor(e,n,s){super(e,n),this.z=s}}class Py extends Oc{constructor(e,n,s,l){super(e,n,s),this.w=l}}function y_(t,e,n,s){const l=[],c=s===0?(d,_,y,w,E,A)=>{d.push(new lt(A,y+(A-_)/(w-_)*(E-y)))}:(d,_,y,w,E,A)=>{d.push(new lt(_+(A-y)/(E-y)*(w-_),A))};for(const d of t){const _=[];for(const y of d){if(y.length<=2)continue;const w=[];for(let I=0;I<y.length-1;I++){const z=y[I].x,k=y[I].y,B=y[I+1].x,N=y[I+1].y,W=s===0?z:k,ee=s===0?B:N;W<e?ee>e&&c(w,z,k,B,N,e):W>n?ee<n&&c(w,z,k,B,N,n):w.push(y[I]),ee<e&&W>=e&&c(w,z,k,B,N,e),ee>n&&W<=n&&c(w,z,k,B,N,n)}let E=y[y.length-1];const A=s===0?E.x:E.y;A>=e&&A<=n&&w.push(E),w.length&&(E=w[w.length-1],w[0].x===E.x&&w[0].y===E.y||w.push(w[0]),_.push(w))}_.length&&l.push(_)}return l}function Kx(t,e,n,s){const l=n==="x"?"y":"x",c=(s-t[n])/(e[n]-t[n]);t[l]=t[l]+(e[l]-t[l])*c,t[n]=s,t.hasOwnProperty("z")&&(t.z=Ht(t.z,e.z,c)),t.hasOwnProperty("w")&&(t.w=Ht(t.w,e.w,c))}function Jx(t,e,n,s){const l=n,c=s;for(const d of["x","y"]){let _=t,y=e;_[d]>=y[d]&&(_=e,y=t),_[d]<l&&y[d]>l&&Kx(_,y,d,l),_[d]<c&&y[d]>c&&Kx(y,_,d,c)}}function pf(t,e){return t.x-e.x||t.y-e.y}function Qx(t,e){return pf(t.min,e.min)===0&&pf(t.max,e.max)===0}function Ry(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Ly(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n].sourceId!==e[n].sourceId||!Qx(t[n],e[n])||t[n].order!==e[n].order||t[n].clipMask!==e[n].clipMask)return!1;return!0}function $s(t,e,n){const s=1/xt,l=1/(1<<n.canonical.z),c=(e.x*s+n.canonical.x)*l+n.wrap,d=(e.y*s+n.canonical.y)*l;return{min:new lt((t.x*s+n.canonical.x)*l+n.wrap,(t.y*s+n.canonical.y)*l),max:new lt(c,d)}}function Dy(t,e,n){const s=1<<n.canonical.z,l=((e.x-n.wrap)*s-n.canonical.x)*xt,c=(e.y*s-n.canonical.y)*xt;return{min:new lt(((t.x-n.wrap)*s-n.canonical.x)*xt,(t.y*s-n.canonical.y)*xt),max:new lt(l,c)}}function e1(t,e,n,s,l,c,d){const _=t.indices,y=t.vertices,w=[];for(let E=s;E<s+l;E+=3){const A=e[n[E+0]+c],I=e[n[E+1]+c],z=e[n[E+2]+c],k=Math.min(A.x,I.x,z.x),B=Math.max(A.x,I.x,z.x),N=Math.min(A.y,I.y,z.y),W=Math.max(A.y,I.y,z.y);w.length=0,t.grid.query(new lt(k,N),new lt(B,W),w);for(let ee=0;ee<w.length;ee++){const te=w[ee];if(dy(y[_[3*te+0]],y[_[3*te+1]],y[_[3*te+2]],A,I,z,d))return!0}}return!1}function t1(t,e,n,s){if(!t||!n)return!1;let l=t.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(n.vertices.length<t.vertices.length)return t1(n,s,t,e);const c=e.canonical,d=s.canonical,_=Math.pow(2,d.z-c.z);l=t.vertices.map(y=>new lt((y.x+c.x*xt)*_-d.x*xt,(y.y+c.y*xt)*_-d.y*xt))}return e1(n,l,t.indices,0,t.indices.length,0,0)}function n1(t,e,n,s){const l=Math.pow(2,s.z-n.z);return new lt((t+n.x*xt)*l-s.x*xt,(e+n.y*xt)*l-s.y*xt)}function r1(t,e){const n=[];e.footprint.grid.queryPoint(t,n);const s=e.footprint.indices,l=e.footprint.vertices;for(let c=0;c<n.length;c++){const d=n[c];if(zc([l[s[3*d+0]],l[s[3*d+1]],l[s[3*d+2]]],t))return!0}return!1}class x_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function i1(t,e,n,s){let l=0,c=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(s[d])<1e-15){if(n[d]<t[d]||n[d]>e[d])return null}else{const _=1/s[d];let y=(t[d]-n[d])*_,w=(e[d]-n[d])*_;if(y>w){const E=y;y=w,w=E}if(y>l&&(l=y),w<c&&(c=w),l>c)return null}return l}function v_(t,e,n,s,l,c,d,_,y,w,E){const A=s-t,I=l-e,z=c-n,k=d-t,B=_-e,N=y-n,W=E[1]*N-E[2]*B,ee=E[2]*k-E[0]*N,te=E[0]*B-E[1]*k,ne=A*W+I*ee+z*te;if(Math.abs(ne)<1e-15)return null;const me=1/ne,de=w[0]-t,be=w[1]-e,Ae=w[2]-n,ze=(de*W+be*ee+Ae*te)*me;if(ze<0||ze>1)return null;const $e=be*z-Ae*I,Ve=Ae*A-de*z,Je=de*I-be*A,ht=(E[0]*$e+E[1]*Ve+E[2]*Je)*me;return ht<0||ze+ht>1?null:(k*$e+B*Ve+N*Je)*me}function s1(t,e,n){return(t-e)/(n-e)}function o1(t,e,n,s,l,c,d,_,y){const w=1<<n,E=c-s,A=d-l,I=(t+1)/w*E+s,z=(e+0)/w*A+l,k=(e+1)/w*A+l;_[0]=(t+0)/w*E+s,_[1]=z,y[0]=I,y[1]=k}class a1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(c){const d=Math.ceil(Math.log2(c.dim/8)),_=[];let y=Math.ceil(Math.pow(2,d));const w=1/y,E=(z,k,B,N,W)=>{const ee=N?1:0,te=(z+1)*B-ee,ne=k*B,me=(k+1)*B-ee;W[0]=z*B,W[1]=ne,W[2]=te,W[3]=me};let A=new x_(y);const I=[];for(let z=0;z<y*y;z++){E(z%y,Math.floor(z/y),w,!1,I);const k=fu(I[0],I[1],c),B=fu(I[2],I[1],c),N=fu(I[2],I[3],c),W=fu(I[0],I[3],c);A.minimums.push(Math.min(k,B,N,W)),A.maximums.push(Math.max(k,B,N,W)),A.leaves.push(1)}for(_.push(A),y/=2;y>=1;y/=2){const z=_[_.length-1];A=new x_(y);for(let k=0;k<y*y;k++){E(k%y,Math.floor(k/y),2,!0,I);const B=z.getElevation(I[0],I[1]),N=z.getElevation(I[2],I[1]),W=z.getElevation(I[2],I[3]),ee=z.getElevation(I[0],I[3]),te=z.isLeaf(I[0],I[1]),ne=z.isLeaf(I[2],I[1]),me=z.isLeaf(I[2],I[3]),de=z.isLeaf(I[0],I[3]),be=Math.min(B.min,N.min,W.min,ee.min),Ae=Math.max(B.max,N.max,W.max,ee.max),ze=te&&ne&&me&&de;A.maximums.push(Ae),A.minimums.push(be),A.leaves.push(Ae-be<=5&&ze?1:0)}_.push(A)}return _}(this.dem),s=n.length-1,l=n[s];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,l,c,d,_=1){return i1([e,n,-100],[s,l,this.maximums[0]*_],c,d)}raycast(e,n,s,l,c,d,_=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,n,s,l,c,d,_);if(y==null)return null;const w=[],E=[],A=[],I=[],z=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:k,t:B,nodex:N,nodey:W,depth:ee}=z.pop();if(this.leaves[k]){o1(N,W,ee,e,n,s,l,A,I);const ne=1<<ee,me=(N+0)/ne,de=(N+1)/ne,be=(W+0)/ne,Ae=(W+1)/ne,ze=fu(me,be,this.dem)*_,$e=fu(de,be,this.dem)*_,Ve=fu(de,Ae,this.dem)*_,Je=fu(me,Ae,this.dem)*_,ht=v_(A[0],A[1],ze,I[0],A[1],$e,I[0],I[1],Ve,c,d),Ye=v_(I[0],I[1],Ve,A[0],I[1],Je,A[0],A[1],ze,c,d),it=Math.min(ht!==null?ht:Number.MAX_VALUE,Ye!==null?Ye:Number.MAX_VALUE);if(it!==Number.MAX_VALUE)return it;{const qe=o._.scaleAndAdd([],c,d,B);if(l1(ze,$e,Je,Ve,s1(qe[0],A[0],I[0]),s1(qe[1],A[1],I[1]))>=qe[2])return B}continue}let te=0;for(let ne=0;ne<this._siblingOffset.length;ne++){o1((N<<1)+this._siblingOffset[ne][0],(W<<1)+this._siblingOffset[ne][1],ee+1,e,n,s,l,A,I),A[2]=-100,I[2]=this.maximums[this.childOffsets[k]+ne]*_;const me=i1(A,I,c,d);if(me!=null){const de=me;w[ne]=de;let be=!1;for(let Ae=0;Ae<te&&!be;Ae++)de>=w[E[Ae]]&&(E.splice(Ae,0,ne),be=!0);be||(E[te]=ne),te++}}for(let ne=0;ne<te;ne++){const me=E[ne];z.push({idx:this.childOffsets[k]+me,t:w[me],nodex:(N<<1)+this._siblingOffset[me][0],nodey:(W<<1)+this._siblingOffset[me][1],depth:ee+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,l,c){if(e[l].isLeaf(n,s)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const d=l-1,_=e[d];let y=0,w=0;for(let E=0;E<this._siblingOffset.length;E++){const A=2*n+this._siblingOffset[E][0],I=2*s+this._siblingOffset[E][1],z=_.getElevation(A,I),k=_.isLeaf(A,I),B=this._addNode(z.min,z.max,k);k&&(y|=1<<E),w||(w=B)}for(let E=0;E<this._siblingOffset.length;E++)y&1<<E||this._construct(e,2*n+this._siblingOffset[E][0],2*s+this._siblingOffset[E][1],d,w+E)}}function l1(t,e,n,s,l,c){return Ht(Ht(t,n,c),Ht(e,s,c),l)}function fu(t,e,n){const s=n.dim,l=Xt(t*s-.5,0,s-1),c=Xt(e*s-.5,0,s-1),d=Math.floor(l),_=Math.floor(c),y=Math.min(d+1,s-1),w=Math.min(_+1,s-1);return l1(n.get(d,_),n.get(y,_),n.get(d,w),n.get(y,w),l-d,c-_)}const jb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Gb(t,e,n){return(256*t*256+256*e+n)/10-1e4}function Wb(t,e,n){return 256*t+e+n/256-32768}class mf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,l=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return xr(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const c=this.dim=n.height-2,d=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let y=0;y<c;y++)d[this._idx(-1,y)]=d[this._idx(0,y)],d[this._idx(c,y)]=d[this._idx(c-1,y)],d[this._idx(y,-1)]=d[this._idx(y,0)],d[this._idx(y,c)]=d[this._idx(y,c-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(c,-1)]=d[this._idx(c-1,0)],d[this._idx(-1,c)]=d[this._idx(0,c-1)],d[this._idx(c,c)]=d[this._idx(c-1,c-1)]}const _=s==="terrarium"?Wb:Gb;for(let y=0;y<d.length;++y){const w=4*y;this.floatView[y]=_(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=zi.now()}_buildQuadTree(){this._tree=new a1(this)}get(e,n,s=!1){s&&(e=Xt(e,-1,this.dim),n=Xt(n,-1,this.dim));const l=this._idx(e,n);return this.floatView[l]}set(e,n,s){const l=this._idx(e,n),c=this.floatView[l];return this.floatView[l]=s,s-c}static getUnpackVector(e){return jb[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const s=[0,0,0,0],l=mf.getUnpackVector(n);let c=Math.floor((e+l[3])/l[2]);return s[2]=c%256,c=Math.floor(c/256),s[1]=c%256,c=Math.floor(c/256),s[0]=c,s}getPixels(){return new Ux({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=n*this.dim,c=n*this.dim+this.dim,d=s*this.dim,_=s*this.dim+this.dim;switch(n){case-1:l=c-1;break;case 1:c=l+1}switch(s){case-1:d=_-1;break;case 1:_=d+1}const y=-n*this.dim,w=-s*this.dim;for(let E=d;E<_;E++)for(let A=l;A<c;A++){const I=4*this._idx(A,E),z=4*this._idx(A+y,E+w);this.pixels[I+0]=e.pixels[z+0],this.pixels[I+1]=e.pixels[z+1],this.pixels[I+2]=e.pixels[z+2],this.pixels[I+3]=e.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}se(mf,"DEMData"),se(a1,"DemMinMaxQuadTree",{omit:["dem"]});class Bc{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const l=s||e.findDEMTileFor(n);if(!l||!l.dem)return;const c=l.dem,d=l.tileID,_=1<<n.canonical.z-d.canonical.z;return new Bc(l,c.dim/xt/_,[(n.canonical.x/_-d.canonical.x)*c.dim,(n.canonical.y/_-d.canonical.y)*c.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(s);return new lt(l,c)}getElevationAt(e,n,s,l){const c=e*this._scale+this._offset[0],d=n*this._scale+this._offset[1],_=Math.floor(c),y=Math.floor(d),w=this._dem;return l=!!l,s?Ht(Ht(w.get(_,y,l),w.get(_,y+1,l),d-y),Ht(w.get(_+1,y,l),w.get(_+1,y+1,l),d-y),c-_):w.get(_,y,l)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ms(1,e)*this._dem.stride}}const u1={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},$b=ff.types,qb=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Hb=["fill-extrusion-flood-light-ground-radius"],Zb=Math.pow(2,13),Xb=Math.pow(2,15)-1,c1=new lt(0,1),Fc=2147483648;function rm(t,e,n,s,l,c,d,_){t.emplaceBack((e<<1)+d,(n<<1)+c,(Math.floor(s*Zb)<<1)+l,Math.round(_))}function w_(t,e,n,s,l,c){t.emplaceBack(e.x,e.y,(n.x<<1)+s,(n.y<<1)+l,c)}function im(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class h1{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class d1{constructor(){this.centroidXY=new lt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new lt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new lt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new lt(this.max.x-this.min.x,this.max.y-this.min.y)}}class f1{constructor(){this.acc=new lt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,s){this.accCount++,this.acc._add(n);let l=!!this.borders;n.x<e.min.x?(e.min.x=n.x,l=!0):n.x>e.max.x&&(e.max.x=n.x,l=!0),n.y<e.min.y?(e.min.y=n.y,l=!0):n.y>e.max.y&&(e.max.y=n.y,l=!0),((n.x===0||n.x===xt)&&n.x===s.x)!=((n.y===0||n.y===xt)&&n.y===s.y)&&this.processBorderOverlap(n,s),l&&this.checkBorderIntersection(n,s)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Ht(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>xt!=e.x>xt&&this.addBorderIntersection(1,Ht(n.y,e.y,(xt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Ht(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>xt!=e.y>xt&&this.addBorderIntersection(3,Ht(n.x,e.x,(xt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new lt(0,0):new lt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function p1(t,e){const n=t.add(e)._unit(),s=Xt(t.x*n.x+t.y*n.y,-1,1);var l,c,d;return l=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(l)))/4*Xb*((c=t).x*(d=e).y-c.y*d.x<0?-1:1)}const Yb=[t=>t.x<0,t=>t.x>xt,t=>t.y<0,t=>t.y>xt];function Kb(t,e,n,s){const l=[4];if(s===0)return l;n._mult(s);const c=t.sub(n),d=e.sub(n),_=[t,e,c,d];for(let y=0;y<4;y++)for(const w of _)if(Yb[y](w)){l.push(y);break}return l}class m1{constructor(e){this.vertexArray=new Og,this.indexArray=new Si,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut},n=>Hb.includes(n)),this._segments=new Lr,this.hiddenByLandmarkVertexArray=new qg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Lr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,s,l=!1){const c=e.length;if(c>2){let d=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let y;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const w=e[0],E=e[1];y=p1(w.sub(e[c-1])._perp()._unit(),E.sub(w)._perp()._unit())}for(let w=0;w<c;w++){const E=w===c-1?0:w+1,A=e[w],I=e[E],z=e[E===c-1?0:E+1],k=I.sub(A)._perp()._unit(),B=p1(k,z.sub(I)._perp()._unit()),N=y,W=B;if(T(A,I,n)||l&&D(A,n)&&D(I,n)){y=B;continue}const ee=_.vertexLength;w_(this.vertexArray,A,I,1,1,N),w_(this.vertexArray,A,I,1,0,N),w_(this.vertexArray,A,I,0,1,W),w_(this.vertexArray,A,I,0,0,W),_.vertexLength+=4;const te=Kb(A,I,k,s);for(const ne of te)this._segmentToGroundQuads[d].push({id:ee,region:ne}),this._segmentToRegionTriCounts[d][ne]+=2,_.primitiveLength+=2;y=B}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let s=0;s<n;s++)this._segmentToGroundQuads[s].sort((l,c)=>l.region-c.region);for(let s=0;s<n;s++){const l=this._segmentToGroundQuads[s],c=e[s],d=this._segmentToRegionTriCounts[s];d.reduce((y,w)=>y+w,0);let _=0;for(let y=0;y<=4;y++){const w=d[y];if(w!==0){let E=this.regionSegments[y];E||(E=this.regionSegments[y]=new Lr);const A={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+_,vertexLength:c.vertexLength,primitiveLength:w};E.get().push(A)}_+=w}for(let y=0;y<l.length;y++){const w=l[y].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,s,l,c,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,s,l,c,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Pb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,s,l,c,d){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,s,l,c,d)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&Fc?1:0;for(let l=e.groundVertexArrayOffset;l<n;++l)this.hiddenByLandmarkVertexArray.emplace(l,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Lb.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class b_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Si,this.footprintVertices=new Yo,this.footprintSegments=[],this.layoutVertexArray=new so,this.centroidVertexArray=new mx,this.indexArray=new Si,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut},n=>qb.includes(n)),this.segments=new Lr,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new m1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,s,l){this.features=[],this.hasPattern=Cy("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=$p(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:d,index:_,sourceLayerIndex:y}of e){const w=this.layers[0]._featureFilter.needGeometry,E=uu(c,w);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),E,s))continue;const A={id:d,sourceLayerIndex:y,index:_,geometry:w?E.geometry:Ra(c,s,l),properties:c.properties,type:c.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ay("fill-extrusion",this.layers,A,this.zoom,n)):this.addFeature(A,A.geometry,_,s,{},n.availableImages,l,n.brightness),n.featureIndex.insert(c,A.geometry,_,y,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,s,l,c,d){for(const _ of this.features){const{geometry:y}=_;this.addFeature(_,y,_.index,n,s,l,c,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,s,l,c){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const _=d?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,_,s,l,c),this.groundEffect.update(e,n,_,s,l,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Db.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Rb.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,l,c,d,_,y){const w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new lt(0,0),new lt(xt,xt)],A=_.projection,I=A.name==="globe",z=$b[e.type]==="Polygon",k=new f1;k.centroidDataIndex=this.centroidData.length;const B=new d1,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);B.height=W,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new n_);const ee=__(n,500);for(let Ae=ee.length-1;Ae>=0;Ae--){const ze=ee[Ae];(ze.length===0||(te=ze[0]).every($e=>$e.x<=0)||te.every($e=>$e.x>=xt)||te.every($e=>$e.y<=0)||te.every($e=>$e.y>=xt))&&ee.splice(Ae,1)}var te;let ne;if(I)ne=Le(ee,E,l);else{ne=[];for(const Ae of ee)ne.push({polygon:Ae,bounds:E})}const me=z?this.edgeRadius:0,de=me>0&&this.zoom<17,be=(Ae,ze)=>{if(Ae.length===0)return!1;const $e=Ae[Ae.length-1];return ze.x===$e.x&&ze.y===$e.y};for(const{polygon:Ae,bounds:ze}of ne){let $e=0,Ve=0;for(const it of Ae)z&&!it[0].equals(it[it.length-1])&&it.push(it[0]),Ve+=z?it.length-1:it.length;const Je=this.segments.prepareSegment((z?5:4)*Ve,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);const ht={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ye=new h1;if(Ye.vertexOffset=this.footprintVertices.length,Ye.indexOffset=3*this.footprintIndices.length,Ye.ringIndices=[],z){const it=[],qe=[];$e=Je.vertexLength;for(let mt=0;mt<Ae.length;mt++){const ut=Ae[mt];ut.length&&mt!==0&&qe.push(it.length/2);const Lt=[];let dt,yt;dt=ut[1].sub(ut[0])._perp()._unit(),Ye.ringIndices.push(ut.length-1);for(let Wt=1;Wt<ut.length;Wt++){const jt=ut[Wt],Ut=ut[Wt===ut.length-1?1:Wt+1],_t=jt.clone();if(me){yt=Ut.sub(jt)._perp()._unit();const qt=dt.add(yt)._unit(),pn=me*Math.min(4,1/(dt.x*qt.x+dt.y*qt.y));_t.x+=pn*qt.x,_t.y+=pn*qt.y,_t.x=Math.round(_t.x),_t.y=Math.round(_t.y),dt=yt}!N||me!==0&&!de||be(Lt,_t)||Lt.push(_t),rm(this.layoutVertexArray,_t.x,_t.y,0,0,1,1,0),Je.vertexLength++,this.footprintVertices.emplaceBack(jt.x,jt.y),it.push(jt.x,jt.y),I&&im(this.layoutVertexExtArray,A.projectTilePoint(_t.x,_t.y,l),A.upVector(l,_t.x,_t.y))}N&&(me===0||de)&&(Lt.length!==0&&be(Lt,Lt[0])&&Lt.pop(),this.groundEffect.addData(Lt,ze,w))}const st=Wh(it,qe);for(let mt=0;mt<st.length;mt+=3)this.footprintIndices.emplaceBack(Ye.vertexOffset+st[mt+0],Ye.vertexOffset+st[mt+1],Ye.vertexOffset+st[mt+2]),this.indexArray.emplaceBack($e+st[mt],$e+st[mt+2],$e+st[mt+1]),Je.primitiveLength++;Ye.indexCount+=st.length,Ye.vertexCount+=this.footprintVertices.length-Ye.vertexOffset}for(let it=0;it<Ae.length;it++){const qe=Ae[it];k.startRing(B,qe[0]);let st=qe.length>4&&G(qe[qe.length-2],qe[0],qe[1]),mt=me?Jb(qe[qe.length-2],qe[0],qe[1],me):0;const ut=[];let Lt,dt,yt;dt=qe[1].sub(qe[0])._perp()._unit();let Wt=!0;for(let jt=1,Ut=0;jt<qe.length;jt++){let _t=qe[jt-1],qt=qe[jt];const pn=qe[jt===qe.length-1?1:jt+1];if(k.appendEdge(B,qt,_t),T(qt,_t,ze)){me&&(dt=pn.sub(qt)._perp()._unit(),Wt=!Wt);continue}const nn=qt.sub(_t)._perp(),vn=nn.x/(Math.abs(nn.x)+Math.abs(nn.y)),mn=nn.y>0?1:0,Pn=_t.dist(qt);if(Ut+Pn>32768&&(Ut=0),me){yt=pn.sub(qt)._perp()._unit();let Jn=g(_t,qt,pn,_1(dt,yt),me);isNaN(Jn)&&(Jn=0);const qn=qt.sub(_t)._unit();_t=_t.add(qn.mult(mt))._round(),qt=qt.add(qn.mult(-Jn))._round(),mt=Jn,dt=yt,N&&this.zoom>=17&&(be(ut,_t)||ut.push(_t),be(ut,qt)||ut.push(qt))}const Jt=Je.vertexLength,hr=qe.length>4&&G(_t,qt,pn);let cr=re(Ut,st,Wt);if(rm(this.layoutVertexArray,_t.x,_t.y,vn,mn,0,0,cr),rm(this.layoutVertexArray,_t.x,_t.y,vn,mn,0,1,cr),Ut+=Pn,cr=re(Ut,hr,!Wt),st=hr,rm(this.layoutVertexArray,qt.x,qt.y,vn,mn,0,0,cr),rm(this.layoutVertexArray,qt.x,qt.y,vn,mn,0,1,cr),Je.vertexLength+=4,this.indexArray.emplaceBack(Jt+0,Jt+1,Jt+2),this.indexArray.emplaceBack(Jt+1,Jt+3,Jt+2),Je.primitiveLength+=2,me){const Jn=$e+(jt===1?qe.length-2:jt-2),qn=jt===1?$e:Jn+1;if(this.indexArray.emplaceBack(Jt+1,Jn,Jt+3),this.indexArray.emplaceBack(Jn,qn,Jt+3),Je.primitiveLength+=2,Lt===void 0&&(Lt=Jt),!T(pn,qe[jt],ze)){const Qn=jt===qe.length-1?Lt:Je.vertexLength;this.indexArray.emplaceBack(Jt+2,Jt+3,Qn),this.indexArray.emplaceBack(Jt+3,Qn+1,Qn),this.indexArray.emplaceBack(Jt+3,qn,Qn+1),Je.primitiveLength+=3}Wt=!Wt}if(I){const Jn=this.layoutVertexExtArray,qn=A.projectTilePoint(_t.x,_t.y,l),Qn=A.projectTilePoint(qt.x,qt.y,l),Cr=A.upVector(l,_t.x,_t.y),gr=A.upVector(l,qt.x,qt.y);im(Jn,qn,Cr),im(Jn,qn,Cr),im(Jn,Qn,gr),im(Jn,Qn,gr)}}z&&($e+=qe.length-1),N&&me&&this.zoom>=17&&(ut.length!==0&&be(ut,ut[0])&&ut.pop(),this.groundEffect.addData(ut,ze,w,me>0))}this.footprintSegments.push(Ye),ht.triangleCount=this.indexArray.length-ht.triangleArrayOffset,this.polygonSegments.push(ht),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=k.borders?c1:this.encodeCentroid(k,B),this.centroidData.push(B),k.borders){this.featuresOnBorder.push(k);const Ae=this.featuresOnBorder.length-1;for(let ze=0;ze<k.borders.length;ze++)k.borders[ze][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ze].push(Ae)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,c,d,l,y),this.groundEffect.addPaintPropertiesData(e,s,c,d,l,y),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let _=0;_<this.centroidData.length;_++){const y=this.centroidData[_],w=+(y.min.y+y.max.y>xt),E=2*w+(+(y.min.x+y.max.x>xt)^w);for(let A=0;A<y.polygonSegLen;A++){const I=y.polygonSegIdx+A;e.push({centroidIdx:_,subtile:E,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const n=new Si;e.sort((_,y)=>_.triangleSegmentIdx===y.triangleSegmentIdx?_.subtile-y.subtile:_.triangleSegmentIdx-y.triangleSegmentIdx);let s=0,l=0,c=0;for(const _ of e){if(_.triangleSegmentIdx!==s)break;c++}const d=e.length;for(;l!==e.length;){s=e[l].triangleSegmentIdx;let _=0,y=l,w=l;for(let E=y;E<c&&e[E].subtile===_;E++)w++;for(;y!==c;){const E=e[y];_=E.subtile;const A=this.centroidData[E.centroidIdx].min.clone(),I=this.centroidData[E.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=y;k<w;k++){const B=e[k],N=this.polygonSegments[B.polygonSegmentIdx],W=this.centroidData[B.centroidIdx].min,ee=this.centroidData[B.centroidIdx].max,te=this.indexArray.uint16;for(let ne=N.triangleArrayOffset;ne<N.triangleArrayOffset+N.triangleCount;ne++)n.emplaceBack(te[3*ne],te[3*ne+1],te[3*ne+2]);z.primitiveLength+=N.triangleCount,A.x=Math.min(A.x,W.x),A.y=Math.min(A.y,W.y),I.x=Math.max(I.x,ee.x),I.y=Math.max(I.y,ee.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:A,max:I}),y=w;for(let k=y;k<c&&e[k].subtile===e[y].subtile;k++)w++}l=c;for(let E=l;E<d&&e[E].triangleSegmentIdx===e[l].triangleSegmentIdx;E++)c++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,s){let l=0,c=0;const d=1<<e.canonical.z;if(n){const B=n.getMinMaxForTile(e);B&&(l=B.min,c=B.max)}c+=this.maxHeight;const _=e.toUnwrapped();let y;const w=[_.canonical.x/d+_.wrap,_.canonical.y/d],E=[(_.canonical.x+1)/d+_.wrap,(_.canonical.y+1)/d],A=new Lr,I=(B,N,W)=>[B[0]*(1-W[0])+N[0]*W[0],B[1]*(1-W[1])+N[1]*W[1]],z=[],k=[];for(const B of this.triangleSubSegments){z[0]=B.min.x/xt,z[1]=B.min.y/xt,k[0]=B.max.x/xt,k[1]=B.max.y/xt;const N=I(w,E,z),W=I(w,E,k);if(new Dr([N[0],N[1],l],[W[0],W[1],c]).intersectsPrecise(s)===0){y&&(A.segments.push(y),y=void 0);continue}const ee=B.segment;y&&y.vertexOffset!==ee.vertexOffset&&(A.segments.push(y),y=void 0),y?(y.vertexLength+=ee.vertexLength,y.primitiveLength+=ee.primitiveLength):y={vertexOffset:ee.vertexOffset,primitiveLength:ee.primitiveLength,vertexLength:ee.vertexLength,primitiveOffset:ee.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&A.segments.push(y),A}encodeCentroid(e,n){const s=e.centroid(),l=n.span(),c=Math.min(7,Math.round(l.x*this.tileToMeter/10)),d=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new lt(Xt(s.x,1,xt-1)<<3|c,Xt(s.y,1,xt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new lt(0,0);const n=e.borders,s=Number.MAX_VALUE;if(n[0][0]!==s||n[1][0]!==s){const l=n[0][0]!==s?0:1;return new lt(6|(n[0][0]!==s?0:65528),(n[l][0]+n[l][1])/2<<3|6)}{const l=n[2][0]!==s?2:3;return new lt((n[l][0]+n[l][1])/2<<3|6,6|(n[2][0]!==s?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=Fc,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,l=e.flags&Fc?c1:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==l.y||c!==l.x){for(let d=n;d<s;++d)this.centroidVertexArray.emplace(d,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,s){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped());if(Ly(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const c=[];for(const d of this.activeReplacements){if(d.order<s)continue;const _=Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z);for(const y of this.centroidData)if(!(y.flags&Fc||d.min.x>y.max.x||y.min.x>d.max.x||d.min.y>y.max.y||y.min.y>d.max.y))for(let w=0;w<y.footprintSegLen;w++){const E=this.footprintSegments[y.footprintSegIdx+w];if(c.length=0,Ne(this.footprintVertices,E.vertexOffset,E.vertexCount,d.footprintTileId.canonical,e.canonical,c),e1(d.footprint,c,this.footprintIndices.uint16,E.indexOffset,E.indexCount,-E.vertexOffset,-_)){y.flags|=Fc;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,s){let l=!1;for(let c=0;c<s.footprintSegLen;c++){const d=this.footprintSegments[s.footprintSegIdx+c];let _=0;for(const y of d.ringIndices){for(let w=_,E=y+_-1;w<y+_;E=w++){const A=this.footprintVertices.int16[2*(w+d.vertexOffset)+0],I=this.footprintVertices.int16[2*(w+d.vertexOffset)+1],z=this.footprintVertices.int16[2*(E+d.vertexOffset)+1];I>n!=z>n&&e<(this.footprintVertices.int16[2*(E+d.vertexOffset)+0]-A)*(n-I)/(z-I)+A&&(l=!l)}_=y}}return l}getHeightAtTileCoord(e,n){let s=Number.NEGATIVE_INFINITY,l=!0;const c=4*(e+xt)*xt+(n+xt);if(this.partLookup.hasOwnProperty(c)){const d=this.partLookup[c];return d?{height:d.height,hidden:!!(d.flags&Fc)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||n>d.max.y||d.min.y>n||this.footprintContainsPoint(e,n,d)&&d&&d.height>s&&(s=d.height,this.partLookup[c]=d,l=!!(d.flags&Fc));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:l};this.partLookup[c]=void 0}}function _1(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function Jb(t,e,n,s){const l=e.sub(t)._perp()._unit(),c=n.sub(e)._perp()._unit();return g(t,e,n,_1(l,c),s)}function g(t,e,n,s,l){const c=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,l*c/s)}function T(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function D(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function G(t,e,n){if(t.x<0||t.x>=xt||e.x<0||e.x>=xt||n.x<0||n.x>=xt)return!1;const s=n.sub(e),l=s.perp(),c=t.sub(e);return(s.x*c.x+s.y*c.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(c.x*c.x+c.y*c.y))>-.866&&l.x*c.x+l.y*c.y<0}function re(t,e,n){const s=e?2|t:-3&t;return n?1|s:-2&s}function ye(){const t=Math.PI/32,e=Math.tan(t),n=of;return n*Math.sqrt(1+2*e*e)-n}function Le(t,e,n){const s=1<<n.z,l=Gs(n.x/s),c=Gs((n.x+1)/s),d=Ni(n.y/s),_=Ni((n.y+1)/s);return function(y,w,E,A,I=0,z){const k=[];if(!y.length||!E||!A)return k;const B=(de,be)=>{for(const Ae of de)k.push({polygon:Ae,bounds:be})},N=Math.ceil(Math.log2(E)),W=Math.ceil(Math.log2(A)),ee=N-W,te=[];for(let de=0;de<Math.abs(ee);de++)te.push(ee>0?0:1);for(let de=0;de<Math.min(N,W);de++)te.push(0),te.push(1);let ne=y;if(ne=y_(ne,w[0].y-I,w[1].y+I,1),ne=y_(ne,w[0].x-I,w[1].x+I,0),!ne.length)return k;const me=[];for(te.length?me.push({polygons:ne,bounds:w,depth:0}):B(ne,w);me.length;){const de=me.pop(),be=de.depth,Ae=te[be],ze=de.bounds[0],$e=de.bounds[1],Ve=Ae===0?ze.x:ze.y,Je=Ae===0?$e.x:$e.y,ht=z?z(Ae,Ve,Je):.5*(Ve+Je),Ye=y_(de.polygons,Ve-I,ht+I,Ae),it=y_(de.polygons,ht-I,Je+I,Ae);if(Ye.length){const qe=[ze,new lt(Ae===0?ht:$e.x,Ae===1?ht:$e.y)];te.length>be+1?me.push({polygons:Ye,bounds:qe,depth:be+1}):B(Ye,qe)}if(it.length){const qe=[new lt(Ae===0?ht:ze.x,Ae===1?ht:ze.y),$e];te.length>be+1?me.push({polygons:it,bounds:qe,depth:be+1}):B(it,qe)}}return k}(t,e,Math.ceil((c-l)/11.25),Math.ceil((d-_)/11.25),1,(y,w,E)=>{if(y===0)return .5*(w+E);{const A=Ni((n.y+w/xt)/s);return(fl(.5*(Ni((n.y+E/xt)/s)+A))*s-n.y)*xt}})}function Ne(t,e,n,s,l,c){const d=Math.pow(2,s.z-l.z);for(let _=0;_<n;_++){let y=t.int16[2*(_+e)+0],w=t.int16[2*(_+e)+1];y=(y+l.x*xt)*d-s.x*xt,w=(w+l.y*xt)*d-s.y*xt,c.push(new lt(y,w))}}se(b_,"FillExtrusionBucket",{omit:["layers","features"]}),se(d1,"PartData"),se(h1,"FootprintSegment"),se(f1,"BorderCentroidData"),se(m1,"GroundEffect");const Xe=new Kn({visibility:new nt(ke["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new nt(ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var It={paint:new Kn({"fill-extrusion-opacity":new nt(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new At(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nt(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nt(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new At(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new At(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new At(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new nt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new nt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new nt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new nt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new nt(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new nt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new nt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new At(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new At(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new nt(ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new nt(ke["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new nt(ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new nt(ke["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new nt(ke["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Xe};function Mt(t,e){return t.x*e.x+t.y*e.y}function Dt(t,e){if(t.length===1){let n=0;const s=e[n++];let l;for(;!l||s.equals(l);)if(l=e[n++],!l)return 1/0;for(;n<e.length;n++){const c=e[n],d=t[0],_=l.sub(s),y=c.sub(s),w=d.sub(s),E=Mt(_,_),A=Mt(_,y),I=Mt(y,y),z=Mt(w,_),k=Mt(w,y),B=E*I-A*A,N=(I*z-A*k)/B,W=(E*k-A*z)/B,ee=s.z*(1-N-W)+l.z*N+c.z*W;if(isFinite(ee))return ee}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function $t(t,e,n,s,l,c,d,_){const y=d*l.getElevationAt(t,e,!0,!0),w=c[0]!==0,E=w?c[1]===0?d*(c[0]/7-450):d*function(A,I,z){const k=Math.floor(I[0]/8),B=Math.floor(I[1]/8),N=10*(I[0]-8*k),W=10*(I[1]-8*B),ee=A.getElevationAt(k,B,!0,!0),te=A.getMeterToDEM(z),ne=Math.floor(.5*(N*te-1)),me=Math.floor(.5*(W*te-1)),de=A.tileCoordToPixel(k,B),be=2*ne+1,Ae=2*me+1,ze=function(it,qe,st,mt,ut){return[it.getElevationAtPixel(qe,st,!0),it.getElevationAtPixel(qe+ut,st,!0),it.getElevationAtPixel(qe,st+ut,!0),it.getElevationAtPixel(qe+mt,st+ut,!0)]}(A,de.x-ne,de.y-me,be,Ae),$e=Math.abs(ze[0]-ze[1]),Ve=Math.abs(ze[2]-ze[3]),Je=Math.abs(ze[0]-ze[2])+Math.abs(ze[1]-ze[3]),ht=Math.min(.25,.5*te*($e+Ve)/be),Ye=Math.min(.25,.5*te*Je/Ae);return ee+Math.max(ht*N,Ye*W)}(l,c,_):y;return{base:y+(n===0)?-1:n,top:w?Math.max(E+s,y+n+2):y+s}}const hn=Xn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Mn}=hn,ir=Xn([{name:"a_packed",components:4,type:"Float32"}]),{members:In}=ir,ur=Xn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:dr}=ur,Io=Xn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qs=Xn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Po=Xn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ui=Xn([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),ta=Xn([{name:"a_z_offset",components:1,type:"Float32"}],4),pu=Xn([{name:"a_texb",components:2,type:"Uint16"}]),g1=Xn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),p5=Xn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Xn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const gC=Xn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),m5=Xn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Xn([{name:"triangle",components:3,type:"Uint16"}]),Xn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Xn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),Xn([{type:"Float32",name:"offsetX"}]),Xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class yC{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new kc({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=wd(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const l=[];let c=e.length%2==1?-e[e.length-1]*s:0,d=e[0]*s,_=!0;l.push({left:c,right:d,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let w=1;w<e.length;w++){_=!_;const E=e[w];c=y*s,y+=E,d=y*s,l.push({left:c,right:d,isDash:_,zeroLength:E===0})}return l}addRoundDash(e,n,s){const l=n/2;for(let c=-s;c<=s;c++){const d=this.width*(this.nextRow+s+c);let _=0,y=e[_];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++_]);const E=Math.abs(w-y.left),A=Math.abs(w-y.right),I=Math.min(E,A);let z;const k=c/s*(l+1);if(y.isDash){const B=l-Math.abs(k);z=Math.sqrt(I*I+B*B)}else z=l-Math.sqrt(I*I+k*k);this.image.data[d+w]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){const w=e[y],E=e[y+1];w.zeroLength?e.splice(y,1):E&&E.isDash===w.isDash&&(E.left=w.left,e.splice(y,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const c=this.width*this.nextRow;let d=0,_=e[d];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++d]);const w=Math.abs(y-_.left),E=Math.abs(y-_.right),A=Math.min(w,E);this.image.data[c+y]=Math.max(0,Math.min(255,(_.isDash?A:-A)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const l=n==="round",c=l?7:0,d=2*c+1;if(this.nextRow+d>this.height)return xr("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let E=0;E<e.length;E++)e[E]<0&&(xr("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),_+=e[E];if(_!==0){const E=this.width/_,A=this.getDashRanges(e,this.width,E);l?this.addRoundDash(A,E,c):this.addRegularDash(A,n==="square"?.5*E:0)}const y=this.nextRow+c;this.nextRow+=d;const w={tl:[y,c],br:[_,0]};return this.positions[s]=w,w}}se(yC,"LineAtlas");const _5=ff.types,g5=Math.cos(Math.PI/180*37.5),y5=Math.cos(Math.PI/180*5);class y1{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new e_,this.layoutVertexArray2=new Ac,this.patternVertexArray=new Mc,this.indexArray=new Si,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Lr,this.maxLineLength=0,this.zOffsetVertexArray=new Nh,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:xt/64}updateFootprints(e,n){}populate(e,n,s,l){this.hasPattern=Cy("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),d=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!d.isConstant()||!!d.constantOr(0);const _=[];for(const{feature:A,id:I,index:z,sourceLayerIndex:k}of e){const B=this.layers[0]._featureFilter.needGeometry,N=uu(A,B);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),N,s))continue;const W=c?c.evaluate(N,{},s):void 0,ee={id:I,properties:A.properties,type:A.type,sourceLayerIndex:k,index:z,geometry:B?N.geometry:Ra(A,s,l),patterns:{},sortKey:W};_.push(ee)}c&&_.sort((A,I)=>A.sortKey-I.sortKey);const{lineAtlas:y,featureIndex:w}=n,E=this.addConstantDashes(y);for(const A of _){const{geometry:I,index:z,sourceLayerIndex:k}=A;if(E&&this.addFeatureDashes(A,y),this.hasPattern){const B=Ay("line",this.layers,A,this.zoom,n);this.patternFeatures.push(B)}else this.addFeature(A,I,z,s,y.positions,n.availableImages,n.brightness);w.insert(e[z].feature,I,z,k,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const l=s.paint.get("line-dasharray").value,c=s.layout.get("line-cap").value;if(l.kind!=="constant"||c.kind!=="constant")n=!0;else{const d=c.value,_=l.value;if(!_)continue;e.addDash(_,d)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const l of this.layers){const c=l.paint.get("line-dasharray").value,d=l.layout.get("line-cap").value;if(c.kind==="constant"&&d.kind==="constant")continue;let _,y;if(c.kind==="constant"){if(_=c.value,!_)continue}else _=c.evaluate({zoom:s},e);y=d.kind==="constant"?d.value:d.evaluate({zoom:s},e),n.addDash(_,y),e.patterns[l.id]=n.getKey(_,y)}}update(e,n,s,l,c){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,d?this.stateDependentLayers:this.layers,s,l,c)}addFeatures(e,n,s,l,c,d){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,s,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,In)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,dr)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,ta.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,l,c,d,_){const y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),E=y.get("line-cap").evaluate(e,{}),A=y.get("line-miter-limit"),I=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of n)this.addLine(z,e,l,w,E,A,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,c,d,l,_)}addLine(e,n,s,l,c,d,_){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const y={zoom:this.zoom,lineProgress:void 0},w=this.layers[0].layout,E=l==="none";if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<e.length-1;de++)this.totalDistance+=e[de].dist(e[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=_5[n.type]==="Polygon";let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let z=0;for(;z<I-1&&e[z].equals(e[z+1]);)z++;if(I<(A?3:2))return;l==="bevel"&&(d=1.05);const k=this.overscaling<=16?15*xt/(512*this.overscaling):0,B=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let N,W,ee,te,ne,me;this.e1=this.e2=-1,A&&(N=e[I-2],ne=e[z].sub(N)._unit()._perp());for(let de=z;de<I;de++){if(ee=de===I-1?A?e[z+1]:void 0:e[de+1],ee&&e[de].equals(ee))continue;if(ne&&(te=ne),N&&(W=N),N=e[de],this.hasZOffset){const qe=w.get("line-z-offset").value;if(qe.kind==="constant")me=qe.value;else{if(this.lineClips){const st=this.totalDistance/(this.lineClips.end-this.lineClips.start);y.lineProgress=(st*this.lineClips.start+this.distance+(W?W.dist(N):0))/st}else xr(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),y.lineProgress=0;me=qe.evaluate(y,n)}me=me||0}ne=ee?ee.sub(N)._unit()._perp():te,te=te||ne;const be=W&&ee;let Ae=be?l:A||E?"butt":c;const ze=te.x*ne.x+te.y*ne.y;if(E){const qe=function(st){if(st.patternJoinNone){const mt=st.segmentPoints.length/2,ut=st.lineSoFar-st.segmentStart;for(let Lt=0;Lt<mt;++Lt){const dt=st.segmentPoints[2*Lt+1],yt=Math.round(st.segmentPoints[2*Lt])+.5+.25*dt;st.patternVertexArray.emplaceBack(yt,ut,st.segmentStart),st.patternVertexArray.emplaceBack(yt,ut,st.segmentStart)}st.segmentPoints.length=0}st.e1=st.e2=-1};if(be&&ze<y5){this.updateDistance(W,N),this.addCurrentVertex(N,te,1,1,B,me),qe(this),this.addCurrentVertex(N,ne,-1,-1,B,me);continue}if(W){if(!ee){this.updateDistance(W,N),this.addCurrentVertex(N,te,1,1,B,me),qe(this);continue}Ae="miter"}}let $e=te.add(ne);$e.x===0&&$e.y===0||$e._unit();const Ve=$e.x*ne.x+$e.y*ne.y,Je=Ve!==0?1/Ve:1/0,ht=2*Math.sqrt(2-2*Ve),Ye=Ve<g5&&W&&ee,it=te.x*ne.y-te.y*ne.x>0;if(Ye&&de>z){const qe=N.dist(W);if(qe>2*k){const st=N.sub(N.sub(W)._mult(k/qe)._round());this.updateDistance(W,st),this.addCurrentVertex(st,te,0,0,B,me),W=st}}if(be&&Ae==="round"&&(Je<_?Ae="miter":Je<=2&&(Ae="fakeround")),Ae==="miter"&&Je>d&&(Ae="bevel"),Ae==="bevel"&&(Je>2&&(Ae="flipbevel"),Je<d&&(Ae="miter")),W&&this.updateDistance(W,N),Ae==="miter")$e._mult(Je),this.addCurrentVertex(N,$e,0,0,B,me);else if(Ae==="flipbevel"){if(Je>100)$e=ne.mult(-1);else{const qe=Je*te.add(ne).mag()/te.sub(ne).mag();$e._perp()._mult(qe*(it?-1:1))}this.addCurrentVertex(N,$e,0,0,B,me),this.addCurrentVertex(N,$e.mult(-1),0,0,B,me)}else if(Ae==="bevel"||Ae==="fakeround"){const qe=-Math.sqrt(Je*Je-1),st=it?qe:0,mt=it?0:qe;if(W&&this.addCurrentVertex(N,te,st,mt,B,me),Ae==="fakeround"){const ut=Math.round(180*ht/Math.PI/20);for(let Lt=1;Lt<ut;Lt++){let dt=Lt/ut;if(dt!==.5){const Wt=dt-.5;dt+=dt*Wt*(dt-1)*((1.0904+ze*(ze*(3.55645-1.43519*ze)-3.2452))*Wt*Wt+(.848013+ze*(.215638*ze-1.06021)))}const yt=ne.sub(te)._mult(dt)._add(te)._unit()._mult(it?-1:1);this.addHalfVertex(N,yt.x,yt.y,!1,it,0,B,me)}}ee&&this.addCurrentVertex(N,ne,-st,-mt,B,me)}else Ae==="butt"?this.addCurrentVertex(N,$e,0,0,B,me):Ae==="square"?(W||this.addCurrentVertex(N,$e,-1,-1,B,me),this.addCurrentVertex(N,$e,0,0,B,me),W&&this.addCurrentVertex(N,$e,1,1,B,me)):Ae==="round"&&(W&&(this.addCurrentVertex(N,te,0,0,B,me),this.addCurrentVertex(N,te,1,1,B,me,!0)),ee&&(this.addCurrentVertex(N,ne,-1,-1,B,me,!0),this.addCurrentVertex(N,ne,0,0,B,me)));if(Ye&&de<I-1){const qe=N.dist(ee);if(qe>2*k){const st=N.add(ee.sub(N)._mult(k/qe)._round());this.updateDistance(N,st),this.addCurrentVertex(st,ne,0,0,B,me),N=st}}}}addVerticesTo(e,n,s,l,c,d,_,y,w,E){const A=(n.w-e.w)/this.tessellationStep|0;if(A>1){this.lineSoFar=e.w;const I=(n.x-e.x)/A,z=(n.y-e.y)/A,k=(n.z-e.z)/A,B=(n.w-e.w)/A;for(let N=1;N<A;++N)e.x+=I,e.y+=z,e.z+=k,this.lineSoFar+=B,this.addHalfVertex(e,s,l,E,!1,_,w,e.z),this.addHalfVertex(e,c,d,E,!0,-y,w,e.z)}this.lineSoFar=n.w,this.addHalfVertex(n,s,l,E,!1,_,w,n.z),this.addHalfVertex(n,c,d,E,!0,-y,w,n.z)}addCurrentVertex(e,n,s,l,c,d,_=!1){const y=n.x+n.y*s,w=n.y-n.x*s,E=n.y*l-n.x,A=-n.y-n.x*l;if(d!=null){const z=xt+10,k=d,B=new Py(e.x,e.y,k,this.lineSoFar),N=xC(e,-10,z),W=this.lineSoFar;if(this.currentVertex)if(N){const ee=this.currentVertexIsOutside,te=this.currentVertex,ne=new Py(e.x,e.y,k,this.lineSoFar);Jx(te,ne,-10,z),xC(ne,-10,z)||(ee&&(this.e1=this.e2=-1,this.lineSoFar=te.w,this.addHalfVertex(te,y,w,_,!1,s,c,te.z),this.addHalfVertex(te,E,A,_,!0,-l,c,te.z)),this.addVerticesTo(te,ne,y,w,E,A,s,l,c,_))}else{const ee=this.currentVertex;this.currentVertexIsOutside&&(Jx(ee,B,-10,z),this.e1=this.e2=-1,this.lineSoFar=ee.w,this.addHalfVertex(ee,y,w,_,!1,s,c,ee.z),this.addHalfVertex(ee,E,A,_,!0,-l,c,ee.z)),this.addVerticesTo(ee,B,y,w,E,A,s,l,c,_)}else N||(this.addHalfVertex(e,y,w,_,!1,s,c,d),this.addHalfVertex(e,E,A,_,!0,-l,c,d));this.currentVertex=B,this.currentVertexIsOutside=N,this.lineSoFar=W}else this.addHalfVertex(e,y,w,_,!1,s,c,d),this.addHalfVertex(e,E,A,_,!0,-l,c,d)}addHalfVertex({x:e,y:n},s,l,c,d,_,y,w){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(n<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),y.primitiveLength++),d?this.e2=E:this.e1=E,w!=null&&this.zOffsetVertexArray.emplaceBack(w)}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}function xC(t,e,n){return t.x<e||t.x>n||t.y<e||t.y>n}se(y1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const x5=new Kn({"line-cap":new At(ke.layout_line["line-cap"]),"line-join":new At(ke.layout_line["line-join"]),"line-miter-limit":new nt(ke.layout_line["line-miter-limit"]),"line-round-limit":new nt(ke.layout_line["line-round-limit"]),"line-sort-key":new At(ke.layout_line["line-sort-key"]),"line-z-offset":new At(ke.layout_line["line-z-offset"]),visibility:new nt(ke.layout_line.visibility)});var x1={paint:new Kn({"line-opacity":new At(ke.paint_line["line-opacity"]),"line-color":new At(ke.paint_line["line-color"]),"line-translate":new nt(ke.paint_line["line-translate"]),"line-translate-anchor":new nt(ke.paint_line["line-translate-anchor"]),"line-width":new At(ke.paint_line["line-width"]),"line-gap-width":new At(ke.paint_line["line-gap-width"]),"line-offset":new At(ke.paint_line["line-offset"]),"line-blur":new At(ke.paint_line["line-blur"]),"line-dasharray":new At(ke.paint_line["line-dasharray"]),"line-pattern":new At(ke.paint_line["line-pattern"]),"line-gradient":new Mr(ke.paint_line["line-gradient"]),"line-trim-offset":new nt(ke.paint_line["line-trim-offset"]),"line-trim-fade-range":new nt(ke.paint_line["line-trim-fade-range"]),"line-trim-color":new nt(ke.paint_line["line-trim-color"]),"line-emissive-strength":new nt(ke.paint_line["line-emissive-strength"]),"line-border-width":new At(ke.paint_line["line-border-width"]),"line-border-color":new At(ke.paint_line["line-border-color"]),"line-occlusion-opacity":new nt(ke.paint_line["line-occlusion-opacity"])}),layout:x5};function vC(t,e,n){return e*(xt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function wC(t,e){return 1/vC(t,1,e.tileZoom)}function bC(t,e,n,s){return t.translatePosMatrix(s||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const TC=t=>{const e=[];SC(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=t.layout.get("line-join").constantOr("miter")==="none",l=!!t.paint.get("line-pattern").constantOr(1);return s&&l&&e.push("LINE_JOIN_NONE"),e};function SC(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class EC{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var v5={read:function(t,e,n,s,l){var c,d,_=8*l-s-1,y=(1<<_)-1,w=y>>1,E=-7,A=n?l-1:0,I=n?-1:1,z=t[e+A];for(A+=I,c=z&(1<<-E)-1,z>>=-E,E+=_;E>0;c=256*c+t[e+A],A+=I,E-=8);for(d=c&(1<<-E)-1,c>>=-E,E+=s;E>0;d=256*d+t[e+A],A+=I,E-=8);if(c===0)c=1-w;else{if(c===y)return d?NaN:1/0*(z?-1:1);d+=Math.pow(2,s),c-=w}return(z?-1:1)*d*Math.pow(2,c-s)},write:function(t,e,n,s,l,c){var d,_,y,w=8*c-l-1,E=(1<<w)-1,A=E>>1,I=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=s?0:c-1,k=s?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,d=E):(d=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-d))<1&&(d--,y*=2),(e+=d+A>=1?I/y:I*Math.pow(2,1-A))*y>=2&&(d++,y/=2),d+A>=E?(_=0,d=E):d+A>=1?(_=(e*y-1)*Math.pow(2,l),d+=A):(_=e*Math.pow(2,A-1)*Math.pow(2,l),d=0));l>=8;t[n+z]=255&_,z+=k,_/=256,l-=8);for(d=d<<l|_,w+=l;w>0;t[n+z]=255&d,z+=k,d/=256,w-=8);t[n+z-k]|=128*B}},CC=kr,v1=v5;function kr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}kr.Varint=0,kr.Fixed64=1,kr.Bytes=2,kr.Fixed32=5;var Qb=4294967296,AC=1/Qb,MC=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Hh(t){return t.type===kr.Bytes?t.readVarint()+t.pos:t.pos+1}function T_(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function IC(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var l=n.pos-1;l>=t;l--)n.buf[l+s]=n.buf[l]}function w5(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function b5(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function T5(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function S5(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function E5(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function C5(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function A5(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function M5(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function I5(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function w1(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function S_(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function PC(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}kr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),l=s>>3,c=this.pos;this.type=7&s,t(l,e,this),this.pos===c&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=w1(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=PC(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=w1(this.buf,this.pos)+w1(this.buf,this.pos+4)*Qb;return this.pos+=8,t},readSFixed64:function(){var t=w1(this.buf,this.pos)+PC(this.buf,this.pos+4)*Qb;return this.pos+=8,t},readFloat:function(){var t=v1.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=v1.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(l,c,d){var _,y,w=d.buf;if(_=(112&(y=w[d.pos++]))>>4,y<128||(_|=(127&(y=w[d.pos++]))<<3,y<128)||(_|=(127&(y=w[d.pos++]))<<10,y<128)||(_|=(127&(y=w[d.pos++]))<<17,y<128)||(_|=(127&(y=w[d.pos++]))<<24,y<128)||(_|=(1&(y=w[d.pos++]))<<31,y<128))return T_(l,_,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&MC?function(n,s,l){return MC.decode(n.subarray(s,l))}(this.buf,e,t):function(n,s,l){for(var c="",d=s;d<l;){var _,y,w,E=n[d],A=null,I=E>239?4:E>223?3:E>191?2:1;if(d+I>l)break;I===1?E<128&&(A=E):I===2?(192&(_=n[d+1]))==128&&(A=(31&E)<<6|63&_)<=127&&(A=null):I===3?(y=n[d+2],(192&(_=n[d+1]))==128&&(192&y)==128&&((A=(15&E)<<12|(63&_)<<6|63&y)<=2047||A>=55296&&A<=57343)&&(A=null)):I===4&&(y=n[d+2],w=n[d+3],(192&(_=n[d+1]))==128&&(192&y)==128&&(192&w)==128&&((A=(15&E)<<18|(63&_)<<12|(63&y)<<6|63&w)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,I=1):A>65535&&(A-=65536,c+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),c+=String.fromCharCode(A),d+=I}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==kr.Bytes)return t.push(this.readVarint(e));var n=Hh(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==kr.Bytes)return t.push(this.readSVarint());var e=Hh(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==kr.Bytes)return t.push(this.readBoolean());var e=Hh(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==kr.Bytes)return t.push(this.readFloat());var e=Hh(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==kr.Bytes)return t.push(this.readDouble());var e=Hh(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==kr.Bytes)return t.push(this.readFixed32());var e=Hh(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==kr.Bytes)return t.push(this.readSFixed32());var e=Hh(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==kr.Bytes)return t.push(this.readFixed64());var e=Hh(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==kr.Bytes)return t.push(this.readSFixed64());var e=Hh(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===kr.Varint)for(;this.buf[this.pos++]>127;);else if(e===kr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===kr.Fixed32)this.pos+=4;else{if(e!==kr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),S_(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),S_(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),S_(this.buf,-1&t,this.pos),S_(this.buf,Math.floor(t*AC),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),S_(this.buf,-1&t,this.pos),S_(this.buf,Math.floor(t*AC),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,l;if(e>=0?(s=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(c,d,_){_.buf[_.pos++]=127&c|128,c>>>=7,_.buf[_.pos++]=127&c|128,c>>>=7,_.buf[_.pos++]=127&c|128,c>>>=7,_.buf[_.pos++]=127&c|128,_.buf[_.pos]=127&(c>>>=7)}(s,0,n),function(c,d){var _=(7&c)<<4;d.buf[d.pos++]|=_|((c>>>=3)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c)))))}(l,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,l,c){for(var d,_,y=0;y<l.length;y++){if((d=l.charCodeAt(y))>55295&&d<57344){if(!_){d>56319||y+1===l.length?(s[c++]=239,s[c++]=191,s[c++]=189):_=d;continue}if(d<56320){s[c++]=239,s[c++]=191,s[c++]=189,_=d;continue}d=_-55296<<10|d-56320|65536,_=null}else _&&(s[c++]=239,s[c++]=191,s[c++]=189,_=null);d<128?s[c++]=d:(d<2048?s[c++]=d>>6|192:(d<65536?s[c++]=d>>12|224:(s[c++]=d>>18|240,s[c++]=d>>12&63|128),s[c++]=d>>6&63|128),s[c++]=63&d|128)}return c}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&IC(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),v1.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),v1.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&IC(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,kr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,w5,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,b5,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,E5,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,T5,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,S5,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,C5,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,A5,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,M5,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,I5,e)},writeBytesField:function(t,e){this.writeTag(t,kr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,kr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,kr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,kr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,kr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,kr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,kr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,kr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,kr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,kr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var E_=et(CC);const P5=["id","tile","layer","source","sourceLayer","state"];class RC{constructor(e,n,s,l,c){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=l,this.properties=e.properties,this.id=c}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of P5)this[n]!==void 0&&(e[n]=this[n]);return e}}class R5{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const l=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Rr(this.stateChanges[e][l],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const c in this.state[e])c!==l&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const c in this.state[e][l])s[c]||(this.deletedStates[e][l][c]=null)}else for(const c in s)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][c]===null&&delete this.deletedStates[e][l][c]}removeFeatureState(e,n,s){if(this.deletedStates[e]===null)return;const l=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&n!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][s]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(s in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][s]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),l=Rr({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const c=this.deletedStates[e][n];if(c===null)return{};for(const d in c)delete l[d]}return l}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const c={};for(const d in this.stateChanges[l])this.state[l][d]||(this.state[l][d]={}),Rr(this.state[l][d],this.stateChanges[l][d]),c[d]=this.state[l][d];s[l]=c}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const c={};if(this.deletedStates[l]===null)for(const d in this.state[l])c[d]={},this.state[l][d]={};else for(const d in this.deletedStates[l]){if(this.deletedStates[l][d]===null)this.state[l][d]={};else if(this.state[l][d])for(const _ of Object.keys(this.deletedStates[l][d]))delete this.state[l][d][_];c[d]=this.state[l][d]}s[l]=s[l]||{},Rr(s[l],c)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const l in e)e[l].setFeatureState(s,n)}}class LC{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ge(xt,16,0),this.featureIndexArray=new px,this.promoteId=n,this.is3DTile=!1}insert(e,n,s,l,c,d=0,_=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,c,d);const w=this.grid;for(let E=0;E<n.length;E++){const A=n[E],I=[1/0,1/0,-1/0,-1/0];for(let z=0;z<A.length;z++){const k=A[z];I[0]=Math.min(I[0],k.x),I[1]=Math.min(I[1],k.y),I[2]=Math.max(I[2],k.x),I[3]=Math.max(I[3],k.y)}_!==0&&(I[0]-=_,I[1]-=_,I[2]+=_,I[3]+=_),I[0]<xt&&I[1]<xt&&I[2]>=0&&I[3]>=0&&w.insert(y,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Iy(new E_(this.rawTileData)).layers,this.sourceLayerCoder=new EC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,l){this.loadVTLayers();const c=e.params||{},d=ri(c.filter),_=e.tileResult,y=e.transform,w=_.bufferedTilespaceBounds,E=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(k,B,N,W)=>Ex(_.bufferedTilespaceGeometry,k,B,N,W));E.sort(L5);let A=null;y.elevation&&E.length>0&&(A=Bc.create(y.elevation,this.tileID));const I={};let z;for(let k=0;k<E.length;k++){const B=E[k];if(B===z)continue;z=B;const N=this.featureIndexArray.get(B);let W=null;if(this.is3DTile){const ee=this.bucketLayerIDs[0][0],te=n[ee];if(te.type!=="model")continue;const{queryFeature:ne,intersectionZ:me}=te.queryIntersectsMatchingFeature(_,N.featureIndex,d,y);ne&&this.appendToResult(I,ee,N.featureIndex,ne,me)}else this.loadMatchingFeature(I,N,d,c.layers,c.availableImages,n,s,l,(ee,te,ne,me=0)=>(W||(W=Ra(ee,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(_,ee,ne,W,this.z,e.transform,e.pixelPosMatrix,A,me)))}return I}loadMatchingFeature(e,n,s,l,c,d,_,y,w){const{featureIndex:E,bucketIndex:A,sourceLayerIndex:I,layoutVertexArrayOffset:z}=n,k=this.bucketLayerIDs[A];if(l&&!function(ee,te){for(let ne=0;ne<ee.length;ne++)if(te.indexOf(ee[ne])>=0)return!0;return!1}(l,k))return;const B=this.sourceLayerCoder.decode(I),N=this.vtLayers[B].feature(E);if(s.needGeometry){const ee=uu(N,!0);if(!s.filter(new tn(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!s.filter(new tn(this.tileID.overscaledZ),N))return;const W=this.getId(N,B);for(let ee=0;ee<k.length;ee++){const te=k[ee];if(l&&l.indexOf(te)<0)continue;const ne=d[te];if(!ne)continue;let me={};W!==void 0&&y&&(me=y.getState(ne.sourceLayer||"_geojsonTileLayer",W));const de=!w||w(N,ne,me,z);if(!de)continue;const be=new RC(N,this.z,this.x,this.y,W),Ae=Rr({},_[te]);Ae.paint=DC(Ae.paint,ne.paint,N,me,c),Ae.layout=DC(Ae.layout,ne.layout,N,me,c),be.layer=Ae,this.appendToResult(e,te,E,be,de)}}appendToResult(e,n,s,l,c){let d=e[n];d===void 0&&(d=e[n]=[]),d.push({featureIndex:s,feature:l,intersectionZ:c})}lookupSymbolFeatures(e,n,s,l,c,d,_,y){const w={};this.loadVTLayers();const E=ri(c);for(const A of e)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:l,featureIndex:A,layoutVertexArrayOffset:0},E,d,_,y,n);return w}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(s),c=this.vtFeatures[l];if(c[n])return c[n];const d=this.vtLayers[l].feature(n);return c[n]=d,d}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];l!=null&&(s=e.properties[l]),typeof s=="boolean"&&(s=Number(s))}return s}}function DC(t,e,n,s,l){return Wu(t,(c,d)=>{const _=e instanceof ar?e.get(d):null;return _&&_.evaluate?_.evaluate(n,s,l):_})}function L5(t,e){return e-t}se(LC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var hs=24;const mu=128;function eT(t,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new tn(t+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=n;let c=0;for(;c<s.length&&s[c]<=t;)c++;c=Math.max(0,c-1);let d=c;for(;d<s.length&&s[d]<t+1;)d++;d=Math.min(s.length-1,d);const _=s[c],y=s[d];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:y,interpolationType:l}:{kind:"camera",minZoom:_,maxZoom:y,minSize:n.evaluate(new tn(_)),maxSize:n.evaluate(new tn(y)),interpolationType:l}}}function b1(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:l}){return t.kind==="source"?s/mu:t.kind==="composite"?Ht(s/mu,l/mu,n):e}function C_(t,e){let n=0,s=0;if(t.kind==="constant")s=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:l,minZoom:c,maxZoom:d}=t,_=l?Xt(bs.interpolationFactor(l,e,c,d),0,1):0;t.kind==="camera"?s=Ht(t.minSize,t.maxSize,_):n=_}return{uSizeT:n,uSize:s}}var D5=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:mu,evaluateSizeForFeature:b1,evaluateSizeForZoom:C_,getSizeData:eT});function z5(t,e,n){return t.sections.forEach(s=>{s.text=function(l,c,d){const _=c.layout.get("text-transform").evaluate(d,{});return _==="uppercase"?l=l.toLocaleUpperCase():_==="lowercase"&&(l=l.toLocaleLowerCase()),Vt.applyArabicShaping&&(l=Vt.applyArabicShaping(l)),l}(s.text,e,n)}),t}const zy={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function k5(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function O5(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}const tT=3;function B5(t,e,n){e.glyphs=[],t===1&&n.readMessage(F5,e)}function F5(t,e,n){if(t===3){const{id:s,bitmap:l,width:c,height:d,left:_,top:y,advance:w}=n.readMessage(N5,{});e.glyphs.push({id:s,bitmap:new kc({width:c+2*tT,height:d+2*tT},l),metrics:{width:c,height:d,left:_,top:y,advance:w}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function N5(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}const zC=tT,za={horizontal:1,vertical:2,horizontalOnly:3};class ky{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new ky;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new ky;return n.imageName=e,n}}class A_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new A_;for(let l=0;l<e.sections.length;l++){const c=e.sections[l];c.image?s.addImageSection(c):s.addTextSection(c,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,s){let l="";for(let c=0;c<n.length;c++){const d=n.charCodeAt(c+1)||null,_=n.charCodeAt(c-1)||null;l+=!s&&(d&&Qe(d)&&!zy[n[c+1]]||_&&Qe(_)&&!zy[n[c-1]])||!zy[n[c]]?n[c]:zy[n[c]]}return l}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&T1[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&T1[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new A_;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(ky.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.namePrimary:"";if(n.length===0)return void xr("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(ky.forImage(n)),this.sectionIndex.push(this.sections.length-1)):xr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function nT(t,e,n,s,l,c,d,_,y,w,E,A,I,z,k){const B=A_.fromFeature(t,l);A===za.vertical&&B.verticalizePunctuation(I);let N=[];const W=function(de,be,Ae,ze,$e,Ve){if(!de)return[];const Je=[],ht=function(st,mt,ut,Lt,dt,yt){let Wt=0;for(let jt=0;jt<st.length();jt++){const Ut=st.getSection(jt);Wt+=kC(st.getCodePoint(jt),Ut,Lt,dt,mt,yt)}return Wt/Math.max(1,Math.ceil(Wt/ut))}(de,be,Ae,ze,$e,Ve),Ye=de.text.indexOf("​")>=0;let it=0;for(let st=0;st<de.length();st++){const mt=de.getSection(st),ut=de.getCodePoint(st);if(T1[ut]||(it+=kC(ut,mt,ze,$e,be,Ve)),st<de.length()-1){const Lt=!((qe=ut)<11904||!(pe["Bopomofo Extended"](qe)||pe.Bopomofo(qe)||pe["CJK Compatibility Forms"](qe)||pe["CJK Compatibility Ideographs"](qe)||pe["CJK Compatibility"](qe)||pe["CJK Radicals Supplement"](qe)||pe["CJK Strokes"](qe)||pe["CJK Symbols and Punctuation"](qe)||pe["CJK Unified Ideographs Extension A"](qe)||pe["CJK Unified Ideographs"](qe)||pe["Enclosed CJK Letters and Months"](qe)||pe["Halfwidth and Fullwidth Forms"](qe)||pe.Hiragana(qe)||pe["Ideographic Description Characters"](qe)||pe["Kangxi Radicals"](qe)||pe["Katakana Phonetic Extensions"](qe)||pe.Katakana(qe)||pe["Vertical Forms"](qe)||pe["Yi Radicals"](qe)||pe["Yi Syllables"](qe)));(V5[ut]||Lt||mt.imageName)&&Je.push(BC(st+1,it,ht,Je,U5(ut,de.getCodePoint(st+1),Lt&&Ye),!1))}}var qe;return FC(BC(de.length(),it,ht,Je,0,!0))}(B,w,c,e,s,z),{processBidirectionalText:ee,processStyledBidirectionalText:te}=Vt;if(ee&&B.sections.length===1){const de=ee(B.toString(),W);for(const be of de){const Ae=new A_;Ae.text=be,Ae.sections=B.sections;for(let ze=0;ze<be.length;ze++)Ae.sectionIndex.push(0);N.push(Ae)}}else if(te){const de=te(B.text,B.sectionIndex,W);for(const be of de){const Ae=new A_;Ae.text=be[0],Ae.sectionIndex=be[1],Ae.sections=B.sections,N.push(Ae)}}else N=function(de,be){const Ae=[],ze=de.text;let $e=0;for(const Ve of be)Ae.push(de.substring($e,Ve)),$e=Ve;return $e<ze.length&&Ae.push(de.substring($e,ze.length)),Ae}(B,W);const ne=[],me={positionedLines:ne,text:B.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(de,be,Ae,ze,$e,Ve,Je,ht,Ye,it,qe,st){let mt=0,ut=0,Lt=0;const dt=ht==="right"?1:ht==="left"?0:.5;let yt=!1;for(const pn of $e){const nn=pn.getSections();for(const vn of nn){if(vn.imageName)continue;const mn=be[vn.fontStack];if(mn&&(yt=mn.ascender!==void 0&&mn.descender!==void 0,!yt))break}if(!yt)break}let Wt=0;for(const pn of $e){pn.trim();const nn=pn.getMaxScale(),vn=(nn-1)*hs,mn={positionedGlyphs:[],lineOffset:0};de.positionedLines[Wt]=mn;const Pn=mn.positionedGlyphs;let Jt=0;if(!pn.length()){ut+=Ve,++Wt;continue}let hr=0,cr=0;for(let qn=0;qn<pn.length();qn++){const Qn=pn.getSection(qn),Cr=pn.getSectionIndex(qn),gr=pn.getCodePoint(qn);let $r=Qn.scale,Ur=null,Is=null,ti=null,Or=hs,yi=0;const Ji=!(Ye===za.horizontal||!qe&&!rt(gr)||qe&&(T1[gr]||(jt=gr,pe.Arabic(jt)||pe["Arabic Supplement"](jt)||pe["Arabic Extended-A"](jt)||pe["Arabic Presentation Forms-A"](jt)||pe["Arabic Presentation Forms-B"](jt))));if(Qn.imageName){const Qi=ze[Qn.imageName];if(!Qi)continue;ti=Qn.imageName,de.iconsInText=de.iconsInText||!0,Is=Qi.paddedRect;const wr=Qi.displaySize;$r=$r*hs/st,Ur={width:wr[0],height:wr[1],left:0,top:-zC,advance:Ji?wr[1]:wr[0],localGlyph:!1},yi=yt?-Ur.height*$r:nn*hs-17-wr[1]*$r,Or=Ur.advance;const uo=(Ji?wr[0]:wr[1])*$r-hs*nn;uo>0&&uo>Jt&&(Jt=uo)}else{const Qi=Ae[Qn.fontStack];if(!Qi)continue;Qi[gr]&&(Is=Qi[gr]);const wr=be[Qn.fontStack];if(!wr)continue;const uo=wr.glyphs[gr];if(!uo)continue;if(Ur=uo.metrics,Or=gr!==8203?hs:0,yt){const Xh=wr.ascender!==void 0?Math.abs(wr.ascender):0,wl=wr.descender!==void 0?Math.abs(wr.descender):0,bu=(Xh+wl)*$r;hr<bu&&(hr=bu,cr=(Xh-wl)/2*$r),yi=-Xh*$r}else yi=(nn-$r)*hs-17}Ji?(de.verticalizable=!0,Pn.push({glyph:gr,imageName:ti,x:mt,y:ut+yi,vertical:Ji,scale:$r,localGlyph:Ur.localGlyph,fontStack:Qn.fontStack,sectionIndex:Cr,metrics:Ur,rect:Is}),mt+=Or*$r+it):(Pn.push({glyph:gr,imageName:ti,x:mt,y:ut+yi,vertical:Ji,scale:$r,localGlyph:Ur.localGlyph,fontStack:Qn.fontStack,sectionIndex:Cr,metrics:Ur,rect:Is}),mt+=Ur.advance*$r+it)}Pn.length!==0&&(Lt=Math.max(mt-it,Lt),yt?NC(Pn,dt,Jt,cr,Ve*nn/2):NC(Pn,dt,Jt,0,Ve/2)),mt=0;const Jn=Ve*nn+Jt;mn.lineOffset=Math.max(Jt,vn),ut+=Jn,++Wt}var jt;const Ut=ut,{horizontalAlign:_t,verticalAlign:qt}=rT(Je);(function(pn,nn,vn,mn,Pn,Jt){const hr=(nn-vn)*Pn,cr=-Jt*mn;for(const Jn of pn)for(const qn of Jn.positionedGlyphs)qn.x+=hr,qn.y+=cr})(de.positionedLines,dt,_t,qt,Lt,Ut),de.top+=-qt*Ut,de.bottom=de.top+Ut,de.left+=-_t*Lt,de.right=de.left+Lt,de.hasBaseline=yt}(me,e,n,s,N,d,_,y,A,w,I,k),!function(de){for(const be of de)if(be.positionedGlyphs.length!==0)return!1;return!0}(ne)&&me}const T1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},V5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kC(t,e,n,s,l,c){if(e.imageName){const d=s[e.imageName];return d?d.displaySize[0]*e.scale*hs/c+l:0}{const d=n[e.fontStack],_=d&&d.glyphs[t];return _?_.metrics.advance*e.scale+l:0}}function OC(t,e,n,s){const l=Math.pow(t-e,2);return s?t<e?l/2:2*l:l+Math.abs(n)*n}function U5(t,e,n){let s=0;return t===10&&(s-=1e4),n&&(s+=150),t!==40&&t!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function BC(t,e,n,s,l,c){let d=null,_=OC(e,n,l,c);for(const y of s){const w=OC(e-y.x,n,l,c)+y.badness;w<=_&&(d=y,_=w)}return{index:t,x:e,priorBreak:d,badness:_}}function FC(t){return t?FC(t.priorBreak).concat(t.index):[]}function rT(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function NC(t,e,n,s,l){if(!(e||n||s||l))return;const c=t.length-1,d=t[c],_=(d.x+d.metrics.advance*d.scale)*e;for(let y=0;y<=c;y++)t[y].x-=_,t[y].y+=n+s+l}function j5(t,e,n,s){const{horizontalAlign:l,verticalAlign:c}=rT(s),d=n[0]-t.displaySize[0]*l,_=n[1]-t.displaySize[1]*c;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:d,right:d+t.displaySize[0]}}function VC(t,e,n,s,l,c){const d=t.imagePrimary;let _;if(d.content){const N=d.content,W=d.pixelRatio||1;_=[N[0]/W,N[1]/W,d.displaySize[0]-N[2]/W,d.displaySize[1]-N[3]/W]}const y=e.left*c,w=e.right*c;let E,A,I,z;n==="width"||n==="both"?(z=l[0]+y-s[3],A=l[0]+w+s[1]):(z=l[0]+(y+w-d.displaySize[0])/2,A=z+d.displaySize[0]);const k=e.top*c,B=e.bottom*c;return n==="height"||n==="both"?(E=l[1]+k-s[0],I=l[1]+B+s[2]):(E=l[1]+(k+B-d.displaySize[1])/2,I=E+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:E,right:A,bottom:I,left:z,collisionPadding:_}}class Zh extends lt{constructor(e,n,s,l,c){super(e,n),this.angle=l,this.z=s,c!==void 0&&(this.segment=c)}clone(){return new Zh(this.x,this.y,this.z,this.angle,this.segment)}}function UC(t,e,n,s,l){if(e.segment===void 0)return!0;let c=e,d=e.segment+1,_=0;for(;_>-n/2;){if(d--,d<0)return!1;_-=t[d].dist(c),c=t[d]}_+=t[d].dist(t[d+1]),d++;const y=[];let w=0;for(;_<n/2;){const E=t[d],A=t[d+1];if(!A)return!1;let I=t[d-1].angleTo(E)-E.angleTo(A);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:_,angleDelta:I}),w+=I;_-y[0].distance>s;)w-=y.shift().angleDelta;if(w>l)return!1;d++,_+=E.dist(A)}return!0}function jC(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function GC(t,e,n){return t?.6*e*n:0}function WC(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function G5(t,e,n,s,l,c){const d=GC(n,l,c),_=WC(n,s)*c;let y=0;const w=jC(t)/2;for(let E=0;E<t.length-1;E++){const A=t[E],I=t[E+1],z=A.dist(I);if(y+z>w){const k=(w-y)/z,B=Ht(A.x,I.x,k),N=Ht(A.y,I.y,k),W=new Zh(B,N,0,I.angleTo(A),E);return!d||UC(t,W,_,d,e)?W:void 0}y+=z}}function W5(t,e,n,s,l,c,d,_,y){const w=GC(s,c,d),E=WC(s,l),A=E*d,I=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-A<e/4&&(e=A+e/4),$C(t,I?e/2*_%e:(E/2+2*c)*d*_%e,e,w,n,A,I,!1,y)}function $C(t,e,n,s,l,c,d,_,y){const w=c/2,E=jC(t);let A=0,I=e-n,z=[];for(let k=0;k<t.length-1;k++){const B=t[k],N=t[k+1],W=B.dist(N),ee=N.angleTo(B);for(;I+n<A+W;){I+=n;const te=(I-A)/W,ne=Ht(B.x,N.x,te),me=Ht(B.y,N.y,te);if(ne>=0&&ne<y&&me>=0&&me<y&&I-w>=0&&I+w<=E){const de=new Zh(ne,me,0,ee,k);s&&!UC(t,de,c,s,l)||z.push(de)}}A+=W}return _||z.length||d||(z=$C(t,A/2,n,s,l,c,d,!0,y)),z}function qC(t,e,n,s,l){const c=[];for(let d=0;d<t.length;d++){const _=t[d];let y;for(let w=0;w<_.length-1;w++){let E=_[w],A=_[w+1];E.x<e&&A.x<e||(E.x<e?E=new lt(e,E.y+(e-E.x)/(A.x-E.x)*(A.y-E.y))._round():A.x<e&&(A=new lt(e,E.y+(e-E.x)/(A.x-E.x)*(A.y-E.y))._round()),E.y<n&&A.y<n||(E.y<n?E=new lt(E.x+(n-E.y)/(A.y-E.y)*(A.x-E.x),n)._round():A.y<n&&(A=new lt(E.x+(n-E.y)/(A.y-E.y)*(A.x-E.x),n)._round()),E.x>=s&&A.x>=s||(E.x>=s?E=new lt(s,E.y+(s-E.x)/(A.x-E.x)*(A.y-E.y))._round():A.x>=s&&(A=new lt(s,E.y+(s-E.x)/(A.x-E.x)*(A.y-E.y))._round()),E.y>=l&&A.y>=l||(E.y>=l?E=new lt(E.x+(l-E.y)/(A.y-E.y)*(A.x-E.x),l)._round():A.y>=l&&(A=new lt(E.x+(l-E.y)/(A.y-E.y)*(A.x-E.x),l)._round()),y&&E.equals(y[y.length-1])||(y=[E],c.push(y)),y.push(A)))))}}return c}function HC(t){let e=0,n=0;for(const d of t)e+=d.w*d.h,n=Math.max(n,d.w);t.sort((d,_)=>_.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let l=0,c=0;for(const d of t)for(let _=s.length-1;_>=0;_--){const y=s[_];if(!(d.w>y.w||d.h>y.h)){if(d.x=y.x,d.y=y.y,c=Math.max(c,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===y.w&&d.h===y.h){const w=s.pop();_<s.length&&(s[_]=w)}else d.h===y.h?(y.x+=d.w,y.w-=d.w):d.w===y.w?(y.y+=d.h,y.h-=d.h):(s.push({x:y.x+d.w,y:y.y,w:y.w-d.w,h:d.h}),y.y+=d.h,y.h-=d.h);break}}return{w:l,h:c,fill:e/(l*c)||0}}se(Zh,"Anchor");const na=1;class iT{constructor(e,{pixelRatio:n,version:s,stretchX:l,stretchY:c,content:d}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=l,this.stretchY=c,this.content=d,this.version=s}get tl(){return[this.paddedRect.x+na,this.paddedRect.y+na]}get br(){return[this.paddedRect.x+this.paddedRect.w-na,this.paddedRect.y+this.paddedRect.h-na]}get displaySize(){return[(this.paddedRect.w-2*na)/this.pixelRatio,(this.paddedRect.h-2*na)/this.pixelRatio]}}class ZC{constructor(e,n,s){const l={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,l,d),this.addImages(n,c,d);const{w:_,h:y}=HC(d),w=new Mo({width:_||1,height:y||1});for(const E in e){const A=e[E],I=l[E].paddedRect;Mo.copy(A.data,w,{x:0,y:0},{x:I.x+na,y:I.y+na},A.data,s,A.sdf)}for(const E in n){const A=n[E],I=c[E].paddedRect,z=I.x+na,k=I.y+na,B=A.data.width,N=A.data.height;Mo.copy(A.data,w,{x:0,y:0},{x:z,y:k},A.data,s),Mo.copy(A.data,w,{x:0,y:N-1},{x:z,y:k-1},{width:B,height:1},s),Mo.copy(A.data,w,{x:0,y:0},{x:z,y:k+N},{width:B,height:1},s),Mo.copy(A.data,w,{x:B-1,y:0},{x:z-1,y:k},{width:1,height:N},s),Mo.copy(A.data,w,{x:0,y:0},{x:z+B,y:k},{width:1,height:N},s)}this.image=w,this.iconPositions=l,this.patternPositions=c}addImages(e,n,s){for(const l in e){const c=e[l],d={x:0,y:0,w:c.data.width+2*na,h:c.data.height+2*na};s.push(d),n[l]=new iT(d,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,n,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const l in e.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[l],e.getImage(l,s),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l,s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[l,c]=e.tl,d=!!Object.keys(this.patternPositions).length;s.update(n.data,{useMipmap:d},{x:l,y:c})}}se(iT,"ImagePosition"),se(ZC,"ImageAtlas");const Oy=1e20;function XC(t,e,n,s,l,c,d,_,y){for(let w=e;w<e+s;w++)YC(t,n*c+w,c,l,d,_,y);for(let w=n;w<n+l;w++)YC(t,w*c+e,1,s,d,_,y)}function YC(t,e,n,s,l,c,d){c[0]=0,d[0]=-Oy,d[1]=Oy,l[0]=t[e];for(let _=1,y=0,w=0;_<s;_++){l[_]=t[e+_*n];const E=_*_;do{const A=c[y];w=(l[_]-l[A]+E-A*A)/(_-A)/2}while(w<=d[y]&&--y>-1);y++,c[y]=_,d[y]=w,d[y+1]=Oy}for(let _=0,y=0;_<s;_++){for(;d[y+1]<_;)y++;const w=c[y],E=_-w;t[e+_*n]=l[w]+E*E}}const _u=2,sT={none:0,ideographs:1,all:2};class M_{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,s){const l=[],c=this.urls[n]||Q.GLYPHS_URL;for(const d in e)for(const _ of e[d])l.push({stack:d,id:_});Ul(l,({stack:d,id:_},y)=>{let w=this.entries[d];w||(w=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=w.glyphs[_];if(E!==void 0)return void y(null,{stack:d,id:_,glyph:E});if(E=this._tinySDF(w,d,_),E)return w.glyphs[_]=E,void y(null,{stack:d,id:_,glyph:E});const A=Math.floor(_/256);if(256*A>65535)return void y(new Error("glyphs > 65535 not supported"));if(w.ranges[A])return void y(null,{stack:d,id:_,glyph:E});let I=w.requests[A];I||(I=w.requests[A]=[],M_.loadGlyphRange(d,A,c,this.requestManager,(z,k)=>{if(k){w.ascender=k.ascender,w.descender=k.descender;for(const B in k.glyphs)this._doesCharSupportLocalGlyph(+B)||(w.glyphs[+B]=k.glyphs[+B]);w.ranges[A]=!0}for(const B of I)B(z,k);delete w.requests[A]})),I.push((z,k)=>{z?y(z):k&&y(null,{stack:d,id:_,glyph:k.glyphs[_]||null})})},(d,_)=>{if(d)s(d);else if(_){const y={};for(const{stack:w,id:E,glyph:A}of _)y[w]===void 0&&(y[w]={}),y[w].glyphs===void 0&&(y[w].glyphs={}),y[w].glyphs[E]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;s(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==sT.none&&(this.localGlyphMode===sT.all?!!this.localFontFamily:!!this.localFontFamily&&(pe["CJK Unified Ideographs"](e)||pe["Hangul Syllables"](e)||pe.Hiragana(e)||pe.Katakana(e)||pe["CJK Symbols and Punctuation"](e)||pe["CJK Unified Ideographs Extension A"](e)||pe["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,s){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(s))return;let c=e.tinySDF;if(!c){let B="400";/bold/i.test(n)?B="900":/medium/i.test(n)?B="500":/light/i.test(n)&&(B="200"),c=e.tinySDF=new M_.TinySDF({fontFamily:l,fontWeight:B,fontSize:24*_u,buffer:3*_u,radius:8*_u}),c.fontWeight=B}if(this.localGlyphs[c.fontWeight][s])return this.localGlyphs[c.fontWeight][s];const d=String.fromCodePoint(s),{data:_,width:y,height:w,glyphWidth:E,glyphHeight:A,glyphLeft:I,glyphTop:z,glyphAdvance:k}=c.draw(d);return this.localGlyphs[c.fontWeight][s]={id:s,bitmap:new kc({width:y,height:w},_),metrics:{width:E/_u,height:A/_u,left:I/_u,top:z/_u-27,advance:k/_u,localGlyph:!0}}}}M_.loadGlyphRange=function(t,e,n,s,l){const c=256*e,d=c+255,_=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${c}-${d}`),ec.Glyphs);Wl(_,(y,w)=>{if(y)l(y);else if(w){const E={},A=function(I){return new E_(I).readFields(B5,{})}(w);for(const I of A.glyphs)E[I.id]=I;l(null,{glyphs:E,ascender:A.ascender,descender:A.descender})}})},M_.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:l="sans-serif",fontWeight:c="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const _=this.size=t+4*e,y=this._createCanvas(_),w=this.ctx=y.getContext("2d",{willReadFrequently:!0});w.font=`${d} ${c} ${t}px ${l}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:l,actualBoundingBoxRight:c}=this.ctx.measureText(t),d=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-l))),y=Math.min(this.size-this.buffer,d+Math.ceil(s)),w=_+2*this.buffer,E=y+2*this.buffer,A=Math.max(w*E,0),I=new Uint8ClampedArray(A),z={data:I,width:w,height:E,glyphWidth:_,glyphHeight:y,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return z;const{ctx:k,buffer:B,gridInner:N,gridOuter:W}=this;k.clearRect(B,B,_,y),k.fillText(t,B,B+d);const ee=k.getImageData(B,B,_,y);W.fill(Oy,0,A),N.fill(0,0,A);for(let te=0;te<y;te++)for(let ne=0;ne<_;ne++){const me=ee.data[4*(te*_+ne)+3]/255;if(me===0)continue;const de=(te+B)*w+ne+B;if(me===1)W[de]=0,N[de]=Oy;else{const be=.5-me;W[de]=be>0?be*be:0,N[de]=be<0?be*be:0}}XC(W,0,0,w,E,w,this.f,this.v,this.z),XC(N,B,B,_,y,w,this.f,this.v,this.z);for(let te=0;te<A;te++){const ne=Math.sqrt(W[te])-Math.sqrt(N[te]);I[te]=Math.round(255-255*(ne/this.radius+this.cutoff))}return z}};const _f=na;function KC(t,e,n,s){const l=[],c=t.imagePrimary,d=c.pixelRatio,_=c.paddedRect.w-2*_f,y=c.paddedRect.h-2*_f,w=t.right-t.left,E=t.bottom-t.top,A=c.stretchX||[[0,_]],I=c.stretchY||[[0,y]],z=(Ve,Je)=>Ve+Je[1]-Je[0],k=A.reduce(z,0),B=I.reduce(z,0),N=_-k,W=y-B;let ee=0,te=k,ne=0,me=B,de=0,be=N,Ae=0,ze=W;if(c.content&&s){const Ve=c.content;ee=S1(A,0,Ve[0]),ne=S1(I,0,Ve[1]),te=S1(A,Ve[0],Ve[2]),me=S1(I,Ve[1],Ve[3]),de=Ve[0]-ee,Ae=Ve[1]-ne,be=Ve[2]-Ve[0]-te,ze=Ve[3]-Ve[1]-me}const $e=(Ve,Je,ht,Ye)=>{const it=E1(Ve.stretch-ee,te,w,t.left),qe=C1(Ve.fixed-de,be,Ve.stretch,k),st=E1(Je.stretch-ne,me,E,t.top),mt=C1(Je.fixed-Ae,ze,Je.stretch,B),ut=E1(ht.stretch-ee,te,w,t.left),Lt=C1(ht.fixed-de,be,ht.stretch,k),dt=E1(Ye.stretch-ne,me,E,t.top),yt=C1(Ye.fixed-Ae,ze,Ye.stretch,B),Wt=new lt(it,st),jt=new lt(ut,st),Ut=new lt(ut,dt),_t=new lt(it,dt),qt=new lt(qe/d,mt/d),pn=new lt(Lt/d,yt/d),nn=e*Math.PI/180;if(nn){const cr=Math.sin(nn),Jn=Math.cos(nn),qn=[Jn,-cr,cr,Jn];Wt._matMult(qn),jt._matMult(qn),_t._matMult(qn),Ut._matMult(qn)}const vn=Ve.stretch+Ve.fixed,mn=ht.stretch+ht.fixed,Pn=Je.stretch+Je.fixed,Jt=Ye.stretch+Ye.fixed,hr=t.imageSecondary;return{tl:Wt,tr:jt,bl:_t,br:Ut,texPrimary:{x:c.paddedRect.x+_f+vn,y:c.paddedRect.y+_f+Pn,w:mn-vn,h:Jt-Pn},texSecondary:hr?{x:hr.paddedRect.x+_f+vn,y:hr.paddedRect.y+_f+Pn,w:mn-vn,h:Jt-Pn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qt,pixelOffsetBR:pn,minFontScaleX:be/d/w,minFontScaleY:ze/d/E,isSDF:n}};if(s&&(c.stretchX||c.stretchY)){const Ve=JC(A,N,k),Je=JC(I,W,B);for(let ht=0;ht<Ve.length-1;ht++){const Ye=Ve[ht],it=Ve[ht+1];for(let qe=0;qe<Je.length-1;qe++)l.push($e(Ye,Je[qe],it,Je[qe+1]))}}else l.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:y+1}));return l}function S1(t,e,n){let s=0;for(const l of t)s+=Math.max(e,Math.min(n,l[1]))-Math.max(e,Math.min(n,l[0]));return s}function JC(t,e,n){const s=[{fixed:-_f,stretch:0}];for(const[l,c]of t){const d=s[s.length-1];s.push({fixed:l-d.stretch,stretch:d.stretch}),s.push({fixed:l-d.stretch,stretch:d.stretch+(c-l)})}return s.push({fixed:e+_f,stretch:n}),s}function E1(t,e,n,s){return t/e*n+s}function C1(t,e,n,s){return t-e*n/s}function $5(t,e,n,s){const l=e+t.positionedLines[s].lineOffset;return s===0?n+l/2:n+(l+(e+t.positionedLines[s-1].lineOffset))/2}function q5(t,e=1,n=!1){let s=1/0,l=1/0,c=-1/0,d=-1/0;const _=t[0];for(let z=0;z<_.length;z++){const k=_[z];(!z||k.x<s)&&(s=k.x),(!z||k.y<l)&&(l=k.y),(!z||k.x>c)&&(c=k.x),(!z||k.y>d)&&(d=k.y)}const y=Math.min(c-s,d-l);let w=y/2;const E=new wp([],H5);if(y===0)return new lt(s,l);for(let z=s;z<c;z+=y)for(let k=l;k<d;k+=y)E.push(new I_(z+w,k+w,w,t));let A=function(z){let k=0,B=0,N=0;const W=z[0];for(let ee=0,te=W.length,ne=te-1;ee<te;ne=ee++){const me=W[ee],de=W[ne],be=me.x*de.y-de.x*me.y;B+=(me.x+de.x)*be,N+=(me.y+de.y)*be,k+=3*be}return new I_(B/k,N/k,0,z)}(t),I=E.length;for(;E.length;){const z=E.pop();(z.d>A.d||!A.d)&&(A=z,n&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,I)),z.max-A.d<=e||(w=z.h/2,E.push(new I_(z.p.x-w,z.p.y-w,w,t)),E.push(new I_(z.p.x+w,z.p.y-w,w,t)),E.push(new I_(z.p.x-w,z.p.y+w,w,t)),E.push(new I_(z.p.x+w,z.p.y+w,w,t)),I+=4)}return n&&(console.log(`num probes: ${I}`),console.log(`best distance: ${A.d}`)),A.p}function H5(t,e){return e.max-t.max}class I_{constructor(e,n,s,l){this.p=new lt(e,n),this.h=s,this.d=function(c,d){let _=!1,y=1/0;for(let w=0;w<d.length;w++){const E=d[w];for(let A=0,I=E.length,z=I-1;A<I;z=A++){const k=E[A],B=E[z];k.y>c.y!=B.y>c.y&&c.x<(B.x-k.x)*(c.y-k.y)/(B.y-k.y)+k.x&&(_=!_),y=Math.min(y,Tx(c,k,B))}}return(_?1:-1)*Math.sqrt(y)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const oT=Number.POSITIVE_INFINITY,Z5=Math.sqrt(2);function QC(t,[e,n]){let s=0,l=0;if(n===oT){e<0&&(e=0);const c=e/Z5;switch(t){case"top-right":case"top-left":l=c-7;break;case"bottom-right":case"bottom-left":l=7-c;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(t){case"top-right":case"bottom-right":s=-c;break;case"top-left":case"bottom-left":s=c;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":l=n-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-n}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,l]}function aT(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function X5(t,e,n,s,l,c,d,_,y,w,E,A,I,z,k){let B=c.textMaxSize.evaluate(e,{},A);B===void 0&&(B=d);const N=t.layers[0].layout,W=N.get("icon-offset").evaluate(e,{},A),ee=tA(n.horizontal)||n.vertical,te=I.name==="globe",ne=hs,me=d/ne,de=t.tilePixelRatio*B/ne,be=(it=t.overscaling,t.zoom>18&&it>2&&(it>>=1),Math.max(xt/(512*it),1)*N.get("symbol-spacing")),Ae=N.get("text-padding")*t.tilePixelRatio,ze=N.get("icon-padding")*t.tilePixelRatio,$e=kn(N.get("text-max-angle")),Ve=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Je=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",ht=N.get("symbol-placement"),Ye=be/2;var it;const qe=N.get("icon-text-fit").evaluate(e,{},A),st=N.get("icon-text-fit-padding").evaluate(e,{},A),mt=qe!=="none";let ut;t.hasAnyIconTextFit===!1&&mt&&(t.hasAnyIconTextFit=!0),s&&mt&&(t.allowVerticalPlacement&&n.vertical&&(ut=VC(s,n.vertical,qe,st,W,me)),ee&&(s=VC(s,ee,qe,st,W,me)));const Lt=(dt,yt,Wt)=>{if(yt.x<0||yt.x>=xt||yt.y<0||yt.y>=xt)return;let jt=null;if(te){const{x:Ut,y:_t,z:qt}=I.projectTilePoint(yt.x,yt.y,Wt);jt={anchor:new Zh(Ut,_t,qt,0,void 0),up:I.upVector(Wt,yt.x,yt.y)}}(function(Ut,_t,qt,pn,nn,vn,mn,Pn,Jt,hr,cr,Jn,qn,Qn,Cr,gr,$r,Ur,Is,ti,Or,yi,Ji,Qi,wr,uo,Xh){const wl=Ut.addToLineVertexArray(_t,pn);let bu,Tf,Sf,hm,rM,iM,sM,oM=0,aM=0,lM=0,uM=0,zT=-1,kT=-1;const Uc={};let cM=ql("");const dm=qt?qt.anchor:_t,OT=Jt.layout.get("icon-text-fit").evaluate(Or,{},wr)!=="none";let BT=0,FT=0;if(Jt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[BT,FT]=Jt.layout.get("text-offset").evaluate(Or,{},wr).map(ia=>ia*hs):(BT=Jt.layout.get("text-radial-offset").evaluate(Or,{},wr)*hs,FT=oT),Ut.allowVerticalPlacement&&nn.vertical){const ia=nn.vertical;if(Cr)iM=lT(ia),Pn&&(sM=lT(Pn));else{const sa=Jt.layout.get("text-rotate").evaluate(Or,{},wr)+90;Sf=A1(hr,dm,_t,cr,Jn,qn,ia,Qn,sa,gr),Pn&&(hm=A1(hr,dm,_t,cr,Jn,qn,Pn,Ur,sa))}}if(vn){const ia=Jt.layout.get("icon-rotate").evaluate(Or,{},wr),sa=KC(vn,ia,Ji,OT),F_=Pn?KC(Pn,ia,Ji,OT):void 0;Tf=A1(hr,dm,_t,cr,Jn,qn,vn,Ur,ia),oM=4*sa.length;const hM=Ut.iconSizeData;let fm=null;hM.kind==="source"?(fm=[mu*Jt.layout.get("icon-size").evaluate(Or,{},wr)],fm[0]>gf&&xr(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${By}. Reduce your "icon-size".`)):hM.kind==="composite"&&(fm=[mu*yi.compositeIconSizes[0].evaluate(Or,{},wr),mu*yi.compositeIconSizes[1].evaluate(Or,{},wr)],(fm[0]>gf||fm[1]>gf)&&xr(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${By}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,sa,fm,ti,Is,Or,!1,qt,_t,wl.lineStartIndex,wl.lineLength,-1,Qi,wr,uo,Xh),zT=Ut.icon.placedSymbolArray.length-1,F_&&(aM=4*F_.length,Ut.addSymbols(Ut.icon,F_,fm,ti,Is,Or,za.vertical,qt,_t,wl.lineStartIndex,wl.lineLength,-1,Qi,wr,uo,Xh),kT=Ut.icon.placedSymbolArray.length-1)}for(const ia in nn.horizontal){const sa=nn.horizontal[ia];bu||(cM=ql(sa.text),Cr?rM=lT(sa):bu=A1(hr,dm,_t,cr,Jn,qn,sa,Qn,Jt.layout.get("text-rotate").evaluate(Or,{},wr),gr));const F_=sa.positionedLines.length===1;if(lM+=eA(Ut,qt,_t,sa,mn,Jt,Cr,Or,gr,wl,nn.vertical?za.horizontal:za.horizontalOnly,F_?Object.keys(nn.horizontal):[ia],Uc,zT,yi,Qi,wr,uo),F_)break}nn.vertical&&(uM+=eA(Ut,qt,_t,nn.vertical,mn,Jt,Cr,Or,gr,wl,za.vertical,["vertical"],Uc,kT,yi,Qi,wr,uo));let Ef=-1;const NT=(ia,sa)=>ia?Math.max(ia,sa):sa;Ef=NT(rM,Ef),Ef=NT(iM,Ef),Ef=NT(sM,Ef);const fk=Ef>-1?1:0;Ut.glyphOffsetArray.length>=65535&&xr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Or.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Or.sortKey),Ut.symbolInstances.emplaceBack(_t.x,_t.y,dm.x,dm.y,dm.z,Uc.right>=0?Uc.right:-1,Uc.center>=0?Uc.center:-1,Uc.left>=0?Uc.left:-1,Uc.vertical>=0?Uc.vertical:-1,zT,kT,cM,bu!==void 0?bu:Ut.collisionBoxArray.length,bu!==void 0?bu+1:Ut.collisionBoxArray.length,Sf!==void 0?Sf:Ut.collisionBoxArray.length,Sf!==void 0?Sf+1:Ut.collisionBoxArray.length,Tf!==void 0?Tf:Ut.collisionBoxArray.length,Tf!==void 0?Tf+1:Ut.collisionBoxArray.length,hm||Ut.collisionBoxArray.length,hm?hm+1:Ut.collisionBoxArray.length,cr,lM,uM,oM,aM,fk,0,BT,FT,Ef,0,1,1,OT?1:0)})(t,yt,jt,dt,n,s,l,ut,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Ae,Ve,y,0,ze,Je,W,e,c,w,E,A,z,k)};if(ht==="line")for(const dt of qC(e.geometry,0,0,xt,xt)){const yt=W5(dt,be,$e,n.vertical||ee,s,ne,de,t.overscaling,xt);for(const Wt of yt)ee&&Y5(t,ee.text,Ye,Wt)||Lt(dt,Wt,A)}else if(ht==="line-center"){for(const dt of e.geometry)if(dt.length>1){const yt=G5(dt,$e,n.vertical||ee,s,ne,de);yt&&Lt(dt,yt,A)}}else if(e.type==="Polygon")for(const dt of __(e.geometry,0)){const yt=q5(dt,16);Lt(dt[0],new Zh(yt.x,yt.y,0,0,void 0),A)}else if(e.type==="LineString")for(const dt of e.geometry)Lt(dt,new Zh(dt[0].x,dt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const dt of e.geometry)for(const yt of dt)Lt([yt],new Zh(yt.x,yt.y,0,0,void 0),A)}const By=255,gf=By*mu;function eA(t,e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N,W){const ee=function(me,de,be,Ae,ze,$e,Ve,Je){const ht=[];if(de.positionedLines.length===0)return ht;const Ye=Ae.layout.get("text-rotate").evaluate($e,{})*Math.PI/180,it=function(Lt){const dt=Lt[0],yt=Lt[1],Wt=dt*yt;return Wt>0?[dt,-yt]:Wt<0?[-dt,yt]:dt===0?[yt,dt]:[yt,-dt]}(be);let qe=Math.abs(de.top-de.bottom);for(const Lt of de.positionedLines)qe-=Lt.lineOffset;const st=de.positionedLines.length,mt=qe/st;let ut=de.top-be[1];for(let Lt=0;Lt<st;++Lt){const dt=de.positionedLines[Lt];ut=$5(de,mt,ut,Lt);for(const yt of dt.positionedGlyphs){if(!yt.rect)continue;const Wt=yt.rect||{};let jt=zC+1,Ut=!0,_t=1,qt=0;if(yt.imageName){const ti=Ve[yt.imageName];if(!ti)continue;if(ti.sdf){xr("SDF images are not supported in formatted text and will be ignored.");continue}Ut=!1,_t=ti.pixelRatio,jt=na/_t}const pn=(ze||Je)&&yt.vertical,nn=yt.metrics.advance*yt.scale/2,vn=yt.metrics,mn=yt.rect;if(mn===null)continue;Je&&de.verticalizable&&(qt=yt.imageName?nn-yt.metrics.width*yt.scale/2:0);const Pn=ze?[yt.x+nn,yt.y]:[0,0];let Jt=[0,0],hr=[0,0],cr=!1;ze||(pn?(hr=[yt.x+nn+it[0],yt.y+it[1]-qt],cr=!0):Jt=[yt.x+nn+be[0],yt.y+be[1]-qt]);const Jn=mn.w*yt.scale/(_t*(yt.localGlyph?_u:1)),qn=mn.h*yt.scale/(_t*(yt.localGlyph?_u:1));let Qn,Cr,gr,$r;if(pn){const ti=yt.y-ut,Or=new lt(-nn,nn-ti),yi=-Math.PI/2,Ji=new lt(...hr);Qn=new lt(-nn+Jt[0],Jt[1]),Qn._rotateAround(yi,Or)._add(Ji),Qn.x+=-ti+nn,Qn.y-=(vn.left-jt)*yt.scale;const Qi=yt.imageName?vn.advance*yt.scale:hs*yt.scale,wr=String.fromCodePoint(yt.glyph);k5(wr)?Qn.x+=(1-jt)*yt.scale:O5(wr)?Qn.x+=Qi-vn.height*yt.scale+(-jt-1)*yt.scale:Qn.x+=yt.imageName||vn.width+2*jt===mn.w&&vn.height+2*jt===mn.h?(Qi-qn)/2:(Qi-(vn.height+2*jt)*yt.scale)/2,Cr=new lt(Qn.x,Qn.y-Jn),gr=new lt(Qn.x+qn,Qn.y),$r=new lt(Qn.x+qn,Qn.y-Jn)}else{const ti=(vn.left-jt)*yt.scale-nn+Jt[0],Or=(-vn.top-jt)*yt.scale+Jt[1],yi=ti+Jn,Ji=Or+qn;Qn=new lt(ti,Or),Cr=new lt(yi,Or),gr=new lt(ti,Ji),$r=new lt(yi,Ji)}if(Ye){let ti;ti=ze?new lt(0,0):cr?new lt(it[0],it[1]):new lt(be[0],be[1]),Qn._rotateAround(Ye,ti),Cr._rotateAround(Ye,ti),gr._rotateAround(Ye,ti),$r._rotateAround(Ye,ti)}const Ur=new lt(0,0),Is=new lt(0,0);ht.push({tl:Qn,tr:Cr,bl:gr,br:$r,texPrimary:Wt,texSecondary:void 0,writingMode:de.writingMode,glyphOffset:Pn,sectionIndex:yt.sectionIndex,isSDF:Ut,pixelOffsetTL:Ur,pixelOffsetBR:Is,minFontScaleX:0,minFontScaleY:0})}}return ht}(0,s,y,c,d,_,l,t.allowVerticalPlacement),te=t.textSizeData;let ne=null;te.kind==="source"?(ne=[mu*c.layout.get("text-size").evaluate(_,{},N)],ne[0]>gf&&xr(`${t.layerIds[0]}: Value for "text-size" is >= ${By}. Reduce your "text-size".`)):te.kind==="composite"&&(ne=[mu*k.compositeTextSizes[0].evaluate(_,{},N),mu*k.compositeTextSizes[1].evaluate(_,{},N)],(ne[0]>gf||ne[1]>gf)&&xr(`${t.layerIds[0]}: Value for "text-size" is >= ${By}. Reduce your "text-size".`)),t.addSymbols(t.text,ee,ne,y,d,_,E,e,n,w.lineStartIndex,w.lineLength,z,B,N,W,!1);for(const me of A)I[me]=t.text.placedSymbolArray.length-1;return 4*ee.length}function tA(t){for(const e in t)return t[e];return null}function A1(t,e,n,s,l,c,d,_,y,w){let E=d.top,A=d.bottom,I=d.left,z=d.right;const k=d.collisionPadding;if(k&&(I-=k[0],E-=k[1],z+=k[2],A+=k[3]),y){const B=new lt(I,E),N=new lt(z,E),W=new lt(I,A),ee=new lt(z,A),te=kn(y);let ne=new lt(0,0);w&&(ne=new lt(w[0],w[1])),B._rotateAround(te,ne),N._rotateAround(te,ne),W._rotateAround(te,ne),ee._rotateAround(te,ne),I=Math.min(B.x,N.x,W.x,ee.x),z=Math.max(B.x,N.x,W.x,ee.x),E=Math.min(B.y,N.y,W.y,ee.y),A=Math.max(B.y,N.y,W.y,ee.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,I,E,z,A,_,s,l,c),t.length-1}function lT(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Y5(t,e,n,s){const l=t.compareText;if(e in l){const c=l[e];for(let d=c.length-1;d>=0;d--)if(s.dist(c[d])<n)return!0}else l[e]=[];return l[e].push(s),!1}function nA(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),c=Math.sin(n)*l/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),d=Math.sin(t._pitch)*c+l;return Math.min(1.01*d,l*(1/t._horizonShift))}function sm(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,l=(t.x+1)*n,c=t.y*n,d=(t.y+1)*n,_=Gs(s),y=Gs(l),w=Ni(c),E=Ni(d),A=e.project(_,w),I=e.project(y,w),z=e.project(y,E),k=e.project(_,E);let B=Math.min(A.x,I.x,z.x,k.x),N=Math.min(A.y,I.y,z.y,k.y),W=Math.max(A.x,I.x,z.x,k.x),ee=Math.max(A.y,I.y,z.y,k.y);const te=n/16;function ne(de,be,Ae,ze,$e,Ve){const Je=(Ae+$e)/2,ht=(ze+Ve)/2,Ye=e.project(Gs(Je),Ni(ht)),it=Math.max(0,B-Ye.x,N-Ye.y,Ye.x-W,Ye.y-ee);B=Math.min(B,Ye.x),W=Math.max(W,Ye.x),N=Math.min(N,Ye.y),ee=Math.max(ee,Ye.y),it>te&&(ne(de,Ye,Ae,ze,Je,ht),ne(Ye,be,Je,ht,$e,Ve))}ne(A,I,s,c,l,c),ne(I,z,l,c,l,d),ne(z,k,l,d,s,d),ne(k,A,s,d,s,c),B-=te,N-=te,W+=te,ee+=te;const me=1/Math.max(W-B,ee-N);return{scale:me,x:B*me,y:N*me,x2:W*me,y2:ee*me,projection:e}}function rA(t,{x:e,y:n},s=0){return new lt(((e-s)*t.scale-t.x)*xt,(n*t.scale-t.y)*xt)}const K5=o.ad.identity(new Float32Array(16));class yf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Un(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return Ms(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return nA(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,l){const c=e.horizonLineFromTop(!1),d=new lt(n,Math.max(c,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,l))}pointCoordinate3D(e,n,s){const l=new lt(n,s);if(e.elevation)return e.elevation.pointCoordinate(l);{const c=this.pointCoordinate(e,l.x,l.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return K5}createTileMatrix(e,n,s){let l,c,d;const _=s.canonical,y=o.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=sm(_,this);l=1,c=w.x+s.wrap*w.scale,d=w.y,o.ad.scale(y,y,[l/w.scale,l/w.scale,e.pixelsPerMeter/n])}else l=n/e.zoomScale(_.z),c=(_.x+Math.pow(2,_.z)*s.wrap)*l,d=_.y*l;return o.ad.translate(y,y,[c,d,0]),o.ad.scale(y,y,[l/xt,l/xt,1]),y}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class J5 extends yf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(kn(n));this.n=(l+Math.sin(kn(s)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c:l,r0:c}=this,d=kn(e-this.center[0]),_=kn(n),y=Math.sqrt(l-2*s*Math.sin(_))/s;return{x:y*Math.sin(d*s),y:y*Math.cos(d*s)-c,z:0}}unproject(e,n){const{n:s,c:l,r0:c}=this,d=c+n;let _=Math.atan2(e,Math.abs(d))*Math.sign(d);d*s<0&&(_-=Math.PI*Math.sign(e)*Math.sign(d));const y=kn(this.center[0])*s;_=Ds(_,-Math.PI-y,Math.PI-y);const w=Xt(Gi(_/s)+this.center[0],-180,180),E=Math.asin(Xt((l-(e*e+d*d)*s*s)/(2*s),-1,1)),A=Xt(Gi(E),-Kr,Kr);return new Un(w,A)}}const Fy=1.340264,Ny=-.081106,Vy=893e-6,Uy=.003796,M1=Math.sqrt(3)/2;class Q5 extends yf{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(M1*Math.sin(n)),l=s*s,c=l*l*l;return{x:.5*(e*Math.cos(s)/(M1*(Fy+3*Ny*l+c*(7*Vy+9*Uy*l)))/Math.PI+.5),y:1-.5*(s*(Fy+Ny*l+c*(Vy+Uy*l))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,l=s*s,c=l*l*l;for(let E,A,I,z=0;z<12&&(A=s*(Fy+Ny*l+c*(Vy+Uy*l))-n,I=Fy+3*Ny*l+c*(7*Vy+9*Uy*l),E=A/I,s=Xt(s-E,-Math.PI/3,Math.PI/3),l=s*s,c=l*l*l,!(Math.abs(E)<1e-12));++z);const d=M1*e*(Fy+3*Ny*l+c*(7*Vy+9*Uy*l))/Math.cos(s),_=Math.asin(Math.sin(s)/M1),y=Xt(180*d/Math.PI,-180,180),w=Xt(180*_/Math.PI,-Kr,Kr);return new Un(y,w)}}class ez extends yf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),l=Xt(360*(.5-n),-Kr,Kr);return new Un(s,l)}}const P_=Math.PI/2;function I1(t){return Math.tan((P_+t)/2)}class tz extends yf{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let l=kn(n),c=kn(s);this.southernCenter=l+c<0,this.southernCenter&&(l=-l,c=-c);const d=Math.cos(l),_=I1(l);this.n=l===c?Math.sin(l):Math.log(d/Math.cos(c))/Math.log(I1(c)/_),this.f=d*Math.pow(I1(l),this.n)/this.n}project(e,n){n=kn(n),this.southernCenter&&(n=-n),e=kn(e-this.center[0]);const s=1e-6,{n:l,f:c}=this;c>0?n<-P_+s&&(n=-P_+s):n>P_-s&&(n=P_-s);const d=c/Math.pow(I1(n),l);let _=d*Math.sin(l*e),y=c-d*Math.cos(l*e);return _=.5*(_/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:_,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:l}=this,c=l-n,d=Math.sign(c),_=Math.sign(s)*Math.sqrt(e*e+c*c);let y=Math.atan2(e,Math.abs(c))*d;c*s<0&&(y-=Math.PI*Math.sign(e)*d);const w=Xt(Gi(y/s)+this.center[0],-180,180),E=Xt(Gi(2*Math.atan(Math.pow(l/_,1/s))-P_),-Kr,Kr);return new Un(w,this.southernCenter?-E:E)}}class iA extends yf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:dl(e),y:fl(n),z:0}}unproject(e,n){const s=Gs(e),l=Ni(n);return new Un(s,l)}}const sA=kn(Kr);class nz extends yf{project(e,n){const s=(n=kn(n))*n,l=s*s;return{x:.5*((e=kn(e))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,l=25,c=0,d=s*s;do{d=s*s;const w=d*d;c=(s*(1.007226+d*(.015085+w*(.028874*d-.044475-.005916*w)))-n)/(1.007226+d*(.045255+w*(.259866*d-.311325-.005916*11*w))),s=Xt(s-c,-sA,sA)}while(Math.abs(c)>1e-6&&--l>0);d=s*s;const _=Xt(Gi(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),y=Gi(s);return new Un(_,y)}}const oA=kn(Kr);class rz extends yf{project(e,n){n=kn(n),e=kn(e);const s=Math.cos(n),l=2/Math.PI,c=Math.acos(s*Math.cos(e/2)),d=Math.sin(c)/c,_=.5*(e*l+2*s*Math.sin(e/2)/d)||0,y=.5*(n+Math.sin(n)/d)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,l=n=(2*(1-n)-1)*Math.PI,c=25;const d=1e-6;let _=0,y=0;do{const w=Math.cos(l),E=Math.sin(l),A=2*E*w,I=E*E,z=w*w,k=Math.cos(s/2),B=Math.sin(s/2),N=2*k*B,W=B*B,ee=1-z*k*k,te=ee?1/ee:0,ne=ee?Math.acos(w*k)*Math.sqrt(1/ee):0,me=.5*(2*ne*w*B+2*s/Math.PI)-e,de=.5*(ne*E+l)-n,be=.5*te*(z*W+ne*w*k*I)+1/Math.PI,Ae=te*(N*A/4-ne*E*B),ze=.125*te*(A*B-ne*E*z*N),$e=.5*te*(I*k+ne*W*w)+.5,Ve=Ae*ze-$e*be;_=(de*Ae-me*$e)/Ve,y=(me*ze-de*be)/Ve,s=Xt(s-_,-Math.PI,Math.PI),l=Xt(l-y,-oA,oA)}while((Math.abs(_)>d||Math.abs(y)>d)&&--c>0);return new Un(Gi(s),Gi(l))}}class aA extends yf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(kn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:l}=this;return{x:kn(e)*l*s+.5,y:-Math.sin(kn(n))/l*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:l}=this,c=-(n-.5)/s,d=Xt(Gi((e-.5)/s)/l,-180,180),_=Math.asin(Xt(c*l,-1,1)),y=Xt(Gi(_),-Kr,Kr);return new Un(d,y)}}class iz extends iA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,s){const l=hf(e,n,s),c=_l(ml(s));return o._.transformMat4(l,l,c),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,n){const s=Uh(n.lat,n.lng),l=o._.normalize([],s),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,d=Ms(1,0)*xt*c;o._.scaleAndAdd(s,s,l,d);const _=o.ad.identity(new Float64Array(16));return o.ad.multiply(_,e.pixelMatrix,e.globeMatrix),o._.transformMat4(s,s,_),new lt(s[0],s[1])}pixelsPerMeter(e,n){return Ms(1,0)*n}pixelSpaceConversion(e,n,s){const l=Ms(1,e)*n,c=Ht(Ms(1,45)*n,l,s);return this.pixelsPerMeter(e,n)/c}createTileMatrix(e,n,s){const l=gy(ml(s.canonical));return o.ad.multiply(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,n){const{center:s}=e,l=_l(ml(n));return o.ad.rotateY(l,l,kn(s.lng)),o.ad.rotateX(l,l,kn(s.lat)),o.ad.scale(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,n,s,l){return Rx(e,n,s,!0)||new Hi(0,0)}pointCoordinate3D(e,n,s){const l=this.pointCoordinate(e,n,s,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,n){return!Rx(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(l,c){const d=l.cameraToCenterDistance,_=l._centerAltitude*c,y=l._camera,w=l._camera.forward(),E=o._.add([],o._.scale([],w,-d),[0,0,_]),A=l.worldSize/(2*Math.PI),I=[0,0,-A],z=l.width/l.height,k=Math.tan(l.fovAboveCenter),B=o._.scale([],y.up(),k),N=o._.scale([],y.right(),k*z),W=o._.normalize([],o._.add([],o._.add([],w,B),N)),ee=[];let te;if(new pl(E,W).closestPointOnSphere(I,A,ee)){const ne=o._.add([],ee,I),me=o._.sub([],ne,E);te=Math.cos(l.fovAboveCenter)*o._.length(me)}else{const ne=o._.sub([],E,I),me=o._.sub([],I,E);o._.normalize(me,me);const de=o._.length(ne)-A;te=Math.sqrt(de*(de+2*A));const be=Math.acos(te/(A+de))-Math.acos(o._.dot(w,me));te*=Math.cos(be)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=du(e.zoom);if(s>0){const l=nA(e,Ms(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ht(n,l+c*(1-Math.cos(d)),Math.pow(s,10))}return n}upVector(e,n,s){return hf(n,s,e,1)}upVectorScale(e){return{metersToTile:ei(Gh(ml(e)))}}}function lA(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new iA(t);case"equirectangular":return new ez(t);case"naturalEarth":return new nz(t);case"equalEarth":return new Q5(t);case"winkelTripel":return new rz(t);case"albers":return n?new aA(t):new J5(t);case"lambertConformalConic":return n?new aA(t):new tz(t);case"globe":return new iz(t)}throw new Error(`Invalid projection name: ${t.name}`)}class om{constructor(e,n,s,l){this.id=om.uniqueIdxCounter,om.uniqueIdxCounter++,this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||l||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=om.uniqueIdxCounter,om.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}om.uniqueIdxCounter=0;class R_{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}R_.ReadOnly=!1,R_.ReadWrite=!0,R_.disabled=new R_(519,R_.ReadOnly,[0,1]);const uT=7680;class cT{constructor(e,n,s,l,c,d){this.test=e,this.ref=n,this.mask=s,this.fail=l,this.depthFail=c,this.pass=d}}cT.disabled=new cT({func:519,mask:0},0,0,uT,uT,uT);const jy=771;class ra{constructor(e,n,s,l){this.blendFunction=e,this.blendColor=n,this.mask=s,this.blendEquation=l}}ra.Replace=[1,0,1,0],ra.disabled=new ra(ra.Replace,Gn.transparent,[!1,!1,!1,!1]),ra.unblended=new ra(ra.Replace,Gn.transparent,[!0,!0,!0,!0]),ra.alphaBlended=new ra([1,jy,1,jy],Gn.transparent,[!0,!0,!0,!0]),ra.alphaBlendedNonPremultiplied=new ra([770,jy,770,jy],Gn.transparent,[!0,!0,!0,!0]),ra.multiply=new ra([774,0,774,0],Gn.transparent,[!0,!0,!0,!0]);const hT=1029,dT=2305;class gu{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}gu.disabled=new gu(!1,hT,dT),gu.backCCW=new gu(!0,hT,dT),gu.backCW=new gu(!0,hT,2304),gu.frontCW=new gu(!0,1028,2304),gu.frontCCW=new gu(!0,1028,dT);const sz=ff.types,oz=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function P1(t,e,n,s,l,c,d,_,y,w,E,A,I){const z=_?Math.min(gf,Math.round(_[0])):0,k=_?Math.min(gf,Math.round(_[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*l),c,d,(z<<1)+(y?1:0),k,16*w,16*E,256*A,256*I)}function R1(t,e,n){t.emplaceBack(e,n)}function L1(t,e,n,s,l,c,d){t.emplaceBack(e,n,s,l,c,d)}function D1(t,e,n,s,l){t.emplaceBack(e,n,s,l),t.emplaceBack(e,n,s,l),t.emplaceBack(e,n,s,l),t.emplaceBack(e,n,s,l)}function az(t){for(const e of t.sections)if(Ke(e.text))return!0;return!1}class fT{constructor(e){this.layoutVertexArray=new Bg,this.indexArray=new Si,this.programConfigurations=e,this.segments=new Lr,this.dynamicLayoutVertexArray=new Ac,this.opacityVertexArray=new Ng,this.occlusionQueryOpacityVertexArray=new Nh,this.placedSymbolArray=new ux,this.iconTransitioningVertexArray=new Pc,this.globeExtVertexArray=new Fg,this.zOffsetVertexArray=new Nh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,s,l,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Io.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Po.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,oz,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,ui.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,pu.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,qs.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,ta.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}se(fT,"SymbolBuffers");class pT{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new Lr,this.collisionVertexArray=new i_,this.collisionVertexArrayExt=new Ac}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,g1.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,p5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}se(pT,"CollisionBuffers");class L_{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=o.ad.identity([]),this.placementViewportMatrix=o.ad.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=eT(this.zoom,n["text-size"]),this.iconSizeData=eT(this.zoom,n["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),c=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(d=>za[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new fT(new Pa(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new fT(new Pa(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new dx,this.lineVertexArray=new o_,this.symbolInstances=new hx}calculateGlyphDependencies(e,n,s,l,c){for(let d=0;d<e.length;d++){const _=e.codePointAt(d);if(_===void 0)break;if(n[_]=!0,l&&c&&_<=65535){const y=zy[e.charAt(d)];y&&(n[y.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const s=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Ly(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}populate(e,n,s,l){const c=this.layers[0],d=c.layout,_=this.projection.name==="globe",y=d.get("text-font"),w=d.get("text-field"),E=d.get("icon-image"),A=(w.value.kind!=="constant"||w.value.value instanceof oi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),I=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,z=d.get("symbol-sort-key");if(this.features=[],!A&&!I)return;const k=n.iconDependencies,B=n.glyphDependencies,N=n.availableImages,W=new tn(this.zoom);for(const{feature:ee,id:te,index:ne,sourceLayerIndex:me}of e){const de=c._featureFilter.needGeometry,be=uu(ee,de);if(!c._featureFilter.filter(W,be,s))continue;if(de||(be.geometry=Ra(ee,s,l)),_&&ee.type!==1&&s.z<=5){const Ve=be.geometry,Je=.98078528056,ht=(Ye,it)=>{const qe=hf(Ye.x,Ye.y,s,1),st=hf(it.x,it.y,s,1);return o._.dot(qe,st)<Je};for(let Ye=0;Ye<Ve.length;Ye++)Ve[Ye]=ob(Ve[Ye],ht)}let Ae,ze;if(A){const Ve=c.getValueAndResolveTokens("text-field",be,s,N),Je=oi.factory(Ve);az(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||yn()==="unavailable"||this.hasRTLText&&Vt.isParsed())&&(Ae=z5(Je,c,be))}if(I){const Ve=c.getValueAndResolveTokens("icon-image",be,s,N);ze=Ve instanceof Ti?Ve:Ti.fromString(Ve)}if(!Ae&&!ze)continue;const $e=this.sortFeaturesByKey?z.evaluate(be,{},s):void 0;if(this.features.push({id:te,text:Ae,icon:ze,index:ne,sourceLayerIndex:me,geometry:be.geometry,properties:ee.properties,type:sz[ee.type],sortKey:$e}),ze&&(k[ze.namePrimary]=!0,ze.nameSecondary&&(k[ze.nameSecondary]=!0)),Ae){const Ve=y.evaluate(be,{},s).join(","),Je=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(za.vertical)>=0;for(const ht of Ae.sections)if(ht.image)k[ht.image.namePrimary]=!0;else{const Ye=Be(Ae.toString()),it=ht.fontStack||Ve,qe=B[it]=B[it]||{};this.calculateGlyphDependencies(ht.text,qe,Je,this.allowVerticalPlacement,Ye)}}}d.get("symbol-placement")==="line"&&(this.features=function(ee){const te={},ne={},me=[];let de=0;function be(Ve){me.push(ee[Ve]),de++}function Ae(Ve,Je,ht){const Ye=ne[Ve];return delete ne[Ve],ne[Je]=Ye,me[Ye].geometry[0].pop(),me[Ye].geometry[0]=me[Ye].geometry[0].concat(ht[0]),Ye}function ze(Ve,Je,ht){const Ye=te[Je];return delete te[Je],te[Ve]=Ye,me[Ye].geometry[0].shift(),me[Ye].geometry[0]=ht[0].concat(me[Ye].geometry[0]),Ye}function $e(Ve,Je,ht){const Ye=ht?Je[0][Je[0].length-1]:Je[0][0];return`${Ve}:${Ye.x}:${Ye.y}`}for(let Ve=0;Ve<ee.length;Ve++){const Je=ee[Ve],ht=Je.geometry,Ye=Je.text?Je.text.toString():null;if(!Ye){be(Ve);continue}const it=$e(Ye,ht),qe=$e(Ye,ht,!0);if(it in ne&&qe in te&&ne[it]!==te[qe]){const st=ze(it,qe,ht),mt=Ae(it,qe,me[st].geometry);delete te[it],delete ne[qe],ne[$e(Ye,me[mt].geometry,!0)]=mt,me[st].geometry=null}else it in ne?Ae(it,qe,ht):qe in te?ze(it,qe,ht):(be(Ve),te[it]=de-1,ne[qe]=de-1)}return me.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,te)=>ee.sortKey-te.sortKey)}update(e,n,s,l,c){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const _=d?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,_,s,l,c),this.icon.programConfigurations.updatePaintArrays(e,n,_,s,l,c)}updateOcclusionOpacities(e,n,s){if(!n.useOcclusionQueries)return!1;const l=this;if(l.projection.name==="globe")return!1;let c=!1;l.hasTextData()&&(c=c||l.text.occlusionQueryOpacityVertexArray.length!==0),l.hasIconData()&&(c=c||l.icon.occlusionQueryOpacityVertexArray.length!==0);const d=l.layers[0].paint,_=d.get("icon-occlusion-opacity").constantOr(0),y=d.get("text-occlusion-opacity").constantOr(0);if(!l.layers[0].hasInitialOcclusionOpacityProperties||_===1&&y===1)return!1;let w=!c;for(let z=0;z<l.symbolInstances.length;z++){const k=l.symbolInstances.get(z),B=k.occlusionOpacity;k.occlusionOpacity+=(k.occlusionState>.5?1:-1)*n.fadeSpeed*s*.001,k.occlusionOpacity=Xt(k.occlusionOpacity,0,1),w=w||k.occlusionOpacity!==B}if(!w)return!1;let E=0,A=0;const I=(z,k,B,N)=>{let W=0,ee=0;B?(W=A,A+=N,ee=A):(W=E,E+=N,ee=E),ee>k.occlusionQueryOpacityVertexArray.length&&k.occlusionQueryOpacityVertexArray.resize(ee);const te=z.occlusionOpacity;for(let ne=0;ne<N;ne++)k.occlusionQueryOpacityVertexArray.emplace(ne+W,te)};for(let z=0;z<l.symbolInstances.length;z++){const k=l.symbolInstances.get(z),{numHorizontalGlyphVertices:B,numVerticalGlyphVertices:N,numIconVertices:W}=k,ee=W>0;if((B>0||N>0)&&(I(k,l.text,!1,B),I(k,l.text,!1,N)),ee){const{placedIconSymbolIndex:te,verticalPlacedIconSymbolIndex:ne}=k;te>=0&&I(k,l.icon,!0,W),ne>=0&&I(k,l.icon,!0,k.numVerticalIconVertices)}}return l.hasTextData()&&l.text.occlusionQueryOpacityVertexBuffer&&(l.text.occlusionQueryOpacityVertexBuffer.length<l.text.occlusionQueryOpacityVertexArray.length?l.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(l.text.occlusionQueryOpacityVertexArray,ui.members,!0):l.text.occlusionQueryOpacityVertexBuffer.updateData(l.text.occlusionQueryOpacityVertexArray)),l.hasIconData()&&l.icon.occlusionQueryOpacityVertexBuffer&&(l.icon.occlusionQueryOpacityVertexBuffer.length<l.icon.occlusionQueryOpacityVertexArray.length?l.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(l.icon.occlusionQueryOpacityVertexArray,ui.members,!0):l.icon.occlusionQueryOpacityVertexBuffer.updateData(l.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){const e=(c,d,_)=>{s+=d,s>c.length&&c.resize(s);for(let y=-d;y<0;y++)c.emplace(y+s,_)},n=(c,d,_)=>{l+=d,l>c.length&&c.resize(l);for(let y=-d;y<0;y++)c.emplace(y+l,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,l=0;for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:y,numIconVertices:w}=d,E=d.zOffset,A=w>0;if((_>0||y>0)&&(e(this.text.zOffsetVertexArray,_,E),e(this.text.zOffsetVertexArray,y,E)),A){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:z}=d;I>=0&&n(this.icon.zOffsetVertexArray,w,E),z>=0&&n(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=lA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(const e of this.queries.values())e.destroy()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:c}of n)this.lineVertexArray.emplaceBack(l,c);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,l,c,d,_,y,w,E,A,I,z,k,B,N){const W=e.indexArray,ee=e.layoutVertexArray,te=e.globeExtVertexArray,ne=e.segments.prepareSegment(4*n.length,ee,W,this.canOverlap?d.sortKey:void 0),me=this.glyphOffsetArray.length,de=ne.vertexLength,be=this.allowVerticalPlacement&&_===za.vertical?Math.PI/2:0,Ae=d.text&&d.text.sections;for(let $e=0;$e<n.length;$e++){const{tl:Ve,tr:Je,bl:ht,br:Ye,texPrimary:it,texSecondary:qe,pixelOffsetTL:st,pixelOffsetBR:mt,minFontScaleX:ut,minFontScaleY:Lt,glyphOffset:dt,isSDF:yt,sectionIndex:Wt}=n[$e],jt=ne.vertexLength,Ut=dt[1];if(P1(ee,w.x,w.y,Ve.x,Ut+Ve.y,it.x,it.y,s,yt,st.x,st.y,ut,Lt),P1(ee,w.x,w.y,Je.x,Ut+Je.y,it.x+it.w,it.y,s,yt,mt.x,st.y,ut,Lt),P1(ee,w.x,w.y,ht.x,Ut+ht.y,it.x,it.y+it.h,s,yt,st.x,mt.y,ut,Lt),P1(ee,w.x,w.y,Ye.x,Ut+Ye.y,it.x+it.w,it.y+it.h,s,yt,mt.x,mt.y,ut,Lt),y){const{x:_t,y:qt,z:pn}=y.anchor,[nn,vn,mn]=y.up;L1(te,_t,qt,pn,nn,vn,mn),L1(te,_t,qt,pn,nn,vn,mn),L1(te,_t,qt,pn,nn,vn,mn),L1(te,_t,qt,pn,nn,vn,mn),D1(e.dynamicLayoutVertexArray,_t,qt,pn,be)}else D1(e.dynamicLayoutVertexArray,w.x,w.y,w.z,be);if(N){const _t=qe||it;R1(e.iconTransitioningVertexArray,_t.x,_t.y),R1(e.iconTransitioningVertexArray,_t.x+_t.w,_t.y),R1(e.iconTransitioningVertexArray,_t.x,_t.y+_t.h),R1(e.iconTransitioningVertexArray,_t.x+_t.w,_t.y+_t.h)}W.emplaceBack(jt,jt+1,jt+2),W.emplaceBack(jt+1,jt+2,jt+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),$e!==n.length-1&&Wt===n[$e+1].sectionIndex||e.programConfigurations.populatePaintArrays(ee.length,d,d.index,{},z,k,B,Ae&&Ae[Wt])}const ze=y?y.anchor:w;e.placedSymbolArray.emplaceBack(ze.x,ze.y,ze.z,w.x,w.y,me,this.glyphOffsetArray.length-me,de,E,A,w.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],_,0,!1,0,I,0)}_commitLayoutVertex(e,n,s,l,c,d,_){e.emplaceBack(n,s,l,c,d,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,n,s,l,c,d,_){const y=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=y.vertexLength,E=_.tileAnchorX,A=_.tileAnchorY;for(let z=0;z<4;z++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,n,e.padding,_.zOffset),this._commitLayoutVertex(s.layoutVertexArray,l,c,d,E,A,new lt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,c,d,E,A,new lt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,c,d,E,A,new lt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,l,c,d,E,A,new lt(e.x1,e.y2)),y.vertexLength+=4;const I=s.indexArray;I.emplaceBack(w,w+1),I.emplaceBack(w+1,w+2),I.emplaceBack(w+2,w+3),I.emplaceBack(w+3,w),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,l,c,d){for(let _=l;_<c;_++){const y=s.get(_),w=this.getSymbolInstanceTextSize(e,d,n,_);this._addCollisionDebugVertices(y,w,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,n,s,l,c,d){for(let _=l;_<c;_++){const y=s.get(_),w=this.getSymbolInstanceIconSize(e,n,d.placedIconSymbolIndex);this._addCollisionDebugVertices(y,w,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pT(Fp,gC.members,Pc),this.iconCollisionBox=new pT(Fp,gC.members,Pc);const s=C_(this.iconSizeData,e),l=C_(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(l,e,n,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(l,e,n,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(s,e,n,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(s,e,n,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,n,s,l){const c=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:l),d=b1(this.textSizeData,e,c)/hs;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,n,s){const l=this.icon.placedSymbolArray.get(s),c=b1(this.iconSizeData,e,l);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,n,s,l){e.emplaceBack(n,-s,-s,l),e.emplaceBack(n,s,-s,l),e.emplaceBack(n,s,s,l),e.emplaceBack(n,-s,s,l)}_updateTextDebugCollisionBoxes(e,n,s,l,c,d){for(let _=l;_<c;_++){const y=s.get(_),w=this.getSymbolInstanceTextSize(e,d,n,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,y.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,n,s,l,c,d){for(let _=l;_<c;_++){const y=s.get(_),w=this.getSymbolInstanceIconSize(e,n,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,y.padding,d.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=C_(this.iconSizeData,e),l=C_(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(l,e,n,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(l,e,n,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(s,e,n,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._updateIconDebugCollisionBoxes(s,e,n,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,l,c,d,_,y,w){const E={};if(n<s){const{x1:A,y1:I,x2:z,y2:k,padding:B,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ne,featureIndex:me}=e.get(n);E.textBox={x1:A,y1:I,x2:z,y2:k,padding:B,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ne},E.textFeatureIndex=me}if(l<c){const{x1:A,y1:I,x2:z,y2:k,padding:B,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ne,featureIndex:me}=e.get(l);E.verticalTextBox={x1:A,y1:I,x2:z,y2:k,padding:B,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ne},E.verticalTextFeatureIndex=me}if(d<_){const{x1:A,y1:I,x2:z,y2:k,padding:B,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ne,featureIndex:me}=e.get(d);E.iconBox={x1:A,y1:I,x2:z,y2:k,padding:B,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ne},E.iconFeatureIndex=me}if(y<w){const{x1:A,y1:I,x2:z,y2:k,padding:B,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ne,featureIndex:me}=e.get(y);E.verticalIconBox={x1:A,y1:I,x2:z,y2:k,padding:B,projectedAnchorX:N,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:ne},E.verticalIconFeatureIndex=me}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),l=s.vertexStartIndex+4*s.numGlyphs;for(let c=s.vertexStartIndex;c<l;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),l=[],c=[],d=[];for(let _=0;_<this.symbolInstances.length;++_){d.push(_);const y=this.symbolInstances.get(_);l.push(0|Math.round(n*y.tileAnchorX+s*y.tileAnchorY)),c.push(y.featureIndex)}return d.sort((_,y)=>l[_]-l[y]||c[y]-c[_]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:w}=s;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),c>=0&&c!==l&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&d!==l&&this.addIndicesForPlacedSymbol(this.text,d),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}se(L_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),L_.addDynamicAttributes=D1;class xl{constructor(e,n,s,l){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,l)}update(e,n,s){const{width:l,height:c}=e,{context:d}=this,{gl:_}=d;if(_.bindTexture(_.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!n||n.premultiply!==!1)),s||this.size&&this.size[0]===l&&this.size[1]===c){const{x:y,y:w}=s||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,y,w,_.RGBA,_.UNSIGNED_BYTE,e);else{let E=this.format,A=_.UNSIGNED_BYTE;this.format===_.R32F&&(E=_.RED,A=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,y,w,l,c,E,A,e.data)}}else if(this.size=[l,c],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===_.R8&&(y=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,y,_.UNSIGNED_BYTE,e)}else{let y=this.format,w=this.format,E=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,E=_.UNSIGNED_SHORT),this.format===_.R8&&(w=_.RED),this.format===_.R32F&&(E=_.FLOAT,w=_.RED),_.texImage2D(_.TEXTURE_2D,0,y,l,c,0,w,E,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n,s=!1){const{context:l}=this,{gl:c}=l;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,s,l){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),n!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),this.wrapS=s),l!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class z1{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,n),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,n),this.wrapS=n)}}const vl=32,Nc=33,xf=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,l=0,c=0,d=0,_=0;for(1&e?l=c=d=vl:n=s=_=vl;(e>>=1)>1;){const w=n+l>>1,E=s+c>>1;1&e?(l=n,c=s,n=d,s=_):(n=l,s=c,l=d,c=_),d=w,_=E}const y=4*t;xf[y+0]=n,xf[y+1]=s,xf[y+2]=l,xf[y+3]=c}const Vc=new Uint16Array(2178),vf=new Uint8Array(1089),k1=new Uint16Array(1089);function uA(t){return t===0?-.03125:t===32?.03125:0}var O1=Xn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),lz=Xn([{name:"a_index",type:"Int16",components:1}]);const cA={type:2,extent:xt,loadGeometry:()=>[[new lt(0,0),new lt(xt+1,0),new lt(xt+1,xt+1),new lt(0,xt+1),new lt(0,0)]]};class B1{constructor(e,n,s,l,c){this.tileID=e,this.uid=uh(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,l&&l.style&&(this._lastUpdatedBrightness=l.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<zi.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=sm(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,c){const d={};if(!c)return d;for(const _ of l){const y=_.layerIds.map(w=>c.getLayer(w)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(w=>y.filter(E=>E.id===w)[0]));for(const w of y)d[w.fqid]=_}}return d}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const c=this.buckets[l];if(c instanceof L_){if(this.hasSymbolBuckets=!0,!s)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const c=this.buckets[l];if(c instanceof L_&&c.hasRTLText){this.hasRTLText=!0,Vt.isLoading()||Vt.isLoaded()||yn()!=="deferred"||Sn();break}}this.queryPadding=0;for(const l in this.buckets){const c=this.buckets[l],d=n.style.getOwnLayer(l);if(!d)continue;const _=d.queryRadius(c);this.queryPadding=Math.max(this.queryPadding,_)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Hg}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const l in this.buckets){const c=this.buckets[l];c.uploadPending()&&c.upload(e)}const n=e.gl,s=this.imageAtlas;if(s&&!s.uploaded){const l=!!Object.keys(s.patternPositions).length;this.imageAtlasTexture=new xl(e,s.image,n.RGBA,{useMipmap:l}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new xl(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new xl(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,s){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,s),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const l=n.style.getBrightness();(this._lastUpdatedBrightness||l)&&(this._lastUpdatedBrightness&&l&&Math.abs(this._lastUpdatedBrightness-l)<.001||(this._lastUpdatedBrightness=l,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,s,l,c,d,_,y){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:_,transform:d,params:c,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const l=s.loadVTLayers(),c=n?n.sourceLayer:"",d=l._geojsonTileLayer||l[c];if(!d)return;const _=ri(n&&n.filter),{z:y,x:w,y:E}=this.tileID.canonical,A={z:y,x:w,y:E};for(let I=0;I<d.length;I++){const z=d.feature(I);if(_.needGeometry){const N=uu(z,!0);if(!_.filter(new tn(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!_.filter(new tn(this.tileID.overscaledZ),z))continue;const k=s.getId(z,c),B=new RC(z,y,w,E,k);B.tile=A,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=dh(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let l=!1;if(this.expirationTime>s)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{const c=this.expirationTime-n;c?this.expirationTime=s+Math.max(c,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;const s=this.latestFeatureIndex.loadVTLayers(),l=n.style.listImages(),c=n.style.getBrightness();for(const d in this.buckets){if(!n.style.hasLayer(d))continue;const _=this.buckets[d],y=_.layers[0].sourceLayer||"_geojsonTileLayer",w=s[y];let E={};if(e&&(E=e[y],!w||!E||Object.keys(E).length===0))continue;if(_.update(E,w,l,this.imageAtlas&&this.imageAtlas.patternPositions||{},c),_ instanceof y1||_ instanceof nm){const I=n.style.getOwnSourceCache(_.layers[0].source);n._terrain&&n._terrain.enabled&&I&&_.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(I.id,this.tileID)}const A=n&&n.style&&n.style.getOwnLayer(d);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=zi.now()+e}setTexture(e,n){const s=n.context,l=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof xl?this.texture.update(e,{useMipmap:!0}):(this.texture=new xl(s,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,n){const s={};for(const l of n)s[l]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const l=this.dependencies[s];if(l){for(const c of n)if(l[c])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const s=Ra(cA,this.tileID.canonical,this.tileTransform)[0],l=new Yo,c=new Np;for(let d=0;d<s.length;d++){const{x:_,y}=s[d];l.emplaceBack(_,y),c.emplaceBack(d)}c.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(l,Wr.members),this._tileDebugSegments=Lr.simpleSegment(0,0,l.length,c.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const s=Ra(cA,this.tileID.canonical,this.tileTransform)[0];let l,c;if(this.isRaster){const d=function(_,y){const w=sm(_,y),E=Math.pow(2,_.z);for(let N=0;N<Nc;N++)for(let W=0;W<Nc;W++){const ee=Gs((_.x+(W+uA(W))/vl)/E),te=Ni((_.y+(N+uA(N))/vl)/E),ne=y.project(ee,te),me=N*Nc+W;Vc[2*me+0]=Math.round((ne.x*w.scale-w.x)*xt),Vc[2*me+1]=Math.round((ne.y*w.scale-w.y)*xt)}vf.fill(0),k1.fill(0);for(let N=2045;N>=0;N--){const W=4*N,ee=xf[W+0],te=xf[W+1],ne=xf[W+2],me=xf[W+3],de=ee+ne>>1,be=te+me>>1,Ae=de+be-te,ze=be+ee-de,$e=te*Nc+ee,Ve=me*Nc+ne,Je=be*Nc+de,ht=Math.hypot((Vc[2*$e+0]+Vc[2*Ve+0])/2-Vc[2*Je+0],(Vc[2*$e+1]+Vc[2*Ve+1])/2-Vc[2*Je+1])>=16;vf[Je]=vf[Je]||(ht?1:0),N<1022&&(vf[Je]=vf[Je]||vf[(te+ze>>1)*Nc+(ee+Ae>>1)]||vf[(me+ze>>1)*Nc+(ne+Ae>>1)])}const A=new so,I=new Si;let z=0;function k(N,W){const ee=W*Nc+N;return k1[ee]===0&&(A.emplaceBack(Vc[2*ee+0],Vc[2*ee+1],N*xt/vl,W*xt/vl),k1[ee]=++z),k1[ee]-1}function B(N,W,ee,te,ne,me){const de=N+ee>>1,be=W+te>>1;if(Math.abs(N-ne)+Math.abs(W-me)>1&&vf[be*Nc+de])B(ne,me,N,W,de,be),B(ee,te,ne,me,de,be);else{const Ae=k(N,W),ze=k(ee,te),$e=k(ne,me);I.emplaceBack(Ae,ze,$e)}}return B(0,0,vl,vl,vl,0),B(vl,vl,0,0,0,vl),{vertices:A,indices:I}}(this.tileID.canonical,n);l=d.vertices,c=d.indices}else{l=new so,c=new Si;for(const{x:_,y}of s)l.emplaceBack(_,y,0,0);const d=Wh(l.int16,void 0,4);for(let _=0;_<d.length;_+=3)c.emplaceBack(d[_],d[_+1],d[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,O1.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(c),this._tileBoundsSegments=Lr.simpleSegment(0,0,l.length,c.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||s.name!=="globe"||n.freezeTileCoverage)return;const l=this.tileID.canonical,c=_l(Lx(l,n)),d=du(n.zoom);let _;d>0&&(_=o.ad.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,n,c,_,d),this._makeGlobeTileDebugTextBuffer(e,l,n,c,_,d)}_globePoint(e,n,s,l,c,d,_){let y=hf(e,n,s);if(d){const w=1<<s.z,E=dl(l.center.lng),A=fl(l.center.lat),I=(s.x+.5)/w-E;let z=0;I>.5?z=-1:I<-.5&&(z=1);let k=(e/xt+s.x)/w+z,B=(n/xt+s.y)/w;k=(k-E)*l._pixelsPerMercatorPixel+E,B=(B-A)*l._pixelsPerMercatorPixel+A;const N=[k*l.worldSize,B*l.worldSize,0];o._.transformMat4(N,N,d),y=hu(y,N,_)}return o._.transformMat4(y,y,c)}_makeGlobeTileDebugBorderBuffer(e,n,s,l,c,d){const _=new Yo,y=new Np,w=new Ao,E=(I,z,k,B,N)=>{const W=(k-I)/(N-1),ee=(B-z)/(N-1),te=_.length;for(let ne=0;ne<N;ne++){const me=I+ne*W,de=z+ne*ee;_.emplaceBack(me,de);const be=this._globePoint(me,de,n,s,l,c,d);w.emplaceBack(be[0],be[1],be[2]),y.emplaceBack(te+ne)}},A=xt;E(0,0,A,0,16),E(A,0,A,A,16),E(A,A,0,A,16),E(0,A,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(_,Wr.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,Kp.members),this._tileDebugSegments=Lr.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,s,l,c,d){const _=xt/4,y=new Yo,w=new Si,E=new Ao,A=25;w.reserve(32),y.reserve(A),E.reserve(A);const I=(z,k)=>A*z+k;for(let z=0;z<A;z++){const k=z*_;for(let B=0;B<A;B++){const N=B*_;y.emplaceBack(N,k);const W=this._globePoint(N,k,n,s,l,c,d);E.emplaceBack(W[0],W[1],W[2])}}for(let z=0;z<4;z++)for(let k=0;k<4;k++){const B=I(z,k),N=I(z,k+1),W=I(z+1,k),ee=I(z+1,k+1);w.emplaceBack(B,N,W),w.emplaceBack(W,N,ee)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(y,Wr.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,Kp.members),this._tileDebugTextSegments=Lr.simpleSegment(0,0,A,32)}destroy(e=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof xl&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const dn={read:function(t,e){return t.readFields(dn._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(dn.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};dn.Filter.read=function(t,e){return t.readFields(dn.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},dn.Filter._readField=function(t,e,n){t===1?(e.delta_filter=dn.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=dn.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=dn.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=dn.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},dn.Filter.Delta={},dn.Filter.Delta.read=function(t,e){return t.readFields(dn.Filter.Delta._readField,{block_size:0},e)},dn.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},dn.Filter.Zigzag={},dn.Filter.Zigzag.read=function(t,e){return t.readFields(dn.Filter.Zigzag._readField,{},e)},dn.Filter.Zigzag._readField=function(t,e,n){},dn.Filter.BitShuffle={},dn.Filter.BitShuffle.read=function(t,e){return t.readFields(dn.Filter.BitShuffle._readField,{},e)},dn.Filter.BitShuffle._readField=function(t,e,n){},dn.Filter.ByteShuffle={},dn.Filter.ByteShuffle.read=function(t,e){return t.readFields(dn.Filter.ByteShuffle._readField,{},e)},dn.Filter.ByteShuffle._readField=function(t,e,n){},dn.Codec={},dn.Codec.read=function(t,e){return t.readFields(dn.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},dn.Codec._readField=function(t,e,n){t===1?(e.gzip_data=dn.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=dn.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=dn.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=dn.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},dn.Codec.GzipData={},dn.Codec.GzipData.read=function(t,e){return t.readFields(dn.Codec.GzipData._readField,{},e)},dn.Codec.GzipData._readField=function(t,e,n){},dn.Codec.JpegImage={},dn.Codec.JpegImage.read=function(t,e){return t.readFields(dn.Codec.JpegImage._readField,{},e)},dn.Codec.JpegImage._readField=function(t,e,n){},dn.Codec.WebpImage={},dn.Codec.WebpImage.read=function(t,e){return t.readFields(dn.Codec.WebpImage._readField,{},e)},dn.Codec.WebpImage._readField=function(t,e,n){},dn.Codec.PngImage={},dn.Codec.PngImage.read=function(t,e){return t.readFields(dn.Codec.PngImage._readField,{},e)},dn.Codec.PngImage._readField=function(t,e,n){},dn.DataIndexEntry={},dn.DataIndexEntry.read=function(t,e){return t.readFields(dn.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},dn.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(dn.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=dn.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},dn.Layer={},dn.Layer.read=function(t,e){return t.readFields(dn.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},dn.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(dn.DataIndexEntry.read(n,n.readVarint()+n.pos))};const yu={read:function(t,e){return t.readFields(yu._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=yu.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=yu.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};yu.Uint32Values.read=function(t,e){return t.readFields(yu.Uint32Values._readField,{values:[]},e)},yu.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(s){if(s.type!==2)throw new Error(`Unsupported pbf type "${s.type}"`);const l=function(d){return d.type===2?d.readVarint()+d.pos:d.pos+1}(s),c=s.pos;return s.pos=l,function(d){s.pos=c;let _=0;for(;s.pos<l;){const y=s.readVarint();d[_++]=y}return d}}(n))},yu.Fixed32Values={},yu.Fixed32Values.read=function(t,e){return t.readFields(yu.Fixed32Values._readField,{values:[]},e)},yu.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.6
 */class uz{constructor(e=0,n=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=s,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){const n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){const s=this.items[e];this.ttl>0&&s.expiry<=Date.now()?this.delete(e):(n=s.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){const e=[];let n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,s=!1,l=this.resetTtl){let c;if(s||this.has(e)){if(c=this.items[e],c.value=n,s===!1&&l&&(c.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==c){const d=this.last,_=c.next,y=c.prev;this.first===c&&(this.first=c.next),c.next=null,c.prev=this.last,d.next=c,y!==null&&(y.next=_),_!==null&&(_.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),c=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=c:this.last.next=c;return this.last=c,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function cz(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let s=2;s>=1;s--){const l=s===1?1:0,c=s===2?1:0;for(let d=0;d<e[0];d++){const _=e[1]*d;for(let y=l;y<e[1];y++){const w=e[2]*(y+_);for(let E=c;E<e[2];E++){const A=e[3]*(E+w);for(let I=0;I<e[3];I++){const z=A+I;t[z]+=t[z-n]}}}}n*=e[s]}return t}function hz(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function dz(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){const s=t[n],l=t[n+1];t[n]=(240&s)>>4|(61440&s)>>8|(240&l)<<4|61440&l,t[n+1]=15&s|(3840&s)>>4|(15&l)<<8|(3840&l)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){const s=t[n],l=t[n+1],c=t[n+2],d=t[n+3];t[n+0]=(192&s)>>6|(192&l)>>4|(192&c)>>2|192&d,t[n+1]=(48&s)>>4|(48&l)>>2|48&c|(48&d)<<2,t[n+2]=(12&s)>>2|12&l|(12&c)<<2|(12&d)<<4,t[n+3]=3&s|(3&l)<<2|(3&c)<<4|(3&d)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class wf extends Error{constructor(e){super(e),this.name="MRTError"}}var ka=Uint8Array,Gy=Uint16Array,fz=Int32Array,hA=new ka([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),dA=new ka([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),pz=new ka([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fA=function(t,e){for(var n=new Gy(31),s=0;s<31;++s)n[s]=e+=1<<t[s-1];var l=new fz(n[30]);for(s=1;s<30;++s)for(var c=n[s];c<n[s+1];++c)l[c]=c-n[s]<<5|s;return{b:n,r:l}},pA=fA(hA,2),mA=pA.b,mz=pA.r;mA[28]=258,mz[258]=28;for(var _z=fA(dA,0).b,_A=new Gy(32768),ci=0;ci<32768;++ci){var D_=(43690&ci)>>1|(21845&ci)<<1;_A[ci]=((65280&(D_=(61680&(D_=(52428&D_)>>2|(13107&D_)<<2))>>4|(3855&D_)<<4))>>8|(255&D_)<<8)>>1}var Wy=function(t,e,n){for(var s=t.length,l=0,c=new Gy(e);l<s;++l)t[l]&&++c[t[l]-1];var d,_=new Gy(e);for(l=1;l<e;++l)_[l]=_[l-1]+c[l-1]<<1;{d=new Gy(1<<e);var y=15-e;for(l=0;l<s;++l)if(t[l])for(var w=l<<4|t[l],E=e-t[l],A=_[t[l]-1]++<<E,I=A|(1<<E)-1;A<=I;++A)d[_A[A]>>y]=w}return d},$y=new ka(288);for(ci=0;ci<144;++ci)$y[ci]=8;for(ci=144;ci<256;++ci)$y[ci]=9;for(ci=256;ci<280;++ci)$y[ci]=7;for(ci=280;ci<288;++ci)$y[ci]=8;var gA=new ka(32);for(ci=0;ci<32;++ci)gA[ci]=5;var gz=Wy($y,9),yz=Wy(gA,5),mT=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},xu=function(t,e,n){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&n},_T=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},xz=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],vu=function(t,e,n){var s=new Error(e||xz[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,vu),!n)throw s;return s},vz=new ka(0),wz=typeof TextDecoder<"u"&&new TextDecoder;try{wz.decode(vz,{stream:!0})}catch{}const bz={gzip_data:"gzip"},Tz={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Sz={uint32:1,uint16:2,uint8:4},Ez={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class gT{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const n=new Uint8Array(e),s=new DataView(e);if(n[0]!==13)throw new wf("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),s=this.getHeaderLength(e);if(n.length<s)throw new wf(`Expected header with length >= ${s} but got buffer of length ${n.length}`);const l=new E_(n.subarray(0,s)),c=dn.read(l);if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new wf(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const d of c.layers)this.layers[d.name]=new Cz(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],s=this.getLayer(e.layerName);for(let l=0;l<s.dataIndex.length;l++){const c=s.dataIndex[l],d=c.first_byte-e.firstByte,_=c.last_byte+1-e.firstByte;if(l<e.firstBlock||l>e.lastBlock||s._blocksInProgress.has(l))continue;const y={layerName:s.name,firstByte:d,lastByte:_,pixelFormat:s.pixelFormat,blockIndex:l,blockShape:[c.bands.length].concat(s.bandShape),buffer:s.buffer,codec:c.codec.codec,filters:c.filters.map(w=>w.filter)};s._blocksInProgress.add(l),n.push(y)}return new yA(n,()=>{n.forEach(l=>s._blocksInProgress.delete(l.blockIndex))},(l,c)=>{if(n.forEach(d=>s._blocksInProgress.delete(d.blockIndex)),l)throw l;c.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class Cz{constructor({version:e,name:n,units:s,tilesize:l,pixel_format:c,buffer:d,data_index:_},y){if(this.version=e,this.version!==1)throw new wf(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=s,this.tileSize=l,this.buffer=d,this.pixelFormat=Tz[c],this.dataIndex=_,this.bandShape=[l+2*d,l+2*d,Sz[this.pixelFormat]],this._decodedBlocks=function(w=1e3,E=0,A=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(E)||E<0)throw new TypeError("Invalid ttl value");if(typeof A!="boolean")throw new TypeError("Invalid resetTtl value");return new uz(w,E,A)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[s,l]of this.dataIndex.entries()){for(const[c,d]of l.bands.entries())if(d===e)return{bandIndex:n+c,blockIndex:s,blockBandIndex:c};n+=l.bands.length}break;case"number":for(const[s,l]of this.dataIndex.entries()){if(e>=n&&e<n+l.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-n};n+=l.bands.length}break;default:throw new wf(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new wf(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,s=-1/0,l=1/0,c=-1/0;for(const d of e){const{blockIndex:_}=this.getBlockForBand(d);if(_<0)throw new wf(`Invalid band: ${JSON.stringify(d)}`);const y=this.dataIndex[_];l=Math.min(l,_),c=Math.max(c,_),n=Math.min(n,y.first_byte),s=Math.max(s,y.last_byte)}return{layerName:this.name,firstByte:n,lastByte:s,firstBlock:l,lastBlock:c}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:s}=this.getBlockForBand(e),l=this._decodedBlocks.get(n.toString());if(!l)throw new wf(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const c=this.dataIndex[n],d=this.bandShape.reduce((w,E)=>w*E,1),_=s*d,y=l.subarray(_,_+d);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:c.offset,scale:c.scale}}}class yA{constructor(e,n,s){this.tasks=e,this._onCancel=n,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}gT.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{const{layerName:s,firstByte:l,lastByte:c,pixelFormat:d,blockShape:_,blockIndex:y,filters:w,codec:E}=n,A=new Uint8Array(t).subarray(l,c+1),I=new Uint32Array(_[0]*_[1]*_[2]);let z;if(E!=="gzip_data")throw new Error(`Unhandled codec: ${E}`);return z=function(k,B){if(!globalThis.DecompressionStream&&B==="gzip_data")return Promise.resolve(((te=function(de){de[0]==31&&de[1]==139&&de[2]==8||vu(6,"invalid gzip data");var be=de[3],Ae=10;4&be&&(Ae+=2+(de[10]|de[11]<<8));for(var ze=(be>>3&1)+(be>>4&1);ze>0;ze-=!de[Ae++]);return Ae+(2&be)}(ee=k))+8>ee.length&&vu(6,"invalid gzip data"),function(de,be,Ae,ze){var $e=de.length;if(!$e||be.f&&!be.l)return Ae||new ka(0);var Ve=!Ae,Je=Ve||be.i!=2,ht=be.i;Ve&&(Ae=new ka(3*$e));var Ye,it,qe=function(Tf){var Sf=Ae.length;if(Tf>Sf){var hm=new ka(Math.max(2*Sf,Tf));hm.set(Ae),Ae=hm}},st=be.f||0,mt=be.p||0,ut=be.b||0,Lt=be.l,dt=be.d,yt=be.m,Wt=be.n,jt=8*$e;do{if(!Lt){st=xu(de,mt,1);var Ut=xu(de,mt+1,3);if(mt+=3,!Ut){var _t=de[(qn=4+((mt+7)/8|0))-4]|de[qn-3]<<8,qt=qn+_t;if(qt>$e){ht&&vu(0);break}Je&&qe(ut+_t),Ae.set(de.subarray(qn,qt),ut),be.b=ut+=_t,be.p=mt=8*qt,be.f=st;continue}if(Ut==1)Lt=gz,dt=yz,yt=9,Wt=5;else if(Ut==2){var pn=xu(de,mt,31)+257,nn=xu(de,mt+10,15)+4,vn=pn+xu(de,mt+5,31)+1;mt+=14;for(var mn=new ka(vn),Pn=new ka(19),Jt=0;Jt<nn;++Jt)Pn[pz[Jt]]=xu(de,mt+3*Jt,7);mt+=3*nn;var hr=mT(Pn),cr=(1<<hr)-1,Jn=Wy(Pn,hr);for(Jt=0;Jt<vn;){var qn,Qn=Jn[xu(de,mt,cr)];if(mt+=15&Qn,(qn=Qn>>4)<16)mn[Jt++]=qn;else{var Cr=0,gr=0;for(qn==16?(gr=3+xu(de,mt,3),mt+=2,Cr=mn[Jt-1]):qn==17?(gr=3+xu(de,mt,7),mt+=3):qn==18&&(gr=11+xu(de,mt,127),mt+=7);gr--;)mn[Jt++]=Cr}}var $r=mn.subarray(0,pn),Ur=mn.subarray(pn);yt=mT($r),Wt=mT(Ur),Lt=Wy($r,yt),dt=Wy(Ur,Wt)}else vu(1);if(mt>jt){ht&&vu(0);break}}Je&&qe(ut+131072);for(var Is=(1<<yt)-1,ti=(1<<Wt)-1,Or=mt;;Or=mt){var yi=(Cr=Lt[_T(de,mt)&Is])>>4;if((mt+=15&Cr)>jt){ht&&vu(0);break}if(Cr||vu(2),yi<256)Ae[ut++]=yi;else{if(yi==256){Or=mt,Lt=null;break}var Ji=yi-254;yi>264&&(Ji=xu(de,mt,(1<<(uo=hA[Jt=yi-257]))-1)+mA[Jt],mt+=uo);var Qi=dt[_T(de,mt)&ti],wr=Qi>>4;if(Qi||vu(3),mt+=15&Qi,Ur=_z[wr],wr>3){var uo=dA[wr];Ur+=_T(de,mt)&(1<<uo)-1,mt+=uo}if(mt>jt){ht&&vu(0);break}Je&&qe(ut+131072);var Xh=ut+Ji;if(ut<Ur){var wl=0-Ur,bu=Math.min(Ur,Xh);for(wl+ut<0&&vu(3);ut<bu;++ut)Ae[ut]=(void 0)[wl+ut]}for(;ut<Xh;++ut)Ae[ut]=Ae[ut-Ur]}}be.l=Lt,be.p=Or,be.b=ut,be.f=st,Lt&&(st=1,be.m=yt,be.d=dt,be.n=Wt)}while(!st);return ut!=Ae.length&&Ve?(Ye=Ae,((it=ut)==null||it>Ye.length)&&(it=Ye.length),new ka(Ye.subarray(0,it))):Ae.subarray(0,ut)}(ee.subarray(te,-8),{i:2},new ka(((N=ee)[(W=N.length)-4]|N[W-3]<<8|N[W-2]<<16|N[W-1]<<24)>>>0))));var N,W,ee,te;const ne=bz[B];if(!ne)throw new Error(`Unhandled codec: ${B}`);const me=new globalThis.DecompressionStream(ne);return new Response(new Blob([k]).stream().pipeThrough(me)).arrayBuffer().then(de=>new Uint8Array(de))}(A,E).then(k=>{const B=yu.read(new E_(k));if(B.values==="uint32_values")return B.uint32_values.readValuesInto(I),new Ez[d](I.buffer);throw new Error(`Unhandled numeric data "${B.values}"`)}),z.then(k=>{for(let B=w.length-1;B>=0;B--)switch(w[B]){case"delta_filter":cz(k,_);break;case"zigzag_filter":hz(k);break;case"bitshuffle_filter":dz(k,d);break;default:throw new Error(`Unhandled filter "${w[B]}"`)}return{layerName:s,blockIndex:y,data:k}}).catch(k=>{throw k})}))};class xA extends B1{constructor(e,n,s,l,c){super(e,n,s,l,c),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,n){const s=n.context,l=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof xl?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new xl(s,e,l.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,n){const s=this._mrt=new gT(30),l=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=Wl(l,(c,d,_,y)=>{if(c)n(c);else try{const w=s.getHeaderLength(d);if(w>e)return void(this.request=this.fetchHeader(w,n));s.parseHeader(d),this._isHeaderLoaded=!0;let E=0;for(const A of Object.values(s.layers))E=Math.max(E,A.dataIndex[A.dataIndex.length-1].last_byte);d.byteLength>=E&&(this.entireBuffer=d),n(null,this.entireBuffer||d,_,y)}catch(w){n(w)}}),this.request}fetchBand(e,n,s){const l=this._mrt;if(!this._isHeaderLoaded||!l)return void s(new Error("Tile header is not ready"));const c=this.actor;if(!c)return void s(new Error("Can't fetch tile band without an actor"));let d;const _=(A,I)=>{d.complete(A,I),A?s(A):(this.updateTextureDescriptor(e,n),s(null,this.textureDescriptor&&this.textureDescriptor.img))},y=(A,I)=>{if(A)return s(A);const z=c.send("decodeRasterArray",{buffer:I,task:d},_,void 0,!0);this._workQueue.push(()=>{z&&z.cancel(),d.cancel()})},w=l.getLayer(e);if(!w)return void s(new Error(`Unknown sourceLayer "${e}"`));if(w.hasDataForBand(n))return this.updateTextureDescriptor(e,n),void s(null,this.textureDescriptor?this.textureDescriptor.img:null);const E=w.getDataRange([n]);if(d=l.createDecodingTask(E),!d||d.tasks.length)if(this.flushQueues(),this.entireBuffer)y(null,this.entireBuffer.slice(E.firstByte,E.lastByte+1));else{const A=Object.assign({},this.requestParams,{headers:{Range:`bytes=${E.firstByte}-${E.lastByte}`}}),I=Wl(A,y);this._fetchQueue.push(()=>{I.cancel(),d.cancel()})}else s(null)}updateNeeded(e,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,n){if(!this._mrt)return;const s=this._mrt.getLayer(e);if(!s||!s.hasBand(n)||!s.hasDataForBand(n))return;const{bytes:l,tileSize:c,buffer:d,offset:_,scale:y}=s.getBandView(n),w=c+2*d,E={data:l,width:w,height:w},A=this.texture;A&&A instanceof xl&&A.update(E,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:n,img:E,buffer:d,offset:_,tileSize:c,format:s.pixelFormat,mix:[y,256*y,65536*y,16777216*y]}}}class Az{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const c={value:n,timeout:void 0};if(s!==void 0&&(c.timeout=setTimeout(()=>{this.remove(e,c)},s)),this.data[l].push(c),this.order.push(l),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,l=n===void 0?0:this.data[s].indexOf(n),c=this.data[s][l];return this.data[s].splice(l,1),c.timeout&&clearTimeout(c.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(c.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const l of this.data[s])e(l.value)||n.push(l);for(const s of n)this.remove(s.value.tileID,s)}}class am extends Uo{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Az(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new R5,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return gs(this._tiles).map(e=>e.tileID).sort(vA).map(e=>e.key)}getRenderableIds(e,n){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,e,n)&&s.push(this._tiles[l]);return e?s.sort((l,c)=>{const d=l.tileID,_=c.tileID,y=new lt(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),w=new lt(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-_.overscaledZ||w.y-y.y||w.x-y.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(vA).map(l=>l.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(s||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new Pd(l,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new as("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=zi.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new as("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let l=0;l<n.length;l++){const c=n[l];if(e.neighboringTiles&&e.neighboringTiles[c]){const d=this.getTileByID(c);s(e,d),s(d,e)}}function s(l,c){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let d=c.tileID.canonical.x-l.tileID.canonical.x;const _=c.tileID.canonical.y-l.tileID.canonical.y,y=Math.pow(2,l.tileID.canonical.z),w=c.tileID.key;d===0&&_===0||Math.abs(_)>1||(Math.abs(d)>1&&(Math.abs(d+y)===1?d+=y:Math.abs(d-y)===1&&(d-=y)),c.dem&&l.dem&&(l.dem.backfillBorder(c.dem,d,_),l.neighboringTiles&&l.neighboringTiles[w]&&(l.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,l){for(const c in this._tiles){let d=this._tiles[c];if(l[c]||!d.hasData()||d.tileID.overscaledZ<=n||d.tileID.overscaledZ>s)continue;let _=d.tileID;for(;d&&d.tileID.overscaledZ>n+1;){const w=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[w.key],d&&d.hasData()&&(_=w)}let y=_;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){l[_.key]=_;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const l=e.scaledTo(s),c=this._getLoadedTile(l);if(c)return c}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,l=Math.ceil(e.height/n)+1,c=Math.floor(s*l*5),d=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,c):c,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(_)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const l in this._tiles){const c=this._tiles[l];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+n),s[c.tileID.key]=c}this._tiles=s;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,n,s,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new ai(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y));else if(this.tileCoverLift!==0){const y=e.clone();y.tileCoverLift=this.tileCoverLift,c=y.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(c.push(new ai(1,0,1,0,0)),c.push(new ai(1,0,1,1,0)),c.push(new ai(1,0,1,0,1)),c.push(new ai(1,0,1,1,1)))}else if(c=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){const y=this._source.hasTile.bind(this._source);c=c.filter(w=>y(w))}}else c=[];if(c.length>0&&this.castsShadows&&l&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!yT(this._source.type)){const y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!s}),w=Math.min(y,this._source.maxzoom),E=e.extendTileCoverForShadows(c,l,w);for(const A of E)this._shadowCasterTiles[A.key]=!0,c.push(A)}const d=this._updateRetainedTiles(c);if(yT(this._source.type)&&c.length!==0){const y={},w={},E=Object.keys(d);for(const I of E){const z=d[I],k=this._tiles[I];if(!k||k.fadeEndTime&&k.fadeEndTime<=zi.now())continue;const B=this.findLoadedParent(z,Math.max(z.overscaledZ-am.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),y[B.tileID.key]=B.tileID),w[I]=z}const A=c[c.length-1].overscaledZ;for(const I in this._tiles){const z=this._tiles[I];if(d[I]||!z.hasData())continue;let k=z.tileID;for(;k.overscaledZ>A;){k=k.scaledTo(k.overscaledZ-1);const B=this._tiles[k.key];if(B&&B.hasData()&&w[k.key]){d[I]=z.tileID;break}}}for(const I in y)d[I]||(this._coveredTiles[I]=!0,d[I]=y[I])}for(const y in d)this._tiles[y].clearFadeHold();const _=function(y,w){const E=[];for(const A in y)A in w||E.push(A);return E}(this._tiles,d);for(const y of _){const w=this._tiles[y];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const s={},l=e.reduce((w,E)=>Math.min(w,E.overscaledZ),1/0),c=e[0].overscaledZ,d=Math.max(c-am.maxOverzooming,this._source.minzoom),_=Math.max(c+am.maxUnderzooming,this._source.minzoom),y={};for(const w of e){const E=this._addTile(w);n[w.key]=w,E.hasData()||l<this._source.maxzoom&&(y[w.key]=w)}this._retainLoadedChildren(y,l,_,n);for(const w of e){let E=this._tiles[w.key];if(E.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const I=w.children(this._source.maxzoom)[0],z=this.getTile(I);if(z&&z.hasData()){n[I.key]=I;continue}}else{const I=w.children(this._source.maxzoom);if(n[I[0].key]&&n[I[1].key]&&n[I[2].key]&&n[I[3].key])continue}let A=E.wasRequested();for(let I=w.overscaledZ-1;I>=d;--I){const z=w.scaledTo(I);if(s[z.key]||(s[z.key]=!0,E=this.getTile(z),!E&&A&&(E=this._addTile(z)),E&&(n[z.key]=z,A=E.wasRequested(),E.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){s=this._loadedParentTiles[l.key];break}n.push(l.key);const c=l.scaledTo(l.overscaledZ-1);if(s=this._getLoadedTile(c),s)break;l=c}for(const c of n)this._loadedParentTiles[c]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=!!n;if(!s){const l=this.map?this.map.painter:null,c=this._source.tileSize*e.overscaleFactor();n=this._source.type==="raster-array"?new xA(e,c,this.transform.tileZoom,l,this._isRaster):new B1(e,c,this.transform.tileZoom,l,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new as("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const l=[],c=this.transform;if(!c)return l;const d=c.projection.name==="globe",_=dl(c.center.lng);for(const y in this._tiles){const w=this._tiles[y];if(s&&w.clearQueryDebugViz(),w.holdingForFade())continue;let E;if(d){const A=w.tileID.canonical;if(A.z===0){const I=[Math.abs(Xt(_,...qy(A,-1))-_),Math.abs(Xt(_,...qy(A,1))-_)];E=[0,2*I.indexOf(Math.min(...I))-1]}else{const I=[Math.abs(Xt(_,...qy(A,-1))-_),Math.abs(Xt(_,...qy(A,0))-_),Math.abs(Xt(_,...qy(A,1))-_)];E=[I.indexOf(Math.min(...I))-1]}}else E=[0];for(const A of E){const I=e.containsTile(w,c,n,A);I&&l.push(I)}}return l}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){const s=this.getRenderableIds(e,n).map(c=>this._tiles[c].tileID),l=this.transform.projection.name==="globe";for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped()),c.expandedProjMatrix=l?this.transform.calculateProjMatrix(c.toUnwrapped(),!1,!0):c.projMatrix;return s}sortCoordinatesByDistance(e){const n=e.slice(),s=this.transform._camera.position,l=this.transform._camera.forward(),c={};for(const d of n){const _=1/(1<<d.canonical.z);c[d.key]=((d.canonical.x+.5)*_+d.wrap-s[0])*l[0]+((d.canonical.y+.5)*_-s[1])*l[1]-s[2]*l[2]}return n.sort((d,_)=>c[d.key]-c[_.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(yT(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=zi.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const l=this._tiles[e];l&&l.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,n))};return void this._source.on("data",_)}const s=new Map,l=Array.isArray(e)?e:[e],c=this.map.painter.terrain,d=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const _ of l){const y=_.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of y)s.set(w.key,w);this.usedForTerrain&&_.updateElevation(!1)}Ul(Array.from(s.values()),(_,y)=>{const w=new B1(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,E=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),y(E,w)})},n)}}function vA(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function yT(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function qy(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}am.maxOverzooming=10,am.maxUnderzooming=3;const wA=new class extends At{possiblyEvaluate(t,e){return e=new tn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=Rr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(x1.paint.properties["line-width"].specification);function bA(t,e){return e>0?e+2*t:t}wA.useIntegerZoom=!0;const Mz=new Kn({"symbol-placement":new nt(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new nt(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nt(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new At(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nt(ke.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new nt(ke.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new nt(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new nt(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new nt(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nt(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new At(ke.layout_symbol["icon-size"]),"icon-text-fit":new At(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new At(ke.layout_symbol["icon-image"]),"icon-rotate":new At(ke.layout_symbol["icon-rotate"]),"icon-padding":new nt(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new nt(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new At(ke.layout_symbol["icon-offset"]),"icon-anchor":new At(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nt(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nt(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nt(ke.layout_symbol["text-rotation-alignment"]),"text-field":new At(ke.layout_symbol["text-field"]),"text-font":new At(ke.layout_symbol["text-font"]),"text-size":new At(ke.layout_symbol["text-size"]),"text-max-width":new At(ke.layout_symbol["text-max-width"]),"text-line-height":new At(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new At(ke.layout_symbol["text-letter-spacing"]),"text-justify":new At(ke.layout_symbol["text-justify"]),"text-radial-offset":new At(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nt(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new At(ke.layout_symbol["text-anchor"]),"text-max-angle":new nt(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new nt(ke.layout_symbol["text-writing-mode"]),"text-rotate":new At(ke.layout_symbol["text-rotate"]),"text-padding":new nt(ke.layout_symbol["text-padding"]),"text-keep-upright":new nt(ke.layout_symbol["text-keep-upright"]),"text-transform":new At(ke.layout_symbol["text-transform"]),"text-offset":new At(ke.layout_symbol["text-offset"]),"text-allow-overlap":new nt(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new nt(ke.layout_symbol["text-ignore-placement"]),"text-optional":new nt(ke.layout_symbol["text-optional"]),visibility:new nt(ke.layout_symbol.visibility)});var xT={paint:new Kn({"icon-opacity":new At(ke.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new At(ke.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new At(ke.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new At(ke.paint_symbol["text-emissive-strength"]),"icon-color":new At(ke.paint_symbol["icon-color"]),"icon-halo-color":new At(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new At(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new At(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new nt(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new nt(ke.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new At(ke.paint_symbol["icon-image-cross-fade"]),"text-opacity":new At(ke.paint_symbol["text-opacity"]),"text-occlusion-opacity":new At(ke.paint_symbol["text-occlusion-opacity"]),"text-color":new At(ke.paint_symbol["text-color"],{runtimeType:ls,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new At(ke.paint_symbol["text-halo-color"]),"text-halo-width":new At(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new At(ke.paint_symbol["text-halo-blur"]),"text-translate":new nt(ke.paint_symbol["text-translate"]),"text-translate-anchor":new nt(ke.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new nt(ke.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new nt(ke.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new nt(ke.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new nt(ke.paint_symbol["icon-color-brightness-max"])}),layout:Mz};class TA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:lc,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}se(TA,"FormatSectionOverride",{omit:["defaultValue"]});class F1 extends ii{constructor(e,n,s,l){super(e,xT,n,s,l),this._colorAdjustmentMatrix=o.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const c of s)l.indexOf(c)<0&&l.push(c);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,s,l){return this._saturation===e&&this._contrast===n&&this._brightnessMin===s&&this._brightnessMax===l||(this._colorAdjustmentMatrix=function(c,d,_,y){c=Xu(c),d=Zu(d);const w=o.ad.create(),E=c/3,A=1-2*E,I=[A,E,E,0,E,A,E,0,E,E,A,0,0,0,0,1],z=.5-.5*d,k=y-_;return o.ad.multiply(w,[k,0,0,0,0,k,0,0,0,0,k,0,_,_,_,1],[d,0,0,0,0,d,0,0,0,0,d,0,z,z,z,1]),o.ad.multiply(w,w,I),w}(e,n,s,l),this._saturation=e,this._contrast=n,this._brightnessMin=s,this._brightnessMax=l),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,s,l){const c=this.layout.get(e).evaluate(n,{},s,l),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||F(d.value)||!c?c:function(_,y){return y.replace(/{([^{}]+)}/g,(w,E)=>E in _?String(_[E]):"")}(n.properties,c)}createBucket(e){return new L_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of xT.paint.overridableProperties){if(!F1.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new TA(n),l=new O(s,n.property.specification,this.scope,this.options);let c=null;c=n.value.kind==="constant"||n.value.kind==="source"?new j("source",l):new H("composite",l,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new vr(n.property,c,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&F1.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),l=xT.paint.properties[n];let c=!1;const d=_=>{for(const y of _)if(l.overrides&&l.overrides.hasOverride(y))return void(c=!0)};if(s.value.kind==="constant"&&s.value.value instanceof oi)d(s.value.value.sections);else if(s.value.kind==="source"){const _=w=>{c||(w instanceof ba&&ni(w.value)===Xr?d(w.value.sections):w instanceof Ta?d(w.sections):w.eachChild(_))},y=s.value;y._styleExpression&&_(y._styleExpression.expression)}return c}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,s=[];return e&&s.push("symbolIcon"),n&&s.push("symbolSDF"),s}getDefaultProgramParams(e,n,s){return{config:new Vh(this,{zoom:n,lut:s}),overrideFog:!1}}}const Iz=new Kn({visibility:new nt(ke.layout_background.visibility)});var Pz={paint:new Kn({"background-color":new nt(ke.paint_background["background-color"]),"background-pattern":new nt(ke.paint_background["background-pattern"]),"background-opacity":new nt(ke.paint_background["background-opacity"]),"background-emissive-strength":new nt(ke.paint_background["background-emissive-strength"])}),layout:Iz};const Rz=new Kn({visibility:new nt(ke.layout_raster.visibility)});var Lz={paint:new Kn({"raster-opacity":new nt(ke.paint_raster["raster-opacity"]),"raster-color":new Mr(ke.paint_raster["raster-color"]),"raster-color-mix":new nt(ke.paint_raster["raster-color-mix"]),"raster-color-range":new nt(ke.paint_raster["raster-color-range"]),"raster-hue-rotate":new nt(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nt(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nt(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new nt(ke.paint_raster["raster-saturation"]),"raster-contrast":new nt(ke.paint_raster["raster-contrast"]),"raster-resampling":new nt(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new nt(ke.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new nt(ke.paint_raster["raster-emissive-strength"]),"raster-array-band":new nt(ke.paint_raster["raster-array-band"]),"raster-elevation":new nt(ke.paint_raster["raster-elevation"])}),layout:Rz};function N1(t,e,n,s,l,c,d,_){const y=[t,e,1,n,s,1,l,c,1],w=[d,_,1],E=o.bC.adjoint([],y),[A,I,z]=o._.transformMat3(w,w,E);return o.bC.multiply(y,y,[A,0,0,0,I,0,0,0,z])}function SA(t,e,n,s,l,c,d,_){const y=function(w,E,A,I,z,k,B,N){const W=N1(0,0,1,0,1,1,0,1),ee=N1(w,E,A,I,z,k,B,N),te=o.bC.adjoint([],W);return o.bC.multiply(ee,ee,te)}(t,e,n,s,l,c,d,_);return[y[2]/y[8]/xt,y[5]/y[8]/xt]}function V1(t){return[t[0],Math.min(Math.max(t[1],-Kr),Kr)]}class EA extends Uo{constructor(e,n,s,l){super(),this.id=e,this.dispatcher=s,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new as("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=xa(this.map._requestManager.transformRequest(this.url,ec.Image),(s,l)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Pd(s)):l&&(this.image=l instanceof HTMLImageElement?zi.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new z1(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new as("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof z1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],s=e[0][1];for(const c of e)c[1]>s&&(s=c[1]),c[1]<n&&(n=c[1]);const l=(s+n)/2;if(l>Kr?this.onNorthPole=!0:l<-Kr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=e.map(Hi.fromLngLat);this.tileID=function(d){let _=1/0,y=1/0,w=-1/0,E=-1/0;for(const B of d)_=Math.min(_,B.x),y=Math.min(y,B.y),w=Math.max(w,B.x),E=Math.max(E,B.y);const A=Math.max(w-_,E-y),I=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,I);let k=Math.floor((_+w)/2*z);return k>1&&(k-=1),new jh(I,k,Math.floor((y+E)/2*z))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new as("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const N in this.tiles){const W=this.tiles[N];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=sm(new jh(0,0,0),this.map.transform.projection),s=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const W=N[1].x-N[0].x,ee=N[1].y-N[0].y,te=N[2].x-N[1].x,ne=N[2].y-N[1].y,me=N[3].x-N[2].x,de=N[3].y-N[2].y,be=N[0].x-N[3].x,Ae=N[0].y-N[3].y,ze=W*ne-te*ee,$e=te*de-me*ne,Ve=me*Ae-be*de,Je=be*ee-W*Ae;return ze>0&&$e>0&&Ve>0&&Je>0||ze<0&&$e<0&&Ve<0&&Je<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const l=sm(this.tileID,this.map.transform.projection),[c,d,_,y]=this.coordinates.map(N=>{const W=l.projection.project(N[0],N[1]);return rA(l,W)._round()});this.perspectiveTransform=SA(c.x,c.y,d.x,d.y,_.x,_.y,y.x,y.y);const w=this._boundsArray=new so;w.emplaceBack(c.x,c.y,0,0),w.emplaceBack(d.x,d.y,xt,0),w.emplaceBack(y.x,y.y,0,xt),w.emplaceBack(_.x,_.y,xt,xt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,O1.members),this.boundsSegments=Lr.simpleSegment(0,0,4,2);const E=[],A=function(N){return[V1(N[0]),V1(N[1]),V1(N[2]),V1(N[3])]}(this.coordinates),[I,z,k,B]=function(N){let W=N[0][0],ee=W,te=N[0][1],ne=te;for(let me=1;me<N.length;me++)N[me][0]<W?W=N[me][0]:N[me][0]>ee&&(ee=N[me][0]),N[me][1]<te?te=N[me][1]:N[me][1]>ne&&(ne=N[me][1]);return[W,te,ee-W,ne-te]}(A);{const N=new so,[W,ee,te,ne]=function(qe){let st=qe[0].x,mt=st,ut=qe[0].y,Lt=ut;for(let dt=1;dt<qe.length;dt++)qe[dt].x<st?st=qe[dt].x:qe[dt].x>mt&&(mt=qe[dt].x),qe[dt].y<ut?ut=qe[dt].y:qe[dt].y>Lt&&(Lt=qe[dt].y);return[st,ut,mt-st,Lt-ut]}(s),me=qe=>[(qe.x-W)/te,(qe.y-ee)/ne],[de,be,Ae,ze]=s.map(me),$e=function(qe,st,mt,ut,Lt,dt,yt,Wt){const jt=N1(0,0,1,0,1,1,0,1),Ut=N1(qe,st,mt,ut,Lt,dt,yt,Wt),_t=o.bC.adjoint([],Ut);return o.bC.multiply(jt,jt,_t)}(de[0],de[1],be[0],be[1],Ae[0],Ae[1],ze[0],ze[1]);this.elevatedGlobePerspectiveTransform=SA(de[0],de[1],be[0],be[1],Ae[0],Ae[1],ze[0],ze[1]);const Ve=(qe,st)=>{E.push(qe.lng);const mt=Math.round((qe.lng-I)/k*xt),ut=Math.round((qe.lat-z)/B*xt),Lt=me(st),dt=o._.transformMat3([],[Lt[0],Lt[1],1],$e),yt=Math.round(dt[0]/dt[2]*xt),Wt=Math.round(dt[1]/dt[2]*xt);N.emplaceBack(mt,ut,yt,Wt)},Je=s[3].x-s[0].x,ht=s[3].y-s[0].y,Ye=s[2].x-s[1].x,it=s[2].y-s[1].y;for(let qe=0;qe<65;qe++){const st=qe/64,mt=[s[0].x+st*Je,s[0].y+st*ht],ut=[s[1].x+st*Ye,s[1].y+st*it],Lt=ut[0]-mt[0],dt=ut[1]-mt[1];for(let yt=0;yt<65;yt++){const Wt=yt/64,jt={x:mt[0]+Lt*Wt,y:mt[1]+dt*Wt,z:0};Ve(n.projection.unproject(jt.x,jt.y),jt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,O1.members)}{this.maxLongitudeTriangleSize=0;let N=[],W=new Si;const ee=(te,ne,me)=>{W.emplaceBack(te,ne,me);const de=E[te],be=E[ne],Ae=E[me],ze=Math.min(Math.min(de,be),Ae),$e=Math.max(Math.max(de,be),Ae)-ze;$e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=$e),N.push(ze+$e/2)};for(let te=0;te<64;te++)for(let ne=0;ne<64;ne++){const me=65*te+ne,de=me+1,be=me+65,Ae=be+1;ee(me,be,de),ee(de,be,Ae)}[N,W]=function(te,ne){const me=Array.from({length:te.length},(Ae,ze)=>ze);me.sort((Ae,ze)=>te[Ae]-te[ze]);const de=[],be=new Si;for(let Ae=0;Ae<me.length;Ae++){const ze=me[Ae];de.push(te[ze]);const $e=3*ze,Ve=$e+1;be.emplaceBack(ne.uint16[$e],ne.uint16[Ve],ne.uint16[Ve+1])}return[de,be]}(N,W),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=Lr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/xt,0,B/xt,0,0,z,I,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,s=n.gl;!this._dirty||this.texture instanceof z1||(this.texture?this.texture.update(this.image):(this.texture=new xl(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let l=(c=e+180)+360*Math.round((s[0]-c)/360);var c;const d=new Lr,_=(A,I)=>{d.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:n.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-l)<=y){const A=ap(s,0,s.length,l+y);return A===s.length||_(A,Sd(s,A+1,s.length,l+360-y)-A),d}l<s[0]&&(l+=360);const w=Sd(s,0,s.length,l-y);if(w===s.length)return _(0,s.length),d;_(0,w-0);const E=ap(s,w+1,s.length,l+y);return E!==s.length&&_(E,s.length-E),d}}const Dz=(Math.pow(256,2)-1)/16907520;class CA extends ii{constructor(e,n,s,l){super(e,Lz,n,s,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof EA&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[s,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(l)||s===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=Jp({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,l])}}const zz=new Kn({visibility:new nt(ke["layout_raster-particle"].visibility)});var kz={paint:new Kn({"raster-particle-array-band":new nt(ke["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new nt(ke["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Mr(ke["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new nt(ke["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new nt(ke["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new nt(ke["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new nt(ke["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:zz};class AA extends ii{constructor(e,n,s,l){super(e,kz,n,s,l),this._updateColorRamp(),this.lastInvalidatedAt=zi.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Jp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=zi.now()}}class Oz extends ii{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const Bz=new Kn({visibility:new nt(ke.layout_sky.visibility)});var Fz={paint:new Kn({"sky-type":new nt(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new nt(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new nt(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new nt(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new nt(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new Mr(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new nt(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new nt(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new nt(ke.paint_sky["sky-opacity"])}),layout:Bz};function vT(t,e,n){const s=[0,0,1],l=o.av.identity([]);return o.av.rotateY(l,l,n?-kn(t)+Math.PI:kn(t)),o.av.rotateX(l,l,-kn(e)),o._.transformQuat(s,s,l),o._.normalize(s,s)}var Nz={paint:new Kn({})};function MA(t,e){const n=U1(t.projection,t.zoom,t.width,t.height),s=function(c,d,_,y,w){const E=new Un(_.lng-180*bf,_.lat),A=new Un(_.lng+180*bf,_.lat),I=c.project(E.lng,E.lat),z=c.project(A.lng,A.lat),k=-Math.atan2(z.y-I.y,z.x-I.x),B=Hi.fromLngLat(_);B.y=Xt(B.y,-1+bf,1-bf);const N=B.toLngLat(),W=c.project(N.lng,N.lat),ee=Hi.fromLngLat(N);ee.x+=bf;const te=ee.toLngLat(),ne=c.project(te.lng,te.lat),me=RA(ne.x-W.x,ne.y-W.y,k),de=Hi.fromLngLat(N);de.y+=bf;const be=de.toLngLat(),Ae=c.project(be.lng,be.lat),ze=RA(Ae.x-W.x,Ae.y-W.y,k),$e=Math.abs(me.x)/Math.abs(ze.y),Ve=o.ad.identity([]);o.ad.rotateZ(Ve,Ve,-k*(1-(w?0:y)));const Je=o.ad.identity([]);return o.ad.scale(Je,Je,[1,1-(1-$e)*y,1]),Je[4]=-ze.x/ze.y*y,o.ad.rotateZ(Je,Je,k),o.ad.multiply(Je,Ve,Je),Je}(t.projection,0,t.center,n,e),l=IA(t);return o.ad.scale(s,s,[l,l,1]),s}function IA(t){const e=t.projection,n=U1(t.projection,t.zoom,t.width,t.height),s=PA(e,t.center),l=PA(e,Un.convert(e.center));return Math.pow(2,s*n+(1-n)*l)}function U1(t,e,n,s,l=1/0){const c=t.range;if(!c)return 0;const d=Math.min(l,Math.max(n,s)),_=Math.log(d/1024)/Math.LN2;return ga(c[0]+_,c[1]+_,e)}const bf=1/4e4;function PA(t,e){const n=Xt(e.lat,-Kr,Kr),s=new Un(e.lng-180*bf,n),l=new Un(e.lng+180*bf,n),c=t.project(s.lng,n),d=t.project(l.lng,n),_=Hi.fromLngLat(s),y=Hi.fromLngLat(l),w=d.x-c.x,E=d.y-c.y,A=y.x-_.x,I=y.y-_.y,z=Math.sqrt((A*A+I*I)/(w*w+E*E));return Math.log(z)/Math.LN2}function RA(t,e,n){const s=Math.cos(n),l=Math.sin(n);return{x:t*s-e*l,y:t*l+e*s}}function LA(t,e,n){o.ad.identity(t),o.ad.rotateZ(t,t,kn(e[2])),o.ad.rotateX(t,t,kn(e[0])),o.ad.rotateY(t,t,kn(e[1])),o.ad.scale(t,t,n),o.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function j1(t,e,n,s,l,c,d,_){const y=[n[0]-e[0],n[1]-e[1],0],w=[s[0]-e[0],s[1]-e[1],0];if(o._.length(y)<1e-12||o._.length(w)<1e-12)return o.av.identity(t);const E=o._.cross([],y,w);o._.normalize(E,E),o._.subtract(w,s,e),y[2]=(c-l)*_,w[2]=(d-l)*_;const A=y;return o._.cross(A,y,w),o._.normalize(A,A),o.av.rotationTo(t,E,A)}function wT(t,e,n=!1){const s=du(e.zoom),l=function(c,d,_){const y=d.worldSize,w=[c[12],c[13],c[14]],E=Ni(w[1]/y),A=Gs(w[0]/y),I=o.ad.identity([]),z=Ms(1,E)*y,k=Ms(1,0)*y*Dc(E,d.zoom),B=1/yy(y);let N=k*B;if(_){const ne=U1(d.projection,d.zoom,d.width,d.height,1024);N=B*d.projection.pixelSpaceConversion(d.center.lat,y,ne)}const W=Uh(E,A);o._.add(W,W,o._.scale([],o._.normalize([],W),z*N*w[2]));const ee=function(ne){const me=[ne[0],ne[1],ne[2]];let de=[0,1,0];const be=o._.cross([],de,me);return o._.cross(de,me,be),o._.squaredLength(de)===0&&(de=[0,1,0],o._.cross(be,me,de)),o._.normalize(be,be),o._.normalize(de,de),o._.normalize(me,me),[be[0],be[1],be[2],0,de[0],de[1],de[2],0,me[0],me[1],me[2],0,ne[0],ne[1],ne[2],1]}(W);o.ad.scale(I,I,[N,N,N*z]),o.ad.translate(I,I,[-w[0],-w[1],-w[2]]);const te=o.ad.multiply([],d.globeMatrix,ee);return o.ad.multiply(te,te,I),o.ad.multiply(te,te,c),te}(t,e,n);if(s>0){const c=function(d,_){const y=_.worldSize,w=Ms(1,0)*y*Dc(_.center.lat,_.zoom)/yy(y),E=Ms(1,_.center.lat)*y,A=o.ad.identity([]);return o.ad.rotateY(A,A,kn(_.center.lng)),o.ad.rotateX(A,A,kn(_.center.lat)),o.ad.translate(A,A,[0,0,As]),o.ad.scale(A,A,[w,w,w*E]),o.ad.translate(A,A,[_.point.x-.5*y,_.point.y-.5*y,0]),o.ad.multiply(A,A,d),o.ad.multiply(A,_.globeMatrix,A)}(t,e);return function(d,_,y){const w=(k,B,N)=>{const W=o._.length(k),ee=o._.length(B),te=hu(k,B,N);return o._.scale(te,te,1/o._.length(te)*Ht(W,ee,N))},E=w([d[0],d[1],d[2]],[_[0],_[1],_[2]],y),A=w([d[4],d[5],d[6]],[_[4],_[5],_[6]],y),I=w([d[8],d[9],d[10]],[_[8],_[9],_[10]],y),z=hu([d[12],d[13],d[14]],[_[12],_[13],_[14]],y);return[E[0],E[1],E[2],0,A[0],A[1],A[2],0,I[0],I[1],I[2],0,z[0],z[1],z[2],1]}(l,c,s)}return l}function DA(t,e,n,s){const l=Dr.projectAabbCorners(s,n);let c=Number.MAX_VALUE,d=-1;for(let w=0;w<l.length;++w){const E=l[w];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<c&&(d=w,c=E[2])}const _=w=>new lt(l[w][0],l[w][1]);let y;switch(d){case 0:case 6:y=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:y=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:y=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:y=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(uy(t,y))return c}const Vz=Xn([{name:"a_pos_3f",components:3,type:"Float32"}]),Uz=Xn([{name:"a_color_3f",components:3,type:"Float32"}]),jz=Xn([{name:"a_color_4f",components:4,type:"Float32"}]),Gz=Xn([{name:"a_uv_2f",components:2,type:"Float32"}]),Wz=Xn([{name:"a_normal_3f",components:3,type:"Float32"}]),$z=Xn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),qz=Xn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class G1{constructor(e,n,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),n!=null&&n.__line__&&(this.line=n.__line__)}}function zA(t,e){const n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class kA{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class OA{constructor(){this.instancedDataArray=new $g,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class bT{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,s,l){this.tileToMeter=$p(s);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:_,index:y,sourceLayerIndex:w}of e){const E=_??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),A=uu(d,c);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),A,s))continue;const I={id:E,sourceLayerIndex:w,index:y,geometry:c?A.geometry:Ra(d,s,l),properties:d.properties,type:d.type,patterns:{}},z=this.addFeature(I,I.geometry,A);z&&n.featureIndex.insert(d,I.geometry,y,w,this.index,this.instancesPerModel[z].instancedDataArray.length,xt/32)}this.lookup=null}update(e,n,s,l){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];for(const _ in e)d.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(d.features[d.idToFeaturesIndex[_]],e[_],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const s=this.instancesPerModel[n];for(const l of s.features){const c=this.layers[0],d=l.feature,_=this.canonical,y=c.paint.get("model-rotation").evaluate(d,{},_),w=c.paint.get("model-scale").evaluate(d,{},_),E=c.paint.get("model-translation").evaluate(d,{},_);o._.exactEquals(l.rotation,y)&&o._.exactEquals(l.scale,w)&&o._.exactEquals(l.translation,E)||(this.evaluate(l,l.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,n,s){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const l=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Ly(this.activeReplacements,l))return!1;this.activeReplacements=l;let c=!1;for(const d in this.instancesPerModel){const _=this.instancesPerModel[d],y=_.instancedDataArray;for(const w of _.features){const E=w.instancedDataOffset,A=w.instancedDataCount;for(let I=0;I<A;I++){const z=16*(I+E);let k=y.float32[z+0];k=k>xt?k-xt:k;const B=Math.floor(k),N=y.float32[z+1];let W=!1;for(const ee of this.activeReplacements)if(!(ee.order<s||ee.order===1/0)&&ee.clipMask&u1.Model&&!(ee.min.x>B||B>ee.max.x||ee.min.y>N||N>ee.max.y)&&(W=r1(n1(B,N,e.canonical,ee.footprintTileId.canonical),ee),W))break;y.float32[z]=W?k+xt:k,c=c||W}}}return c}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const s=this.instancesPerModel[n];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,$z.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const s=this.instancesPerModel[n];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,s){const l=this.layers[0],c=l.layout.get("model-id").evaluate(s,{},this.canonical);if(!c)return xr(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),c;zA(c,!1)&&(this.modelUris.includes(c)||this.modelUris.push(c)),this.instancesPerModel[c]||(this.instancesPerModel[c]=new OA);const d=this.instancesPerModel[c],_=d.instancedDataArray,y=new kA(s,_.length);for(const w of n)for(const E of w){if(E.x<0||E.x>=xt||E.y<0||E.y>=xt)continue;const A=(this.lookupDim-1)/xt,I=this.lookupDim*(E.y*A|0)+E.x*A|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const z=_.length;_.resize(z+1),d.instancesEvaluatedElevation.push(0),_.float32[16*z]=E.x,_.float32[16*z+1]=E.y}return y.instancedDataCount=d.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(y),this.evaluate(y,{},d,!1)),c}getModelUris(){return this.modelUris}evaluate(e,n,s,l){const c=this.layers[0],d=e.feature,_=this.canonical,y=e.rotation=c.paint.get("model-rotation").evaluate(d,n,_),w=e.scale=c.paint.get("model-scale").evaluate(d,n,_),E=e.translation=c.paint.get("model-translation").evaluate(d,n,_),A=c.paint.get("model-color").evaluate(d,n,_);A.a=c.paint.get("model-color-mix-intensity").evaluate(d,n,_);const I=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),LA(I,y,w);const z=Math.round(100*A.a)+A.b/1.05;for(let k=0;k<e.instancedDataCount;++k){const B=e.instancedDataOffset+k,N=16*B,W=s.instancedDataArray.float32;let ee=0;l&&(ee=W[N+6]-s.instancesEvaluatedElevation[B]);const te=0|W[N+1];W[N]=(0|W[N])+A.r/1.05,W[N+1]=te+A.g/1.05,W[N+2]=z,W[N+3]=1/(_.z>10?this.tileToMeter:$p(_,te)),W[N+4]=E[0],W[N+5]=E[1],W[N+6]=E[2]+ee,W[N+7]=I[0],W[N+8]=I[1],W[N+9]=I[2],W[N+10]=I[4],W[N+11]=I[5],W[N+12]=I[6],W[N+13]=I[8],W[N+14]=I[9],W[N+15]=I[10],s.instancesEvaluatedElevation[B]=E[2]}}}se(bT,"ModelBucket",{omit:["layers"]}),se(OA,"PerModelAttributes"),se(kA,"ModelFeature");const Hz=new Kn({visibility:new nt(ke.layout_model.visibility),"model-id":new At(ke.layout_model["model-id"])});var Zz={paint:new Kn({"model-opacity":new nt(ke.paint_model["model-opacity"]),"model-rotation":new At(ke.paint_model["model-rotation"]),"model-scale":new At(ke.paint_model["model-scale"]),"model-translation":new At(ke.paint_model["model-translation"]),"model-color":new At(ke.paint_model["model-color"]),"model-color-mix-intensity":new At(ke.paint_model["model-color-mix-intensity"]),"model-type":new nt(ke.paint_model["model-type"]),"model-cast-shadows":new nt(ke.paint_model["model-cast-shadows"]),"model-receive-shadows":new nt(ke.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new nt(ke.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new At(ke.paint_model["model-emissive-strength"]),"model-roughness":new At(ke.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new At(ke.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new nt(ke.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new nt(ke.paint_model["model-front-cutoff"])}),layout:Hz};const lm=64,z_={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function BA(t,e,n,s,l,c,d,_,y,w=!1){const E=n.zoom,A=n.project(s),I=Dc(s.lat,E),z=1/I;o.ad.identity(t),o.ad.translate(t,t,[A.x+d[0]*z,A.y+d[1]*z,d[2]]);let k=1,B=1;const N=n.worldSize;if(w){if(n.projection.name==="mercator"){let ne=0;n.elevation&&(ne=n.elevation.getAtPointOrZero(new Hi(A.x/N,A.y/N),0));const me=o.aA.transformMat4([],[A.x,A.y,ne,1],n.projMatrix)[3]/n.cameraToCenterDistance;k=me,B=me*Dc(n.center.lat,E)}else if(n.projection.name==="globe"){const ne=wT(t,n),me=o.ad.multiply([],n.projMatrix,ne),de=[0,0,0,1];o.aA.transformMat4(de,de,me);const be=de[3]/n.cameraToCenterDistance,Ae=du(E),ze=n.projection.pixelsPerMeter(s.lat,N)*Dc(s.lat,E),$e=n.projection.pixelsPerMeter(n.center.lat,N)*Dc(n.center.lat,E);k=be/Ht(ze,iy(n.center.lat),Ae),B=be*I/ze,k*=$e,B*=$e}}else k=z;o.ad.scale(t,t,[k,k,B]);const W=[...t],ee=e.orientation,te=[];if(LA(te,[ee[0]+l[0],ee[1]+l[1],ee[2]+l[2]],c),o.ad.multiply(t,W,te),_&&n.elevation){let ne=0;const me=[];if(y&&n.elevation){ne=function(Ae,ze,$e,Ve,Je){const ht=ze.elevation;if(!ht)return 0;const Ye=Dr.projectAabbCorners($e,Ve),it=Ms(1,Je.lat)*ze.worldSize,qe=function(qt,pn){const nn=[0,0,1],vn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const mn of vn){const Pn=qt[mn.corners[0]],Jt=qt[mn.corners[1]],hr=qt[mn.corners[2]],cr=[Jt[0]-Pn[0],Jt[1]-Pn[1],pn*(Jt[2]-Pn[2])],Jn=o._.cross(cr,cr,[hr[0]-Pn[0],hr[1]-Pn[1],pn*(hr[2]-Pn[2])]);o._.normalize(Jn,Jn),mn.dotProductWithUp=o._.dot(Jn,nn)}return vn.sort((mn,Pn)=>mn.dotProductWithUp-Pn.dotProductWithUp),vn[0].corners}(Ye,it),st=Ye[qe[0]],mt=Ye[qe[1]],ut=Ye[qe[2]],Lt=Ye[qe[3]],dt=ht.getAtPointOrZero(new Hi(st[0]/ze.worldSize,st[1]/ze.worldSize),0),yt=ht.getAtPointOrZero(new Hi(mt[0]/ze.worldSize,mt[1]/ze.worldSize),0),Wt=ht.getAtPointOrZero(new Hi(ut[0]/ze.worldSize,ut[1]/ze.worldSize),0),jt=ht.getAtPointOrZero(new Hi(Lt[0]/ze.worldSize,Lt[1]/ze.worldSize),0),Ut=(dt+jt)/2,_t=(yt+Wt)/2;return Ut>_t?yt<Wt?j1(Ae,mt,Lt,st,yt,jt,dt,it):j1(Ae,ut,st,Lt,Wt,dt,jt,it):dt<jt?j1(Ae,st,mt,ut,dt,yt,Wt,it):j1(Ae,Lt,ut,mt,jt,Wt,yt,it),Math.max(Ut,_t)}(me,n,e.aabb,t,s);const de=o.ad.fromQuat([],me),be=o.ad.multiply([],de,te);o.ad.multiply(t,W,be)}else ne=n.elevation.getAtPointOrZero(new Hi(A.x/N,A.y/N),0);ne!==0&&(t[14]+=ne)}}function Hy(t,e,n=!1){t.uploaded||(t.gfxTexture=new xl(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function Xz(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,Vz.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,Wz.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,Gz.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?Uz:jz).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,qz.members,!0)),t.segments=Lr.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const s=t.material;s.pbrMetallicRoughness.baseColorTexture&&Hy(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&Hy(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&Hy(s.normalTexture,e),s.occlusionTexture&&Hy(s.occlusionTexture,e,n),s.emissionTexture&&Hy(s.emissionTexture,e)}function TT(t,e,n){if(t.meshes)for(const s of t.meshes)Xz(s,e,n);if(t.children)for(const s of t.children)TT(s,e,n)}function W1(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)W1(e)}function ST(t){if(t.meshes)for(const n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const n of t.children)ST(n)}class Yz{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Kz{constructor(){this.tasks={},this.taskQueue=[],hh(["process"],this),this.invoker=new Yz(this.process),this.nextId=0}add(e,n){const s=this.nextId++,l=function({type:c,isSymbolTile:d,zoom:_}){return _=_||0,c==="message"?0:c!=="maybePrepare"||d?c!=="parseTile"||d?c==="parseTile"&&d?300-_:c==="maybePrepare"&&d?400-_:500:200-_:100-_}(n);if(l===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:n,priority:l,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let l=0;l<this.taskQueue.length;l++){const c=this.tasks[this.taskQueue[l]];c.priority<n&&(n=c.priority,e=l)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class FA{constructor(e,n,s){this.target=e,this.parent=n,this.mapId=s,this.callbacks={},this.cancelCallbacks={},hh(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Kz}send(e,n,s,l,c=!1,d){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=d,this.callbacks[_]=s);const y=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!s,targetMapId:l,mustQueue:c,sourceMapId:this.mapId,data:Se(n,y)},y),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const n=e.data,s=n.id;if(s&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(n.mustQueue||jr()){const l=this.callbacks[s],c=this.scheduler.add(()=>this.processTask(s,n),l&&l.metadata||{type:"message"});c&&(this.cancelCallbacks[s]=c)}else this.processTask(s,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(n.error?s(Oe(n.error)):s(null,Oe(n.data)))}else{const s=new Set,l=n.hasCallback?(d,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?Se(d):null,data:Se(_,s)},s)}:d=>{},c=Oe(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,c,l);else if(this.parent.getWorkerSource){const d=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,d[0],c.source,c.scope)[d[1]](c,l)}else l(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class k_{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=uh();const s=this.workerPool.acquire(this.id);for(let l=0;l<s.length;l++){const c=new k_.Actor(s[l],n,this.id);c.name=`Worker ${l}`,this.actors.push(c)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,s){Ul(this.actors,(l,c)=>{l.send(e,n,c)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}k_.Actor=FA;var Zy={workerUrl:"",workerClass:null,workerParams:void 0};function Jz(){return Zy.workerClass!=null?new Zy.workerClass:new self.Worker(Zy.workerUrl,Zy.workerParams)}const ET="mapboxgl_preloaded_worker_pool";class Xy{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Xy.workerCount;)this.workers.push(new Jz);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ET]}numActive(){return Object.keys(this.active).length}}let Yy;function $1(){return Yy||(Yy=new Xy),Yy}Xy.workerCount=2;let q1,CT,wu,O_,AT,B_=null;function NA(){return jr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:CT||Q.DRACO_URL}function VA(){if(jr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(O_)return O_;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return O_=WebAssembly.validate(t)?Q.MESHOPT_SIMD_URL:Q.MESHOPT_URL,O_}const H1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qz={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ky={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function UA(t,e,n){const s=n.json.bufferViews.length,l=n.buffers.length;e.bufferView=s,n.json.bufferViews[s]={buffer:l,byteLength:t.byteLength},n.buffers[l]=t}const MT="KHR_draco_mesh_compression";function ek(t,e){const n=t.extensions&&t.extensions[MT];if(!n)return;const s=new wu.Decoder,l=$A(e,n.bufferView),c=new wu.Mesh;if(!s.DecodeArrayToMesh(l,l.byteLength,c))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[t.indices],_=H1[d.componentType],y=d.count*_.BYTES_PER_ELEMENT,w=wu._malloc(y);_===Uint16Array?s.GetTrianglesUInt16Array(c,y,w):s.GetTrianglesUInt32Array(c,y,w),UA(wu.memory.buffer.slice(w,w+y),d,e),wu._free(w);for(const E of Object.keys(n.attributes)){const A=s.GetAttributeByUniqueId(c,n.attributes[E]),I=e.json.accessors[t.attributes[E]],z=Qz[I.componentType],k=I.count*Ky[I.type]*H1[I.componentType].BYTES_PER_ELEMENT,B=wu._malloc(k);s.GetAttributeDataArrayForAllPoints(c,A,wu[z],k,B),UA(wu.memory.buffer.slice(B,B+k),I,e),wu._free(B)}s.destroy(),c.destroy(),delete t.extensions[MT]}const Z1="EXT_meshopt_compression";function tk(t,e){if(!t.extensions||!t.extensions[Z1])return;const n=t.extensions[Z1],s=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),l=new Uint8Array(n.count*n.byteStride);AT.decodeGltfBuffer(l,n.count,n.byteStride,s,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=l.buffer,delete t.extensions[Z1]}const jA=1179937895,GA=new TextDecoder("utf8");function WA(t,e){return new URL(t,e).href}function nk(t,e,n,s){return fetch(WA(t.uri,s)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[n]=l})}function $A(t,e){const n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function rk(t,e,n,s){if(t.uri){const l=WA(t.uri,s);return fetch(l).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{e.images[n]=c})}if(t.bufferView!==void 0){const l=$A(e,t.bufferView),c=new Blob([l],{type:t.mimeType});return createImageBitmap(c).then(d=>{e.images[n]=d})}}function qA(t,e=0,n){const s={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===jA){const E=new Uint32Array(t,e);let A=2;const I=(E[A++]>>2)-3,z=E[A++]>>2;if(A++,s.json=JSON.parse(GA.decode(E.subarray(A,A+z))),A+=z,A<I){const k=E[A++];A++;const B=e+(A<<2);s.buffers[0]=t.slice(B,B+k)}}else s.json=JSON.parse(GA.decode(new Uint8Array(t,e)));const{buffers:l,images:c,meshes:d,extensionsUsed:_,bufferViews:y}=s.json;let w=Promise.resolve();if(l){const E=[];for(let A=0;A<l.length;A++){const I=l[A];I.uri?E.push(nk(I,s,A,n)):s.buffers[A]||(s.buffers[A]=null)}w=Promise.all(E)}return w.then(()=>{const E=[],A=_&&_.includes(MT),I=_&&_.includes(Z1);if(A&&E.push(function(){if(!wu)return q1||(q1=function(z){let k,B=null;function N(){k=new Uint8Array(B.buffer)}function W(){throw new Error("Unexpected Draco error.")}const ee={a:{a:W,d:function(te,ne,me){return k.copyWithin(te,ne,ne+me)},c:function(te){const ne=k.length,me=Math.max(te>>>0,Math.ceil(1.2*ne)),de=Math.ceil((me-ne)/65536);try{return B.grow(de),N(),!0}catch{return!1}},b:W}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,ee):z.then(te=>te.arrayBuffer()).then(te=>WebAssembly.instantiate(te,ee))).then(te=>{const{Rb:ne,Qb:me,P:de,T:be,X:Ae,Ja:ze,La:$e,Qa:Ve,Va:Je,Wa:ht,eb:Ye,jb:it,f:qe,e:st,yb:mt,zb:ut,Ab:Lt,Bb:dt,Db:yt,Gb:Wt}=te.instance.exports;B=st;const jt=(()=>{let Ut=0,_t=0,qt=0,pn=0;return nn=>{qt&&(ne(pn),ne(Ut),_t+=qt,qt=Ut=0),Ut||(_t+=128,Ut=me(_t));const vn=nn.length+7&-8;let mn=Ut;vn>=_t&&(qt=vn,mn=pn=me(vn));for(let Pn=0;Pn<nn.length;Pn++)k[mn+Pn]=nn[Pn];return mn}})();return N(),qe(),{memory:st,_free:ne,_malloc:me,Mesh:class{constructor(){this.ptr=de()}destroy(){be(this.ptr)}},Decoder:class{constructor(){this.ptr=ze()}destroy(){it(this.ptr)}DecodeArrayToMesh(Ut,_t,qt){const pn=jt(Ut),nn=$e(this.ptr,pn,_t,qt.ptr);return!!Ae(nn)}GetAttributeByUniqueId(Ut,_t){return{ptr:Ve(this.ptr,Ut.ptr,_t)}}GetTrianglesUInt16Array(Ut,_t,qt){Je(this.ptr,Ut.ptr,_t,qt)}GetTrianglesUInt32Array(Ut,_t,qt){ht(this.ptr,Ut.ptr,_t,qt)}GetAttributeDataArrayForAllPoints(Ut,_t,qt,pn,nn){Ye(this.ptr,Ut.ptr,_t.ptr,qt,pn,nn)}},DT_INT8:mt(),DT_UINT8:ut(),DT_INT16:Lt(),DT_UINT16:dt(),DT_UINT32:yt(),DT_FLOAT32:Wt()}})}(fetch(NA())),q1.then(z=>{wu=z,q1=void 0}))}()),I&&E.push(function(){if(AT)return;const z=function(k){let B;const N=WebAssembly.instantiateStreaming(k,{}).then(te=>{B=te.instance,B.exports.__wasm_call_ctors()}),W={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ee={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(te,ne,me,de,be,Ae){(function(ze,$e,Ve,Je,ht,Ye,it){const qe=ze.exports.sbrk,st=Je+3&-4,mt=qe(st*ht),ut=qe(Ye.length),Lt=new Uint8Array(ze.exports.memory.buffer);Lt.set(Ye,ut);const dt=$e(mt,Je,ht,ut,Ye.length);if(dt===0&&it&&it(mt,st,ht),Ve.set(Lt.subarray(mt,mt+Je*ht)),qe(mt-qe(0)),dt!==0)throw new Error(`Malformed buffer data: ${dt}`)})(B,B.exports[ee[be]],te,ne,me,de,B.exports[W[Ae]])}}}(fetch(VA()));return z.ready.then(()=>{AT=z})}()),c)for(let z=0;z<c.length;z++)E.push(rk(c[z],s,z,n));return(E.length?Promise.all(E):Promise.resolve()).then(()=>{if(A&&d)for(const{primitives:z}of d)for(const k of z)ek(k,s);if(I&&d&&y)for(const z of y)tk(z,s);return s})})}function um(t,e){const n=t.json.bufferViews[e.bufferView],s=H1[e.componentType];return new s(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Ky[e.type]*s.BYTES_PER_ELEMENT?n.byteStride/s.BYTES_PER_ELEMENT:Ky[e.type]))}function IT(t,e,n,s){const l=H1[e.componentType],c=function(E){switch(E){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),d=t.json.bufferViews[e.bufferView],_=d.byteStride?d.byteStride/l.BYTES_PER_ELEMENT:Ky[e.type],y=n.float32,w=y.length/n.capacity;for(let E=0,A=0;E<e.count*_;E+=_,A+=w)for(let I=0;I<w;I++)y[A+I]=s[E+I]*c;n._trim()}function ik(t,e,n){const s=t.indices,l=t.attributes,c={};c.indexArray=new Si;const d=e.json.accessors[s],_=d.count/3;c.indexArray.reserve(_);const y=um(e,d);for(let I=0;I<_;I++)c.indexArray.emplaceBack(y[3*I],y[3*I+1],y[3*I+2]);c.indexArray._trim(),c.vertexArray=new Mc;const w=e.json.accessors[l.POSITION];c.vertexArray.reserve(w.count);const E=um(e,w);for(let I=0;I<w.count;I++)c.vertexArray.emplaceBack(E[3*I],E[3*I+1],E[3*I+2]);if(c.vertexArray._trim(),c.aabb=new Dr(w.min,w.max),c.centroid=function(I,z){const k=[0,0,0],B=I.length;if(B>0){for(let N=0;N<B;N++){const W=3*I[N];k[0]+=z[W],k[1]+=z[W+1],k[2]+=z[W+2]}k[0]/=B,k[1]/=B,k[2]/=B}return k}(y,E),l.COLOR_0!==void 0){const I=e.json.accessors[l.COLOR_0],z=Ky[I.type],k=um(e,I);c.colorArray=z===3?new Mc:new Ac,c.colorArray.resize(I.count),IT(e,I,c.colorArray,k)}if(l.NORMAL!==void 0){c.normalArray=new Mc;const I=e.json.accessors[l.NORMAL];c.normalArray.resize(I.count);const z=um(e,I);IT(e,I,c.normalArray,z)}if(l.TEXCOORD_0!==void 0&&n.length>0){c.texcoordArray=new ef;const I=e.json.accessors[l.TEXCOORD_0];c.texcoordArray.resize(I.count);const z=um(e,I);IT(e,I,c.texcoordArray,z)}if(l._FEATURE_ID_RGBA4444!==void 0){const I=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(c.featureData=um(e,I))}l._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(um(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));const A=t.material;return c.material=function(I,z){const{emissiveFactor:k=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:N=.5,normalTexture:W,occlusionTexture:ee,emissiveTexture:te,doubleSided:ne}=I,{baseColorFactor:me=[1,1,1,1],metallicFactor:de=1,roughnessFactor:be=1,baseColorTexture:Ae,metallicRoughnessTexture:ze}=I.pbrMetallicRoughness||{},$e=ee?z[ee.index]:void 0;if(ee&&ee.extensions&&ee.extensions.KHR_texture_transform&&$e){const Ve=ee.extensions.KHR_texture_transform;$e.offsetScale=[Ve.offset[0],Ve.offset[1],Ve.scale[0],Ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Gn(...me),metallicFactor:de,roughnessFactor:be,baseColorTexture:Ae?z[Ae.index]:void 0,metallicRoughnessTexture:ze?z[ze.index]:void 0},doubleSided:ne,emissiveFactor:k,alphaMode:B,alphaCutoff:N,normalTexture:W?z[W.index]:void 0,occlusionTexture:$e,emissionTexture:te?z[te.index]:void 0,defined:I.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},n),c}function HA(t,e,n){const{matrix:s,rotation:l,translation:c,scale:d,mesh:_,extras:y,children:w}=t,E={};if(E.matrix=s||o.ad.fromRotationTranslationScale([],l||[0,0,0,1],c||[0,0,0],d||[1,1,1]),_!==void 0){E.meshes=n[_];const A=E.anchor=[0,0];for(const I of E.meshes){const{min:z,max:k}=I.aabb;A[0]+=z[0]+k[0],A[1]+=z[1]+k[1]}A[0]=Math.floor(A[0]/E.meshes.length/2),A[1]=Math.floor(A[1]/E.meshes.length/2)}if(y&&(y.id&&(E.id=y.id),y.lights&&(E.lights=function(A){if(!A.length)return[];const I=function(W){const ee=atob(W),te=new Uint8Array(ee.length);for(let ne=0;ne<ee.length;ne++)te[ne]=ee.codePointAt(ne);return te}(A),z=[],k=I.length/24,B=new Uint16Array(I.buffer),N=new Float32Array(I.buffer);for(let W=0;W<k;W++){const ee=B[2*W*6]/30,te=B[2*W*6+1]/30,ne=B[2*W*6+10]/100,me=N[6*W+1],de=N[6*W+2],be=N[6*W+3],Ae=N[6*W+4],ze=be-me,$e=Ae-de,Ve=Math.hypot(ze,$e);z.push({pos:[me+.5*ze,de+.5*$e,te],normal:[$e/Ve,-ze/Ve,0],width:Ve,height:ee,depth:ne,points:[me,de,be,Ae]})}return z}(y.lights))),w){const A=[];for(const I of w)A.push(HA(e.json.nodes[I],e,n));E.children=A}return E}function sk(t){if(t.vertices.length===0||t.indices.length===0)return null;const e=new My(t.vertices,t.indices,8,256),[n,s]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:s}}function ok(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const s=[];for(const d of n){if(!Array.isArray(d)||d.length!==2)continue;const _=d[0],y=d[1];typeof _=="number"&&typeof y=="number"&&s.push(new lt(_,y))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let l=0;for(let d=0;d<s.length;d++){const _=s[d],y=s[(d+1)%s.length],w=s[(d+2)%s.length];l+=(_.x-y.x)*(w.y-y.y)-(w.x-y.x)*(_.y-y.y)}l>0&&s.reverse();const c=Wh(s.flatMap(d=>[d.x,d.y]),[]);return c.length===0?null:{vertices:s,indices:c}}function ak(t,e){const n=[],s=[];let l=0;const c=[];for(const d of t){l=n.length;const _=d.vertexArray.float32,y=d.indexArray.uint16;for(let w=0;w<d.vertexArray.length;w++)c[0]=_[3*w+0],c[1]=_[3*w+1],c[2]=_[3*w+2],o._.transformMat4(c,c,e),n.push(new lt(c[0],c[1]));for(let w=0;w<3*d.indexArray.length;w++)s.push(y[w]+l)}if(s.length%3!=0)return null;for(let d=0;d<s.length;d+=3){const _=n[s[d+0]],y=n[s[d+1]],w=n[s[d+2]];(_.x-y.x)*(w.y-y.y)-(w.x-y.x)*(_.y-y.y)>0&&([s[d+1],s[d+2]]=[s[d+2],s[d+1]])}return{vertices:n,indices:s}}function ZA(t){const e=function(y,w){const E=[],A=WebGL2RenderingContext;if(y.json.textures)for(const I of y.json.textures){const z={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};I.sampler!==void 0&&Object.assign(z,y.json.samplers[I.sampler]),E.push({image:w[I.source],sampler:z,uploaded:!1})}return E}(t,t.images),n=function(y,w){const E=[];for(const A of y.json.meshes){const I=[];for(const z of A.primitives)I.push(ik(z,y,w));E.push(I)}return E}(t,e),{scenes:s,scene:l,nodes:c}=t.json,d=s?s[l||0].nodes:c,_=[];for(const y of d)_.push(HA(c[y],t,n));return function(y,w,E){const A={},I=new Set;for(let z=0;z<y.length;z++){const k=E[w[z]];if(!k.extras)continue;const B=k.extras["mapbox:footprint:version"],N=k.extras["mapbox:footprint:id"];(B||N)&&I.add(z),B==="1.0.0"&&N&&(A[N]=z)}for(let z=0;z<y.length;z++){if(I.has(z))continue;const k=y[z],B=E[w[z]];if(!B.extras)continue;let N=null;k.id in A&&(N=ak(y[A[k.id]].meshes,k.matrix)),N||(N=ok(B)),N&&(k.footprint=sk(N))}if(I.size>0){const z=Array.from(I.values()).sort((k,B)=>k-B);for(let k=z.length-1;k>=0;k--)y.splice(z[k],1)}}(_,d,t.json.nodes),_}function lk(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,n=t.aabb.min[0]-1,s=t.aabb.min[1]-1,l=lm/(t.aabb.max[0]-n+2),c=lm/(t.aabb.max[1]-s+2);for(let d=0;d<e.length;d+=3){const _=e[d+2],y=(e[d+0]-n)*l|0,w=(e[d+1]-s)*c|0;_>t.heightmap[w*lm+y]&&(t.heightmap[w*lm+y]=_)}}function uk(t,e){const n={};n.indexArray=new Si,n.indexArray.reserve(4*t.length),n.vertexArray=new Mc,n.vertexArray.reserve(10*t.length),n.colorArray=new Ac,n.vertexArray.reserve(10*t.length);let s=0;for(const d of t){const _=Math.min(10,Math.max(4,1.3*d.height))*e,y=[-d.normal[1],d.normal[0],0],w=Math.min(.29,.1*d.width/d.depth),E=d.width-2*d.depth*e*(w+.01),A=o._.scaleAndAdd([],d.pos,y,E/2),I=o._.scaleAndAdd([],d.pos,y,-E/2),z=[A[0],A[1],A[2]+d.height],k=[I[0],I[1],I[2]+d.height],B=o._.scaleAndAdd([],d.normal,y,w);o._.scale(B,B,_);const N=o._.scaleAndAdd([],d.normal,y,-w);o._.scale(N,N,_),o._.add(B,A,B),o._.add(N,I,N),A[2]+=.1,I[2]+=.1,n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(z[0],z[1],z[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]);const W=E/_/2;n.colorArray.emplaceBack(-W-w,-1,W,.8),n.colorArray.emplaceBack(W+w,-1,W,.8),n.colorArray.emplaceBack(-W,0,W,1.3),n.colorArray.emplaceBack(W,0,W,1.3),n.colorArray.emplaceBack(W+w,-.8,W,.7),n.colorArray.emplaceBack(W+w,-.8,W,.7),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(W+w,-1.2,W,.8),n.colorArray.emplaceBack(W+w,-1.2,W,.8),n.indexArray.emplaceBack(6+s,4+s,8+s),n.indexArray.emplaceBack(7+s,9+s,5+s),n.indexArray.emplaceBack(0+s,1+s,2+s),n.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const l={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=Gn.white,l.pbrMetallicRoughness=c,n.material=l,n.aabb=new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const PT=new Float32Array(262144),cm=new Uint8Array(262144);function XA(t){let e=0;if(t.meshes)for(const n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(const n of t.children)e=Math.max(e,XA(n));return e}function YA(t,e,n){if(t.meshes)for(const s of t.meshes)s.aabb.min[0]!==1/0&&n.insert(e,s.aabb.min[0],s.aabb.min[1],s.aabb.max[0],s.aabb.max[1]);if(t.children)for(const s of t.children)YA(s,e,n)}const KA=["","wall","door","roof","window","lamp","logo"];class JA{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:XA(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=Dr.applyTransform(s.aabb,this.node.matrix),n.encapsulate(s.transformedAabb)),e++;this.aabb=n}return this.aabb}}class X1{constructor(e,n,s,l,c,d){this.id=n,this.modelTraits|=z_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=z_.HasMapboxMeshFeatures),l&&(this.modelTraits|=z_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=c,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const _ of e)this.nodesInfo.push(new JA(_)),YA(_,d.featureIndexArray.length,d.grid),d.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,d.bucketLayerIDs.length-1,0)}updateFootprints(e,n){for(const s of this.getNodesInfo()){const l=s.node;l.footprint&&n.push({footprint:l.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const s of n){const l=s.node;this.uploaded?this.updatePbrBuffer(l):TT(l,e,!0)}for(const s of n)W1(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),n=!0);return n}needsReEvaluation(e,n,s){const l=e.transform.projectionOptions,c=e.style.getBrightness(),d=this.brightness!==c;return!!(!this.uploaded||this.dirty||l.name!==this.projection.name||Jy(s.paint.get("model-color").value,d)||Jy(s.paint.get("model-color-mix-intensity").value,d)||Jy(s.paint.get("model-roughness").value,d)||Jy(s.paint.get("model-emissive-strength").value,d)||Jy(s.paint.get("model-height-based-emissive-strength-multiplier").value,d))&&(this.projection=l,this.brightness=c,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),l=this.id.canonical;for(const c of s){const d=c.feature;c.evaluatedScale=n.paint.get("model-scale").evaluate(d,{},l)}}evaluate(e){const n=this.getNodesInfo();for(const s of n){if(!s.node.meshes)continue;const l=s.feature,c=s.node.meshes&&s.node.meshes[0].featureData,d=s.evaluatedColor[2],_=s.evaluatedRMEA[2],y=this.id.canonical;if(s.hasTranslucentParts=!1,c){for(let w=0;w<KA.length;w++){const E=KA[w];E.length&&(l.properties.part=E);const A=e.paint.get("model-color").evaluate(l,{},y).toRenderColor(null),I=e.paint.get("model-color-mix-intensity").evaluate(l,{},y);s.evaluatedColor[w]=[A.r,A.g,A.b,I],s.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(l,{},y),s.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(l,{},y),s.evaluatedRMEA[w][3]=A.a,s.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,{},y),!s.hasTranslucentParts&&A.a<1&&(s.hasTranslucentParts=!0)}delete l.properties.part,hk(s,d!==s.evaluatedColor[2]||_!==s.evaluatedRMEA[2],this.modelTraits)}else s.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,{},y);s.evaluatedScale=e.paint.get("model-scale").evaluate(l,{},y),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,s,l){const c=e.findDEMTileFor(s);if(c&&(c.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const d=Bc.create(e,s,c);if(!d)return;this.modelTraits&z_.HasMapboxMeshFeatures&&this.updateDEM(e,d,s,l);for(const _ of this.getNodesInfo()){const y=_.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;const w=y.footprint.vertices;let E=d.getElevationAt(w[0].x,w[0].y,!0,!0);for(let A=1;A<w.length;A++)E=Math.min(E,d.getElevationAt(w[A].x,w[A].y,!0,!0));y.elevation=E}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,s,l){let c=n._dem._modifiedForSources[l];if(c===void 0&&(n._dem._modifiedForSources[l]=[],c=n._dem._modifiedForSources[l]),c.includes(s.canonical))return;const d=n._dem.dim;c.push(s.canonical);let _=!1;for(const y of this.getNodesInfo()){const w=y.node;if(!w.footprint||!w.footprint.grid)continue;const E=w.footprint.grid,A=n.tileCoordToPixel(E.min.x,E.min.y),I=n.tileCoordToPixel(E.max.x,E.max.y),z=Math.min(Math.min(d-I.y,A.x),Math.min(A.y,d-I.x));if(z<0)continue;const k=Xt(z,2,5);let B=Math.max(0,A.x-k),N=Math.max(0,A.y-k),W=Math.min(I.x+k,d-1),ee=Math.min(I.y+k,d-1);for(let de=N;de<=ee;++de)for(let be=B;be<=W;++be)cm[de*d+be]=255;let te=0,ne=0;for(let de=0;de<E.cellsY;++de)for(let be=0;be<E.cellsX;++be){if(!E.cells[de*E.cellsX+be])continue;const Ae=n.tileCoordToPixel(E.min.x+be/E.xScale,E.min.y+de/E.yScale),ze=n.tileCoordToPixel(E.min.x+(be+1)/E.xScale,E.min.y+(de+1)/E.yScale);for(let $e=Ae.y;$e<=Math.min(ze.y+1,d-1);++$e)for(let Ve=Ae.x;Ve<=Math.min(ze.x+1,d-1);++Ve)cm[$e*d+Ve]===255&&(cm[$e*d+Ve]=0,te+=n.getElevationAtPixel(Ve,$e),ne++)}const me=te/ne;B=Math.max(1,A.x-k),N=Math.max(1,A.y-k),W=Math.min(I.x+k,d-2),ee=Math.min(I.y+k,d-2),_=!0;for(let de=N;de<=ee;++de)for(let be=B;be<=W;++be)cm[de*d+be]===0&&(PT[de*d+be]=n._dem.set(be,de,me));for(let de=1;de<k;++de){B=Math.max(1,A.x-de),N=Math.max(1,A.y-de),W=Math.min(I.x+de,d-2),ee=Math.min(I.y+de,d-2);for(let be=N;be<=ee;++be)for(let Ae=B;Ae<=W;++Ae){const ze=be*d+Ae;if(cm[ze]===255){let $e=0,Ve=0,Je=-1,ht=-1;for(let Ye=-1;Ye<=1;++Ye)for(let it=-1;it<=1;++it){const qe=(be+Ye)*d+Ae+it;if(cm[qe]>=de)continue;const st=PT[qe],mt=Math.abs(st);mt>Ve&&($e=st,Ve=mt,Je=it,ht=Ye)}if(Ve>.1){const Ye=1-(de+.5*Math.abs(Je*ht))/k;let it=n._dem.get(Ae,be)+$e*Ye;const qe=n._dem.get(Ae+Je,be+ht),st=n._dem.get(Ae-Je,be-ht,!0);(it-qe)*(it-st)>0&&(it=(qe+st)/2),PT[ze]=n._dem.set(Ae,be,it),cm[ze]=de}}}}}_&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=zi.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)W1(n.node),ST(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const s=n.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const d=l[c].node;l[c].hiddenByReplacement=!!d.footprint&&!s.find(_=>_.footprint===d.footprint)}}getHeightAtTileCoord(e,n){const s=this.getNodesInfo(),l=[],c=[0,0,0],d=o.ad.identity([]);for(let _=0;_<this.nodesInfo.length;_++){const y=s[_],w=y.node.meshes[0],E=w.transformedAabb;if(e<E.min[0]||n<E.min[1]||e>E.max[0]||n>E.max[1])continue;if(y.node.hidden===!0)return{height:0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};o.ad.invert(d,y.node.matrix),c[0]=e,c[1]=n,o._.transformMat4(c,c,d);const A=(c[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*lm|0,I=Math.min(63,(c[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*lm|0)*lm+Math.min(63,A),z=w.heightmap[I];if(!(z<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:z,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new lt(e,n),new lt(e,n),l),l.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Jy(t,e){return!t.isLightConstant&&e}function ck(t,e,n,s,l,c,d,_){let y=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;n[3]>0&&(y=Ht(y,255*n[0],n[3]),w=Ht(w,255*n[1],n[3]),E=Ht(E,255*n[2],n[3]));const A=y<<8|w,I=E<<8|Math.floor(255*s[3]),z=function(de){const be=Xt(de,0,2);return Math.min(Math.round(.5*be*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],k=Xt(l[0],0,1),B=Xt(l[1],0,1),N=Xt(l[2],0,1),W=Xt(l[3],0,1);let ee,te,ne,me;if(k!==B&&d!==c&&B!==k){const de=d-c;te=1/(de*(B-k)),ne=-(c+de*k)/(de*(B-k));const be=Xt(l[4],-1,1);me=Math.pow(10,be),ee=255*N<<8|255*W}else ee=65535,te=0,ne=1,me=1;if(t.emplaceBack(A,I,z,ee,te,ne,me),_){const de=_.length;_.clear();for(let be=0;be<de;be++)_.emplaceBack(A,I,z,ee,te,ne,me)}}function hk(t,e,n){const s=t.node;let l=0;const c=n&z_.HasMeshoptCompression;for(const d of s.meshes){if(s.lights&&s.lightMeshIndex===l||!d.featureData)continue;d.featureArray=new s_,d.featureArray.reserve(d.featureData.length);let _=e;for(const y of d.featureData){const w=c?65535&y:y>>16&65535,E=c?y>>16&65535:65535&y,A=(15&E)<8?15&E:0,I=t.evaluatedRMEA[A],z=t.evaluatedColor[A],k=t.emissionHeightBasedParams[A];let B;if(_&&A===2&&s.lights&&(B=new s_,B.resize(10*s.lights.length)),ck(d.featureArray,w,z,I,k,d.aabb.min[2],d.aabb.max[2],B),B&&_){_=!1;const N=s.meshes[s.lightMeshIndex];N.featureArray=B,N.featureArray._trim()}}d.featureArray._trim(),l++}}function QA(t,e,n,s){const l=1<<t.z;e.lat=Ni((s/xt+t.y)/l),e.lng=Gs((n/xt+t.x)/l)}se(X1,"Tiled3dModelBucket",{omit:["layers"]}),se(JA,"Tiled3dModelFeature");const dk={circle:class extends ii{constructor(t,e,n,s){super(t,cb,e,n,s)}createBucket(t){return new ly(t)}queryRadius(t){const e=t;return Qo("circle-radius",this,e)+Qo("circle-stroke-width",this,e)+$n(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,l,c,d,_){const y=Ws(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Ir(t,s,c,d,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,n){const s=Bx(this);return{config:new Vh(this,{zoom:e,lut:n}),defines:s,overrideFog:!1}}},heatmap:class extends ii{createBucket(t){return new Fx(t)}constructor(t,e,n,s){super(t,mb,e,n,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Jp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Qo("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,l,c,d,_){const y=this.paint.get("heatmap-radius").evaluate(e,n);return Ir(t,s,c,d,_,!0,!0,new lt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,n){return t==="heatmap"?{config:new Vh(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends ii{constructor(t,e,n,s){super(t,gb,e,n,s)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},fill:class extends ii{constructor(t,e,n,s){super(t,Cb,e,n,s)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e,n){return{config:new Vh(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new nm(t)}queryRadius(){return $n(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,l,c){return!t.queryGeometry.isAboveHorizon&&bx(Cx(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends ii{constructor(t,e,n,s){super(t,It,e,n,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new b_(t)}queryRadius(){return $n(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,s,l,c,d,_,y){const w=Ws(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,n),A=this.paint.get("fill-extrusion-base").evaluate(e,n),I=[0,0],z=_&&c.elevation,k=c.elevation?c.elevation.exaggeration():1,B=t.tile.getBucket(this);if(z&&B instanceof b_){const ne=B.centroidVertexArray,me=y+1;me<ne.length&&(I[0]=ne.geta_centroid_pos0(me),I[1]=ne.geta_centroid_pos1(me))}if(I[0]===0&&I[1]===1)return!1;c.projection.name==="globe"&&(s=Le([s],[new lt(0,0),new lt(xt,xt)],t.tileID.canonical).map(ne=>ne.polygon).flat());const N=z?_:null,[W,ee]=function(ne,me,de,be,Ae,ze,$e,Ve,Je,ht,Ye){return ne.projection.name==="globe"?function(it,qe,st,mt,ut,Lt,dt,yt,Wt,jt,Ut){const _t=[],qt=[],pn=it.projection.upVectorScale(Ut,it.center.lat,it.worldSize).metersToTile,nn=[0,0,0,1],vn=[0,0,0,1],mn=(Jt,hr,cr,Jn)=>{Jt[0]=hr,Jt[1]=cr,Jt[2]=Jn,Jt[3]=1},Pn=ye();st>0&&(st+=Pn),mt+=Pn;for(const Jt of qe){const hr=[],cr=[];for(const Jn of Jt){const qn=Jn.x+ut.x,Qn=Jn.y+ut.y,Cr=it.projection.projectTilePoint(qn,Qn,Ut),gr=it.projection.upVector(Ut,Jn.x,Jn.y);let $r=st,Ur=mt;if(dt){const Is=$t(qn,Qn,st,mt,dt,yt,Wt,jt);$r+=Is.base,Ur+=Is.top}st!==0?mn(nn,Cr.x+gr[0]*pn*$r,Cr.y+gr[1]*pn*$r,Cr.z+gr[2]*pn*$r):mn(nn,Cr.x,Cr.y,Cr.z),mn(vn,Cr.x+gr[0]*pn*Ur,Cr.y+gr[1]*pn*Ur,Cr.z+gr[2]*pn*Ur),o._.transformMat4(nn,nn,Lt),o._.transformMat4(vn,vn,Lt),hr.push(new Oc(nn[0],nn[1],nn[2])),cr.push(new Oc(vn[0],vn[1],vn[2]))}_t.push(hr),qt.push(cr)}return[_t,qt]}(ne,me,de,be,Ae,ze,$e,Ve,Je,ht,Ye):$e?function(it,qe,st,mt,ut,Lt,dt,yt,Wt){const jt=[],Ut=[],_t=[0,0,0,1];for(const qt of it){const pn=[],nn=[];for(const vn of qt){const mn=vn.x+mt.x,Pn=vn.y+mt.y,Jt=$t(mn,Pn,qe,st,Lt,dt,yt,Wt);_t[0]=mn,_t[1]=Pn,_t[2]=Jt.base,_t[3]=1,o.aA.transformMat4(_t,_t,ut),_t[3]=Math.max(_t[3],1e-5);const hr=new Oc(_t[0]/_t[3],_t[1]/_t[3],_t[2]/_t[3]);_t[0]=mn,_t[1]=Pn,_t[2]=Jt.top,_t[3]=1,o.aA.transformMat4(_t,_t,ut),_t[3]=Math.max(_t[3],1e-5);const cr=new Oc(_t[0]/_t[3],_t[1]/_t[3],_t[2]/_t[3]);pn.push(hr),nn.push(cr)}jt.push(pn),Ut.push(nn)}return[jt,Ut]}(me,de,be,Ae,ze,$e,Ve,Je,ht):function(it,qe,st,mt,ut){const Lt=[],dt=[],yt=ut[8]*qe,Wt=ut[9]*qe,jt=ut[10]*qe,Ut=ut[11]*qe,_t=ut[8]*st,qt=ut[9]*st,pn=ut[10]*st,nn=ut[11]*st;for(const vn of it){const mn=[],Pn=[];for(const Jt of vn){const hr=Jt.x+mt.x,cr=Jt.y+mt.y,Jn=ut[0]*hr+ut[4]*cr+ut[12],qn=ut[1]*hr+ut[5]*cr+ut[13],Qn=ut[2]*hr+ut[6]*cr+ut[14],Cr=ut[3]*hr+ut[7]*cr+ut[15],gr=Jn+yt,$r=qn+Wt,Ur=Qn+jt,Is=Math.max(Cr+Ut,1e-5),ti=Jn+_t,Or=qn+qt,yi=Qn+pn,Ji=Math.max(Cr+nn,1e-5);mn.push(new Oc(gr/Is,$r/Is,Ur/Is)),Pn.push(new Oc(ti/Ji,Or/Ji,yi/Ji))}Lt.push(mn),dt.push(Pn)}return[Lt,dt]}(me,de,be,Ae,ze)}(c,s,A,E,w,d,N,I,k,c.center.lat,t.tileID.canonical),te=t.queryGeometry;return function(ne,me,de){let be=1/0;bx(de,me)&&(be=Dt(de,me[0]));for(let Ae=0;Ae<me.length;Ae++){const ze=me[Ae],$e=ne[Ae];for(let Ve=0;Ve<ze.length-1;Ve++){const Je=ze[Ve],ht=[Je,ze[Ve+1],$e[Ve+1],$e[Ve],Je];uy(de,ht)&&(be=Math.min(be,Dt(de,ht)))}}return be!==1/0&&be}(W,ee,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends ii{constructor(t,e,n,s){super(t,x1,e,n,s),x1.layout&&(this.layout=new ar(x1.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof xc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=wA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new y1(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,n){const s=TC(this);return{config:new Vh(this,{zoom:e,lut:n}),defines:s,overrideFog:!1}}queryRadius(t){const e=t,n=bA(Qo("line-width",this,e),Qo("line-gap-width",this,e)),s=Qo("line-offset",this,e);return n/2+Math.abs(s)+$n(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,l,c){if(t.queryGeometry.isAboveHorizon)return!1;const d=Cx(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*bA(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(s=function(w,E){const A=[],I=new lt(0,0);for(let z=0;z<w.length;z++){const k=w[z],B=[];for(let N=0;N<k.length;N++){const W=k[N],ee=k[N+1],te=N===0?I:W.sub(k[N-1])._unit()._perp(),ne=N===k.length-1?I:ee.sub(W)._unit()._perp(),me=te._add(ne)._unit();me._mult(1/(me.x*ne.x+me.y*ne.y)),B.push(me._mult(E)._add(W))}A.push(B)}return A}(s,y*t.pixelToTileUnitsFactor)),function(w,E,A){for(let I=0;I<E.length;I++){const z=E[I];if(w.length>=3){for(let k=0;k<z.length;k++)if(zc(w,z[k]))return!0}if(lb(w,z,A))return!0}return!1}(d,s,_)}isTileClipped(){return!0}isDraped(t){const e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:F1,background:class extends ii{constructor(t,e,n,s){super(t,Pz,e,n,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,n){return{overrideFog:!1}}},raster:CA,"raster-particle":AA,sky:class extends ii{constructor(t,e,n,s){super(t,Fz,e,n,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Jp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),l=!s,c=t.style.light,d=c.properties.get("position");return l&&c.properties.get("anchor")==="viewport"&&xr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?vT(d.azimuthal,90-d.polar,e):vT(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return vT(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends ii{constructor(t,e,n,s){super(t,Nz,e,null)}},model:class extends ii{constructor(t,e,n,s){super(t,Zz,e,n,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new bT(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof X1?xt-1:0}queryIntersectsFeature(t,e,n,s,l,c){if(!this.modelManager)return!1;const d=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof bT))return!1;const y=_;for(const w in y.instancesPerModel){const E=y.instancesPerModel[w],A=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(A)){const I=E.features[E.idToFeaturesIndex[A]],z=d.getModel(w,this.scope);if(!z)return!1;let k=o.ad.create();const B=new Un(0,0),N=y.canonical;let W=Number.MAX_VALUE;for(let ee=0;ee<I.instancedDataCount;++ee){const te=16*(I.instancedDataOffset+ee),ne=E.instancedDataArray.float32,me=[ne[te+4],ne[te+5],ne[te+6]];QA(N,B,ne[te],0|ne[te+1]),BA(k,z,c,B,I.rotation,I.scale,me,!1,!1,!1),c.projection.name==="globe"&&(k=wT(k,c));const de=o.ad.multiply([],c.projMatrix,k),be=t.queryGeometry,Ae=DA(be.isPointQuery()?be.screenBounds:be.screenGeometry,c,de,z.aabb);Ae!=null&&(W=Math.min(Ae,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof H}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,s){const l=t.tile,c=l.getBucket(this);let d=null,_=Number.MAX_VALUE;if(!(c&&c instanceof X1))return{queryFeature:d,intersectionZ:_};const y=c.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!n.filter(new tn(l.tileID.overscaledZ),y.feature,l.tileID.canonical))return{queryFeature:d,intersectionZ:_};const w=y.node,E=s.calculatePosMatrix(l.tileID.toUnwrapped(),s.worldSize),A=y.evaluatedScale;let I=0;s.elevation&&w.elevation&&(I=w.elevation*s.elevation.exaggeration()),o.ad.translate(E,E,[(w.anchor?w.anchor[0]:0)*(A[0]-1),(w.anchor?w.anchor[1]:0)*(A[1]-1),I]),o.ad.scale(E,E,A),o.ad.multiply(E,E,w.matrix);const z=t.queryGeometry,k=z.isPointQuery()?z.screenBounds:z.screenGeometry,B=function(W){const ee=o.ad.multiply([],E,W.matrix),te=o.ad.multiply(ee,s.expandedFarZProjMatrix,ee);for(let ne=0;ne<W.meshes.length;++ne){const me=W.meshes[ne];if(ne===W.lightMeshIndex)continue;const de=DA(k,s,te,me.aabb);de!=null&&(_=Math.min(de,_))}if(W.children)for(const ne of W.children)B(ne)};if(B(w),_===Number.MAX_VALUE)return{queryFeature:d,intersectionZ:_};const N=new Un(0,0);return QA(l.tileID.canonical,N,y.node.anchor[0],y.node.anchor[1]),d={type:"Feature",geometry:{type:"Point",coordinates:[N.lng,N.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:d,intersectionZ:_}}},clip:class extends ii{constructor(t,e,n,s){super(t,Mb,e,n,s)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new Hx(t)}isTileClipped(){return!0}is3D(){return!0}}};se(yA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const eM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class RT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,s]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const c=eM[15&s];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new RT(_,d,c,e)}constructor(e,n=64,s=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=eM.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-_%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+_+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=n,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return LT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:_}=this,y=[0,c.length-1,0],w=[];for(;y.length;){const E=y.pop()||0,A=y.pop()||0,I=y.pop()||0;if(A-I<=_){for(let N=I;N<=A;N++){const W=d[2*N],ee=d[2*N+1];W>=e&&W<=s&&ee>=n&&ee<=l&&w.push(c[N])}continue}const z=I+A>>1,k=d[2*z],B=d[2*z+1];k>=e&&k<=s&&B>=n&&B<=l&&w.push(c[z]),(E===0?e<=k:n<=B)&&(y.push(I),y.push(z-1),y.push(1-E)),(E===0?s>=k:l>=B)&&(y.push(z+1),y.push(A),y.push(1-E))}return w}within(e,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:c,nodeSize:d}=this,_=[0,l.length-1,0],y=[],w=s*s;for(;_.length;){const E=_.pop()||0,A=_.pop()||0,I=_.pop()||0;if(A-I<=d){for(let N=I;N<=A;N++)nM(c[2*N],c[2*N+1],e,n)<=w&&y.push(l[N]);continue}const z=I+A>>1,k=c[2*z],B=c[2*z+1];nM(k,B,e,n)<=w&&y.push(l[z]),(E===0?e-s<=k:n-s<=B)&&(_.push(I),_.push(z-1),_.push(1-E)),(E===0?e+s>=k:n+s>=B)&&(_.push(z+1),_.push(A),_.push(1-E))}return y}}function LT(t,e,n,s,l,c){if(l-s<=n)return;const d=s+l>>1;tM(t,e,d,s,l,c),LT(t,e,n,s,d-1,1-c),LT(t,e,n,d+1,l,1-c)}function tM(t,e,n,s,l,c){for(;l>s;){if(l-s>600){const w=l-s+1,E=n-s+1,A=Math.log(w),I=.5*Math.exp(2*A/3),z=.5*Math.sqrt(A*I*(w-I)/w)*(E-w/2<0?-1:1);tM(t,e,n,Math.max(s,Math.floor(n-E*I/w+z)),Math.min(l,Math.floor(n+(w-E)*I/w+z)),c)}const d=e[2*n+c];let _=s,y=l;for(Qy(t,e,s,n),e[2*l+c]>d&&Qy(t,e,s,l);_<y;){for(Qy(t,e,_,y),_++,y--;e[2*_+c]<d;)_++;for(;e[2*y+c]>d;)y--}e[2*s+c]===d?Qy(t,e,s,y):(y++,Qy(t,e,y,l)),y<=n&&(s=y+1),n<=y&&(l=y-1)}}function Qy(t,e,n,s){DT(t,n,s),DT(e,2*n,2*s),DT(e,2*n+1,2*s+1)}function DT(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function nM(t,e,n,s){const l=t-n,c=e-s;return l*l+c*c}o.$=ga,o.A=Mh,o.B=ol,o.C=Gn,o.D=Yi,o.E=Uo,o.G=Sr,o.H=u,o.I=om,o.J=Op,o.K=function(t){const e=t.value;let n=[];if(!e)return n;const s=fe(e);return s!=="string"?(n=n.concat([new G1(t.key,e,`string expected, "${s}" found`)]),n):(zA(e,!0)||(n=n.concat([new G1(t.key,e,`invalid url "${e}"`)])),n)},o.L=ke,o.M=class{constructor(t,e,n,s){this.id=t,this.position=e!=null?new Un(e[0],e[1]):new Un(0,0),this.orientation=n??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(o.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(const n of t.meshes){const s=Dr.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(s)}if(t.children)for(const n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){const t=o.ad.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,s,l,c,d=!1){BA(this.matrix,this,t.transform,this.position,e,n,s,l,c,d)}upload(t){if(!this.uploaded){for(const e of this.nodes)TT(e,t);for(const e of this.nodes)W1(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)ST(t)}},o.N=Kn,o.O=nt,o.P=lt,o.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return mr(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Ht(t.x,e.x,n),y:Ht(t.y,e.y,n),z:Ht(t.z,e.z,n),azimuthal:Ht(t.azimuthal,e.azimuthal,n),polar:Ht(t.polar,e.polar,n)}}},o.R=ec,o.S=oo,o.T=xl,o.U=nr,o.V=G1,o.W=Rr,o.X=tn,o.Y=Hi,o.Z=H,o.a=ra,o.a$=function(t){const{x:e,y:n}=t.point,{lng:s,lat:l}=t._center;return zx(e,n,t.worldSize,s,l)},o.a0=ar,o.a1=du,o.a2=Ht,o.a3=xt,o.a4=oc,o.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,s]){const l=mr([1,n,s]);return{x:l.x,y:l.y,z:l.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Ht(t.x,e.x,n),y:Ht(t.y,e.y,n),z:Ht(t.z,e.z,n)}}},o.a6=tf,o.a7=l_,o.a8=ou,o.a9=yx,o.aB=function(t,e){const{x:n,y:s}=t.point,l=zx(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return o.ad.multiply(l,l,gy(ml(e)))},o.aD=C_,o.aE=za,o.aF=b1,o.aG=function(t,e,n,s,l){const c=5*e+2;t.float32[c+0]=n,t.float32[c+1]=s,t.float32[c+2]=l},o.aH=D1,o.aI=Un,o.aJ=lA,o.aK=jp,o.aL=ai,o.aM=Xp,o.aN=IA,o.aO=jh,o.aP=uf,o.aQ=function(t,e,n,s,l,c,d,_,y){if(y.name==="globe")return uf(t,e,new jh(n,s,l),!1);const w=sm({z:n,x:s,y:l},y);return new Dr([(c+w.x/w.scale)*e,e*(w.y/w.scale),d],[(c+w.x2/w.scale)*e,e*(w.y2/w.scale),_])},o.aR=function(t,e,n){let s=0;for(let l=0;l<2;++l)t[l]>0&&(s+=(t[l]-0)*(t[l]-0)),e[l]<0&&(s+=(0-e[l])*(0-e[l]));return s},o.aS=Kr,o.aT=pl,o.aU=vx,o.aV=function(t){const e=o.ad.identity(new Float64Array(16));o.ad.multiply(e,t.pixelMatrix,t.globeMatrix);const n=[0,Ko,0],s=[0,Jo,0];return o._.transformMat4(n,n,e),o._.transformMat4(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Da(t,new Un(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!Da(t,new Un(t.center.lat,-90))]},o.aW=function(t,e){const{scale:n}=t.tileTransform,s=n*xt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},o.aX=U1,o.aY=MA,o.aZ=function(t){const e=MA(t,!0);return o.aC.invert([],[e[0],e[1],e[4],e[5]])},o.a_=fy,o.aa=Cs,o.ab=kn,o.ac=function(t,e,n){const s=Math.sqrt(t*t+e*e+n*n),l=s>0?Math.acos(n/s)*lh:0;let c=t!==0||e!==0?Math.atan2(-e,-t)*lh+90:0;return c<0&&(c+=360),[s,c,l]},o.ae=R_,o.af=gu,o.ag=cT,o.ah=function(t,e){const n={};for(let s=0;s<e.length;s++){const l=e[s];l in t&&(n[l]=t[l])}return n},o.ai=Lc,o.aj=dl,o.ak=fl,o.al=Bh,o.am=function(t){Cd++,Cd>ss&&(t.getActor().send("enforceCacheSizeLimit",Ed),Cd=0)},o.an=Kt,o.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,s){const l=this.entries[t]=this.entries[t]||{callbacks:[]};if(l.result){const[c,d]=l.result;return this.scheduler?this.scheduler.add(()=>{s(c,d)},e):s(c,d),()=>{}}return l.callbacks.push(s),l.cancel||(l.cancel=n((c,d)=>{l.result=[c,d];for(const _ of l.callbacks)this.scheduler?this.scheduler.add(()=>{_(c,d)},e):_(c,d);setTimeout(()=>delete this.entries[t],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(c=>c!==s),l.callbacks.length||(l.cancel(),delete this.entries[t]))}}},o.ap=function(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},l=>{const c=Wl(t.request,(d,_,y,w)=>{d?l(d):_&&l(null,{vectorTile:n?void 0:new Iy(new E_(_)),rawData:_,cacheControl:y,expires:w})});return()=>{c.cancel(),l()}},e)},o.aq=Yg,o.ar=class extends su{constructor(t){super(t),this.current=Xw}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},o.as=Kg,o.at=Xt,o.au=Ds,o.aw=ph,o.ax=Ms,o.ay=Ni,o.az=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},o.b=Lr,o.b$=Fc,o.b0=Gi,o.b1=ty,o.b2=function(t){const e=Math.round((t+45+360)%360/90)%4;return Nm[e]},o.b3=45,o.b4=ry,o.b5=$p,o.b6=Dr,o.b7=mr,o.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},o.b9=sp,o.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},o.bB=vC,o.bD=Dx,o.bE=Xu,o.bF=Zu,o.bG=256,o.bH=function(t,e){const n=[0,0,0],s=_l(ml(e.canonical));return o._.transformMat4(n,n,s),o._.transformMat4(n,n,t),n},o.bI=t=>({u_camera_to_center_distance:new Cs(t),u_extrude_scale:new Qg(t),u_device_pixel_ratio:new Cs(t),u_matrix:new tf(t),u_inv_rot_matrix:new tf(t),u_merc_center:new ou(t),u_tile_id:new Yg(t),u_zoom_transition:new Cs(t),u_up_dir:new Yg(t),u_emissive_strength:new Cs(t)}),o.bJ=t=>({u_matrix:new tf(t),u_pixels_to_tile_units:new Qg(t),u_device_pixel_ratio:new Cs(t),u_units_to_pixels:new ou(t),u_dash_image:new l_(t),u_gradient_image:new l_(t),u_image_height:new Cs(t),u_texsize:new ou(t),u_tile_units_to_pixels:new Cs(t),u_alpha_discard_threshold:new Cs(t),u_trim_offset:new ou(t),u_trim_fade_range:new ou(t),u_trim_color:new Kg(t),u_emissive_strength:new Cs(t)}),o.bK=t=>({u_matrix:new tf(t),u_texsize:new ou(t),u_pixels_to_tile_units:new Qg(t),u_device_pixel_ratio:new Cs(t),u_image:new l_(t),u_units_to_pixels:new ou(t),u_tile_units_to_pixels:new Cs(t),u_alpha_discard_threshold:new Cs(t),u_trim_offset:new ou(t)}),o.bL=r_,o.bM=m5,o.bN=hs,o.bO=D5,o.bP=QC,o.bQ=rT,o.bR=Bx,o.bS=(t,e,n,s,l,c)=>{const d=t.transform,_=d.projection.name==="globe";let y;if(c.paint.get("circle-pitch-alignment")==="map")if(_){const E=Dx(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;y=Float32Array.from([E,0,0,E])}else y=d.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const w={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(d.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:zi.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:Ox,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(_){w.u_inv_rot_matrix=s,w.u_merc_center=l,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=du(d.zoom);const E=l[0]*xt,A=l[1]*xt;w.u_up_dir=d.projection.upVector(new jh(0,0,0),E,A)}return w},o.bT=TC,o.bU=(t,e,n,s,l,c)=>{const d=t.transform;return{u_matrix:bC(t,e,n,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_image:0,u_tile_units_to_pixels:wC(e,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:c}},o.bV=(t,e,n,s,l,c,d)=>{const _=t.transform,y=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:bC(t,e,n,s),u_pixels_to_tile_units:y,u_device_pixel_ratio:c,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:SC(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:wC(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:d,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength")}},o.bW=wd,o.bX=Jp,o.bY=ye,o.bZ=rb,o.b_=b_,o.ba=function(t,e,n){const s=du(n.zoom),l=t.style.map._antialias,c=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return s===0&&!l&&!c},o.bb=function(t){const e=t.pixelsPerMeter,n=e/Ms(1,t.center.lat),s=o.ad.identity(new Float64Array(16));return o.ad.translate(s,s,[t.point.x,t.point.y,0]),o.ad.scale(s,s,[n,n,e]),Float32Array.from(s)},o.bc=cf,o.bd=function(t){const e=Kr-5;t=Xt(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(kn(t))),3);return Math.round(n*(ny.length-1))},o.be=function(t,e,n,s){const l=e.getNorth(),c=e.getSouth(),d=e.getWest(),_=e.getEast(),y=1<<t.z,w=_-d,E=l-c,A=w/rf,I=-E/ny[n],z=[0,A,0,I,0,0,l,d,0];if(t.z>0){const k=180/s;o.bC.multiply(z,z,[k/w+1,0,0,0,k/E+1,0,-.5*k/A,.5*k/I,1])}return z[2]=y,z[5]=t.x,z[8]=t.y,z},o.bf=_l,o.bg=ml,o.bh=function(t,e,n){const s=o.ad.identity(new Float64Array(16)),l=(e/(1<<t)-.5)*Math.PI*2;return o.ad.rotateY(s,n.globeMatrix,l),Float32Array.from(s)},o.bi=Gl,o.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.bk=CA,o.bl=AA,o.bm=EA,o.bn=function(t,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const l=document.createElement("source");Gm(t[s])||(n.crossOrigin="Anonymous"),l.src=t[s],n.appendChild(l)}return{cancel:()=>{}}},o.bo=z1,o.bp=hh,o.bq=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,l=Math.floor(t.x),c=Math.floor((t.x-l)*s),d=Math.floor(t.y*s),_=this.findDEMTileFor(new ai(n,l,n,c,d));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const l=s.getSource().maxzoom,c=1<<l,d=Math.floor(t.x),_=t.x-d,y=new ai(l,d,l,Math.floor(_*c),Math.floor(t.y*c)),w=this.findDEMTileFor(y);if(!w||!w.dem)return e;const E=w.dem,A=1<<w.tileID.canonical.z,I=(_*A-w.tileID.canonical.x)*E.dim,z=(t.y*A-w.tileID.canonical.y)*E.dim,k=Math.floor(I),B=Math.floor(z);return(n?this.exaggeration():1)*Ht(Ht(E.get(k,B),E.get(k,B+1),z-B),Ht(E.get(k+1,B),E.get(k+1,B+1),z-B),I-k)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Hi(t.wrap+(t.canonical.x+e/xt)/s,(t.canonical.y+n/xt)/s))}getAtTileOffsetFunc(t,e,n,s){return l=>{const c=this.getAtTileOffset(t,l.x,l.y),d=s.upVector(t.canonical,l.x,l.y),_=s.upVectorScale(t.canonical,e,n).metersToTile;return o._.scale(d,d,c*_),d}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;const l=Bc.create(this,t,s);return!!l&&(e.forEach(c=>{c[2]=this.exaggeration()*l.getElevationAt(c[0],c[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,l=1<<t.canonical.z-s.canonical.z;let c=t.canonical.x/l-s.canonical.x,d=t.canonical.y/l-s.canonical.y,_=0;for(let y=0;y<t.canonical.z-s.canonical.z&&!n.leaves[_];y++){c*=2,d*=2;const w=2*Math.floor(d)+Math.floor(c);_=n.childOffsets[_]+w,c%=1,d%=1}return{min:this.exaggeration()*n.minimums[_],max:this.exaggeration()*n.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const l of t){const c=this.getMinMaxForTile(l.tileID);c&&(n=Math.min(n,c.min),s=Math.max(s,c.max),e=!0)}return e?{min:n,max:s}:null}},o.br=Wr,o.bs=ei,o.bt=Yo,o.bu=Si,o.bv=am,o.bw=k_,o.bx=$1,o.by=B1,o.bz=Ux,o.c=ZA,o.c$=Ja,o.c0=450,o.c1=7,o.c2=Dz,o.c3=xA,o.c4=256,o.c5=Lx,o.c6=gy,o.c7=Xn,o.c8=Mc,o.c9=Rc,o.cA=function(t){let e=1/0,n=1/0,s=-1/0,l=-1/0;for(const c of t)e=Math.min(e,c.x),n=Math.min(n,c.y),s=Math.max(s,c.x),l=Math.max(l,c.y);return{min:new lt(e,n),max:new lt(s,l)}},o.cB=zc,o.cC=sy,o.cD=As,o.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.cF=qC,o.cG=uy,o.cH=n1,o.cI=r1,o.cJ=aT,o.cK=RT,o.cL=function(t){return t({pluginStatus:ot,pluginURL:Ze}),sn.on("pluginStateChange",t),t},o.cM=M_,o.cN=sT,o.cO=To,o.cP=kt,o.cQ=xe,o.cR=mh,o.cS=ql,o.cT=No,o.cU=function(t){const e=t.indexOf(ru);return e>=0?t.slice(0,e):t},o.cV=function(t){return t.indexOf(ru)>=0},o.cW=function(t){const e=t.indexOf(ru);return e>=0?t.slice(e+1):""},o.cX=function(t){const e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.cY=function(t,e,n,s){return t.type==="custom"?new Oz(t,e):new dk[t.type](t,e,n,s)},o.cZ=Li,o.c_=sn,o.ca=1,o.cb=jy,o.cc=0,o.cd=Gg,o.ce=function(t,e,n,s,l){return Xt((t-e)/(n-e)*(l-s)+s,s,l)},o.cf=zh,o.cg=Dc,o.ch=class{constructor(t,e,n,s){this.context=t,this.format=s,this.size=n,this.texture=t.gl.createTexture();const[l,c,d]=this.size,{gl:_}=t;_.bindTexture(_.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let y=this.format,w=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,w=_.UNSIGNED_SHORT),this.format===_.R8&&(s=_.RED),this.format===_.R32F&&(w=_.FLOAT,s=_.RED),_.texImage3D(_.TEXTURE_3D,0,y,l,c,d,0,s,w,e.data)}bind(t,e){const{context:n}=this,{gl:s}=n;s.bindTexture(s.TEXTURE_3D,this.texture),t!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,t),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},o.ci=wT,o.cj=[1,1,1],o.ck=Bc,o.cl=z_,o.cm=Pc,o.cn=ef,o.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new lt(1/0,1/0),max:new lt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){const n=$s(new lt(0,0),new lt(xt,xt),t),s=[];if(e&&!Ry(n,this._globalClipBounds))return s;for(const l of this._activeRegions){if(l.hiddenByOverlap||!Ry(n,l))continue;const c=Dy(l.min,l.max,t);s.push({min:c.min,max:c.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId,order:l.order,clipMask:l.clipMask})}return s}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const s of e.cache.getVisibleCoordinates()){const l=e.cache.getTile(s).buckets[e.layer];l&&l.updateFootprints(s.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){const e=t.getFootprints();if(e.length===0)return;const n=t.getOrder(),s=t.getClipMask();for(const l of e){if(!l.footprint)continue;const c=$s(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:c.min,max:c.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:n,clipMask:s})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||pf(e.min,n.min)||pf(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){const n=this._activeRegions[e],s=this._prevRegions[e];t=n.priority!==s.priority||!Qx(n,s)||n.order!==s.order||n.clipMask!==s.clipMask,++e}}if(t){++this._updateTime;for(const n of this._activeRegions)n.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const s=this._activeRegions;if(n>=s.length)return n;const l=s[n].priority;for(;n<s.length&&s[n].priority===l;)++n;return n};if(this._sourceIds.length>1){let n=0,s=e(n);for(;n!==s;){let l=n;const c=n;for(;l!==s;){const d=this._activeRegions[l];d.hiddenByOverlap=!1;for(let _=0;_<c;_++){const y=this._activeRegions[_];if(!y.hiddenByOverlap&&d.order===1/0&&Ry(d,y)&&(d.hiddenByOverlap=t1(d.footprint,d.tileId,y.footprint,y.tileId),d.hiddenByOverlap))break}++l}n=s,s=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},o.cp=so,o.cq=O1,o.cr=Np,o.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const n=new Yo,s=new Si,l=[],c=t+1+2,d=e[0]+1,_=e[0]+1+(1+e.length),y=(w,E,A)=>{let I=w===c-1?w-2:w===0?w:w-1;return I+=A?24575:0,[I,E]};for(let w=0;w<c;++w)n.emplaceBack(...y(w,0,!0));for(let w=0;w<d;++w)for(let E=0;E<c;++E)n.emplaceBack(...y(E,w,(E===0||E===c-1)&&!0));for(let w=0;w<e.length;++w){const E=e[w];for(let A=0;A<c;++A)n.emplaceBack(...y(A,E,!0))}for(let w=0;w<e.length;++w){const E=s.length,A=e[w]+1+2,I=new Si;for(let B=0;B<A-1;B++){const N=B===A-2,W=N?c*(_-e.length+w-B):c;for(let ee=0;ee<c-1;ee++){const te=B*c+ee;B===0||N||ee===0||ee===c-2?(I.emplaceBack(te+1,te,te+W),I.emplaceBack(te+W,te+W+1,te+1)):(s.emplaceBack(te+1,te,te+W),s.emplaceBack(te+W,te+W+1,te+1))}}const z=Lr.simpleSegment(0,E,n.length,s.length-E);for(let B=0;B<I.uint16.length;B+=3)s.emplaceBack(I.uint16[B],I.uint16[B+1],I.uint16[B+2]);const k=Lr.simpleSegment(0,E,n.length,s.length-E);l.push({withoutSkirts:z,withSkirts:k})}return{vertices:n,indices:s,segments:l}}_createGrid(t){const e=this._fillGridMeshWithLods(rf,ny);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Wr.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Si;for(let d=0;d<=rf;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Rc,s=new Rc,l=new Rc,c=new Rc;this._poleSegments=[];for(let d=0,_=0;d<ty;d++){const y=360/(1<<d);n.emplaceBack(0,-As,0,.5,0),s.emplaceBack(0,-As,0,.5,1),l.emplaceBack(0,-As,0,.5,.5),c.emplaceBack(0,-As,0,.5,.5);for(let w=0;w<=rf;w++){let E=w/rf,A=0;const I=Ht(0,y,E),[z,k,B]=sf(kx,ea,I,As);n.emplaceBack(z,k,B,E,A),s.emplaceBack(z,k,B,E,1-A);const N=kn(I);E=.5+.5*Math.sin(N),A=.5+.5*Math.cos(N),l.emplaceBack(z,k,B,E,A),c.emplaceBack(z,k,B,E,1-A)}this._poleSegments.push(Lr.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Yp,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,Yp,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(l,Yp,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(c,Yp,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},o.ct=function(t){return _h.has(t)},o.cu=u1,o.cv=function(t,e,n=0,s=!0){const l=new lt(n,n),c=t.sub(l),d=e.add(l),_=[c,new lt(d.x,c.y),d,new lt(c.x,d.y)];return s&&_.push(c.clone()),_},o.cw=function(t,e){const n=[];for(let s=0;s<t.length;s++){const l=Ds(s-1,-1,t.length-1),c=Ds(s+1,-1,t.length-1),d=t[s],_=t[c],y=t[l].sub(d).unit(),w=_.sub(d).unit(),E=w.angleWithSep(y.x,y.y),A=y.add(w).unit().mult(-1*e/Math.sin(E/2));n.push(d.add(A))}return n},o.cx=rA,o.cy=Ex,o.cz=function(t,e,n=0){return o._.fromValues(((e.x-n)*t.scale-t.x)*xt,(e.y*t.scale-t.y)*xt,Wp(e.z,e.y))},o.d=Pd,o.d$=vd,o.d0=ju,o.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.d2=Gu,o.d3=c_,o.d4=Uh,o.d5=function([t,e,n]){const s=Math.hypot(t,e,n),l=Math.atan2(t,n),c=.5*Math.PI-Math.acos(-e/s);return new Un(Gi(l),Gi(c))},o.d6=Gs,o.d7=of,o.d8=Q,o.d9=Da,o.dA=function(t){const e=lp();if(!e)return;const n=e.delete(Um);t&&n.catch(t).then(()=>t())},o.dB=Zy,o.dC=NA,o.dD=function(t){CT=zi.resolveURL(t),B_||(B_=new k_($1(),new Uo)),B_.broadcast("setDracoUrl",CT)},o.dE=VA,o.dF=function(t){O_=zi.resolveURL(t),B_||(B_=new k_($1(),new Uo)),B_.broadcast("setMeshoptUrl",O_)},o.dG=gs,o.dH=se,o.dI=kc,o.dJ=_u,o.dK=sm,o.dL=Hg,o.dM=EC,o.dN=LC,o.dO=yC,o.dP=Wu,o.dQ=ZC,o.dR=L_,o.dS=function(t,e,n,s,l,c,d,_,y,w,E){t.createArrays(),t.tilePixelRatio=xt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,I=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){const{minZoom:W,maxZoom:ee}=t.textSizeData;z.compositeTextSizes=[I["text-size"].possiblyEvaluate(new tn(W),_),I["text-size"].possiblyEvaluate(new tn(ee),_)]}if(t.iconSizeData.kind==="composite"){const{minZoom:W,maxZoom:ee}=t.iconSizeData;z.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new tn(W),_),I["icon-size"].possiblyEvaluate(new tn(ee),_)]}z.layoutTextSize=I["text-size"].possiblyEvaluate(new tn(y+1),_),z.layoutIconSize=I["icon-size"].possiblyEvaluate(new tn(y+1),_),z.textMaxSize=I["text-size"].possiblyEvaluate(new tn(18),_);const k=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",B=A.get("text-size");let N=!1;for(const W of t.features)if(W.icon&&W.icon.nameSecondary){N=!0;break}for(const W of t.features){const ee=A.get("text-font").evaluate(W,{},_).join(","),te=B.evaluate(W,{},_),ne=z.layoutTextSize.evaluate(W,{},_),me=(z.layoutIconSize.evaluate(W,{},_),{horizontal:{},vertical:void 0}),de=W.text;let be,Ae=[0,0];if(de){const Ve=de.toString(),Je=A.get("text-letter-spacing").evaluate(W,{},_)*hs,ht=A.get("text-line-height").evaluate(W,{},_)*hs,Ye=Fe(Ve)?Je:0,it=A.get("text-anchor").evaluate(W,{},_),qe=A.get("text-variable-anchor");if(!qe){const dt=A.get("text-radial-offset").evaluate(W,{},_);Ae=dt?QC(it,[dt*hs,oT]):A.get("text-offset").evaluate(W,{},_).map(yt=>yt*hs)}let st=k?"center":A.get("text-justify").evaluate(W,{},_);const mt=A.get("symbol-placement")==="point",ut=mt?A.get("text-max-width").evaluate(W,{},_)*hs:1/0,Lt=dt=>{t.allowVerticalPlacement&&Be(Ve)&&(me.vertical=nT(de,e,n,l,ee,ut,ht,it,dt,Ye,Ae,za.vertical,!0,ne,te))};if(!k&&qe){const dt=st==="auto"?qe.map(Wt=>aT(Wt)):[st];let yt=!1;for(let Wt=0;Wt<dt.length;Wt++){const jt=dt[Wt];if(!me.horizontal[jt])if(yt)me.horizontal[jt]=me.horizontal[0];else{const Ut=nT(de,e,n,l,ee,ut,ht,"center",jt,Ye,Ae,za.horizontal,!1,ne,te);Ut&&(me.horizontal[jt]=Ut,yt=Ut.positionedLines.length===1)}}Lt("left")}else{if(st==="auto"&&(st=aT(it)),mt||A.get("text-writing-mode").indexOf("horizontal")>=0||!Be(Ve)){const dt=nT(de,e,n,l,ee,ut,ht,it,st,Ye,Ae,za.horizontal,!1,ne,te);dt&&(me.horizontal[st]=dt)}Lt(mt?"left":st)}}let ze=!1;if(W.icon&&W.icon.namePrimary){const Ve=s[W.icon.namePrimary];Ve&&(be=j5(l[W.icon.namePrimary],W.icon.nameSecondary?l[W.icon.nameSecondary]:void 0,A.get("icon-offset").evaluate(W,{},_),A.get("icon-anchor").evaluate(W,{},_)),ze=Ve.sdf,t.sdfIcons===void 0?t.sdfIcons=Ve.sdf:t.sdfIcons!==Ve.sdf&&xr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ve.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const $e=tA(me.horizontal)||me.vertical;t.iconsInText||(t.iconsInText=!!$e&&$e.iconsInText),($e||be)&&X5(t,W,me,be,s,z,ne,0,Ae,ze,d,_,w,E,N)}c&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},o.dT=y1,o.dU=nm,o.dV=Iy,o.dW=E_,o.dX=mf,o.dY=gT,o.dZ=ff,o.d_=g_,o.da=xy,o.db=function(t){const e=[0,0,0],n=o.ad.identity(new Float64Array(16));return o.ad.multiply(n,t.pixelMatrix,t.globeMatrix),o._.transformMat4(e,e,n),new lt(e[0],e[1])},o.dc=Ee,o.dd=Te,o.de=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(jl==null){const s=n.navigator?n.navigator.userAgent:null;jl=!!n.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return jl}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.df=uh,o.dg=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",dp,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!xe(t))return t;const n=So(t);return n.params.push(`sdk=js-${q}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!xe(t))return t;const n=So(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!xe(t))return t;const n=So(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!xe(t))return t;const l=So(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),n&&l.params.push(`language=${n}`),s&&l.params.push(`worldview=${s}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const l=So(t);return xe(t)?(l.path=`/styles/v1${l.path}/sprite${e}${n}`,this._makeAPIURL(l,this._customAccessToken||s)):(l.path+=`${e}${n}`,tc(l))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!xe(t))return t;const s=So(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&s.authority!=="raster"&&n===512?"@2x":""}${Ad.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${Q.RASTER_URL_PREFIX}${s.path}`:s.authority==="rasterarrays"?s.path=`/${Q.RASTERARRAYS_URL_PREFIX}${s.path}`:s.authority==="3dtiles"?s.path=`/${Q.TILES3D_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Q.TILE_URL_VERSION}${s.path}`);const l=this._customAccessToken||function(c){for(const d of c){const _=d.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(s.params)||Q.ACCESS_TOKEN;return Q.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,l)}canonicalizeTileURL(t,e){const n=So(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${Q.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?s+=`rasterarrays/${n.path.replace(`/${Q.RASTERARRAYS_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${Q.TILE_URL_VERSION}/`,"")}`;let l=n.params;return e&&(l=l.filter(c=>!c.match(/^access_token=/))),l.length&&(s+=`?${l.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&xe(e),s=[];for(const l of t.tiles||[])ae(l)?s.push(this.canonicalizeTileURL(l,n)):s.push(l);return s}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=So(Q.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,t.protocol==="http"){const l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(s.path!=="/"&&(t.path=`${s.path}${t.path}`),!Q.REQUIRE_ACCESS_TOKEN)return tc(t);if(e=e||Q.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(l=>l.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),tc(t)}},o.dh=function(t,e){e?_h.add(t):_h.delete(t)},o.di=Ad,o.dj=Ig,o.dk=$l,o.dl=fp,o.dm=_r,o.dn=zr,o.dp=function(t){_h.delete(t)},o.dq=$i,o.dr=An,o.ds=Ul,o.dt=q,o.du=function(t,e){Ed=t,ss=e},o.dv=function(t,e,n=!1){if(ot===bt||ot===St||ot===Pt)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ze=zi.resolveURL(t),ot=bt,Et=e,cn(),n||Sn()},o.dw=yn,o.dx=function(){$1().acquire(ET)},o.dy=function(){const t=Yy;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(ET),Yy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dz=Xy,o.e=zi,o.e0=CC,o.e1=et,o.e2=Wl,o.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==jA){const n=new Uint32Array(t,0,7),[,,s,l,c,d]=n;e=n.byteLength+l+c+d+c,(s!==t.byteLength||e>=t.byteLength)&&xr("Invalid b3dm header information.")}return qA(t,e)},o.e4=function(t,e){const n=ZA(t);for(const s of n){for(const l of s.meshes)lk(l);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(uk(s.lights,e)))}return n},o.e5=X1,o.e6=FA,o.e7=Vt,o.e8=function(t){Ku(),bo&&bo.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},o.f=as,o.g=function(t,e){return Ja(Rr(t,{type:"json"}),e)},o.h=xa,o.i=Mo,o.j=HC,o.k=iT,o.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>qA(e,0,t))},o.m=class extends G1{},o.n=fe,o.o=ac,o.p=lz,o.q=Oh,o.r=f,o.s=i,o.t=F,o.u=Vs,o.v=Vr,o.w=xr,o.x=Z,o.y=U,o.z=al}),P(["./shared"],function(o){function q(Ce){const $=Ce?Ce.url.toString():void 0;return $?performance.getEntriesByName($):[]}function J(Ce){if(typeof Ce=="number"||typeof Ce=="boolean"||typeof Ce=="string"||Ce==null)return JSON.stringify(Ce);if(Array.isArray(Ce)){let K="[";for(const he of Ce)K+=`${J(he)},`;return`${K}]`}let $="{";for(const K of Object.keys(Ce).sort())$+=`${K}:${J(Ce[K])},`;return`${$}}`}function Q(Ce){let $="";for(const K of o.cE)$+=`/${J(Ce[K])}`;return $}class ae{constructor($){this.keyCache={},this._layers={},this._layerConfigs={},$&&this.replace($)}replace($,K){this._layerConfigs={},this._layers={},this.update($,[],K)}update($,K,he){this._options=he;for(const we of $)this._layerConfigs[we.id]=we,(this._layers[we.id]=o.cY(we,this.scope,null,this._options)).compileFilter(),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of K)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ve=function(we,De){const Ge={};for(let We=0;We<we.length;We++){const gt=De&&De[we[We].id]||Q(we[We]);De&&(De[we[We].id]=gt);let ft=Ge[gt];ft||(ft=Ge[gt]=[]),ft.push(we[We])}const Ie=[];for(const We in Ge)Ie.push(Ge[We]);return Ie}(o.dG(this._layerConfigs),this.keyCache);for(const we of ve){const De=we.map(Ft=>this._layers[Ft.id]),Ge=De[0];if(Ge.visibility==="none")continue;const Ie=Ge.source||"";let We=this.familiesBySource[Ie];We||(We=this.familiesBySource[Ie]={});const gt=Ge.sourceLayer||"_geojsonTileLayer";let ft=We[gt];ft||(ft=We[gt]=[]),ft.push(De)}}}const xe=1*o.dJ;class Re{constructor($){const K={},he=[];for(const Ge in $){const Ie=$[Ge],We=K[Ge]={};for(const gt in Ie.glyphs){const ft=Ie.glyphs[+gt];if(!ft||ft.bitmap.width===0||ft.bitmap.height===0)continue;const Ft=ft.metrics.localGlyph?xe:1,Yt={x:0,y:0,w:ft.bitmap.width+2*Ft,h:ft.bitmap.height+2*Ft};he.push(Yt),We[gt]=Yt}}const{w:ve,h:we}=o.j(he),De=new o.dI({width:ve||1,height:we||1});for(const Ge in $){const Ie=$[Ge];for(const We in Ie.glyphs){const gt=Ie.glyphs[+We];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const ft=K[Ge][We],Ft=gt.metrics.localGlyph?xe:1;o.dI.copy(gt.bitmap,De,{x:0,y:0},{x:ft.x+Ft,y:ft.y+Ft},gt.bitmap)}}this.image=De,this.positions=K}}o.dH(Re,"GlyphAtlas");class Ue{constructor($){this.tileID=new o.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.lut=$.lut,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.scope=$.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.promoteId=$.promoteId,this.isSymbolTile=$.isSymbolTile,this.tileTransform=o.dK($.tileID.canonical,$.projection),this.projection=$.projection,this.brightness=$.brightness,this.extraShadowCaster=!!$.extraShadowCaster,this.tessellationStep=$.tessellationStep}parse($,K,he,ve,we){this.status="parsing",this.data=$,this.collisionBoxArray=new o.dL;const De=new o.dM(Object.keys($.layers).sort()),Ge=new o.dN(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const Ie={},We=new o.dO(256,256),gt={featureIndex:Ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:We,availableImages:he,brightness:this.brightness},ft=K.familiesBySource[this.source];for(const Bt in ft){const Ar=$.layers[Bt];if(!Ar)continue;let rr=!1,Fn=!1,Zr=!1;for(const Ri of ft[Bt])Ri[0].type==="symbol"?rr=!0:Fn=!0,Ri[0].is3D()&&Ri[0].type!=="model"&&(Zr=!0);if(this.extraShadowCaster&&!Zr||this.isSymbolTile===!0&&!rr||this.isSymbolTile===!1&&!Fn)continue;Ar.version===1&&o.w(`Vector tile source "${this.source}" layer "${Bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const br=De.encode(Bt),Qr=[];for(let Ri=0;Ri<Ar.length;Ri++){const bi=Ar.feature(Ri),Fl=Ge.getId(bi,Bt);Qr.push({feature:bi,id:Fl,index:Ri,sourceLayerIndex:br})}for(const Ri of ft[Bt]){const bi=Ri[0];(!this.extraShadowCaster||bi.is3D()&&bi.type!=="model")&&(this.isSymbolTile!==void 0&&bi.type==="symbol"!==this.isSymbolTile||bi.minzoom&&this.zoom<Math.floor(bi.minzoom)||bi.maxzoom&&this.zoom>=bi.maxzoom||bi.visibility!=="none"&&(Tt(Ri,this.zoom,gt.brightness,he),(Ie[bi.id]=bi.createBucket({index:Ge.bucketLayerIDs.length,layers:Ri,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:br,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Qr,gt,this.tileID.canonical,this.tileTransform),Ge.bucketLayerIDs.push(Ri.map(Fl=>Fl.id))))}}let Ft,Yt,gn,Tn;We.trim();const un={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Rn=()=>{if(Ft)return this.status="done",we(Ft);if(this.extraShadowCaster)this.status="done",we(null,{buckets:o.dG(Ie).filter(Bt=>!Bt.isEmpty()),featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:gt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yt&&gn&&Tn){const Bt=new Re(Yt),Ar=new o.dQ(gn,Tn,this.lut);for(const rr in Ie){const Fn=Ie[rr];Fn instanceof o.dR?(Tt(Fn.layers,this.zoom,gt.brightness,he),o.dS(Fn,Yt,Bt.positions,gn,Ar.iconPositions,this.showCollisionBoxes,he,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Fn.hasPattern&&(Fn instanceof o.dT||Fn instanceof o.dU||Fn instanceof o.b_)&&(Tt(Fn.layers,this.zoom,gt.brightness,he),Fn.addFeatures(gt,this.tileID.canonical,Ar.patternPositions,he,this.tileTransform,this.brightness))}this.status="done",we(null,{buckets:o.dG(Ie).filter(rr=>!rr.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Bt.image,lineAtlas:We,imageAtlas:Ar,brightness:gt.brightness})}};if(!this.extraShadowCaster){const Bt=o.dP(gt.glyphDependencies,Fn=>Object.keys(Fn).map(Number));Object.keys(Bt).length?ve.send("getGlyphs",{uid:this.uid,stacks:Bt,scope:this.scope},(Fn,Zr)=>{Ft||(Ft=Fn,Yt=Zr,Rn())},void 0,!1,un):Yt={};const Ar=Object.keys(gt.iconDependencies);Ar.length?ve.send("getImages",{icons:Ar,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Fn,Zr)=>{Ft||(Ft=Fn,gn=Zr,Rn())},void 0,!1,un):gn={};const rr=Object.keys(gt.patternDependencies);rr.length?ve.send("getImages",{icons:rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Fn,Zr)=>{Ft||(Ft=Fn,Tn=Zr,Rn())},void 0,!1,un):Tn={}}Rn()}}function Tt(Ce,$,K,he){const ve=new o.X($,{brightness:K});for(const we of Ce)we.recalculate(ve,he)}class Te extends o.E{constructor($,K,he,ve,we,De){super(),this.actor=$,this.layerIndex=K,this.availableImages=he,this.loadVectorData=we||o.ap,this.loading={},this.loaded={},this.deduped=new o.ao($.scheduler),this.isSpriteLoaded=ve,this.scheduler=$.scheduler,this.brightness=De}loadTile($,K){const he=$.uid,ve=$&&$.request,we=ve&&ve.collectResourceTiming,De=this.loading[he]=new Ue($);De.abort=this.loadVectorData($,(Ge,Ie)=>{const We=!this.loading[he];if(delete this.loading[he],We||Ge||!Ie)return De.status="done",We||(this.loaded[he]=De),K(Ge);const gt=Ie.rawData,ft={};Ie.expires&&(ft.expires=Ie.expires),Ie.cacheControl&&(ft.cacheControl=Ie.cacheControl),De.vectorTile=Ie.vectorTile||new o.dV(new o.dW(gt));const Ft=()=>{De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,(Yt,gn)=>{if(Yt||!gn)return K(Yt);const Tn={};if(we){const un=q(ve);un.length>0&&(Tn.resourceTiming=JSON.parse(JSON.stringify(un)))}K(null,o.W({rawTileData:gt.slice(0)},gn,ft,Tn))})};this.isSpriteLoaded?Ft():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ft,{type:"parseTile",isSymbolTile:$.isSymbolTile,zoom:$.tileZoom}):Ft()}),this.loaded=this.loaded||{},this.loaded[he]=De})}reloadTile($,K){const he=this.loaded,ve=$.uid;if(he&&he[ve]){const we=he[ve];we.showCollisionBoxes=$.showCollisionBoxes,we.projection=$.projection,we.brightness=$.brightness,we.tileTransform=o.dK($.tileID.canonical,$.projection),we.extraShadowCaster=$.extraShadowCaster,we.lut=$.lut;const De=(Ge,Ie)=>{const We=we.reloadCallback;We&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,We)),K(Ge,Ie)};we.status==="parsing"?we.reloadCallback=De:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,De):De())}else K(null,void 0)}abortTile($,K){const he=$.uid,ve=this.loading[he];ve&&(ve.abort&&ve.abort(),delete this.loading[he]),K()}removeTile($,K){const he=this.loaded,ve=$.uid;he&&he[ve]&&delete he[ve],K()}}class Ee{loadTile($,K){const{uid:he,encoding:ve,rawImageData:we,padding:De}=$,Ge=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,De):we;K(null,new o.dX(he,Ge,ve,De<1))}getImageData($,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);const he=this.offscreenCanvasContext.getImageData(-K,-K,$.width+2*K,$.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}class Me{decodeRasterArray({task:$,buffer:K},he){o.dY.performDecoding(K,$).then(ve=>{he(null,ve)},ve=>{he(ve)})}}const et=o.dZ.prototype.toGeoJSON;let pt=class{constructor(Ce){this._feature=Ce,this.extent=o.a3,this.type=Ce.type,this.properties=Ce.tags,"id"in Ce&&!isNaN(Ce.id)&&(this.id=parseInt(Ce.id,10))}loadGeometry(){if(this._feature.type===1){const Ce=[];for(const $ of this._feature.geometry)Ce.push([new o.P($[0],$[1])]);return Ce}{const Ce=[];for(const $ of this._feature.geometry){const K=[];for(const he of $)K.push(new o.P(he[0],he[1]));Ce.push(K)}return Ce}}toGeoJSON(Ce,$,K){return et.call(this,Ce,$,K)}},Ct=class{constructor(Ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.a3,this.length=Ce.length,this._features=Ce}feature(Ce){return new pt(this._features[Ce])}};const Ot=64/4096;class zt{constructor(){this.features=new Map}clear(){this.features.clear()}load($=[],K){for(const he of $){const ve=he.id;if(ve==null)continue;let we=this.features.get(ve);we&&this.updateCache(we,K),he.geometry?(we=wn(he),this.updateCache(we,K),this.features.set(ve,we)):this.features.delete(ve),this.updateCache(we,K)}}updateCache($,K){for(const{canonical:he,uid:ve}of Object.values(K)){const{z:we,x:De,y:Ge}=he;Zn($,Math.pow(2,we),De,Ge)&&delete K[ve]}}getTile($,K,he){const ve=Math.pow(2,$),we=[];for(const De of this.features.values())Zn(De,ve,K,he)&&we.push(xo(De,ve,K,he));return{features:we}}getFeatures(){return[...this.features.values()]}}function Zn({minX:Ce,minY:$,maxX:K,maxY:he},ve,we,De){return Ce<(we+1+Ot)/ve&&$<(De+1+Ot)/ve&&K>(we-Ot)/ve&&he>(De-Ot)/ve}function wn(Ce){const{id:$,geometry:K,properties:he}=Ce;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ve,coordinates:we}=K,De={id:$,type:1,geometry:[],tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=De.geometry;if(ve==="Point")xn(we,Ge,De);else if(ve==="MultiPoint")for(const Ie of we)xn(Ie,Ge,De);else if(ve==="LineString")De.type=2,rs(we,Ge,De);else if(ve==="MultiLineString")De.type=2,bn(we,Ge,De);else if(ve==="Polygon")De.type=3,bn(we,Ge,De,!0);else{if(ve!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");De.type=3;for(const Ie of we)bn(Ie,Ge,De,!0)}return De}function xn([Ce,$],K,he){const ve=o.aj(Ce);let we=o.ak($);we=we<0?0:we>1?1:we,K.push(ve,we),he.minX=Math.min(he.minX,ve),he.minY=Math.min(he.minY,we),he.maxX=Math.max(he.maxX,ve),he.maxY=Math.max(he.maxY,we)}function rs(Ce,$,K,he=!1,ve=!1){const we=[];for(const De of Ce)xn(De,we,K);$.push(we),he&&function(De,Ge){let Ie=0;for(let We=0,gt=De.length,ft=gt-2;We<gt;ft=We,We+=2)Ie+=(De[We]-De[ft])*(De[We+1]+De[ft+1]);if(Ie>0===Ge)for(let We=0,gt=De.length;We<gt/2;We+=2){const ft=De[We],Ft=De[We+1];De[We]=De[gt-2-We],De[We+1]=De[gt-1-We],De[gt-2-We]=ft,De[gt-1-We]=Ft}}(we,ve)}function bn(Ce,$,K,he=!1){for(let ve=0;ve<Ce.length;ve++)rs(Ce[ve],$,K,he,ve===0)}function xo(Ce,$,K,he){const{id:ve,type:we,geometry:De,tags:Ge}=Ce,Ie=[];if(we===1)Jr(De,$,K,he,Ie);else for(const We of De)Ie.push(Jr(We,$,K,he));return{id:ve,type:we,geometry:Ie,tags:Ge}}function Jr(Ce,$,K,he,ve=[]){for(let we=0;we<Ce.length;we+=2)ve.push(Pi(Ce[we],Ce[we+1],$,K,he));return ve}function Pi(Ce,$,K,he,ve){return[Math.round(o.a3*(Ce*K-he)),Math.round(o.a3*($*K-ve))]}var Cn={exports:{}},Gt=o.d$,_n=o.d_.VectorTileFeature,zn=lr;function lr(Ce,$){this.options=$||{},this.features=Ce,this.length=Ce.length}function Br(Ce,$){this.id=typeof Ce.id=="number"?Ce.id:void 0,this.type=Ce.type,this.rawGeometry=Ce.type===1?[Ce.geometry]:Ce.geometry,this.properties=Ce.tags,this.extent=$||4096}lr.prototype.feature=function(Ce){return new Br(this.features[Ce],this.options.extent)},Br.prototype.loadGeometry=function(){var Ce=this.rawGeometry;this.geometry=[];for(var $=0;$<Ce.length;$++){for(var K=Ce[$],he=[],ve=0;ve<K.length;ve++)he.push(new Gt(K[ve][0],K[ve][1]));this.geometry.push(he)}return this.geometry},Br.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ce=this.geometry,$=1/0,K=-1/0,he=1/0,ve=-1/0,we=0;we<Ce.length;we++)for(var De=Ce[we],Ge=0;Ge<De.length;Ge++){var Ie=De[Ge];$=Math.min($,Ie.x),K=Math.max(K,Ie.x),he=Math.min(he,Ie.y),ve=Math.max(ve,Ie.y)}return[$,he,K,ve]},Br.prototype.toGeoJSON=_n.prototype.toGeoJSON;var jn=o.e0,ps=zn;function Fr(Ce){var $=new jn;return function(K,he){for(var ve in K.layers)he.writeMessage(3,is,K.layers[ve])}(Ce,$),$.finish()}function is(Ce,$){var K;$.writeVarintField(15,Ce.version||1),$.writeStringField(1,Ce.name||""),$.writeVarintField(5,Ce.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<Ce.length;K++)he.feature=Ce.feature(K),$.writeMessage(2,da,he);var ve=he.keys;for(K=0;K<ve.length;K++)$.writeStringField(3,ve[K]);var we=he.values;for(K=0;K<we.length;K++)$.writeMessage(4,Rl,we[K])}function da(Ce,$){var K=Ce.feature;K.id!==void 0&&$.writeVarintField(1,K.id),$.writeMessage(2,Ga,Ce),$.writeVarintField(3,K.type),$.writeMessage(4,pr,K)}function Ga(Ce,$){var K=Ce.feature,he=Ce.keys,ve=Ce.values,we=Ce.keycache,De=Ce.valuecache;for(var Ge in K.properties){var Ie=K.properties[Ge],We=we[Ge];if(Ie!==null){We===void 0&&(he.push(Ge),we[Ge]=We=he.length-1),$.writeVarint(We);var gt=typeof Ie;gt!=="string"&&gt!=="boolean"&&gt!=="number"&&(Ie=JSON.stringify(Ie));var ft=gt+":"+Ie,Ft=De[ft];Ft===void 0&&(ve.push(Ie),De[ft]=Ft=ve.length-1),$.writeVarint(Ft)}}}function en(Ce,$){return($<<3)+(7&Ce)}function Lu(Ce){return Ce<<1^Ce>>31}function pr(Ce,$){for(var K=Ce.loadGeometry(),he=Ce.type,ve=0,we=0,De=K.length,Ge=0;Ge<De;Ge++){var Ie=K[Ge],We=1;he===1&&(We=Ie.length),$.writeVarint(en(1,We));for(var gt=he===3?Ie.length-1:Ie.length,ft=0;ft<gt;ft++){ft===1&&he!==1&&$.writeVarint(en(2,gt-1));var Ft=Ie[ft].x-ve,Yt=Ie[ft].y-we;$.writeVarint(Lu(Ft)),$.writeVarint(Lu(Yt)),ve+=Ft,we+=Yt}he===3&&$.writeVarint(en(7,1))}}function Rl(Ce,$){var K=typeof Ce;K==="string"?$.writeStringField(1,Ce):K==="boolean"?$.writeBooleanField(7,Ce):K==="number"&&(Ce%1!=0?$.writeDoubleField(3,Ce):Ce<0?$.writeSVarintField(6,Ce):$.writeVarintField(5,Ce))}Cn.exports=Fr,Cn.exports.fromVectorTileJs=Fr,Cn.exports.fromGeojsonVt=function(Ce,$){$=$||{};var K={};for(var he in Ce)K[he]=new ps(Ce[he].features,$),K[he].name=he,K[he].version=$.version,K[he].extent=$.extent;return Fr({layers:K})},Cn.exports.GeoJSONWrapper=ps;var Xc=o.e1(Cn.exports);const ms={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},fa=Math.fround||(Du=new Float32Array(1),Ce=>(Du[0]=+Ce,Du[0]));var Du;const wi=3,Ks=5,Yc=6;class Qt{constructor($){this.options=Object.assign(Object.create(ms),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){const{log:K,minZoom:he,maxZoom:ve}=this.options;K&&console.time("total time");const we=`prepare ${$.length} points`;K&&console.time(we),this.points=$;const De=[];for(let Ie=0;Ie<$.length;Ie++){const We=$[Ie];if(!We.geometry)continue;const[gt,ft]=We.geometry.coordinates,Ft=fa(ji(gt)),Yt=fa(Ll(ft));De.push(Ft,Yt,1/0,Ie,-1,1),this.options.reduce&&De.push(0)}let Ge=this.trees[ve+1]=this._createTree(De);K&&console.timeEnd(we);for(let Ie=ve;Ie>=he;Ie--){const We=+Date.now();Ge=this.trees[Ie]=this._createTree(this._cluster(Ge,Ie)),K&&console.log("z%d: %d clusters in %dms",Ie,Ge.numItems,+Date.now()-We)}return K&&console.timeEnd("total time"),this}getClusters($,K){let he=(($[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,$[1]));let we=$[2]===180?180:(($[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)he=-180,we=180;else if(he>we){const ft=this.getClusters([he,ve,180,De],K),Ft=this.getClusters([-180,ve,we,De],K);return ft.concat(Ft)}const Ge=this.trees[this._limitZoom(K)],Ie=Ge.range(ji(he),Ll(De),ji(we),Ll(ve)),We=Ge.data,gt=[];for(const ft of Ie){const Ft=this.stride*ft;gt.push(We[Ft+Ks]>1?Zt(We,Ft,this.clusterProps):this.points[We[Ft+wi]])}return gt}getChildren($){const K=this._getOriginId($),he=this._getOriginZoom($),ve="No cluster with the specified id.",we=this.trees[he];if(!we)throw new Error(ve);const De=we.data;if(K*this.stride>=De.length)throw new Error(ve);const Ge=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Ie=we.within(De[K*this.stride],De[K*this.stride+1],Ge),We=[];for(const gt of Ie){const ft=gt*this.stride;De[ft+4]===$&&We.push(De[ft+Ks]>1?Zt(De,ft,this.clusterProps):this.points[De[ft+wi]])}if(We.length===0)throw new Error(ve);return We}getLeaves($,K,he){const ve=[];return this._appendLeaves(ve,$,K=K||10,he=he||0,0),ve}getTile($,K,he){const ve=this.trees[this._limitZoom($)],we=Math.pow(2,$),{extent:De,radius:Ge}=this.options,Ie=Ge/De,We=(he-Ie)/we,gt=(he+1+Ie)/we,ft={features:[]};return this._addTileFeatures(ve.range((K-Ie)/we,We,(K+1+Ie)/we,gt),ve.data,K,he,we,ft),K===0&&this._addTileFeatures(ve.range(1-Ie/we,We,1,gt),ve.data,we,he,we,ft),K===we-1&&this._addTileFeatures(ve.range(0,We,Ie/we,gt),ve.data,-1,he,we,ft),ft.features.length?ft:null}getClusterExpansionZoom($){let K=this._getOriginZoom($)-1;for(;K<=this.options.maxZoom;){const he=this.getChildren($);if(K++,he.length!==1)break;$=he[0].properties.cluster_id}return K}_appendLeaves($,K,he,ve,we){const De=this.getChildren(K);for(const Ge of De){const Ie=Ge.properties;if(Ie&&Ie.cluster?we+Ie.point_count<=ve?we+=Ie.point_count:we=this._appendLeaves($,Ie.cluster_id,he,ve,we):we<ve?we++:$.push(Ge),$.length===he)break}return we}_createTree($){const K=new o.cK($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<$.length;he+=this.stride)K.add($[he],$[he+1]);return K.finish(),K.data=$,K}_addTileFeatures($,K,he,ve,we,De){for(const Ge of $){const Ie=Ge*this.stride,We=K[Ie+Ks]>1;let gt,ft,Ft;if(We)gt=ko(K,Ie,this.clusterProps),ft=K[Ie],Ft=K[Ie+1];else{const Tn=this.points[K[Ie+wi]];gt=Tn.properties;const[un,Rn]=Tn.geometry.coordinates;ft=ji(un),Ft=Ll(Rn)}const Yt={type:1,geometry:[[Math.round(this.options.extent*(ft*we-he)),Math.round(this.options.extent*(Ft*we-ve))]],tags:gt};let gn;gn=We||this.options.generateId?K[Ie+wi]:this.points[K[Ie+wi]].id,gn!==void 0&&(Yt.id=gn),De.features.push(Yt)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,K){const{radius:he,extent:ve,reduce:we,minPoints:De}=this.options,Ge=he/(ve*Math.pow(2,K)),Ie=$.data,We=[],gt=this.stride;for(let ft=0;ft<Ie.length;ft+=gt){if(Ie[ft+2]<=K)continue;Ie[ft+2]=K;const Ft=Ie[ft],Yt=Ie[ft+1],gn=$.within(Ie[ft],Ie[ft+1],Ge),Tn=Ie[ft+Ks];let un=Tn;for(const Rn of gn){const Bt=Rn*gt;Ie[Bt+2]>K&&(un+=Ie[Bt+Ks])}if(un>Tn&&un>=De){let Rn,Bt=Ft*Tn,Ar=Yt*Tn,rr=-1;const Fn=(ft/gt<<5)+(K+1)+this.points.length;for(const Zr of gn){const br=Zr*gt;if(Ie[br+2]<=K)continue;Ie[br+2]=K;const Qr=Ie[br+Ks];Bt+=Ie[br]*Qr,Ar+=Ie[br+1]*Qr,Ie[br+4]=Fn,we&&(Rn||(Rn=this._map(Ie,ft,!0),rr=this.clusterProps.length,this.clusterProps.push(Rn)),we(Rn,this._map(Ie,br)))}Ie[ft+4]=Fn,We.push(Bt/un,Ar/un,1/0,Fn,-1,un),we&&We.push(rr)}else{for(let Rn=0;Rn<gt;Rn++)We.push(Ie[ft+Rn]);if(un>1)for(const Rn of gn){const Bt=Rn*gt;if(!(Ie[Bt+2]<=K)){Ie[Bt+2]=K;for(let Ar=0;Ar<gt;Ar++)We.push(Ie[Bt+Ar])}}}}return We}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,K,he){if($[K+Ks]>1){const De=this.clusterProps[$[K+Yc]];return he?Object.assign({},De):De}const ve=this.points[$[K+wi]].properties,we=this.options.map(ve);return he&&we===ve?Object.assign({},we):we}}function Zt(Ce,$,K){return{type:"Feature",id:Ce[$+wi],properties:ko(Ce,$,K),geometry:{type:"Point",coordinates:[(he=Ce[$],360*(he-.5)),Oo(Ce[$+1])]}};var he}function ko(Ce,$,K){const he=Ce[$+Ks],ve=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,we=Ce[$+Yc],De=we===-1?{}:Object.assign({},K[we]);return Object.assign(De,{cluster:!0,cluster_id:Ce[$+wi],point_count:he,point_count_abbreviated:ve})}function ji(Ce){return Ce/360+.5}function Ll(Ce){const $=Math.sin(Ce*Math.PI/180),K=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return K<0?0:K>1?1:K}function Oo(Ce){const $=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function zu(Ce,$,K,he){let ve=he;const we=$+(K-$>>1);let De,Ge=K-$;const Ie=Ce[$],We=Ce[$+1],gt=Ce[K],ft=Ce[K+1];for(let Ft=$+3;Ft<K;Ft+=3){const Yt=pa(Ce[Ft],Ce[Ft+1],Ie,We,gt,ft);if(Yt>ve)De=Ft,ve=Yt;else if(Yt===ve){const gn=Math.abs(Ft-we);gn<Ge&&(De=Ft,Ge=gn)}}ve>he&&(De-$>3&&zu(Ce,$,De,he),Ce[De+2]=ve,K-De>3&&zu(Ce,De,K,he))}function pa(Ce,$,K,he,ve,we){let De=ve-K,Ge=we-he;if(De!==0||Ge!==0){const Ie=((Ce-K)*De+($-he)*Ge)/(De*De+Ge*Ge);Ie>1?(K=ve,he=we):Ie>0&&(K+=De*Ie,he+=Ge*Ie)}return De=Ce-K,Ge=$-he,De*De+Ge*Ge}function Ls(Ce,$,K,he){const ve={id:Ce??null,type:$,geometry:K,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if($==="Point"||$==="MultiPoint"||$==="LineString")ma(ve,K);else if($==="Polygon")ma(ve,K[0]);else if($==="MultiLineString")for(const we of K)ma(ve,we);else if($==="MultiPolygon")for(const we of K)ma(ve,we[0]);return ve}function ma(Ce,$){for(let K=0;K<$.length;K+=3)Ce.minX=Math.min(Ce.minX,$[K]),Ce.minY=Math.min(Ce.minY,$[K+1]),Ce.maxX=Math.max(Ce.maxX,$[K]),Ce.maxY=Math.max(Ce.maxY,$[K+1])}function Wa(Ce,$,K,he){if(!$.geometry)return;const ve=$.geometry.coordinates;if(ve&&ve.length===0)return;const we=$.geometry.type,De=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Ge=[],Ie=$.id;if(K.promoteId?Ie=$.properties[K.promoteId]:K.generateId&&(Ie=he||0),we==="Point")Dl(ve,Ge);else if(we==="MultiPoint")for(const We of ve)Dl(We,Ge);else if(we==="LineString")$a(ve,Ge,De,!1);else if(we==="MultiLineString"){if(K.lineMetrics){for(const We of ve)Ge=[],$a(We,Ge,De,!1),Ce.push(Ls(Ie,"LineString",Ge,$.properties));return}qa(ve,Ge,De,!1)}else if(we==="Polygon")qa(ve,Ge,De,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const We of $.geometry.geometries)Wa(Ce,{id:Ie,geometry:We,properties:$.properties},K,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const We of ve){const gt=[];qa(We,gt,De,!0),Ge.push(gt)}}Ce.push(Ls(Ie,we,Ge,$.properties))}function Dl(Ce,$){$.push(_s(Ce[0]),ku(Ce[1]),0)}function $a(Ce,$,K,he){let ve,we,De=0;for(let Ie=0;Ie<Ce.length;Ie++){const We=_s(Ce[Ie][0]),gt=ku(Ce[Ie][1]);$.push(We,gt,0),Ie>0&&(De+=he?(ve*gt-We*we)/2:Math.sqrt(Math.pow(We-ve,2)+Math.pow(gt-we,2))),ve=We,we=gt}const Ge=$.length-3;$[2]=1,zu($,0,Ge,K),$[Ge+2]=1,$.size=Math.abs(De),$.start=0,$.end=$.size}function qa(Ce,$,K,he){for(let ve=0;ve<Ce.length;ve++){const we=[];$a(Ce[ve],we,K,he),$.push(we)}}function _s(Ce){return Ce/360+.5}function ku(Ce){const $=Math.sin(Ce*Math.PI/180),K=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return K<0?0:K>1?1:K}function rn(Ce,$,K,he,ve,we,De,Ge){if(he/=$,we>=(K/=$)&&De<he)return Ce;if(De<K||we>=he)return null;const Ie=[];for(const We of Ce){const gt=We.geometry;let ft=We.type;const Ft=ve===0?We.minX:We.minY,Yt=ve===0?We.maxX:We.maxY;if(Ft>=K&&Yt<he){Ie.push(We);continue}if(Yt<K||Ft>=he)continue;let gn=[];if(ft==="Point"||ft==="MultiPoint")zl(gt,gn,K,he,ve);else if(ft==="LineString")Nr(gt,gn,K,he,ve,!1,Ge.lineMetrics);else if(ft==="MultiLineString")kl(gt,gn,K,he,ve,!1);else if(ft==="Polygon")kl(gt,gn,K,he,ve,!0);else if(ft==="MultiPolygon")for(const Tn of gt){const un=[];kl(Tn,un,K,he,ve,!0),un.length&&gn.push(un)}if(gn.length){if(Ge.lineMetrics&&ft==="LineString"){for(const Tn of gn)Ie.push(Ls(We.id,ft,Tn,We.tags));continue}ft!=="LineString"&&ft!=="MultiLineString"||(gn.length===1?(ft="LineString",gn=gn[0]):ft="MultiLineString"),ft!=="Point"&&ft!=="MultiPoint"||(ft=gn.length===3?"Point":"MultiPoint"),Ie.push(Ls(We.id,ft,gn,We.tags))}}return Ie.length?Ie:null}function zl(Ce,$,K,he,ve){for(let we=0;we<Ce.length;we+=3){const De=Ce[we+ve];De>=K&&De<=he&&vo($,Ce[we],Ce[we+1],Ce[we+2])}}function Nr(Ce,$,K,he,ve,we,De){let Ge=Ou(Ce);const Ie=ve===0?wo:Kc;let We,gt,ft=Ce.start;for(let un=0;un<Ce.length-3;un+=3){const Rn=Ce[un],Bt=Ce[un+1],Ar=Ce[un+2],rr=Ce[un+3],Fn=Ce[un+4],Zr=ve===0?Rn:Bt,br=ve===0?rr:Fn;let Qr=!1;De&&(We=Math.sqrt(Math.pow(Rn-rr,2)+Math.pow(Bt-Fn,2))),Zr<K?br>K&&(gt=Ie(Ge,Rn,Bt,rr,Fn,K),De&&(Ge.start=ft+We*gt)):Zr>he?br<he&&(gt=Ie(Ge,Rn,Bt,rr,Fn,he),De&&(Ge.start=ft+We*gt)):vo(Ge,Rn,Bt,Ar),br<K&&Zr>=K&&(gt=Ie(Ge,Rn,Bt,rr,Fn,K),Qr=!0),br>he&&Zr<=he&&(gt=Ie(Ge,Rn,Bt,rr,Fn,he),Qr=!0),!we&&Qr&&(De&&(Ge.end=ft+We*gt),$.push(Ge),Ge=Ou(Ce)),De&&(ft+=We)}let Ft=Ce.length-3;const Yt=Ce[Ft],gn=Ce[Ft+1],Tn=ve===0?Yt:gn;Tn>=K&&Tn<=he&&vo(Ge,Yt,gn,Ce[Ft+2]),Ft=Ge.length-3,we&&Ft>=3&&(Ge[Ft]!==Ge[0]||Ge[Ft+1]!==Ge[1])&&vo(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&$.push(Ge)}function Ou(Ce){const $=[];return $.size=Ce.size,$.start=Ce.start,$.end=Ce.end,$}function kl(Ce,$,K,he,ve,we){for(const De of Ce)Nr(De,$,K,he,ve,we,!1)}function vo(Ce,$,K,he){Ce.push($,K,he)}function wo(Ce,$,K,he,ve,we){const De=(we-$)/(he-$);return vo(Ce,we,K+(ve-K)*De,1),De}function Kc(Ce,$,K,he,ve,we){const De=(we-K)/(ve-K);return vo(Ce,$+(he-$)*De,we,1),De}function Ha(Ce,$){const K=[];for(let he=0;he<Ce.length;he++){const ve=Ce[he],we=ve.type;let De;if(we==="Point"||we==="MultiPoint"||we==="LineString")De=Za(ve.geometry,$);else if(we==="MultiLineString"||we==="Polygon"){De=[];for(const Ge of ve.geometry)De.push(Za(Ge,$))}else if(we==="MultiPolygon"){De=[];for(const Ge of ve.geometry){const Ie=[];for(const We of Ge)Ie.push(Za(We,$));De.push(Ie)}}K.push(Ls(ve.id,we,De,ve.tags))}return K}function Za(Ce,$){const K=[];K.size=Ce.size,Ce.start!==void 0&&(K.start=Ce.start,K.end=Ce.end);for(let he=0;he<Ce.length;he+=3)K.push(Ce[he]+$,Ce[he+1],Ce[he+2]);return K}function Bu(Ce,$){if(Ce.transformed)return Ce;const K=1<<Ce.z,he=Ce.x,ve=Ce.y;for(const we of Ce.features){const De=we.geometry,Ge=we.type;if(we.geometry=[],Ge===1)for(let Ie=0;Ie<De.length;Ie+=2)we.geometry.push(Ol(De[Ie],De[Ie+1],$,K,he,ve));else for(let Ie=0;Ie<De.length;Ie++){const We=[];for(let gt=0;gt<De[Ie].length;gt+=2)We.push(Ol(De[Ie][gt],De[Ie][gt+1],$,K,he,ve));we.geometry.push(We)}}return Ce.transformed=!0,Ce}function Ol(Ce,$,K,he,ve,we){return[Math.round(K*(Ce*he-ve)),Math.round(K*($*he-we))]}function fd(Ce,$,K,he,ve){const we=$===ve.maxZoom?0:ve.tolerance/((1<<$)*ve.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:Ce.length,source:null,x:K,y:he,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of Ce)Fu(De,Ge,we,ve);return De}function Fu(Ce,$,K,he){const ve=$.geometry,we=$.type,De=[];if(Ce.minX=Math.min(Ce.minX,$.minX),Ce.minY=Math.min(Ce.minY,$.minY),Ce.maxX=Math.max(Ce.maxX,$.maxX),Ce.maxY=Math.max(Ce.maxY,$.maxY),we==="Point"||we==="MultiPoint")for(let Ge=0;Ge<ve.length;Ge+=3)De.push(ve[Ge],ve[Ge+1]),Ce.numPoints++,Ce.numSimplified++;else if(we==="LineString")Js(De,ve,Ce,K,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let Ge=0;Ge<ve.length;Ge++)Js(De,ve[Ge],Ce,K,we==="Polygon",Ge===0);else if(we==="MultiPolygon")for(let Ge=0;Ge<ve.length;Ge++){const Ie=ve[Ge];for(let We=0;We<Ie.length;We++)Js(De,Ie[We],Ce,K,!0,We===0)}if(De.length){let Ge=$.tags||null;if(we==="LineString"&&he.lineMetrics){Ge={};for(const We in $.tags)Ge[We]=$.tags[We];Ge.mapbox_clip_start=ve.start/ve.size,Ge.mapbox_clip_end=ve.end/ve.size}const Ie={geometry:De,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:Ge};$.id!==null&&(Ie.id=$.id),Ce.features.push(Ie)}}function Js(Ce,$,K,he,ve,we){const De=he*he;if(he>0&&$.size<(ve?De:he))return void(K.numPoints+=$.length/3);const Ge=[];for(let Ie=0;Ie<$.length;Ie+=3)(he===0||$[Ie+2]>De)&&(K.numSimplified++,Ge.push($[Ie],$[Ie+1])),K.numPoints++;ve&&function(Ie,We){let gt=0;for(let ft=0,Ft=Ie.length,Yt=Ft-2;ft<Ft;Yt=ft,ft+=2)gt+=(Ie[ft]-Ie[Yt])*(Ie[ft+1]+Ie[Yt+1]);if(gt>0===We)for(let ft=0,Ft=Ie.length;ft<Ft/2;ft+=2){const Yt=Ie[ft],gn=Ie[ft+1];Ie[ft]=Ie[Ft-2-ft],Ie[ft+1]=Ie[Ft-1-ft],Ie[Ft-2-ft]=Yt,Ie[Ft-1-ft]=gn}}(Ge,we),Ce.push(Ge)}const Bo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Qs{constructor($,K){const he=(K=this.options=function(we,De){for(const Ge in De)we[Ge]=De[Ge];return we}(Object.create(Bo),K)).debug;if(he&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let ve=function(we,De){const Ge=[];if(we.type==="FeatureCollection")for(let Ie=0;Ie<we.features.length;Ie++)Wa(Ge,we.features[Ie],De,Ie);else Wa(Ge,we.type==="Feature"?we:{geometry:we},De);return Ge}($,K);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ve=function(we,De){const Ge=De.buffer/De.extent;let Ie=we;const We=rn(we,1,-1-Ge,Ge,0,-1,2,De),gt=rn(we,1,1-Ge,2+Ge,0,-1,2,De);return(We||gt)&&(Ie=rn(we,1,-Ge,1+Ge,0,-1,2,De)||[],We&&(Ie=Ha(We,1).concat(Ie)),gt&&(Ie=Ie.concat(Ha(gt,-1)))),Ie}(ve,K),ve.length&&this.splitTile(ve,0,0,0),he&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile($,K,he,ve,we,De,Ge){const Ie=[$,K,he,ve],We=this.options,gt=We.debug;for(;Ie.length;){ve=Ie.pop(),he=Ie.pop(),K=Ie.pop(),$=Ie.pop();const ft=1<<K,Ft=fi(K,he,ve);let Yt=this.tiles[Ft];if(!Yt&&(gt>1&&console.time("creation"),Yt=this.tiles[Ft]=fd($,K,he,ve,We),this.tileCoords.push({z:K,x:he,y:ve}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,he,ve,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));const Qr=`z${K}`;this.stats[Qr]=(this.stats[Qr]||0)+1,this.total++}if(Yt.source=$,we==null){if(K===We.indexMaxZoom||Yt.numPoints<=We.indexMaxPoints)continue}else{if(K===We.maxZoom||K===we)continue;if(we!=null){const Qr=we-K;if(he!==De>>Qr||ve!==Ge>>Qr)continue}}if(Yt.source=null,$.length===0)continue;gt>1&&console.time("clipping");const gn=.5*We.buffer/We.extent,Tn=.5-gn,un=.5+gn,Rn=1+gn;let Bt=null,Ar=null,rr=null,Fn=null,Zr=rn($,ft,he-gn,he+un,0,Yt.minX,Yt.maxX,We),br=rn($,ft,he+Tn,he+Rn,0,Yt.minX,Yt.maxX,We);$=null,Zr&&(Bt=rn(Zr,ft,ve-gn,ve+un,1,Yt.minY,Yt.maxY,We),Ar=rn(Zr,ft,ve+Tn,ve+Rn,1,Yt.minY,Yt.maxY,We),Zr=null),br&&(rr=rn(br,ft,ve-gn,ve+un,1,Yt.minY,Yt.maxY,We),Fn=rn(br,ft,ve+Tn,ve+Rn,1,Yt.minY,Yt.maxY,We),br=null),gt>1&&console.timeEnd("clipping"),Ie.push(Bt||[],K+1,2*he,2*ve),Ie.push(Ar||[],K+1,2*he,2*ve+1),Ie.push(rr||[],K+1,2*he+1,2*ve),Ie.push(Fn||[],K+1,2*he+1,2*ve+1)}}getTile($,K,he){$=+$,K=+K,he=+he;const ve=this.options,{extent:we,debug:De}=ve;if($<0||$>24)return null;const Ge=1<<$,Ie=fi($,K=K+Ge&Ge-1,he);if(this.tiles[Ie])return Bu(this.tiles[Ie],we);De>1&&console.log("drilling down to z%d-%d-%d",$,K,he);let We,gt=$,ft=K,Ft=he;for(;!We&&gt>0;)gt--,ft>>=1,Ft>>=1,We=this.tiles[fi(gt,ft,Ft)];return We&&We.source?(De>1&&(console.log("found parent tile z%d-%d-%d",gt,ft,Ft),console.time("drilling down")),this.splitTile(We.source,gt,ft,Ft,$,K,he),De>1&&console.timeEnd("drilling down"),this.tiles[Ie]?Bu(this.tiles[Ie],we):null):null}}function fi(Ce,$,K){return 32*((1<<Ce)*K+$)+Ce}function pd(Ce,$){const K=Ce.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const he=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!he)return $(null,null);const ve=new Ct(he.features);let we=Xc(ve);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),$(null,{vectorTile:ve,rawData:we.buffer})}class Bl extends Te{constructor($,K,he,ve,we,De){super($,K,he,ve,pd,De),we&&(this.loadGeoJSON=we),this._dynamicIndex=new zt}loadData($,K){const he=$&&$.request,ve=he&&he.collectResourceTiming;this.loadGeoJSON($,(we,De)=>{if(we||!De)return K(we);if(typeof De!="object")return K(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{try{if($.filter){const Ie=o.y($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(We=>`${We.key}: ${We.message}`).join(", "));De.features=De.features.filter(We=>Ie.value.evaluate({zoom:0},We))}$.dynamic?(De.type==="Feature"&&(De={type:"FeatureCollection",features:[De]}),$.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(De.features,this.loaded),$.cluster&&(De.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=$.cluster?new Qt(function({superclusterOptions:Ie,clusterProperties:We}){if(!We||!Ie)return Ie;const gt={},ft={},Ft={accumulated:null,zoom:0},Yt={properties:null},gn=Object.keys(We);for(const Tn of gn){const[un,Rn]=We[Tn],Bt=o.y(Rn),Ar=o.y(typeof un=="string"?[un,["accumulated"],["get",Tn]]:un);gt[Tn]=Bt.value,ft[Tn]=Ar.value}return Ie.map=Tn=>{Yt.properties=Tn;const un={};for(const Rn of gn)un[Rn]=gt[Rn].evaluate(Ft,Yt);return un},Ie.reduce=(Tn,un)=>{Yt.properties=un;for(const Rn of gn)Ft.accumulated=Tn[Rn],Tn[Rn]=ft[Rn].evaluate(Ft,Yt)},Ie}($)).load(De.features):$.dynamic?this._dynamicIndex:function(Ie,We){return new Qs(Ie,We)}(De,$.geojsonVtOptions)}catch(Ie){return K(Ie)}const Ge={};if(ve){const Ie=q(he);Ie&&(Ge.resourceTiming={},Ge.resourceTiming[$.source]=JSON.parse(JSON.stringify(Ie)))}K(null,Ge)}})}reloadTile($,K){const he=this.loaded;return he&&he[$.uid]?$.partial?K(null,void 0):super.reloadTile($,K):this.loadTile($,K)}loadGeoJSON($,K){if($.request)o.g($.request,K);else{if(typeof $.data!="string")return K(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse($.data))}catch{return K(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(he){K(he)}}getClusterChildren($,K){try{K(null,this._geoJSONIndex.getChildren($.clusterId))}catch(he){K(he)}}getClusterLeaves($,K){try{K(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(he){K(he)}}}class Nu{constructor($,K){this.tileID=new o.aL($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=$.projection,this.brightness=K}parse($,K,he,ve){this.status="parsing";const we=new o.aL(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),De={},Ge=K.familiesBySource[he.source],Ie=new o.dN(we,he.promoteId);return Ie.bucketLayerIDs=[],Ie.is3DTile=!0,o.e3($).then(We=>{if(!We)return ve(new Error("Could not parse tile"));const gt=o.e4(We,1/o.b5(he.tileID.canonical)),ft=We.json.extensionsUsed&&We.json.extensionsUsed.includes("MAPBOX_mesh_features")||We.json.asset.extras&&We.json.asset.extras.MAPBOX_mesh_features,Ft=We.json.extensionsUsed&&We.json.extensionsUsed.includes("EXT_meshopt_compression"),Yt=new o.X(this.zoom,{brightness:this.brightness});for(const gn in Ge)for(const Tn of Ge[gn]){const un=Tn[0];Ie.bucketLayerIDs.push(Tn.map(Bt=>Bt.id)),un.recalculate(Yt,[]);const Rn=new o.e5(gt,we,ft,Ft,this.brightness,Ie);ft||(Rn.needsUpload=!0),De[un.fqid]=Rn,Rn.evaluate(un)}this.status="done",ve(null,{buckets:De,featureIndex:Ie})}).catch(We=>ve(new Error(We.message)))}}class Jc{constructor($,K,he,ve,we,De){this.actor=$,this.layerIndex=K,this.brightness=De,this.loading={},this.loaded={}}loadTile($,K){const he=$.uid,ve=this.loading[he]=new Nu($,this.brightness);o.e2($.request,(we,De)=>{const Ge=!this.loading[he];return delete this.loading[he],Ge||we?(ve.status="done",Ge||(this.loaded[he]=ve),K(we)):De&&De.byteLength!==0?void ve.parse(De,this.layerIndex,$,(Ie,We)=>{ve.status="done",this.loaded=this.loaded||{},this.loaded[he]=ve,Ie||!We?K(Ie):K(null,We)}):(ve.status="done",this.loaded[he]=ve,K())})}reloadTile($,K){const he=this.loaded,ve=$.uid;if(he&&he[ve]){const we=he[ve];we.projection=$.projection,we.brightness=$.brightness;const De=(Ge,Ie)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile($,K)),K(Ge,Ie)};we.status==="parsing"?we.reloadCallback=De:we.status==="done"&&this.loadTile($,K)}}abortTile($,K){const he=$.uid;this.loading[he]&&delete this.loading[he],K()}removeTile($,K){const he=this.loaded,ve=$.uid;he&&he[ve]&&delete he[ve],K()}}class Vu{constructor($){this.self=$,this.actor=new o.e6($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.aJ({name:"mercator"}),this.workerSourceTypes={vector:Te,geojson:Bl,"batched-model":Jc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,he)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=he},this.self.registerRTLTextPlugin=K=>{if(o.e7.isParsed())throw new Error("RTL text plugin already registered.");o.e7.applyArabicShaping=K.applyArabicShaping,o.e7.processBidirectionalText=K.processBidirectionalText,o.e7.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches($,K,he){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],delete this.rasterArrayWorkerSource,he()}checkIfReady($,K,he){he()}setReferrer($,K){this.referrer=K}spriteLoaded($,{scope:K,isLoaded:he}){if(this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.isSpriteLoaded[$][K]=he,this.workerSources[$]&&this.workerSources[$][K])for(const ve in this.workerSources[$][K]){const we=this.workerSources[$][K][ve];for(const De in we){const Ge=we[De];Ge instanceof Te&&(Ge.isSpriteLoaded=he,Ge.fire(new o.f("isSpriteLoaded")))}}}setImages($,{scope:K,images:he},ve){if(this.availableImages[$]||(this.availableImages[$]={}),this.availableImages[$][K]=he,this.workerSources[$]&&this.workerSources[$][K]){for(const we in this.workerSources[$][K]){const De=this.workerSources[$][K][we];for(const Ge in De)De[Ge].availableImages=he}ve()}else ve()}setProjection($,K){this.projections[$]=o.aJ(K)}setBrightness($,K,he){this.brightness=K,he()}setLayers($,K,he){this.getLayerIndex($,K.scope).replace(K.layers,K.options),he()}updateLayers($,K,he){this.getLayerIndex($,K.scope).update(K.layers,K.removedIds,K.options),he()}loadTile($,K,he){K.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,K.type,K.source,K.scope).loadTile(K,he)}loadDEMTile($,K,he){this.getDEMWorkerSource($,K.source,K.scope).loadTile(K,he)}decodeRasterArray($,K,he){this.getRasterArrayWorkerSource().decodeRasterArray(K,he)}reloadTile($,K,he){K.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,K.type,K.source,K.scope).reloadTile(K,he)}abortTile($,K,he){this.getWorkerSource($,K.type,K.source,K.scope).abortTile(K,he)}removeTile($,K,he){this.getWorkerSource($,K.type,K.source,K.scope).removeTile(K,he)}removeSource($,K,he){if(!(this.workerSources[$]&&this.workerSources[$][K.scope]&&this.workerSources[$][K.scope][K.type]&&this.workerSources[$][K.scope][K.type][K.source]))return;const ve=this.workerSources[$][K.scope][K.type][K.source];delete this.workerSources[$][K.scope][K.type][K.source],ve.removeSource!==void 0?ve.removeSource(K,he):he()}loadWorkerSource($,K,he){try{this.self.importScripts(K.url),he()}catch(ve){he(ve.toString())}}syncRTLPluginState($,K,he){try{o.e7.setState(K);const ve=o.e7.getPluginURL();if(o.e7.isLoaded()&&!o.e7.isParsed()&&ve!=null){this.self.importScripts(ve);const we=o.e7.isParsed();he(we?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),we)}}catch(ve){he(ve.toString())}}setDracoUrl($,K){this.dracoUrl=K}getAvailableImages($,K){this.availableImages[$]||(this.availableImages[$]={});let he=this.availableImages[$][K];return he||(he=[]),he}getLayerIndex($,K){this.layerIndexes[$]||(this.layerIndexes[$]={});let he=this.layerIndexes[$][K];return he||(he=this.layerIndexes[$][K]=new ae,he.scope=K),he}getWorkerSource($,K,he,ve){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][ve]||(this.workerSources[$][ve]={}),this.workerSources[$][ve][K]||(this.workerSources[$][ve][K]={}),this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.workerSources[$][ve][K][he]||(this.workerSources[$][ve][K][he]=new this.workerSourceTypes[K]({send:(we,De,Ge,Ie,We,gt)=>{this.actor.send(we,De,Ge,$,We,gt)},scheduler:this.actor.scheduler},this.getLayerIndex($,ve),this.getAvailableImages($,ve),this.isSpriteLoaded[$][ve],void 0,this.brightness)),this.workerSources[$][ve][K][he]}getDEMWorkerSource($,K,he){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][he]||(this.demWorkerSources[$][he]={}),this.demWorkerSources[$][he][K]||(this.demWorkerSources[$][he][K]=new Ee),this.demWorkerSources[$][he][K]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Me),this.rasterArrayWorkerSource}enforceCacheSizeLimit($,K){o.e8(K)}getWorkerPerformanceMetrics($,K,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Vu(self)),Vu}),P(["./shared"],function(o){function q(f,i){if(Array.isArray(f)){if(!Array.isArray(i)||f.length!==i.length)return!1;for(let u=0;u<f.length;u++)if(!q(f[u],i[u]))return!1;return!0}if(typeof f=="object"&&f!==null&&i!==null){if(typeof i!="object"||Object.keys(f).length!==Object.keys(i).length)return!1;for(const u in f)if(!q(f[u],i[u]))return!1;return!0}return f===i}var J=Q;function Q(f){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,x,v=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(v);try{x=new Worker(S),p=!0}catch{p=!1}return x&&x.terminate(),URL.revokeObjectURL(S),p}()?function(){var p=document.createElement("canvas");p.width=p.height=1;var x=p.getContext("2d");if(!x)return!1;var v=x.getImageData(0,0,1,1);return v&&v.width===p.width}()?(ae[u=i&&i.failIfMajorPerformanceCaveat]===void 0&&(ae[u]=function(p){var x,v=function(S){var C=document.createElement("canvas"),R=Object.create(Q.webGLContextAttributes);return R.failIfMajorPerformanceCaveat=S,C.getContext("webgl2",R)}(p);if(!v)return!1;try{x=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!x||v.isContextLost())&&(v.shaderSource(x,"void main() {}"),v.compileShader(x),v.getShaderParameter(x,v.COMPILE_STATUS)===!0)}(u)),ae[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var u}(f)}var ae={};function xe(f,i,u){const p=document.createElement(f);return i!=null&&(p.className=i),u&&u.appendChild(p),p}function Re(f,i,u){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(i))p.setAttributeNS(null,x,String(i[x]));return u&&u.appendChild(p),p}Q.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ue=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Tt=Ue&&Ue.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Te;function Ee(){Ue&&Tt&&(Te=Ue[Tt],Ue[Tt]="none")}function Me(){Ue&&Tt&&(Ue[Tt]=Te)}function et(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",et,!0)}function pt(){window.addEventListener("click",et,!0),window.setTimeout(()=>{window.removeEventListener("click",et,!0)},0)}function Ct(f,i){const u=f.getBoundingClientRect();return Zn(f,u,i)}function Ot(f,i){const u=f.getBoundingClientRect(),p=[];for(let x=0;x<i.length;x++)p.push(Zn(f,u,i[x]));return p}function zt(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Zn(f,i,u){const p=f.offsetWidth===i.width?1:f.offsetWidth/i.width;return new o.P((u.clientX-i.left)*p,(u.clientY-i.top)*p)}class wn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,u){this._updatedSourceCaches[i]=u,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const u=i.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(i.id),this.setDirty()}removeLayer(i){const u=i.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][i.id]=i,this._updatedLayers[u].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const u in this._updatedLayers)i[u]=i[u]||{},i[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)i[u]=i[u]||{},i[u].removedIds=Object.keys(this._removedLayers[u]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const xn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class rs{constructor(i,u,p,x,v,S){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=x,this.instanceCount=S,this.context=i;const C=i.gl;this.buffer=C.createBuffer(),i.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||v||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,u){for(let p=0;p<this.attributes.length;p++){const x=u.attributes[this.attributes[p].name];x!==void 0&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,u,p){for(let x=0;x<this.attributes.length;x++){const v=this.attributes[x],S=u.attributes[v.name];S!==void 0&&i.vertexAttribPointer(S,v.components,i[xn[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(i,u,p){for(let x=0;x<this.attributes.length;x++){const v=u.attributes[this.attributes[x].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(v,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class bn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xo extends bn{getDefault(){return o.C.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Jr extends bn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Pi extends bn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Cn extends bn{getDefault(){return[!0,!0,!0,!0]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Gt extends bn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class _n extends bn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class zn extends bn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const u=this.current;(i.func!==u.func||i.ref!==u.ref||i.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class lr extends bn{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Br extends bn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=i,this.dirty=!1}}class jn extends bn{getDefault(){return[0,1]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class ps extends bn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=i,this.dirty=!1}}class Fr extends bn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class is extends bn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.BLEND):u.disable(u.BLEND),this.current=i,this.dirty=!1}}class da extends bn{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ga extends bn{getDefault(){return o.C.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class en extends bn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class Lu extends bn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=i,this.dirty=!1}}class pr extends bn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Rl extends bn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Xc=class extends bn{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class ms extends bn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class fa extends bn{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Du extends bn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class wi extends bn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ks extends bn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Yc extends bn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Qt extends bn{getDefault(){return null}set(i){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Zt extends bn{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class ko extends bn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class ji extends bn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Ll extends bn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Oo extends bn{constructor(i,u){super(i),this.context=i,this.parent=u}getDefault(){return null}}class zu extends Oo{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class pa extends Oo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ls extends Oo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class ma extends pa{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Wa{constructor(i,u,p,x,v){this.context=i,this.width=u,this.height=p;const S=this.framebuffer=i.gl.createFramebuffer();x&&(this.colorAttachment=new zu(i,S)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new pa(i,S):new Ls(i,S))}destroy(){const i=this.context.gl;if(this.colorAttachment){const u=this.colorAttachment.get();u&&i.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&i.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&i.deleteTexture(u)}i.deleteFramebuffer(this.framebuffer)}}class Dl{constructor(i,u){this.gl=i,this.clearColor=new xo(this),this.clearDepth=new Jr(this),this.clearStencil=new Pi(this),this.colorMask=new Cn(this),this.depthMask=new Gt(this),this.stencilMask=new _n(this),this.stencilFunc=new zn(this),this.stencilOp=new lr(this),this.stencilTest=new Br(this),this.depthRange=new jn(this),this.depthTest=new ps(this),this.depthFunc=new Fr(this),this.blend=new is(this),this.blendFunc=new da(this),this.blendColor=new Ga(this),this.blendEquation=new en(this),this.cullFace=new Lu(this),this.cullFaceSide=new pr(this),this.frontFace=new Rl(this),this.program=new Xc(this),this.activeTexture=new ms(this),this.viewport=new fa(this),this.bindFramebuffer=new Du(this),this.bindRenderbuffer=new wi(this),this.bindTexture=new Ks(this),this.bindVertexBuffer=new Yc(this),this.bindElementBuffer=new Qt(this),this.bindVertexArrayOES=new Zt(this),this.pixelStoreUnpack=new ko(this),this.pixelStoreUnpackPremultiplyAlpha=new ji(this),this.pixelStoreUnpackFlipY=new Ll(this),this.options=u?{...u}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,u,p){return new o.I(this,i,u,p)}createVertexBuffer(i,u,p,x,v){return new rs(this,i,u,p,x,v)}createRenderbuffer(i,u,p){const x=this.gl,v=x.createRenderbuffer();return this.bindRenderbuffer.set(v),x.renderbufferStorage(x.RENDERBUFFER,i,u,p),this.bindRenderbuffer.set(null),v}createFramebuffer(i,u,p,x){return new Wa(this,i,u,p,x)}clear({color:i,depth:u,stencil:p,colorMask:x}){const v=this.gl;let S=0;i&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(x||[!0,!0,!0,!0])),u!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),p!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),v.clear(S)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){q(i.blendFunction,o.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class $a{constructor(i){this._gl=i.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){const i=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,i}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class qa{constructor(i){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,i.registerParameter(this,["Symbols"],"useOcclusionQueries"),i.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),i.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),i.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),i.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class _s{constructor(i,u,p,x){const v={width:p[0],height:p[1],data:null},S=i.gl;this.targetColorTexture=new o.T(i,v,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new o.T(i,v,S.RGBA,{useMipmap:!1}),this.context=i,this.updateParticleTexture(u,x),this.lastInvalidatedAt=0}updateParticleTexture(i,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=u.width*u.height;this.particleTexture0=new o.T(this.context,u,p.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,u,p.RGBA,{premultiply:!1,useMipmap:!1});const v=new o.S;v.reserve(x);for(let S=0;S<x;S++)v.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(v,o.p.members,!0),this.particleSegment=o.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=o.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class ku extends o.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,u){return o.l(this.requestManager.transformRequest(u,o.R.Model).url).then(p=>{if(!p)return;const x=o.c(p),v=new o.M(i,void 0,void 0,x);return v.computeBoundsAndApplyParent(),v}).catch(p=>{if(p&&p.status===404)return null;this.fire(new o.d(new Error(`Could not load model ${i} from ${u}: ${p.message}`)))})}load(i,u){this.models[u]||(this.models[u]={});const p=Object.keys(i);this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+p.length;const x=[];for(const v of p)x.push(this.loadModel(v,i[v]));Promise.allSettled(x).then(v=>{for(let S=0;S<v.length;S++){const{status:C,value:R}=v[S];C==="fulfilled"&&R&&(this.models[u][p[S]]={model:R,numReferences:1})}this.numModelsLoading[u]-=p.length,this.fire(new o.f("data",{dataType:"style"}))}).catch(v=>{this.fire(new o.d(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,u){return!!this.getModel(i,u)}getModel(i,u){return this.models[u]||(this.models[u]={}),this.models[u][i]?this.models[u][i].model:void 0}addModel(i,u,p){this.models[p]||(this.models[p]={}),this.hasModel(i,p)&&this.models[p][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(u)},p)}addModels(i,u){this.models[u]||(this.models[u]={});const p={};for(const x in i)this.models[u][x]={},p[x]=this.requestManager.normalizeModelURL(i[x]);this.load(p,u)}addModelsFromBucket(i,u){this.models[u]||(this.models[u]={});const p={};for(const x of i)this.hasModel(x,u)?this.models[u][x].numReferences++:p[x]=this.requestManager.normalizeModelURL(x);this.load(p,u)}removeModel(i,u){if(this.models[u]&&this.models[u][i]&&(this.models[u][i].numReferences--,this.models[u][i].numReferences===0)){const p=this.models[u][i].model;delete this.models[u][i],p.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,u){this.models[u]||(this.models[u]={});for(const p in this.models[u])this.models[u][p].model&&this.models[u][p].model.upload(i.context)}}function rn(f){const{userImage:i}=f;return!!(i&&i.render&&i.render())&&(f.data.replace(new Uint8Array(i.data.buffer)),!0)}class zl extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new o.i({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,u){if(this.loaded[u]!==i&&(this.loaded[u]=i,i)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,u,x);this.requestors=[]}}hasImage(i,u){return!!this.getImage(i,u)}getImage(i,u){return this.images[u][i]}addImage(i,u,p){this._validate(i,p)&&(this.images[u][i]=p)}_validate(i,u){let p=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new o.d(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new o.d(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new o.d(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,u){if(!i)return!0;let p=0;for(const x of i){if(x[0]<p||x[1]<x[0]||u<x[1])return!1;p=x[1]}return!0}_validateContent(i,u){return!(i&&(i.length!==4||i[0]<0||u.data.width<i[0]||i[1]<0||u.data.height<i[1]||i[2]<0||u.data.width<i[2]||i[3]<0||u.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,u,p){p.version=this.images[u][i].version+1,this.images[u][i]=p,this.updatedImages[u][i]=!0}removeImage(i,u){const p=this.images[u][i];delete this.images[u][i],delete this.patterns[u][i],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,u,p){let x=!0;const v=!!this.loaded[u];if(!v)for(const S of i)this.images[u][S]||(x=!1);v||x?this._notify(i,u,p):this.requestors.push({ids:i,scope:u,callback:p})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,u,p){const x={};for(const v of i){this.images[u][v]||this.fire(new o.f("styleimagemissing",{id:v}));const S=this.images[u][v];S?x[v]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:o.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,x)}getPixelSize(i){const{width:u,height:p}=this.atlasImage[i];return{width:u,height:p}}getPattern(i,u,p){const x=this.patterns[u][i],v=this.getImage(i,u);if(!v)return null;if(x&&x.position.version===v.version)return x.position;if(x)x.position.version=v.version;else{const S={w:v.data.width+2,h:v.data.height+2,x:0,y:0},C=new o.k(S,v);this.patterns[u][i]={bin:S,position:C}}return this._updatePatternAtlas(u,p),this.patterns[u][i].position}bind(i,u){const p=i.gl;let x=this.atlasTexture[u];x?this.dirty&&(x.update(this.atlasImage[u]),this.dirty=!1):(x=new o.T(i,this.atlasImage[u],p.RGBA),this.atlasTexture[u]=x),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(i,u){const p=[];for(const C in this.patterns[i])p.push(this.patterns[i][C].bin);const{w:x,h:v}=o.j(p),S=this.atlasImage[i];S.resize({width:x||1,height:v||1});for(const C in this.patterns[i]){const{bin:R}=this.patterns[i][C],L=R.x+1,O=R.y+1,F=this.images[i][C].data,U=F.width,j=F.height;o.i.copy(F,S,{x:0,y:0},{x:L,y:O},{width:U,height:j},u),o.i.copy(F,S,{x:0,y:j-1},{x:L,y:O-1},{width:U,height:1},u),o.i.copy(F,S,{x:0,y:0},{x:L,y:O+j},{width:U,height:1},u),o.i.copy(F,S,{x:U-1,y:0},{x:L-1,y:O},{width:1,height:j},u),o.i.copy(F,S,{x:0,y:0},{x:L+U,y:O},{width:1,height:j},u)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,u){for(const p of i){if(this.callbackDispatchedThisFrame[u][p])continue;this.callbackDispatchedThisFrame[u][p]=!0;const x=this.images[u][p];rn(x)&&this.updateImage(p,u,x)}}}function Nr(f){const i=f.key,u=f.value,p=f.valueSpec||{},x=f.objectElementValidators||{},v=f.style,S=f.styleSpec;let C=[];const R=o.n(u);if(R!=="object")return[new o.V(i,u,`object expected, ${R} found`)];for(const L in u){const O=L.split(".")[0];let F;x[O]?F=x[O]:p[O]?F=$:x["*"]?F=x["*"]:p["*"]&&(F=$),F?C=C.concat(F({key:(i&&`${i}.`)+L,value:u[L],valueSpec:p[O]||p["*"],style:v,styleSpec:S,object:u,objectKey:L},u)):C.push(new o.m(i,u[L],`unknown property "${L}"`))}for(const L in p)x[L]||p[L].required&&p[L].default===void 0&&u[L]===void 0&&C.push(new o.V(i,u,`missing required property "${L}"`));return C}function Ou(f){const i=f.value,u=f.valueSpec,p=f.style,x=f.styleSpec,v=f.key,S=f.arrayElementValidator||$;if(o.n(i)!=="array")return[new o.V(v,i,`array expected, ${o.n(i)} found`)];if(u.length&&i.length!==u.length)return[new o.V(v,i,`array length ${u.length} expected, length ${i.length} found`)];if(u["min-length"]&&i.length<u["min-length"])return[new o.V(v,i,`array length at least ${u["min-length"]} expected, length ${i.length} found`)];let C={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};x.$version<7&&(C.function=u.function),o.n(u.value)==="object"&&(C=u.value);let R=[];for(let L=0;L<i.length;L++)R=R.concat(S({array:i,arrayIndex:L,value:i[L],valueSpec:C,style:p,styleSpec:x,key:`${v}[${L}]`},!0));return R}function kl(f){const i=f.key,u=f.value,p=f.valueSpec;let x=o.n(u);if(x==="number"&&u!=u&&(x="NaN"),x!=="number")return[new o.V(i,u,`number expected, ${x} found`)];if("minimum"in p){let v=p.minimum;if(o.n(p.minimum)==="array"&&(v=p.minimum[f.arrayIndex]),u<v)return[new o.V(i,u,`${u} is less than the minimum value ${v}`)]}if("maximum"in p){let v=p.maximum;if(o.n(p.maximum)==="array"&&(v=p.maximum[f.arrayIndex]),u>v)return[new o.V(i,u,`${u} is greater than the maximum value ${v}`)]}return[]}function vo(f){const i=f.valueSpec,u=o.u(f.value.type);let p,x,v,S={};const C=u!=="categorical"&&f.value.property===void 0,R=!C,L=o.n(f.value.stops)==="array"&&o.n(f.value.stops[0])==="array"&&o.n(f.value.stops[0][0])==="object",O=Nr({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(j){if(u==="identity")return[new o.V(j.key,j.value,'identity function may not have a "stops" property')];let H=[];const Z=j.value;return H=H.concat(Ou({key:j.key,value:Z,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),o.n(Z)==="array"&&Z.length===0&&H.push(new o.V(j.key,Z,"array must have at least one stop")),H},default:function(j){return $({key:j.key,value:j.value,valueSpec:i,style:j.style,styleSpec:j.styleSpec})}}});return u==="identity"&&C&&O.push(new o.V(f.key,f.value,'missing required property "property"')),u==="identity"||f.value.stops||O.push(new o.V(f.key,f.value,'missing required property "stops"')),u==="exponential"&&f.valueSpec.expression&&!o.s(f.valueSpec)&&O.push(new o.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(R&&!o.q(f.valueSpec)?O.push(new o.V(f.key,f.value,"property functions not supported")):C&&!o.r(f.valueSpec)&&O.push(new o.V(f.key,f.value,"zoom functions not supported"))),u!=="categorical"&&!L||f.value.property!==void 0||O.push(new o.V(f.key,f.value,'"property" property is required')),O;function F(j){let H=[];const Z=j.value,X=j.key;if(o.n(Z)!=="array")return[new o.V(X,Z,`array expected, ${o.n(Z)} found`)];if(Z.length!==2)return[new o.V(X,Z,`array length 2 expected, length ${Z.length} found`)];if(L){if(o.n(Z[0])!=="object")return[new o.V(X,Z,`object expected, ${o.n(Z[0])} found`)];if(Z[0].zoom===void 0)return[new o.V(X,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new o.V(X,Z,"object stop key must have value")];const Y=o.u(Z[0].zoom);if(typeof Y!="number")return[new o.V(X,Z[0].zoom,"stop zoom values must be numbers")];if(v&&v>Y)return[new o.V(X,Z[0].zoom,"stop zoom values must appear in ascending order")];Y!==v&&(v=Y,x=void 0,S={}),H=H.concat(Nr({key:`${X}[0]`,value:Z[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:kl,value:U}}))}else H=H.concat(U({key:`${X}[0]`,value:Z[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},Z));return o.t(o.v(Z[1]))?H.concat([new o.V(`${X}[1]`,Z[1],"expressions are not allowed in function stops.")]):H.concat($({key:`${X}[1]`,value:Z[1],valueSpec:i,style:j.style,styleSpec:j.styleSpec}))}function U(j,H){const Z=o.n(j.value),X=o.u(j.value),Y=j.value!==null?j.value:H;if(p){if(Z!==p)return[new o.V(j.key,Y,`${Z} stop domain type must match previous stop domain type ${p}`)]}else p=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new o.V(j.key,Y,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&u!=="categorical"){let ie=`number expected, ${Z} found`;return o.q(i)&&u===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(j.key,Y,ie)]}return u!=="categorical"||Z!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?u!=="categorical"&&Z==="number"&&typeof X=="number"&&typeof x=="number"&&x!==void 0&&X<x?[new o.V(j.key,Y,"stop domain values must appear in ascending order")]:(x=X,u==="categorical"&&X in S?[new o.V(j.key,Y,"stop domain values must be unique")]:(S[X]=!0,[])):[new o.V(j.key,Y,`integer expected, found ${String(X)}`)]}}function wo(f){const i=(f.expressionContext==="property"?o.x:o.y)(o.v(f.value),f.valueSpec);if(i.result==="error")return i.value.map(p=>new o.V(`${f.key}${p.key}`,f.value,p.message));const u=i.value.expression||i.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!u.outputDefined())return[new o.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!o.z(u))return[new o.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Kc(u,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!o.A(u,["zoom","feature-state"]))return[new o.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!o.B(u))return[new o.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kc(f,i){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const x of i.valueSpec.expression.parameters)u.delete(x);if(u.size===0)return[];const p=[];return f instanceof o.D&&u.has(f.name)?[new o.V(i.key,i.value,`["${f.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(f.eachChild(x=>{p.push(...Kc(x,i))}),p)}function Ha(f){const i=f.key,u=f.value,p=f.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(o.u(u))===-1&&x.push(new o.V(i,u,`expected one of [${p.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(p.values).indexOf(o.u(u))===-1&&x.push(new o.V(i,u,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(u)} found`)),x}function Za(f){return o.G(o.v(f.value))?wo(o.o({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Bu(f)}function Bu(f){const i=f.value,u=f.key;if(o.n(i)!=="array")return[new o.V(u,i,`array expected, ${o.n(i)} found`)];const p=f.styleSpec;let x,v=[];if(i.length<1)return[new o.V(u,i,"filter array must have at least 1 element")];switch(v=v.concat(Ha({key:`${u}[0]`,value:i[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),o.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&o.u(i[1])==="$type"&&v.push(new o.V(u,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&v.push(new o.V(u,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(x=o.n(i[1]),x!=="string"&&v.push(new o.V(`${u}[1]`,i[1],`string expected, ${x} found`)));for(let S=2;S<i.length;S++)x=o.n(i[S]),o.u(i[1])==="$type"?v=v.concat(Ha({key:`${u}[${S}]`,value:i[S],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&v.push(new o.V(`${u}[${S}]`,i[S],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let S=1;S<i.length;S++)v=v.concat(Bu({key:`${u}[${S}]`,value:i[S],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=o.n(i[1]),i.length!==2?v.push(new o.V(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):x!=="string"&&v.push(new o.V(`${u}[1]`,i[1],`string expected, ${x} found`))}return v}function Ol(f,i){const u=f.key,p=f.style,x=f.layer,v=f.styleSpec,S=f.value,C=f.objectKey,R=v[`${i}_${f.layerType}`];if(!R)return[];const L=C.match(/^(.*)-transition$/);if(i==="paint"&&L&&R[L[1]]&&R[L[1]].transition)return $({key:u,value:S,valueSpec:v.transition,style:p,styleSpec:v});const O=f.valueSpec||R[C];if(!O)return[new o.m(u,S,`unknown property "${C}"`)];let F;if(o.n(S)==="string"&&o.q(O)&&!O.tokens&&(F=/^{([^}]+)}$/.exec(S))){const j=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new o.V(u,S,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}const U=[];if(f.layerType==="symbol")C!=="text-field"||!p||p.glyphs||p.imports||U.push(new o.V(u,S,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&o.H(o.v(S))&&o.u(S.type)==="identity"&&U.push(new o.V(u,S,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&i==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&o.q(O)&&(o.J(O)||o.r(O))){const j=o.x(o.v(S),O),H=j.value.expression||j.value._styleExpression.expression;H&&!o.A(H,["measure-light"])&&(C==="model-emissive-strength"&&o.B(H)&&o.z(H)||U.push(new o.V(u,S,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat($({key:f.key,value:S,valueSpec:O,style:p,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:C}))}function fd(f){return Ol(f,"paint")}function Fu(f){return Ol(f,"layout")}function Js(f){let i=[];const u=f.value,p=f.key,x=f.style,v=f.styleSpec;u.type||u.ref||i.push(new o.V(p,u,'either "type" or "ref" is required'));let S=o.u(u.type);const C=o.u(u.ref);if(u.id){const R=o.u(u.id);for(let L=0;L<f.arrayIndex;L++){const O=x.layers[L];o.u(O.id)===R&&i.push(new o.V(p,u.id,`duplicate layer id "${u.id}", previously used at line ${O.id.__line__}`))}}if("ref"in u){let R;["type","source","source-layer","filter","layout"].forEach(L=>{L in u&&i.push(new o.V(p,u[L],`"${L}" is prohibited for ref layers`))}),x.layers.forEach(L=>{o.u(L.id)===C&&(R=L)}),R?R.ref?i.push(new o.V(p,u.ref,"ref cannot reference another ref layer")):S=o.u(R.type):typeof C=="string"&&i.push(new o.V(p,u.ref,`ref layer "${C}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(u.source){const R=x.sources&&x.sources[u.source],L=R&&o.u(R.type);R?L==="vector"&&S==="raster"?i.push(new o.V(p,u.source,`layer "${u.id}" requires a raster source`)):L==="raster"&&S!=="raster"?i.push(new o.V(p,u.source,`layer "${u.id}" requires a vector source`)):L!=="vector"||u["source-layer"]?L==="raster-dem"&&S!=="hillshade"?i.push(new o.V(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||L==="geojson"&&R.lineMetrics?S==="raster-particle"&&L!=="raster-array"&&i.push(new o.V(p,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):i.push(new o.V(p,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new o.V(p,u.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new o.V(p,u,`layer "${u.id}" must specify a "source-layer"`)):i.push(new o.V(p,u.source,`source "${u.source}" not found`))}else i.push(new o.V(p,u,'missing required property "source"'));return i=i.concat(Nr({key:p,value:u,valueSpec:v.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$({key:`${p}.type`,value:u.type,valueSpec:v.layer.type,style:f.style,styleSpec:f.styleSpec,object:u,objectKey:"type"}),filter:R=>Za(o.o({layerType:S},R)),layout:R=>Nr({layer:u,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>Fu(o.o({layerType:S},L))}}),paint:R=>Nr({layer:u,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>fd(o.o({layerType:S,layer:u},L))}})}})),i}function Bo(f){const i=f.value,u=f.key,p=o.n(i);return p!=="string"?[new o.V(u,i,`string expected, ${p} found`)]:[]}const Qs={promoteId:function({key:f,value:i}){if(o.n(i)==="string")return Bo({key:f,value:i});{const u=[];for(const p in i)u.push(...Bo({key:`${f}.${p}`,value:i[p]}));return u}}};function fi(f){const i=f.value,u=f.key,p=f.styleSpec,x=f.style;if(!i.type)return[new o.V(u,i,'"type" is required')];const v=o.u(i.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(i.url||i.tiles||S.push(new o.m(u,i,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Nr({key:u,value:i,valueSpec:p[`source_${v.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Qs})),S;case"geojson":if(S=Nr({key:u,value:i,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:Qs}),i.cluster)for(const C in i.clusterProperties){const[R,L]=i.clusterProperties[C],O=typeof R=="string"?[R,["accumulated"],["get",C]]:R;S.push(...wo({key:`${u}.${C}.map`,value:L,expressionContext:"cluster-map"})),S.push(...wo({key:`${u}.${C}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return S;case"video":return Nr({key:u,value:i,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return Nr({key:u,value:i,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new o.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ha({key:`${u}.type`,value:i.type,valueSpec:{values:pd(p)},style:x,styleSpec:p})}}function pd(f){return f.source.reduce((i,u)=>{const p=f[u];return p.type.type==="enum"&&(i=i.concat(Object.keys(p.type.values))),i},[])}function Bl(f){const i=f.value,u=f.styleSpec,p=u.light,x=f.style;let v=[];const S=o.n(i);if(i===void 0)return v;if(S!=="object")return v=v.concat([new o.V("light",i,`object expected, ${S} found`)]),v;for(const C in i){const R=C.match(/^(.*)-transition$/);v=v.concat(R&&p[R[1]]&&p[R[1]].transition?$({key:C,value:i[C],valueSpec:u.transition,style:x,styleSpec:u}):p[C]?$({key:C,value:i[C],valueSpec:p[C],style:x,styleSpec:u}):[new o.V(C,i[C],`unknown property "${C}"`)])}return v}function Nu(f){const i=f.value;let u=[];if(!i)return u;const p=o.n(i);if(p!=="object")return u=u.concat([new o.V("light-3d",i,`object expected, ${p} found`)]),u;const x=f.styleSpec,v=x["light-3d"],S=f.key,C=f.style,R=f.style.lights;for(const F of["type","id"])if(!(F in i))return u=u.concat([new o.V("light-3d",i,`missing property ${F} on light`)]),u;if(i.type&&R)for(let F=0;F<f.arrayIndex;F++){const U=o.u(i.type),j=R[F];o.u(j.type)===U&&u.push(new o.V(S,i.id,`duplicate light type "${i.type}", previously defined at line ${j.id.__line__}`))}const L=`properties_light_${i.type}`;if(!(L in x))return u=u.concat([new o.V("light-3d",i,`Invalid light type ${i.type}`)]),u;const O=x[L];for(const F in i)if(F==="properties"){const U=i[F],j=o.n(U);if(j!=="object")return u=u.concat([new o.V("properties",U,`object expected, ${j} found`)]),u;for(const H in U)u=u.concat(O[H]?$({key:H,value:U[H],valueSpec:O[H],style:C,styleSpec:x}):[new o.m(f.key,U[H],`unknown property "${H}"`)])}else{const U=F.match(/^(.*)-transition$/);u=u.concat(U&&v[U[1]]&&v[U[1]].transition?$({key:F,value:i[F],valueSpec:x.transition,style:C,styleSpec:x}):v[F]?$({key:F,value:i[F],valueSpec:v[F],style:C,styleSpec:x}):[new o.m(F,i[F],`unknown property "${F}"`)])}return u}function Jc(f){const i=f.value,u=f.key,p=f.style,x=f.styleSpec,v=x.terrain;let S=[];const C=o.n(i);if(i===void 0||C==="null")return S;if(C!=="object")return S=S.concat([new o.V("terrain",i,`object expected, ${C} found`)]),S;for(const R in i){const L=R.match(/^(.*)-transition$/);S=S.concat(L&&v[L[1]]&&v[L[1]].transition?$({key:R,value:i[R],valueSpec:x.transition,style:p,styleSpec:x}):v[R]?$({key:R,value:i[R],valueSpec:v[R],style:p,styleSpec:x}):[new o.m(R,i[R],`unknown property "${R}"`)])}if(i.source){const R=p.sources&&p.sources[i.source],L=R&&o.u(R.type);R?L!=="raster-dem"&&S.push(new o.V(u,i.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):S.push(new o.V(u,i.source,`source "${i.source}" not found`))}else S.push(new o.V(u,i,'terrain is missing required property "source"'));return S}function Vu(f){const i=f.value,u=f.style,p=f.styleSpec,x=p.fog;let v=[];const S=o.n(i);if(i===void 0)return v;if(S!=="object")return v=v.concat([new o.V("fog",i,`object expected, ${S} found`)]),v;for(const C in i){const R=C.match(/^(.*)-transition$/);v=v.concat(R&&x[R[1]]&&x[R[1]].transition?$({key:C,value:i[C],valueSpec:p.transition,style:u,styleSpec:p}):x[C]?$({key:C,value:i[C],valueSpec:x[C],style:u,styleSpec:p}):[new o.m(C,i[C],`unknown property "${C}"`)])}return v}const Ce={"*":()=>[],array:Ou,boolean:function(f){const i=f.value,u=f.key,p=o.n(i);return p!=="boolean"?[new o.V(u,i,`boolean expected, ${p} found`)]:[]},number:kl,color:function(f){const i=f.key,u=f.value,p=o.n(u);return p!=="string"?[new o.V(i,u,`color expected, ${p} found`)]:o.F(u)===null?[new o.V(i,u,`color expected, "${u}" found`)]:[]},enum:Ha,filter:Za,function:vo,layer:Js,object:Nr,source:fi,model:o.K,light:Bl,"light-3d":Nu,terrain:Jc,fog:Vu,string:Bo,formatted:function(f){return Bo(f).length===0?[]:wo(f)},resolvedImage:function(f){return Bo(f).length===0?[]:wo(f)},projection:function(f){const i=f.value,u=f.styleSpec,p=u.projection,x=f.style;let v=[];const S=o.n(i);if(S==="object")for(const C in i)v=v.concat($({key:C,value:i[C],valueSpec:p[C],style:x,styleSpec:u}));else S!=="string"&&(v=v.concat([new o.V("projection",i,`object or string expected, ${S} found`)]));return v},import:function(f){const{value:i,styleSpec:u}=f,{data:p,...x}=i;Object.defineProperty(x,"__line__",{value:i.__line__,enumerable:!1});let v=Nr(o.o({},f,{value:x,valueSpec:u.import}));return o.u(x.id)===""&&v.push(new o.V(`${f.key}.id`,x,"import id can't be an empty string")),p&&(v=v.concat(he(p,u,{key:`${f.key}.data`}))),v}};function $(f,i=!1){const u=f.value,p=f.valueSpec,x=f.styleSpec;if(p.expression&&o.H(o.u(u)))return vo(f);if(p.expression&&o.t(o.v(u)))return wo(f);if(p.type&&Ce[p.type]){const v=Ce[p.type](f);return i===!0&&v.length>0&&o.n(f.value)==="array"?wo(f):v}return Nr(o.o({},f,{valueSpec:p.type?x[p.type]:p}))}function K(f){const i=f.value,u=f.key,p=Bo(f);return p.length||(i.indexOf("{fontstack}")===-1&&p.push(new o.V(u,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&p.push(new o.V(u,i,'"glyphs" url must include a "{range}" token'))),p}function he(f,i=o.L,u={}){return $({key:u.key||"",value:f,valueSpec:i.$root,styleSpec:i,style:f,objectElementValidators:{glyphs:K,"*":()=>[]}})}function ve(f,i=o.L){return Tn(he(f,i))}const we=f=>Tn(fi(f)),De=f=>Tn(Bl(f)),Ge=f=>Tn(Nu(f)),Ie=f=>Tn(Jc(f)),We=f=>Tn(Vu(f)),gt=f=>Tn(Js(f)),ft=f=>Tn(Za(f)),Ft=f=>Tn(fd(f)),Yt=f=>Tn(Fu(f)),gn=f=>Tn(o.K(f));function Tn(f){return f.slice().sort((i,u)=>i.line&&u.line?i.line-u.line:0)}function un(f,i){let u=!1;if(i&&i.length)for(const p of i)p instanceof o.m?o.w(p.message):(f.fire(new o.d(new Error(p.message))),u=!0);return u}const Rn=new o.N({anchor:new o.O(o.L.light.anchor),position:new o.Q(o.L.light.position),color:new o.O(o.L.light.color),intensity:new o.O(o.L.light.intensity)});class Bt extends o.E{constructor(i,u="flat"){super(),this._transitionable=new o.U(Rn),this.setLight(i,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,u,p={}){this._validate(De,i,p)||(this._transitionable.setTransitionOrValue(i),this.id=u)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,p){return(!p||p.validate!==!1)&&un(this,i.call(ve,o.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.L})))}}const Ar=new o.N({source:new o.O(o.L.terrain.source),exaggeration:new o.O(o.L.terrain.exaggeration)});let rr=class extends o.E{constructor(f,i,u,p){super(),this.scope=u,this._transitionable=new o.U(Ar,u,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(f,i){this._transitionable.setTransitionOrValue(f,i)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new o.X(f)).get("exaggeration")}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof o.Z}};const Fn=45,Zr=65,br=.05;function Qr(f,i,u,p){const x=o.$(Fn,Zr,u),[v,S]=Ri(f,p);let C=1-Math.min(1,Math.exp((i-v)/(S-v)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*x*f.alpha}function Ri(f,i){const u=.5/Math.tan(.5*i);return[f.range[0]+u,f.range[1]+u]}function bi(f,i,u,p,x){const v=o._.transformMat4([],[i,u,p],x.mercatorFogMatrix);return Qr(f,o._.length(v),x.pitch,x._fov)}function Fl(f,i,u,p,x,v,S){const C=[[u,p,0],[x,p,0],[x,v,0],[u,v,0]];let R=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const O of C){const F=o._.transformMat4([],O,i),U=o._.length(F);R=Math.min(R,U),L=Math.max(L,U)}return[Qr(f,R,S.pitch,S._fov),Qr(f,L,S.pitch,S._fov)]}const md=new o.N({range:new o.O(o.L.fog.range),color:new o.O(o.L.fog.color),"high-color":new o.O(o.L.fog["high-color"]),"space-color":new o.O(o.L.fog["space-color"]),"horizon-blend":new o.O(o.L.fog["horizon-blend"]),"star-intensity":new o.O(o.L.fog["star-intensity"]),"vertical-range":new o.O(o.L.fog["vertical-range"])});class Qc extends o.E{constructor(i,u,p,x){super(),this._transitionable=new o.U(md,p,new Map(x)),this.set(i,x),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new o.a0(md),this.scope=p}get state(){const i=this._transform,u=i.projection.name==="globe",p=o.a1(i.zoom),x=this.properties.get("range"),v=[.5,3];return{range:u?[o.a2(v[0],x[0],p),o.a2(v[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,u,p={}){if(this._validate(We,i,p))return;const x=o.W({},i);for(const v of Object.keys(o.L.fog))x[v]===void 0&&(x[v]=o.L.fog[v].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.$(Fn,Zr,i))*u.a}getOpacityAtLatLng(i,u){return this._transform.projection.supportsFog?function(p,x,v){const S=o.Y.fromLngLat(x),C=v.elevation?v.elevation.getAtPointOrZero(S):0;return bi(p,S.x,S.y,C,v)}(this.state,i,u):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(i.toUnwrapped());return Fl(this.state,u,0,0,o.a3,o.a3,this._transform)}getOpacityForBounds(i,u,p,x,v){return this._transform.projection.supportsFog?Fl(this.state,i,u,p,x,v,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Ri(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const p of u){const x=i.points[p];let v;if(x[2]>=0)v=x;else{const S=i.points[p-4];v=o.a4(S,x,S[2]/(S[2]-x[2]))}if(bi(this.state,v[0],v[1],0,this._transform)>=br)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,p){return(!p||p.validate!==!1)&&un(this,i.call(ve,o.W({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.L})))}}class Uu extends o.E{constructor(i,u,p,x){super(),this.scope=p,this._options=i,this.properties=new o.a0(u),this._transitionable=new o.U(u,p,new Map(x)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,u){this._options=i,this._transitionable.setTransitionOrValue(i.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const fn=new o.N({color:new o.O(o.L.properties_light_ambient.color),intensity:new o.O(o.L.properties_light_ambient.intensity)}),_d=new o.N({direction:new o.a5(o.L.properties_light_directional.direction),color:new o.O(o.L.properties_light_directional.color),intensity:new o.O(o.L.properties_light_directional.intensity),"cast-shadows":new o.O(o.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.O(o.L.properties_light_directional["shadow-intensity"])});var _a=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,eh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,tp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,gd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",th=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,nh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Xa=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,yd=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,xd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,np=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,rp=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Nl=[];Vl(_a,Nl),Vl(tp,Nl),Vl(eh,Nl);const rh={"_prelude_fog.vertex.glsl":nh,"_prelude_terrain.vertex.glsl":th,"_prelude_shadow.vertex.glsl":np,"_prelude_fog.fragment.glsl":Xa,"_prelude_shadow.fragment.glsl":rp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":yd,"_prelude_raster_particle.glsl":xd},ih={};Ln("",th),Ln(Xa,nh),Ln(rp,np),Ln(yd,""),Ln(xd,"");const km=Ln(eh,tp),Om=_a;var Bm={background:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ln("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ln(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ln("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ln("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ln(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ln(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ln(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ln("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ln("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ln(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Ln(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:Ln(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Ln(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ln("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ln(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,gd),skyboxGradient:Ln(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,gd),skyboxCapture:Ln(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ln(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#else
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ln(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Ln("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Vl(f,i){const u=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of u)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=p.split(" ");for(const v of x)i.includes(v)||i.push(v)}}function Ln(f,i){const u=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(L=>{const O=L.split(" ");return O[O.length-1]}),x=[...new Set(x)]);const v={},S=[],C=[];if(f=f.replace(u,(L,O)=>(C.push(O),"")),(i=i.replace(u,(L,O)=>(S.push(O),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let R=[...Nl];Vl(f,R),Vl(i,R);for(const L of[...S,...C])rh[L]||console.error(`Undefined include: ${L}`),ih[L]||(ih[L]=[],Vl(rh[L],ih[L])),R=[...R,...ih[L]];return{fragmentSource:f=f.replace(p,(L,O,F,U,j)=>(v[j]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${F} ${U} ${j};
#else
uniform ${F} ${U} u_${j};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${F} ${U} ${j} = u_${j};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${U} ${j};
#endif
`:O==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(p,(L,O,F,U,j)=>{const H=U==="float"?"vec2":U,Z=j.match(/color/)?"color":H;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${F} ${U} a_${j};
#endif
`:v[j]?O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${H} a_${j};
out ${F} ${U} ${j};
#else
uniform ${F} ${U} u_${j};
#endif
`:O==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${F} ${U} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${Z}(a_${j}, u_${j}_t);
#else
    ${F} ${U} ${j} = u_${j};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${U} a_${j};
    out ${F} ${U} ${j};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${H} a_${j};
#else
uniform ${F} ${U} u_${j};
#endif
`:O==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${F} ${U} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${H} a_${j};
#else
uniform ${F} ${U} u_${j};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${F} ${U} ${j} = a_${j};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${U} ${j} = a_${j};
#else
    ${F} ${U} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${U} ${j} = unpack_mix_${Z}(a_${j}, u_${j}_t);
#else
    ${F} ${U} ${j} = u_${j};
#endif
`}),staticAttributes:x,usedDefines:R,vertexIncludes:S,fragmentIncludes:C}}class Eg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,u,p,x,v,S,C,R){this.context=i;let L=this.boundPaintVertexBuffers.length!==x.length;for(let F=0;!L&&F<x.length;F++)this.boundPaintVertexBuffers[F]!==x[F]&&(L=!0);let O=this.boundDynamicVertexBuffers.length!==C.length;for(let F=0;!O&&F<C.length;F++)this.boundDynamicVertexBuffers[F]!==C[F]&&(O=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==p||L||O||this.boundIndexBuffer!==v||this.boundVertexOffset!==S)this.freshBind(u,p,x,v,S,C,R);else{i.bindVertexArrayOES.set(this.vao);for(const F of C)F&&(F.bind(),R&&F.instanceCount&&F.setVertexAttribDivisor(i.gl,u,R));v&&v.dynamicDraw&&v.bind()}}freshBind(i,u,p,x,v,S,C){const R=i.numAttributes,L=this.context,O=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=S,u.enableAttributes(O,i),u.bind(),u.setVertexAttribPointers(O,i,v);for(const F of p)F.enableAttributes(O,i),F.bind(),F.setVertexAttribPointers(O,i,v);for(const F of S)F&&(F.enableAttributes(O,i),F.bind(),F.setVertexAttribPointers(O,i,v),C&&F.instanceCount&&F.setVertexAttribDivisor(O,i,C));x&&x.bind(),L.currentNumAttributes=R}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Cg(f,i){const u=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new o.Y(0,p/u).toLngLat().lat,new o.Y(0,(p+1)/u).toLngLat().lat]}function Ag(f,i,u,p,x,v,S){const C=f.context,R=C.gl,L=u.hillshadeFBO;if(!L)return;f.prepareDrawTile();const O=f.isTileAffectedByFog(i),F=f.getOrCreateProgram("hillshade",{overrideFog:O});C.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,L.colorAttachment.get());const U=((X,Y,ie,oe)=>{const ue=ie.paint.get("hillshade-shadow-color"),ge=ie.paint.get("hillshade-highlight-color"),_e=ie.paint.get("hillshade-accent-color"),se=ie.paint.get("hillshade-emissive-strength");let le=o.ab(ie.paint.get("hillshade-illumination-direction"));if(ie.paint.get("hillshade-illumination-anchor")==="viewport")le-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){const Se=X.style.directionalLight.properties.get("direction"),Oe=o.ac(Se.x,Se.y,Se.z);le=o.ab(Oe[1])}const ce=!X.options.moving;return{u_matrix:oe||X.transform.calculateProjMatrix(Y.tileID.toUnwrapped(),ce),u_image:0,u_latrange:Cg(0,Y.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),le],u_shadow:ue.toRenderColor(ie.lut),u_highlight:ge.toRenderColor(ie.lut),u_emissive_strength:se,u_accent:_e.toRenderColor(ie.lut)}})(f,u,p,f.terrain?i.projMatrix:null);f.uploadCommonUniforms(C,F,i.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:H,tileBoundsSegments:Z}=f.getTileBoundsBuffers(u);F.draw(f,R.TRIANGLES,x,v,S,o.af.disabled,U,p.id,j,H,Z)}function sh(f,i,u){if(!i.needsDEMTextureUpload)return;const p=f.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||f.getTileTexture(u.stride);const v=u.getPixels();i.demTexture?i.demTexture.update(v,{premultiply:!1}):i.demTexture=new o.T(p,v,x.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Fo(f,i,u){const p=f.context,x=p.gl;if(!i.dem)return;const v=i.dem;if(p.activeTexture.set(x.TEXTURE1),sh(f,i,v),!i.demTexture)return;i.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const S=v.dim;p.activeTexture.set(x.TEXTURE0);let C=i.hillshadeFBO;if(!C){const U=new o.T(p,{width:S,height:S,data:null},x.RGBA);U.bind(x.LINEAR,x.CLAMP_TO_EDGE),C=i.hillshadeFBO=p.createFramebuffer(S,S,!0,"renderbuffer"),C.colorAttachment.set(U.texture)}p.bindFramebuffer.set(C.framebuffer),p.viewport.set([0,0,S,S]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:L,tileBoundsSegments:O}=f.getMercatorTileBoundsBuffers(),F=[];f.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(f,x.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.unblended,o.af.disabled,((U,j)=>{const H=j.stride,Z=o.ad.create();return o.ad.ortho(Z,0,o.a3,-o.a3,0,0,1),o.ad.translate(Z,Z,[0,-o.a3,0]),{u_matrix:Z,u_image:1,u_dimension:[H,H],u_zoom:U.overscaledZ}})(i.tileID,v),u.id,R,L,O),i.needsHillshadePrepare=!1}function ip(f,i,u,p,x){const v=function(S,C){if(S)return x(S);if(C){if(f.url&&C.tiles&&f.tiles&&delete f.tiles,C.variants){if(!Array.isArray(C.variants))return x(new Error("variants must be an array"));for(const L of C.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return x(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){C=o.W(C,L);break}}}const R=o.ah(o.W(C,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(R.vectorLayers=C.vector_layers,R.vectorLayerIds=R.vectorLayers.map(L=>L.id)),C.raster_layers&&(R.rasterLayers=C.raster_layers,R.rasterLayerIds=R.rasterLayers.map(L=>L.id)),R.tiles=i.canonicalizeTileset(R,f.url),x(null,R)}};return f.url?o.g(i.transformRequest(i.normalizeSourceURL(f.url,null,u,p),o.R.Source),v):o.e.frame(()=>v(null,f))}class oh{constructor(i,u,p){this.bounds=o.ai.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const u=Math.pow(2,i.z),p=Math.floor(o.aj(this.bounds.getWest())*u),x=Math.floor(o.ak(this.bounds.getNorth())*u),v=Math.ceil(o.aj(this.bounds.getEast())*u),S=Math.ceil(o.ak(this.bounds.getSouth())*u);return i.x>=p&&i.x<v&&i.y>=x&&i.y<S}}class ah extends o.E{constructor(i,u,p,x){super(),this.id=i,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.W({type:"raster"},u),o.W(this,o.ah(u,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"})),this._tileJSONRequest=ip(this._options,this.map._requestManager,null,null,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new o.d(u)):p&&(o.W(this,p),p.bounds&&(this.tileBounds=new oh(p.bounds,this.minzoom,this.maxzoom)),o.an(p.tiles),this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))),i&&i(u)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=o.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return o.W({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,u){const p=o.e.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);i.request=o.h(this.map._requestManager.transformRequest(x,o.R.Tile),(v,S,C,R)=>(delete i.request,i.aborted?(i.state="unloaded",u(null)):v?(i.state="errored",u(v)):S?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:C,expires:R}),i.setTexture(S,this.map.painter),i.state="loaded",o.am(this.dispatcher),void u(null)):u(null)))}abortTile(i,u){i.request&&(i.request.cancel(),delete i.request),u&&u()}unloadTile(i,u){i.texture&&i.texture instanceof o.T?(i.destroy(!0),i.texture&&i.texture instanceof o.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class vd extends o.E{constructor(i,u,p,x){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.W(this,o.ah(u,["url","scheme","tileSize","promoteId"])),this._options=o.W({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new o.ao}load(i){this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=ip(this._options,this.map._requestManager,u,p,(x,v)=>{this._tileJSONRequest=null,this._loaded=!0,x?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new o.d(x))):v&&(o.W(this,v),v.bounds&&(this.tileBounds=new oh(v.bounds,this.minzoom,this.maxzoom)),o.an(v.tiles,this.map._requestManager._customAccessToken),this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))),i&&i(x)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=o.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return o.W({},this._options)}loadTile(i,u){const p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),x=this.map._requestManager.transformRequest(p,o.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,S={request:x,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,lut:v?{image:v.image.clone()}:null,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=u:i.request=i.actor.send("reloadTile",S,C.bind(this));else if(i.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",S,C.bind(this),void 0,!0);else{const R=o.ap.call({deduped:this._deduped},S,(L,O)=>{L||!O?C.call(this,L):(S.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},i.actor&&i.actor.send("loadTile",S,C.bind(this),void 0,!0))},!0);i.request={cancel:R}}function C(R,L){return delete i.request,i.aborted?u(null):R&&R.status!==404?u(R):(L&&L.resourceTiming&&(i.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&i.setExpiryData(L),i.loadVectorData(L,this.map.painter),o.am(this.dispatcher),u(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,u){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const yr=f=>({u_matrix:new o.a6(f),u_image0:new o.a7(f),u_skirt_height:new o.aa(f),u_ground_shadow_factor:new o.aq(f)}),lt=(f,i,u)=>({u_matrix:f,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:u}),Fm=(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:u,u_zoom_transition:x,u_merc_center:v,u_image0:0,u_frustum_tl:S,u_frustum_tr:C,u_frustum_br:R,u_frustum_bl:L,u_globe_pos:O,u_globe_radius:F,u_viewport:U,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:H});class lh{constructor(i=0,u=0,p=0,x=0){if(isNaN(i)||i<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=p,this.right=x}interpolate(i,u,p){return u.top!=null&&i.top!=null&&(this.top=o.a2(i.top,u.top,p)),u.bottom!=null&&i.bottom!=null&&(this.bottom=o.a2(i.bottom,u.bottom,p)),u.left!=null&&i.left!=null&&(this.left=o.a2(i.left,u.left,p)),u.right!=null&&i.right!=null&&(this.right=o.a2(i.right,u.right,p)),this}getCenter(i,u){const p=o.at((this.left+i-this.right)/2,0,i),x=o.at((this.top+u-this.bottom)/2,0,u);return new o.P(p,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new lh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function kn(f,i){const u=o.aw(f,3);o.ad.fromQuat(f,i),o.az(f,3,u)}function Gi(f,i){const u=o.av.identity([]);return o.av.rotateZ(u,u,-i),o.av.rotateX(u,u,-f),u}function Nm(f,i){const u=[f[0],f[1],0],p=[i[0],i[1],0];if(o._.length(u)>=1e-15){const S=o._.normalize([],u);o._.scale(p,S,o._.dot(p,S)),i[0]=p[0],i[1]=p[1]}const x=o._.cross([],i,f);if(o._.len(x)<1e-15)return null;const v=Math.atan2(-x[1],x[0]);return Gi(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}class sp{constructor(i,u){this.position=i,this.orientation=u}get position(){return this._position}set position(i){if(i){const u=i instanceof o.Y?i:new o.Y(i[0],i[1],i[2]);this._renderWorldCopies&&(u.x=o.au(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(i,u){if(this.orientation=null,!this.position)return;const p=this.position,x=this._elevation?this._elevation.getAtPointOrZero(o.Y.fromLngLat(i)):0,v=o.Y.fromLngLat(i,x),S=[v.x-p.x,v.y-p.y,v.z-p.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Nm(S,u)}setPitchBearing(i,u){this.orientation=Gi(o.ab(i),o.ab(-u))}}class ju{constructor(i,u){this._transform=o.ad.identity([]),this.orientation=u,this.position=i}get mercatorPosition(){const i=this.position;return new o.Y(i[0],i[1],i[2])}get position(){const i=o.aw(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var u;i&&o.az(this._transform,3,[(u=i)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||o.av.identity([]),i&&kn(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,u){this._orientation=Gi(i,u),kn(this._transform,this._orientation)}forward(){const i=o.aw(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=o.aw(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=o.aw(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,u){const p=new Float64Array(16);return o.ad.invert(p,this.getWorldToCamera(i,u)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,u,p){const x=this.position;o._.scale(x,x,-i);const v=new Float64Array(16);return o.ad.fromScaling(v,[p,p,p]),o.ad.translate(v,v,x),v[10]*=u,v}getWorldToCamera(i,u){const p=new Float64Array(16),x=new Float64Array(4),v=this.position;return o.av.conjugate(x,this._orientation),o._.scale(v,v,-i),o.ad.fromQuat(p,x),o.ad.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=u,p[9]*=u,p[10]*=u,p[11]*=u,p}getCameraToClipPerspective(i,u,p,x){const v=new Float64Array(16);return o.ad.perspective(v,i,u,p,x),v}getCameraToClipOrthographic(i,u,p,x,v,S){const C=new Float64Array(16);return o.ad.ortho(C,i,u,p,x,v,S),C}getDistanceToElevation(i,u=!1){const p=i===0?0:o.ax(i,u?o.ay(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new ju([...this.position],[...this.orientation])}}const Gu={unknown:0,flipRequired:1,flipNotRequired:2},Xt=Math.tan(85*Math.PI/180);function ga(f,i,u,p,x,v,S){const C=o.ad.create();if(u)if(v.name==="globe"){const R=o.aB(x,i);o.ad.multiply(C,C,R)}else{const R=o.aC.invert([],S);C[0]=R[0],C[1]=R[1],C[4]=R[2],C[5]=R[3],p||o.ad.rotateZ(C,C,x.angle)}else o.ad.multiply(C,x.labelPlaneMatrix,f);return C}function Ds(f,i,u,p,x,v,S){const C=ga(f,i,u,p,x,v,S);return v.name==="globe"&&u||(C[2]=C[6]=C[10]=C[14]=0),C}function Ul(f,i,u,p,x,v,S){if(u){if(v.name==="globe"){const C=ga(f,i,u,p,x,v,S);return o.ad.invert(C,C),o.ad.multiply(C,f,C),C}{const C=o.ad.clone(f),R=o.ad.identity([]);return R[0]=S[0],R[1]=S[1],R[4]=S[2],R[5]=S[3],o.ad.multiply(C,C,R),p||o.ad.rotateZ(C,C,-x.angle),C}}return x.glCoordMatrix}function gs(f,i,u,p){const x=[f,i,u,1];u?o.aA.transformMat4(x,x,p):No(x,x,p);const v=x[3];return x[0]/=v,x[1]/=v,x[2]/=v,x}function Rr(f,i){return Math.min(.5+f/i*.5,1.5)}function Vm(f,i){const u=f[0]/f[3],p=f[1]/f[3];return u>=-i[0]&&u<=i[0]&&p>=-i[1]&&p<=i[1]}function uh(f,i,u,p,x,v,S,C,R,L){const O=u.transform,F=p?f.textSizeData:f.iconSizeData,U=o.aD(F,u.transform.zoom),j=O.projection.name==="globe",H=[256/u.width*2+1,256/u.height*2+1],Z=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Z.clear();let X=null;j&&(X=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const Y=f.lineVertexArray,ie=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,oe=u.transform.width/u.transform.height;let ue,ge=!1;for(let _e=0;_e<ie.length;_e++){const se=ie.get(_e),{numGlyphs:le,writingMode:ce}=se;if(ce!==o.aE.vertical||ge||ue===o.aE.horizontal||(ge=!0),ue=ce,(se.hidden||ce===o.aE.vertical)&&!ge){Li(le,Z);continue}ge=!1;const Se=new o.P(se.tileAnchorX,se.tileAnchorY);let{x:Oe,y:pe,z:Be}=O.projection.projectTilePoint(Se.x,Se.y,L.canonical);if(R){const[Pt,Et,ot]=R(Se);Oe+=Pt,pe+=Et,Be+=ot}const Fe=[Oe,pe,Be,1];if(o.aA.transformMat4(Fe,Fe,i),!Vm(Fe,H)){Li(le,Z);continue}const tt=Fe[3],rt=Rr(u.transform.getCameraToCenterDistance(O.projection),tt),Qe=o.aF(F,U,se),Pe=S?Qe/rt:Qe*rt,je=gs(Oe,pe,Be,x);if(je[3]<=0){Li(le,Z);continue}let Ke={};const bt=S?null:R,St=bd(se,Pe,!1,C,i,x,v,f.glyphOffsetArray,Y,Z,X,je,Se,Ke,oe,bt,O.projection,L,S);ge=St.useVertical,bt&&St.needsFlipping&&(Ke={}),(St.notEnoughRoom||ge||St.needsFlipping&&bd(se,Pe,!0,C,i,x,v,f.glyphOffsetArray,Y,Z,X,je,Se,Ke,oe,bt,O.projection,L,S).notEnoughRoom)&&Li(le,Z)}p?(f.text.dynamicLayoutVertexBuffer.updateData(Z),X&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(X)):(f.icon.dynamicLayoutVertexBuffer.updateData(Z),X&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(X))}function ch(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z){const{lineStartIndex:X,glyphStartIndex:Y,segment:ie}=C,oe=Y+C.numGlyphs,ue=X+C.lineLength,ge=i.getoffsetX(Y),_e=i.getoffsetX(oe-1),se=Wu(f*ge,u,p,x,v,S,ie,X,ue,R,L,O,F,U,!0,j,H,Z);if(!se)return null;const le=Wu(f*_e,u,p,x,v,S,ie,X,ue,R,L,O,F,U,!0,j,H,Z);return le?{first:se,last:le}:null}function wd(f,i,u,p){return f===o.aE.horizontal&&Math.abs(p)>Math.abs(u)?{useVertical:!0}:f===o.aE.vertical?p>0?{needsFlipping:!0}:null:i!==Gu.unknown&&function(x,v){return x===0||Math.abs(v/x)>Xt}(u,p)?i===Gu.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function bd(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z,X,Y,ie){const oe=i/24,ue=f.lineOffsetX*oe,ge=f.lineOffsetY*oe,{lineStartIndex:_e,glyphStartIndex:se,numGlyphs:le,segment:ce,writingMode:Se,flipState:Oe}=f,pe=_e+f.lineLength,Be=Fe=>{if(O){const[Pe,je,Ke]=Fe.up,bt=L.length;o.aG(O,bt+0,Pe,je,Ke),o.aG(O,bt+1,Pe,je,Ke),o.aG(O,bt+2,Pe,je,Ke),o.aG(O,bt+3,Pe,je,Ke)}const[tt,rt,Qe]=Fe.point;o.aH(L,tt,rt,Qe,Fe.angle)};if(le>1){const Fe=ch(oe,C,ue,ge,u,F,U,f,R,v,j,Z,!1,X,Y,ie);if(!Fe)return{notEnoughRoom:!0};if(p&&!u){let[tt,rt,Qe]=Fe.first.point,[Pe,je,Ke]=Fe.last.point;[tt,rt]=gs(tt,rt,Qe,S),[Pe,je]=gs(Pe,je,Ke,S);const bt=wd(Se,Oe,(Pe-tt)*H,je-rt);if(f.flipState=bt&&bt.needsFlipping?Gu.flipRequired:Gu.flipNotRequired,bt)return bt}Be(Fe.first);for(let tt=se+1;tt<se+le-1;tt++){const rt=Wu(oe*C.getoffsetX(tt),ue,ge,u,F,U,ce,_e,pe,R,v,j,Z,!1,!1,X,Y,ie);if(!rt)return L.length-=4*(tt-se),{notEnoughRoom:!0};Be(rt)}Be(Fe.last)}else{if(p&&!u){const tt=gs(U.x,U.y,0,x),rt=_e+ce+1,Qe=new o.P(R.getx(rt),R.gety(rt)),Pe=gs(Qe.x,Qe.y,0,x),je=Pe[3]>0?Pe:Wi(U,Qe,tt,1,x,void 0,X,Y.canonical),Ke=wd(Se,Oe,(je[0]-tt[0])*H,je[1]-tt[1]);if(f.flipState=Ke&&Ke.needsFlipping?Gu.flipRequired:Gu.flipNotRequired,Ke)return Ke}const Fe=Wu(oe*C.getoffsetX(se),ue,ge,u,F,U,ce,_e,pe,R,v,j,Z,!1,!1,X,Y,ie);if(!Fe)return{notEnoughRoom:!0};Be(Fe)}return{}}function hh(f,i,u,p,x){const{x:v,y:S,z:C}=p.projectTilePoint(f.x,f.y,i);if(!x)return gs(v,S,C,u);const[R,L,O]=x(f);return gs(v+R,S+L,C+O,u)}function Wi(f,i,u,p,x,v,S,C){const R=hh(f.sub(i)._unit()._add(f),C,x,S,v);return o._.sub(R,u,R),o._.normalize(R,R),o._.scaleAndAdd(R,u,R,p)}function Wu(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z,X,Y){const ie=p?f-i:f+i;let oe=ie>0?1:-1,ue=0;p&&(oe*=-1,ue=Math.PI),oe<0&&(ue+=Math.PI);let ge=C+S+(oe>0?0:1)|0,_e=x,se=x,le=0,ce=0;const Se=Math.abs(ie),Oe=[],pe=[];let Be=v,Fe=Be;const tt=()=>Wi(Fe,Be,se,Se-le+1,O,U,Z,X.canonical);for(;le+ce<=Se;){if(ge+=oe,ge<C||ge>=R)return null;if(se=_e,Fe=Be,Oe.push(se),j&&pe.push(Fe),Be=new o.P(L.getx(ge),L.gety(ge)),_e=F[ge],!_e){const Et=hh(Be,X.canonical,O,Z,U);_e=Et[3]>0?F[ge]=Et:tt()}le+=ce,ce=o._.distance(se,_e)}H&&U&&(F[ge]&&(_e=tt(),ce=o._.distance(se,_e)),F[ge]=_e);const rt=(Se-le)/ce,Qe=Be.sub(Fe)._mult(rt)._add(Fe),Pe=o._.sub([],_e,se),je=o._.scaleAndAdd([],se,Pe,rt);let Ke=[0,0,1],bt=Pe[0],St=Pe[1];if(Y&&(Ke=Z.upVector(X.canonical,Qe.x,Qe.y),Ke[0]!==0||Ke[1]!==0||Ke[2]!==1)){const Et=[Ke[2],0,-Ke[0]],ot=o._.cross([],Ke,Et);o._.normalize(Et,Et),o._.normalize(ot,ot),bt=o._.dot(Pe,Et),St=o._.dot(Pe,ot)}if(u){const Et=o._.cross([],Ke,Pe);o._.normalize(Et,Et),o._.scaleAndAdd(je,je,Et,u*oe)}const Pt=ue+Math.atan2(St,bt);return Oe.push(je),j&&pe.push(Qe),{point:je,angle:Pt,path:Oe,tilePath:pe,up:Ke}}function Li(f,i){const u=i.length,p=u+4*f;i.resize(p),i.float32.fill(-1/0,4*u,4*p)}function No(f,i,u){const p=i[0],x=i[1];return f[0]=u[0]*p+u[4]*x+u[12],f[1]=u[1]*p+u[5]*x+u[13],f[3]=u[3]*p+u[7]*x+u[15],f}const Td=(f,i,u)=>(1-u)*f+u*i,xr=f=>f*f*f*f*f;class zs{constructor(i,u,p,x,v,S,C){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(S),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new o.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new lh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ju,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new zs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,u=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(i||p)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return o.ah(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=o.aJ(this.projectionOptions);const p=!q(u,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.aJ({name:"mercator"});const u=i!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.au(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const u=-i*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=o.aC.create(),o.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const u=o.at(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=o.ab(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,v=0;for(let S=0;S<u.length;S++){const C=new o.P(u[S][0]*this.width,p+u[S][1]*(this.height-p)),R=i.pointCoordinate(C);if(!R)continue;const L=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);x+=R[3]*L,v+=L}return v===0?NaN:x/v}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*u,x=this._mercatorZfromZoom(i),v=this._mercatorZfromZoom(this._maxZoom),S=Math.max(x-p,v);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let p;p=i.z<this._camera.position[2]?[u.x,u.y,u.z]:[i.x,i.y,i.z];const x=o._.length(o._.sub([],this._camera.position,p));return o.at(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let u=!1;if(i.orientation&&!o.av.exactEquals(i.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(i.orientation)),i.position){const p=[i.position.x,i.position.y,i.position.z];o._.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,u=new sp;return u.position=new o.Y(i[0],i[1],i[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(i){if(!o.av.length(i))return!1;o.av.normalize(i,i);const u=o._.transformQuat([],[0,0,-1],i),p=o._.transformQuat([],[0,-1,0],i);if(p[2]<0)return!1;const x=Nm(u,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const u=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=o.at(i[2],x/p,x/u),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,u,p){this._unmodified=!1,this._edgeInsets.interpolate(i,u,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(i){const u=[new o.aK(0,i)];if(this.renderWorldCopies){const p=this.pointCoordinate(new o.P(0,0)),x=this.pointCoordinate(new o.P(this.width,0)),v=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),C=Math.floor(Math.min(p.x,x.x,v.x,S.x)),R=Math.floor(Math.max(p.x,x.x,v.x,S.x)),L=1;for(let O=C-L;O<=R+L;O++)O!==0&&u.push(new o.aK(O,i))}return u}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(i,u,p){let x=[];if(u[0]===0&&u[1]===0)return x;for(const S of i){const C=S.canonical,R=S.overscaledZ,L=S.wrap,O=1<<C.z,F=C.x+1<O,U=C.x>0,j=C.y+1<O,H=C.y>0,Z=S.wrap-(U?0:1),X=S.wrap+(F?0:1),Y=U?C.x-1:O-1,ie=F?C.x+1:0;u[0]<0?(x.push(new o.aL(R,X,C.z,ie,C.y)),u[1]<0&&j&&(x.push(new o.aL(R,L,C.z,C.x,C.y+1)),x.push(new o.aL(R,X,C.z,ie,C.y+1))),u[1]>0&&H&&(x.push(new o.aL(R,L,C.z,C.x,C.y-1)),x.push(new o.aL(R,X,C.z,ie,C.y-1)))):u[0]>0?(x.push(new o.aL(R,Z,C.z,Y,C.y)),u[1]<0&&j&&(x.push(new o.aL(R,L,C.z,C.x,C.y+1)),x.push(new o.aL(R,Z,C.z,Y,C.y+1))),u[1]>0&&H&&(x.push(new o.aL(R,L,C.z,C.x,C.y-1)),x.push(new o.aL(R,Z,C.z,Y,C.y-1)))):u[1]<0&&j?x.push(new o.aL(R,L,C.z,C.x,C.y+1)):H&&x.push(new o.aL(R,L,C.z,C.x,C.y-1))}if(x.length>1){x.sort((R,L)=>R.overscaledZ-L.overscaledZ||R.wrap-L.wrap||R.canonical.z-L.canonical.z||R.canonical.x-L.canonical.x||R.canonical.y-L.canonical.y);let S=0,C=0;for(;C<x.length;)x[C].equals(x[S])?++C:x[++S]=x[C++];x.length=S+1}const v=[];for(const S of x)x.some(C=>S.isChildOf(C))||v.push(S);return x=v.filter(S=>!i.some(C=>!!(S.overscaledZ<p&&C.isChildOf(S))||S.equals(C)||S.isChildOf(C))),x}coveringTiles(i){let u=this.coveringZoomLevel(i);const p=u,x=this.elevation&&this.elevation.exaggeration(),v=x&&!i.isTerrainDEM,S=this.projection.name==="mercator";if(i.minzoom!==void 0&&u<i.minzoom)return[];i.maxzoom!==void 0&&u>i.maxzoom&&(u=i.maxzoom);const C=this.locationCoordinate(this.center),R=this.center.lat,L=1<<u,O=[L*C.x,L*C.y,0],F=this.projection.name==="globe",U=!F,j=o.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,U),H=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=L*o.ax(1,this.center.lat),X=this._camera.position[2]/o.ax(1,this.center.lat),Y=[L*H.x,L*H.y,X*(U?1:Z)],ie=F||x,oe=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),ue=this.isLODDisabled(!0)?u:0;let ge;if(this._elevation&&i.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){const Pe=this._elevation.getMinMaxForVisibleTiles();ge=Pe?Pe.max:this._centerAltitude}else ge=this._centerAltitude;const _e=i.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,se=this.projection.isReprojectedInTileSpace?o.aN(this):1,le=Pe=>{const Ke=new o.Y(Pe.x+25e-6,Pe.y,Pe.z),bt=new o.Y(Pe.x,Pe.y+25e-6,Pe.z),St=Pe.toLngLat(),Pt=Ke.toLngLat(),Et=bt.toLngLat(),ot=this.locationCoordinate(St),Ze=this.locationCoordinate(Pt),kt=this.locationCoordinate(Et),cn=Math.hypot(Ze.x-ot.x,Ze.y-ot.y),sn=Math.hypot(kt.x-ot.x,kt.y-ot.y);return Math.sqrt(cn*sn)*se/25e-6},ce=Pe=>{const je=ge,Ke=_e;return{aabb:o.aQ(this,L,0,0,0,Pe,Ke,je,this.projection),zoom:0,x:0,y:0,minZ:Ke,maxZ:je,wrap:Pe,fullyVisible:!1}},Se=[];let Oe=[];const pe=u,Be=i.reparseOverscaled?p:u,Fe=Pe=>Pe*Pe,tt=Fe((X-this._centerAltitude)*Z),rt=Pe=>{if(!this._elevation||!Pe.tileID||!S)return;const je=this._elevation.getMinMaxForTile(Pe.tileID),Ke=Pe.aabb;je?(Ke.min[2]=je.min,Ke.max[2]=je.max,Ke.center[2]=(Ke.min[2]+Ke.max[2])/2):(Pe.shouldSplit=Qe(Pe),Pe.shouldSplit||(Ke.min[2]=Ke.max[2]=Ke.center[2]=this._centerAltitude))},Qe=Pe=>{if(Pe.zoom<ue)return!0;if(Pe.zoom===pe)return!1;if(Pe.shouldSplit!=null)return Pe.shouldSplit;const je=Pe.aabb.distanceX(Y),Ke=Pe.aabb.distanceY(Y);let bt=tt,St=1;if(F){bt=Fe(Pe.aabb.distanceZ(Y));const ot=Math.pow(2,Pe.zoom),Ze=o.ay((Pe.y+1)/ot),kt=o.ay(Pe.y/ot),cn=Math.min(Math.max(R,Ze),kt),sn=o.b4(cn)/o.b4(R);if(St=cn===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,sn/this._mercatorScaleRatio),this.zoom<=o.b1&&Pe.zoom===pe-1&&sn>=.9)return!0}else if(v&&(bt=Fe(Pe.aabb.distanceZ(Y)*Z)),this.projection.isReprojectedInTileSpace&&p<=5){const ot=Math.pow(2,Pe.zoom),Ze=le(new o.Y((Pe.x+.5)/ot,(Pe.y+.5)/ot));St=Ze>.85?1:Ze}const Pt=je*je+Ke*Ke+bt,Et=Fe((1<<pe-Pe.zoom)*oe*St*((ot,Ze)=>{if(Ze*Fe(.707)<ot)return 1;const kt=Math.sqrt(Ze/ot);return kt/(1.4144271570014144+(Math.pow(1.1,kt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(bt,tt),Pt));return Pt<Et};if(this.renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)Se.push(ce(-Pe)),Se.push(ce(Pe));for(Se.push(ce(0));Se.length>0;){const Pe=Se.pop(),je=Pe.x,Ke=Pe.y;let bt=Pe.fullyVisible;const St=()=>this.projection.name==="globe"&&(Pe.y===0||Pe.y===(1<<Pe.zoom)-1);if(!bt){let Pt=ie?Pe.aabb.intersects(j):Pe.aabb.intersectsFlat(j);if(Pt===0&&St()){const Et=new o.aO(Pe.zoom,je,Ke);Pt=o.aP(this,L,Et,!0).intersects(j)}if(Pt===0)continue;bt=Pt===2}if(Pe.zoom!==pe&&Qe(Pe))for(let Pt=0;Pt<4;Pt++){const Et=(je<<1)+Pt%2,ot=(Ke<<1)+(Pt>>1),Ze={aabb:S?Pe.aabb.quadrant(Pt):o.aQ(this,L,Pe.zoom+1,Et,ot,Pe.wrap,Pe.minZ,Pe.maxZ,this.projection),zoom:Pe.zoom+1,x:Et,y:ot,wrap:Pe.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:Pe.minZ,maxZ:Pe.maxZ};v&&!F&&(Ze.tileID=new o.aL(Pe.zoom+1===pe?Be:Pe.zoom+1,Pe.wrap,Pe.zoom+1,Et,ot),rt(Ze)),Se.push(Ze)}else{const Pt=Pe.zoom===pe?Be:Pe.zoom;if(i.minzoom&&i.minzoom>Pt)continue;if(!bt){let kt=ie?Pe.aabb.intersectsPrecise(j):Pe.aabb.intersectsPreciseFlat(j);if(kt===0&&St()){const cn=new o.aO(Pe.zoom,je,Ke);kt=o.aP(this,L,cn,!0).intersectsPrecise(j)}if(kt===0)continue}const Et=O[0]-(.5+je+(Pe.wrap<<Pe.zoom))*(1<<u-Pe.zoom),ot=O[1]-.5-Ke,Ze=Pe.tileID?Pe.tileID:new o.aL(Pt,Pe.wrap,Pe.zoom,je,Ke);Oe.push({tileID:Ze,distanceSq:Et*Et+ot*ot})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,je=this.horizonLineFromTop();Oe=Oe.filter(Ke=>{const bt=[0,0,0,1],St=[o.a3,o.a3,0,1],Pt=this.calculateFogTileMatrix(Ke.tileID.toUnwrapped());o.aA.transformMat4(bt,bt,Pt),o.aA.transformMat4(St,St,Pt);const Et=o.aA.min([],bt,St),ot=o.aA.max([],bt,St),Ze=o.aR(Et,ot);if(Ze===0)return!0;let kt=!1;const cn=this._elevation;if(cn&&Ze>Pe&&je!==0){const sn=this.calculateProjMatrix(Ke.tileID.toUnwrapped());let yn;i.isTerrainDEM||(yn=cn.getMinMaxForTile(Ke.tileID)),yn||(yn={min:_e,max:ge});const Sn=o.b2(this.rotation),Vt=[Sn[0]*o.a3,Sn[1]*o.a3,yn.max];o._.transformMat4(Vt,Vt,sn),kt=(1-Vt[1])*this.height*.5<je}return Ze<Pe||kt})}return Oe.sort((Pe,je)=>Pe.distanceSq-je.distanceSq).map(Pe=>Pe.tileID)}resize(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const u=o.at(i.lat,-o.aS,o.aS),p=this.projection.project(i.lng,u);return new o.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,u){let p,x;const v=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;p=(u.x-v.x)/C,x=(u.y-v.y)/C}else{const C=this.pointCoordinate(u),R=this.pointCoordinate(v);p=C.x-R.x,x=C.y-R.y}const S=this.locationCoordinate(i);this.setLocation(new o.Y(S.x-p,S.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,u){const p=u?o.ax(u,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new o.Y(x.x,x.y,p)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,u){const p=u??this._centerAltitude,x=[i.x,i.y,0,1],v=[i.x,i.y,1,1];o.aA.transformMat4(x,x,this.pixelMatrixInverse),o.aA.transformMat4(v,v,this.pixelMatrixInverse);const S=v[3];o.aA.scale(x,x,1/x[3]),o.aA.scale(v,v,1/S);const C=x[2],R=v[2];return{p0:x,p1:v,t:C===R?0:(p-C)/(R-C)}}screenPointToMercatorRay(i){const u=[i.x,i.y,0,1],p=[i.x,i.y,1,1];return o.aA.transformMat4(u,u,this.pixelMatrixInverse),o.aA.transformMat4(p,p,this.pixelMatrixInverse),o.aA.scale(u,u,1/u[3]),o.aA.scale(p,p,1/p[3]),u[2]=o.ax(u[2],this._center.lat)*this.worldSize,p[2]=o.ax(p[2],this._center.lat)*this.worldSize,o.aA.scale(u,u,1/this.worldSize),o.aA.scale(p,p,1/this.worldSize),new o.aT([u[0],u[1],u[2]],o._.normalize([],o._.sub([],p,u)))}rayIntersectionCoordinate(i){const{p0:u,p1:p,t:x}=i,v=o.ax(u[2],this._center.lat),S=o.ax(p[2],this._center.lat);return new o.Y(o.a2(u[0],p[0],x)/this.worldSize,o.a2(u[1],p[1],x)/this.worldSize,o.a2(v,S,x))}pointCoordinate(i,u=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,u)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let u=this.projection.pointCoordinate3D(this,i.x,i.y);if(u)return new o.Y(u[0],u[1],u[2]);let p=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const v=.02*x,S=i.clone();for(let C=0;C<10&&x-p>v;C++){S.y=o.a2(p,x,.66);const R=this.projection.pointCoordinate3D(this,S.x,S.y);R?(x=S.y,u=R):p=S.y}return u?new o.Y(u[0],u[1],u[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=o.aU)return!this.isPointAboveHorizon(i);const u=this.pointCoordinate(i);return u.y>=0&&u.y<=1}_coordinatePoint(i,u){const p=u&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,p+i.toAltitude(),1];return o.aA.transformMat4(x,x,this.pixelMatrix),x[3]>0?new o.P(x[0]/x[3],x[1]/x[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:u}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,v=this.pointLocation3D(new o.P(u,i)),S=this.pointLocation3D(new o.P(x,i)),C=this.pointLocation3D(new o.P(x,p)),R=this.pointLocation3D(new o.P(u,p));let L=Math.min(v.lng,S.lng,C.lng,R.lng),O=Math.max(v.lng,S.lng,C.lng,R.lng),F=Math.min(v.lat,S.lat,C.lat,R.lat),U=Math.max(v.lat,S.lat,C.lat,R.lat);const j=Math.pow(2,-this.zoom)/16*270,H=this.projection.name==="globe"?1:4,Z=(X,Y,ie,oe,ue)=>{const ge=(X+ie)/2,_e=(Y+oe)/2,se=new o.P(ge,_e),{lng:le,lat:ce}=this.pointLocation3D(se),Se=Math.max(0,L-le,F-ce,le-O,ce-U);L=Math.min(L,le),O=Math.max(O,le),F=Math.min(F,ce),U=Math.max(U,ce),(ue<H||Se>j)&&(Z(X,Y,ge,_e,ue+1),Z(ge,_e,ie,oe,ue+1))};if(Z(u,i,x,i,1),Z(x,i,x,p,1),Z(x,p,u,p,1),Z(u,p,u,i,1),this.projection.name==="globe"){const[X,Y]=o.aV(this);X?(U=90,O=180,L=-180):Y&&(F=-90,O=180,L=-180)}return new o.ai(new o.aI(L,F),new o.aI(O,U))}_getBoundsRectangular(i,u){const{top:p,left:x}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,C=new o.P(x,p),R=new o.P(S,p),L=new o.P(S,v),O=new o.P(x,v);let F=this.pointCoordinate(C,i),U=this.pointCoordinate(R,i);const j=this.pointCoordinate(L,u),H=this.pointCoordinate(O,u),Z=(X,Y)=>(Y.y-X.y)/(Y.x-X.x);return F.y>1&&U.y>=0?F=new o.Y((1-H.y)/Z(H,F)+H.x,1):F.y<0&&U.y<=1&&(F=new o.Y(-H.y/Z(H,F)+H.x,0)),U.y>1&&F.y>=0?U=new o.Y((1-j.y)/Z(j,U)+j.x,1):U.y<0&&F.y<=1&&(U=new o.Y(-j.y/Z(j,U)+j.x,0)),new o.ai().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=i.visibleDemTiles.reduce((p,x)=>{if(x.dem){const v=x.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*i.exaggeration(),u.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-u*(1-this._horizonShift);return i?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-o.aS,this.maxLat=o.aS,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aj(this.minLng)*this.tileSize,this.worldMaxX=o.aj(this.maxLng)*this.tileSize,this.worldMinY=o.ak(this.maxLat)*this.tileSize,this.worldMaxY=o.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,u){return this.projection.createTileMatrix(this,u,i)}calculateDistanceTileData(i){const u=i.key,p=this._distanceTileDataCache;if(p[u])return p[u];const x=i.canonical,v=1/this.height,S=this.cameraWorldSize,C=S/this.zoomScale(x.z),R=(x.x+Math.pow(2,x.z)*i.wrap)*C,L=x.y*C,O=this.point;O.x*=S/this.worldSize,O.y*=S/this.worldSize;const F=this.angle,U=Math.sin(-F),j=-Math.cos(-F);return p[u]={bearing:[U,j],center:[(O.x-R)*v,(O.y-L)*v],scale:C/o.a3*v},p[u]}calculateFogTileMatrix(i){const u=i.key,p=this._fogTileMatrixCache;if(p[u])return p[u];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return o.ad.multiply(x,this.worldToFogMatrix,x),p[u]=new Float32Array(x),p[u]}calculateProjMatrix(i,u=!1,p=!1){const x=i.key;let v;if(v=p?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,v[x])return v[x];const S=this.calculatePosMatrix(i,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,o.ad.multiply(S,C,S),v[x]=new Float32Array(S),v[x]}calculatePixelsToTileUnitsMatrix(i){const u=i.tileID.key,p=this._pixelsToTileUnitsCache;if(p[u])return p[u];const x=o.aW(i,this);return p[u]=x,p[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,u=o.ad.fromScaling([],[i,i,i]);return o.ad.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const u=o.ax(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),x=this._camera.forward(),v=o.ax(1,this._center.lat);p[2]/=v,x[2]/=v,o._.normalize(x,x);const S=i.raycast(p,x,i.exaggeration());if(S){const C=o._.scaleAndAdd([],p,x,S),R=new o.Y(C[0],C[1],o.ax(C[2],o.ay(C[1]))),L=(R.z+o._.length([R.x-p[0],R.y-p[1],R.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const u=this._elevation,p=o.ax(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),v=u.getAtPointOrZero(new o.Y(...x)),S=this.pixelsPerMeter/this.worldSize*v,C=this._minimumHeightOverTerrain(),R=x[2]-S;if(R<=C)if(R<0||i){const L=this.locationCoordinate(this._center,this._centerAltitude),O=[x[0],x[1],L.z-x[2]],F=o._.length(O);O[2]-=(C-R)/this._pixelsPerMercatorPixel;const U=o._.length(O);if(U===0)return;o._.scale(O,O,F/U*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],L.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const U=this.center;return U.lat=o.at(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(U.lng=o.at(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const u=this._unmodified,{x:p,y:x}=this.point;let v=0,S=p,C=x;const R=this.width/2,L=this.height/2,O=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(x-L<O&&(C=O+L),x+L>F&&(C=F-L),F-O<this.height&&(v=Math.max(v,this.height/(F-O)),C=(F+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,H=this.worldSize/2-(U+j)/2;S=(p+H+this.worldSize)%this.worldSize-H,S-R<U&&(S=U+R),S+R>j&&(S=j-R),j-U<this.width&&(v=Math.max(v,this.width/(j-U)),S=(j+U)/2)}S===p&&C===x||(this.center=this.unproject(new o.P(S,C))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,u=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ax(1,this.center.lat)/o.ax(1,o.b3));const x=o.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?p:1,S=this._camera.getWorldToCamera(this.worldSize,v);let C;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-i.x/this.width,R[9]=2*i.y/this.height,this.isOrthographic){let ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Se=ce*this.aspect,Oe=-Se,pe=-ce;Se-=i.x,Oe-=i.x,ce+=i.y,pe+=i.y,C=this._camera.getCameraToClipOrthographic(Oe,Se,pe,ce,this._nearZ,this._farZ),((Be,Fe,tt,rt)=>{for(let Qe=0;Qe<16;Qe++)Be[Qe]=Td(Fe[Qe],tt[Qe],rt)})(C,C,R,xr(this.pitch>=15?1:this.pitch/15))}else C=R;const L=o.ad.mul([],R,S);let O=o.ad.mul([],C,S);if(this.projection.isReprojectedInTileSpace){const ce=this.locationCoordinate(this.center),Se=o.ad.identity([]);o.ad.translate(Se,Se,[ce.x*this.worldSize,ce.y*this.worldSize,0]),o.ad.multiply(Se,Se,o.aY(this)),o.ad.translate(Se,Se,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),o.ad.multiply(O,O,Se),o.ad.multiply(L,L,Se),this.inverseAdjustmentMatrix=o.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.ad.scale([],O,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=O,this.invProjMatrix=o.ad.invert(new Float64Array(16),this.projMatrix),u){const ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ce[8]=2*-i.x/this.width,ce[9]=2*i.y/this.height,this.expandedFarZProjMatrix=o.ad.mul([],ce,S)}else this.expandedFarZProjMatrix=this.projMatrix;const F=o.ad.invert([],C);this.frustumCorners=o.a_.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const U=new Float32Array(16);o.ad.identity(U),o.ad.scale(U,U,[1,-1,1]),o.ad.rotateX(U,U,this._pitch),o.ad.rotateZ(U,U,this.angle);const j=o.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.ad.clone(j);const H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-i.x/this.width,j[9]=2*(i.y+H)/this.height,this.skyboxMatrix=o.ad.multiply(U,j,U);const Z=this.point,X=Z.x,Y=Z.y,ie=this.width%2/2,oe=this.height%2/2,ue=Math.cos(this.angle),ge=Math.sin(this.angle),_e=X-Math.round(X)+ue*ie+ge*oe,se=Y-Math.round(Y)+ue*oe+ge*ie,le=new Float64Array(O);if(o.ad.translate(le,le,[_e>.5?_e-1:_e,se>.5?se-1:se,0]),this.alignedProjMatrix=le,O=o.ad.create(),o.ad.scale(O,O,[this.width/2,-this.height/2,1]),o.ad.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=o.ad.create(),o.ad.scale(O,O,[1,-1,1]),o.ad.translate(O,O,[-1,-1,0]),o.ad.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=o.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},O=o.ad.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.a$(this);const ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o._.transformMat4(ce,ce,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,v=[i,i,u];o._.scale(v,v,x),o._.scale(p,p,-1),o._.multiply(p,p,v);const S=o.ad.create();o.ad.translate(S,S,p),o.ad.scale(S,S,v),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,u,x)}_computeCameraPosition(i){const u=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*v,x.y/this.worldSize-p[1]*v,i/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=i[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(v=Math.min((u-p)/x,1)),this._camera.position=o._.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,u=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),v=o.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.ab(this._maxPitch)),C=Math.max((i[2]-v)/Math.cos(p),S),R=this._zoomFromMercatorZ(C);o._.scaleAndAdd(i,i,u,C),this._pitch=o.at(p,o.ab(this.minPitch),o.ab(this.maxPitch)),this.angle=o.au(x,-Math.PI,Math.PI),this._setZoom(o.at(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.Y(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let u=0,p=o.aU,x=0,v=1/0;for(;p-u>1e-6&&p>u;){const S=u+.5*(p-u),C=this.tileSize*Math.pow(2,S),R=this.getCameraToCenterDistance(this.projection,S,C),L=this.scaleZoom(R/(i*this.tileSize)),O=Math.abs(S-L);O<v&&(v=O,x=S),S<L?u=S:p=S}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,u){const p=Math.min(i.x,u.x),x=Math.max(i.x,u.x),v=Math.min(i.y,u.y),S=Math.max(i.y,u.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new o.P(p,v),new o.P(x,S),new o.P(p,S),new o.P(x,v)],R=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const O of C){const F=this.pointRayIntersection(O);if(F.t<0)return!0;const U=this.rayIntersectionCoordinate(F);if(U.x<R||U.y<0||U.x>L||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(i,u){const p=o._.length(o._.sub([],this._camera.position,i)),x=this._zoomFromMercatorZ(p)+u;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([u,p,x],v){const S=[u,p,x,1];o.aA.transformMat4(S,S,v);const C=S[3]=Math.max(S[3],1e-6);return S[0]/=C,S[1]/=C,S[2]/=C,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,i))}}getCameraToCenterDistance(i,u=this.zoom,p=this.worldSize){const x=o.aX(i,u,this.width,this.height,1024),v=i.pixelSpaceConversion(this.center.lat,p,x);let S=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(S=Td(1,S,xr(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.ad.multiply(i,i,this.globeMatrix),i}getFrustum(i){return o.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Di={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},mr=(f,i)=>{if(i>0&&f.terrain&&o.w("Cutoff is currently disabled on terrain"),i<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=f.transform,p=Math.max(Math.abs(u._zoom-(f.minCutoffZoom-1)),1),x=u.isLODDisabled(!1)?o.$(60,45,u.pitch):o.$(30,15,u.pitch),v=u._farZ-u._nearZ,S=i*u.height,C=((1-(R=x))*u.cameraToCenterDistance+R*(u._farZ+S))*p;var R;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(C-u._nearZ)/v,(C-S-u._nearZ)/v]}}},jr={cascadeCount:2,shadowMapResolution:2048};class dh{constructor(i,u){this.aabb=i,this.lastCascade=u}}class op{add(i,u){const p=this.receivers[i.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],u.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],u.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],u.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],u.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],u.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],u.max[2])):this.receivers[i.key]=new dh(u,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,u,p){const x=o.b6.fromPoints(i.points);let v=0;for(const S in this.receivers){const C=this.receivers[S];if(!C||!x.intersectsAabb(C.aabb))continue;C.aabb.min=x.closestPoint(C.aabb.min),C.aabb.max=x.closestPoint(C.aabb.max);const R=C.aabb.getCorners();for(let L=0;L<p.length;L++){let O=!0;for(const F of R){const U=[F[0]*u,F[1]*u,F[2]];if(o._.transformMat4(U,U,p[L].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){O=!1;break}}if(C.lastCascade=L,v=Math.max(v,L),O)break}}return v+1}}class $u{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new op,this._depthMode=new o.ae(i.context.gl.LEQUAL,o.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(jr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(jr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,u){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;const x=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||x<=0||(this._shadowLayerCount=p.style.order.reduce((H,Z)=>{const X=p.style._mergedLayers[Z];return H+(X.hasShadowPass()&&!X.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=p.context,S=jr.shadowMapResolution,C=jr.shadowMapResolution;if(this._cascades.length===0||jr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let H=0;H<jr.cascadeCount;++H){const Z=p._shadowMapDebug,X=v.gl,Y=v.createFramebuffer(S,C,Z,"texture"),ie=new o.T(v,{width:S,height:C,data:null},X.DEPTH_COMPONENT);if(Y.depthAttachment.set(ie.texture),Z){const oe=new o.T(v,{width:S,height:C,data:null},X.RGBA);Y.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:Y,texture:ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.aM,scale:0})}}this.shadowDirection=fh(u);let R=0;if(i.elevation){const H=i.elevation,Z=[1e4,-1e4];H.visibleDemTiles.filter(X=>X.dem).forEach(X=>{const Y=X.dem.tree;Z[0]=Math.min(Z[0],Y.minimums[0]),Z[1]=Math.max(Z[1],Y.maximums[0])}),Z[0]!==1e4&&(R=(Z[1]-Z[0])*H.exaggeration())}const L=1.5*i.cameraToCenterDistance,O=3*L,F=new Float64Array(16);for(let H=0;H<this._cascades.length;++H){const Z=this._cascades[H];let X=i.height/50,Y=1;jr.cascadeCount===1?Y=O:H===0?Y=L:(X=L,Y=O);const[ie,oe]=Hu(i,this.shadowDirection,X,Y,jr.shadowMapResolution,R);Z.scale=i.scale,Z.matrix=ie,Z.boundingSphereRadius=oe,o.ad.invert(F,Z.matrix),Z.frustum=o.aM.fromInvProjectionMatrix(F,1,0,!0),Z.far=Y}const U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/jr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=jr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Di.ShadowMap0,this._uniformValues.u_shadowmap_1=Di.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=p.transform.elevation;for(const H of this._groundShadowTiles){let Z={min:0,max:0};if(j){const X=j.getMinMaxForTile(H);X&&(Z=X)}this.addShadowReceiver(H.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,u){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,jr.shadowMapResolution,jr.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){p.currentShadowCascade=v,x.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),x.clear({color:o.C.white,depth:1});for(const S of i.order){const C=i._mergedLayers[S];if(!C.hasShadowPass()||C.isHidden(p.transform.zoom))continue;const R=i.getLayerSourceCache(C),L=R?u[R.id]:void 0;(C.type==="model"||L&&L.length)&&p.renderLayer(p,R,C,L)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,u=i.style,p=i.context,x=u.directionalLight,v=u.ambientLight;if(!x||!v)return;const S=[],C=mr(i,i.longestCutoffRange);C.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const R=ya(u,x,v),L=new o.ae(p.gl.LEQUAL,o.ae.ReadOnly,i.depthRangeFor3D);for(const O of this._groundShadowTiles){const F=O.toUnwrapped(),U=i.isTileAffectedByFog(O),j=i.getOrCreateProgram("groundShadow",{defines:S,overrideFog:U});this.setupShadows(F,j),i.uploadCommonUniforms(p,j,F,null,C);const H={u_matrix:i.transform.calculateProjMatrix(F),u_ground_shadow_factor:R};j.draw(i,p.gl.TRIANGLES,L,o.ag.disabled,o.a.multiply,o.af.disabled,H,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?o.a.unblended:o.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const u=this.painter.transform,p=u.calculatePosMatrix(i,u.worldSize);return o.ad.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(i){return o.ad.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,u,p,x=0){if(!this.enabled)return;const v=this.painter.transform,S=this.painter.context,C=S.gl,R=this._uniformValues,L=new Float64Array(16),O=v.calculatePosMatrix(i,v.worldSize);for(let F=0;F<this._cascades.length;F++)o.ad.multiply(L,this._cascades[F].matrix,O),R[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),S.activeTexture.set(C.TEXTURE0+Di.ShadowMap0+F),this._cascades[F].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){const F=o.b5(i.canonical),U=2/v.tileSize*o.a3/jr.shadowMapResolution,j=U*this._cascades[0].boundingSphereRadius,H=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(p==="vector-tile"?1:3)/Math.pow(2,x-i.canonical.z-(1-v.zoom+Math.floor(v.zoom)));R.u_shadow_normal_offset=[F,j*Z,H*Z],R.u_shadow_bias=[6e-5,.0012,.012]}else R.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(S,R)}setupShadowsFromMatrix(i,u,p=!1){if(!this.enabled)return;const x=this.painter.context,v=x.gl,S=this._uniformValues,C=new Float64Array(16);for(let R=0;R<jr.cascadeCount;R++)o.ad.multiply(C,this._cascades[R].matrix,i),S[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),x.activeTexture.set(v.TEXTURE0+Di.ShadowMap0+R),this._cascades[R].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);this.useNormalOffset=p,p?(S.u_shadow_normal_offset=[1,5,5],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],u.setShadowUniformValues(x,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,u,p,x){if(x[2]>=0)return{};const v=function(R,L,O){const F=O/(1<<R.canonical.z);return new o.b6([R.canonical.x*F+R.wrap*O,R.canonical.y*F+R.wrap*O,0],[(R.canonical.x+1)*F+R.wrap*O,(R.canonical.y+1)*F+R.wrap*O,L])}(i,u,p).getCorners(),S=u/-x[2];x[0]<0?(o._.add(v[0],v[0],[x[0]*S,0,0]),o._.add(v[3],v[3],[x[0]*S,0,0])):x[0]>0&&(o._.add(v[1],v[1],[x[0]*S,0,0]),o._.add(v[2],v[2],[x[0]*S,0,0])),x[1]<0?(o._.add(v[0],v[0],[0,x[1]*S,0]),o._.add(v[1],v[1],[0,x[1]*S,0])):x[1]>0&&(o._.add(v[2],v[2],[0,x[1]*S,0]),o._.add(v[3],v[3],[0,x[1]*S,0]));const C={};return C.vertices=v,C.planes=[qu(v[1],v[0],v[4]),qu(v[2],v[1],v[5]),qu(v[3],v[2],v[6]),qu(v[0],v[3],v[7])],C}addShadowReceiver(i,u,p){this._receivers.add(i,o.b6.fromTileIdAndHeight(i,u,p))}getMaxCascadeForTile(i){const u=this._receivers.get(i);return u&&u.lastCascade?u.lastCascade:0}}function qu(f,i,u){const p=o._.sub([],u,i),x=o._.sub([],f,i),v=o._.cross([],p,x),S=o._.length(v);return S===0?[0,0,1,0]:(o._.scale(v,v,1/S),[v[0],v[1],v[2],-o._.dot(v,i)])}function fh(f){const i=f.properties.get("direction"),u=o.ac(i.x,i.y,i.z);u[2]=o.at(u[2],0,75);const p=o.b7([u[0],u[1],u[2]]);return o._.fromValues(p.x,p.y,p.z)}function ya(f,i,u){const p=i.properties.get("color"),x=i.properties.get("intensity"),v=i.properties.get("direction"),S=[v.x,v.y,v.z],C=u.properties.get("color"),R=u.properties.get("intensity"),L=Math.max(o._.dot([0,0,1],S),0),O=[0,0,0];o._.scale(O,C.toRenderColor(f.getLut(i.scope)).toArray01Linear().slice(0,3),R);const F=[0,0,0];return o._.scale(F,p.toRenderColor(f.getLut(u.scope)).toArray01Linear().slice(0,3),L*x),o.b8([O[0]>0?O[0]/(O[0]+F[0]):0,O[1]>0?O[1]/(O[1]+F[1]):0,O[2]>0?O[2]/(O[2]+F[2]):0])}function Hu(f,i,u,p,x,v){const S=f.zoom,C=f.scale,R=f.worldSize,L=1/R,O=f.aspect,F=Math.sqrt(1+O*O)*Math.tan(.5*f.fovX),U=F*F,j=p-u,H=p+u;let Z,X;U>j/H?(Z=p,X=p*F):(Z=.5*H*(1+U),X=.5*Math.sqrt(j*j+2*(p*p+u*u)*U+H*H*U*U));const Y=f.projection.pixelsPerMeter(f.center.lat,R),ie=f._camera.getCameraToWorldMercator(),oe=[0,0,-Z*L];o._.transformMat4(oe,oe,ie);let ue=X*L;const ge=f._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){const bt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?Y:1),St=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,u,p);St[8]=2*-f.centerOffset.x/f.width,St[9]=2*f.centerOffset.y/f.height;const Pt=new Float64Array(16);o.ad.mul(Pt,St,bt);const Et=new Float64Array(16);o.ad.invert(Et,Pt);const ot=o.aM.fromInvProjectionMatrix(Et,R,S,!0);for(const Ze of ot.points){const kt=((_e=Ze)[0]/=C,_e[1]/=C,_e[2]=o.ax(_e[2],f._center.lat),_e);ue=Math.max(ue,o._.len(o._.subtract([],oe,kt)))}}var _e;ue*=x/(x-1);const se=Math.acos(i[2]),le=Math.atan2(-i[0],-i[1]),ce=new ju;ce.position=oe,ce.setPitchBearing(se,le);const Se=ce.getWorldToCamera(R,Y),Oe=ue*R,pe=Math.min(f._mercatorZfromZoom(17)*R*-2,-2*Oe),Be=ce.getCameraToClipOrthographic(-Oe,Oe,-Oe,Oe,pe,(Oe+v*Y)/i[2]),Fe=new Float64Array(16);o.ad.multiply(Fe,Be,Se);const tt=o._.fromValues(Math.floor(1e6*oe[0])/1e6*R,Math.floor(1e6*oe[1])/1e6*R,0),rt=.5*x,Qe=[0,0,0];o._.transformMat4(Qe,tt,Fe),o._.scale(Qe,Qe,rt);const Pe=[Math.floor(Qe[0]),Math.floor(Qe[1]),Math.floor(Qe[2])],je=[0,0,0];o._.sub(je,Qe,Pe),o._.scale(je,je,-1/rt);const Ke=new Float64Array(16);return o.ad.identity(Ke),o.ad.translate(Ke,Ke,je),o.ad.multiply(Fe,Ke,Fe),[Fe,Oe]}function jl(f,i){return f!=null&&i!=null&&!(!f.hasData()||!i.hasData())&&f.demTexture!=null&&i.demTexture!=null&&f.tileID.key!==i.tileID.key}const eo=new class{constructor(){this.operations={}}newMorphing(f,i,u,p,x){if(f in this.operations){const v=this.operations[f];v.to.tileID.key!==u.tileID.key&&(v.queued=u)}else this.operations[f]={startTime:p,phase:0,duration:x,from:i,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const i=this.operations[f];return{from:i.from,to:i.to,phase:i.phase}}update(f){for(const i in this.operations){const u=this.operations[i];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[i];break}}}_nextOp(f,i){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=i,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},ph={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Sd(f,i,u){if(i===0)return 0;const p=i<1&&u===514?.25/i:1;return 6*Math.pow(1.5,22-f)*Math.max(i,1)*p}function ap(f,i){const u=1<<f.z;return!i&&(f.x===0||f.x===u-1)||f.y===0||f.y===u-1}const Zu=f=>({u_matrix:f});function Xu(f,i,u,p,x){if(x>0){const v=o.e.now(),S=(v-f.timeAdded)/x,C=i?(v-i.timeAdded)/x:-1,R=u.getSource(),L=p.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),O=!i||Math.abs(i.tileID.overscaledZ-L)>Math.abs(f.tileID.overscaledZ-L),F=O&&f.refreshedUponExpiration?1:o.at(O?S:1-C,0,1);return f.refreshedUponExpiration&&S>=1&&(f.refreshedUponExpiration=!1),i?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Gl extends ah{constructor(i,u,p,x){super(i,u,p,x),this.type="raster-array",this.maxzoom=22,this._options=o.W({type:"raster-array"},u)}triggerRepaint(i){const u=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);u&&u.enabled&&p&&u._clearRenderCacheForTile(p.id,i.tileID),this.map.triggerRepaint()}loadTile(i,u){const p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,o.R.Tile);i.requestParams=x,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(v,S,C,R)=>{if(delete i.request,i.aborted)return i.state="unloaded",u(null);if(v)return v.code===20?void 0:(i.state="errored",u(v));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:C,expires:R}),i.state="empty",u(null)})}unloadTile(i,u){const p=i.texture;p&&p instanceof o.T?(i.destroy(!0),this.map.painter.saveTileTexture(p)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,u,p){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(u,p,(x,v)=>{if(x)return i.state="errored",this.fire(new o.d(x)),void this.triggerRepaint(i);v&&(i.setTexture(v,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:v})=>v===i),p=u&&u.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(i,u,p){if(!i)return;const x=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let v=null;u instanceof o.bk?v=u.paint.get("raster-array-band"):u instanceof o.bl&&(v=u.paint.get("raster-particle-array-band"));const S=v||this.getInitialBand(x);if(S!=null)if(i.textureDescriptor){if(!i.updateNeeded(x,S)||p)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,x,S)}}const zi={vector:vd,raster:ah,"raster-dem":class extends ah{constructor(f,i,u,p){super(f,i,u,p),this.type="raster-dem",this.maxzoom=22,this._options=o.W({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(f,i){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,v){x&&(f.state="errored",i(x)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",i(null))}f.request=o.h(this.map._requestManager.transformRequest(u,o.R.Tile),(function(x,v,S,C){if(delete f.request,f.aborted)f.state="unloaded",i(null);else if(x)f.state="errored",i(x);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:S,expires:C});const R=ImageBitmap&&v instanceof ImageBitmap&&o.bi(),L=1-(v.width-o.bj(v.width))/2;L<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const O=R?v:o.e.getImageData(v,L),F={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:L};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",F,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const i=f.canonical,u=Math.pow(2,i.z),p=(i.x-1+u)%u,x=i.x===0?f.wrap-1:f.wrap,v=(i.x+1+u)%u,S=i.x+1===u?f.wrap+1:f.wrap,C={};return C[new o.aL(f.overscaledZ,x,i.z,p,i.y).key]={backfilled:!1},C[new o.aL(f.overscaledZ,S,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(C[new o.aL(f.overscaledZ,x,i.z,p,i.y-1).key]={backfilled:!1},C[new o.aL(f.overscaledZ,f.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},C[new o.aL(f.overscaledZ,S,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<u&&(C[new o.aL(f.overscaledZ,x,i.z,p,i.y+1).key]={backfilled:!1},C[new o.aL(f.overscaledZ,f.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},C[new o.aL(f.overscaledZ,S,i.z,v,i.y+1).key]={backfilled:!1}),C}},"raster-array":Gl,geojson:class extends o.E{constructor(f,i,u,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(p),this._data=i.data,this._options=o.W({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=o.a3/this.tileSize;this.workerOptions=o.W({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*x,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*x,extent:o.a3,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:o.a3,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){return this._options.dynamic?typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection")?this.fire(new o.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...f.features):this._data=f,this._updateWorkerData(!0),this):this.fire(new o.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(f,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterChildren(f,i){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},i),this}getClusterLeaves(f,i,u,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:i,offset:u},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.f("dataloading",{dataType:"source"})),this._loaded=!1;const i=o.W({append:f},this.workerOptions);i.scope=this.scope;const u=this._data;typeof u=="string"?(i.request=this.map._requestManager.transformRequest(o.e.resolveURL(u),o.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new o.d(p));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(v.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new o.f("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,i){const u=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=this._partialReload,v={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p?{image:p.image.clone()}:null,scope:this.scope,pixelRatio:o.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:x};f.request=this.actor.send(u,v,(S,C)=>x&&!C?(f.state="loaded",i(null)):(delete f.request,f.destroy(),f.aborted?i(null):S?i(S):(f.loadVectorData(C,this.map.painter,u==="reloadTile"),i(null))),void 0,u==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,i){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.bm{constructor(f,i,u,p){super(f,i,u,p),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const i of f.urls)this.urls.push(this.map._requestManager.transformRequest(i,o.R.Source).url);o.bn(this.urls,(i,u)=>{this._loaded=!0,i?this.fire(new o.d(i)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const i=this.video.seekable;f<i.start(0)||f>i.end(0)?this.fire(new o.d(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,i=f.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(f,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.bm,model:class extends o.E{constructor(f,i,u,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const f=[];for(const i in this._options.models){const u=this._options.models[i],p=o.l(this.map._requestManager.transformRequest(u.uri,o.R.Model).url).then(x=>{if(!x)return;const v=o.c(x),S=new o.M(i,u.position,u.orientation,v);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(x=>{this.fire(new o.d(new Error(`Could not load model ${i} from ${u.uri}: ${x.message}`)))});f.push(p)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new o.d(new Error(`Could not load models: ${i.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,i){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(f,i,u,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map._worldview;this._tileJSONRequest=ip(this._options,this.map._requestManager,i,u,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new o.d(p))):x&&(o.W(this,x),x.bounds&&(this.tileBounds=new oh(x.bounds,this.minzoom,this.maxzoom)),o.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,i){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(u,o.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=i;else{if(f.buckets){const v=Object.values(f.buckets);for(const S of v)S.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(v,S){return f.aborted?i(null):v&&v.status!==404?i(v):(S&&(S.resourceTiming&&(f.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(S),f.buckets={...f.buckets,...S.buckets},S.featureIndex&&(f.latestFeatureIndex=S.featureIndex)),f.state="loaded",void i(null))}}serialize(){return o.W({},this._options)}},canvas:class extends o.bm{constructor(f,i,u,p){super(f,i,u,p),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(v=>typeof v!="number"))||this.fire(new o.d(new o.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.d(new o.V(`sources.${f}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new o.d(new o.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new o.d(new o.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.d(new o.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof o.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends o.E{constructor(f,i,u,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=i,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new oh(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),o.W(this,o.ah(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:i,y:u,z:p}=f.canonical;return this._implementation.hasTile({x:i,y:u,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,i){const{x:u,y:p,z:x}=f.tileID.canonical,v=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:u,y:p,z:x},{signal:v.signal})).then((function(S){return delete f.request,f.aborted?(f.state="unloaded",i(null)):S===void 0?(f.state="errored",i(null)):S===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",i(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(S)?(this.loadTileData(f,S),f.state="loaded",void i(null)):(f.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(f.state="errored",i(S))}),f.request.cancel=()=>v.abort()}loadTileData(f,i){f.setTexture(i,this._map.painter)}unloadTile(f,i){if(f.texture&&f.texture instanceof o.T?(f.destroy(!0),f.texture&&f.texture instanceof o.T&&this._map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:u,y:p,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:p,z:x})}i&&i()}abortTile(f,i){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=o.al(this.id,this.scope);this._map.style.clearSource(f)}_update(){this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))}}},Yu=function(f,i,u,p){const x=new zi[i.type](f,i,u,p);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return o.bp(["load","abort","unload","serialize","prepare"],x),x};class mh extends o.bv{constructor(i){const u={type:"raster-dem",maxzoom:i.transform.maxZoom},p=new o.bw(o.bx(),null),x=Yu("mock-dem",u,p,i.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,u){i.state="loaded",u(null)}}class Um extends o.bv{constructor(i){const u=Yu("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new o.bw(o.bx(),null),i.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,u,p){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,S)=>{if(v[S.key]="",!this._tiles[S.key]){const C=new o.by(S,this._source.tileSize*S.overscaleFactor(),i.tileZoom);C.state="loaded",this._tiles[S.key]=C}return v},{});for(const v in this._tiles)v in x||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(i){const u=this.proxyCachedFBO[i];if(u!==void 0){const p=Object.values(u);this.renderCachePool.push(...p),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ed extends o.aL{constructor(i,u,p){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=u,this.projMatrix=p}}class ss extends o.bq{constructor(i,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,v]=function(R){const L=new o.bt,O=new o.bu,F=131;L.reserve(17161),O.reserve(33800);const U=o.a3/128,j=o.a3+U/2,H=j+U;for(let X=-U;X<H;X+=U)for(let Y=-U;Y<H;Y+=U){const ie=Y<0||Y>j||X<0||X>j?24575:0,oe=o.at(Math.round(Y),0,o.a3),ue=o.at(Math.round(X),0,o.a3);L.emplaceBack(oe+ie,ue)}const Z=(X,Y)=>{const ie=Y*F+X;O.emplaceBack(ie+1,ie,ie+F),O.emplaceBack(ie+F,ie+F+1,ie+1)};for(let X=1;X<129;X++)for(let Y=1;Y<129;Y++)Z(Y,X);return[0,129].forEach(X=>{for(let Y=0;Y<130;Y++)Z(Y,X),Z(X,Y)}),[L,O,32768]}(),S=i.context;this.gridBuffer=S.createVertexBuffer(p,o.br.members),this.gridIndexBuffer=S.createIndexBuffer(x),this.gridSegments=o.b.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=o.b.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Um(u.map),this.orthoMatrix=o.ad.create(),o.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.a3,0,o.a3,0,1);const C=S.gl;this._overlapStencilMode=new o.ag({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new mh(u.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,u,p){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const x=i.terrain.properties,v=i.terrain.drapeRenderMode===0,S=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.e.now();const C=i.terrain&&i.terrain.scope,R=x.get("source"),L=v?this._mockSourceCache:i.getSourceCache(R,C);if(!L)return void o.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=L,this._exaggeration=S?this.calculateExaggeration(u):x.get("exaggeration"),!u.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const O=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(u,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),u.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(i){const u=this._previousCameraAltitude,p=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=p;const x=u!=null?p-u:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const v=i.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(v);let C=v-this._previousZoom;const R=this._previousUpdateTimestamp;let L=v;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(v-L)>.5&&(C=.5*(v-L+C)),C*x<0&&(L+=C)),this._evaluationZoom=L;const O=S.getExaggeration(L),F=O===S.getExaggeration(Math.max(0,L-.1));if(F&&Math.abs(O-this._exaggeration)<.01)return O;let U=Math.min(.1,.00375*(this._updateTimestamp-R));return(F||O<.1||Math.abs(C)<1e-4)&&(U=Math.min(.2,4*U)),o.a2(this._exaggeration,O,U)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.Y.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=u.getIds().map(R=>{const L=u.getTileByID(R).tileID;return L.projMatrix=p.calculateProjMatrix(L.toUnwrapped()),L});(function(R,L){const O=L.transform.pointCoordinate(L.transform.getCameraPoint()),F=new o.P(O.x,O.y);R.sort((U,j)=>{if(j.overscaledZ-U.overscaledZ)return j.overscaledZ-U.overscaledZ;const H=new o.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Z=new o.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),X=F.mult(1<<U.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(H)-X.distSqr(Z)})})(x,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},x.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const R in S){const L=S[R];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,i[R],v),L.usedForTerrain))continue;const O=i[R];L.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[u.id]=x.map(R=>new Ed(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const L=this.terrainTileForTile[R.key];if(!L)continue;const O=L.tileID.key;O in C||(this._visibleDemTiles.push(L),C[O]=O)}}_assignTerrainTiles(i){this._initializing||i.forEach(u=>{if(this.terrainTileForTile[u.key])return;const p=this._findTileCoveringTileID(u,this.sourceCache);p&&(this.terrainTileForTile[u.key]=p)})}_prepareDEMTextures(){const i=this.painter.context,u=i.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],v=x.dem;!v||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(u.TEXTURE1),sh(this.painter,x,v))}}_prepareDemTileUniforms(i,u,p,x){if(!u||u.demTexture==null)return!1;const v=i.tileID.canonical,S=Math.pow(2,u.tileID.canonical.z-v.z),C=x||"";return p[`u_dem_tl${C}`]=[v.x*S%1,v.y*S%1],p[`u_dem_scale${C}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,u=i.gl;if(!this._emptyDepthBufferTexture){const p=new o.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.T(i,p,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const u=this._visibleDemTiles.reduce((p,x)=>{if(!x.dem)return p;const v=x.dem.tree.minimums[0];return v>0&&i++,p+v},0);return i?u/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,u=i.gl;i.activeTexture.set(u.TEXTURE2);const p=this._getLoadedAreaMinimum(),[x,v]=(()=>{const C=new o.bz({width:1,height:1},new Float32Array([p]));return[u.R32F,C]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(v,{premultiply:!1}):S=this._emptyDEMTexture=new o.T(i,v,x,{premultiply:!1}),S}setupElevationDraw(i,u,p){const x=this.painter.context,v=x.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};S.u_exaggeration=this.exaggeration();let C=null,R=null,L=1;if(p&&p.morphing&&this._useVertexMorphing){const j=p.morphing.srcDemTile,H=p.morphing.dstDemTile;L=p.morphing.phase,j&&H&&(this._prepareDemTileUniforms(i,j,S,"_prev")&&(R=j),this._prepareDemTileUniforms(i,H,S)&&(C=H))}const O=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let F=null;var U;if(this.enabled?R&&C?(F=C.demTexture,x.activeTexture.set(v.TEXTURE4),R.demTexture.bind(O(R),v.CLAMP_TO_EDGE),S.u_dem_lerp=L):(C=this.terrainTileForTile[i.tileID.key],F=this._prepareDemTileUniforms(i,C,S)?C.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,x.activeTexture.set(v.TEXTURE2),F&&(S.u_dem_size=(U=F).size[0]===1?1:U.size[0]-2,F.bind(O(C),v.CLAMP_TO_EDGE)),x.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&C){const j=(1<<C.tileID.canonical.z)*o.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=j}if(p&&p.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),u.setTerrainUniformValues(x,S),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,i.tileID.canonical,p&&p.useDenormalizedUpVectorScale);u.setGlobeUniformValues(x,j)}}globeUniformValues(i,u,p){const x=i.projection;return{u_tile_tl_up:x.upVector(u,0,0),u_tile_tr_up:x.upVector(u,o.a3,0),u_tile_br_up:x.upVector(u,o.a3,o.a3),u_tile_bl_up:x.upVector(u,0,o.a3),u_tile_up_scale:p?o.bs(1):x.upVectorScale(u,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const u=this.painter,p=this.painter.context;i.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,v,S,C,R){if(x.transform.projection.name==="globe")(function(L,O,F,U,j){const H=L.context,Z=H.gl;let X,Y;const ie=L.transform,oe=o.ba(L,H,ie),ue=(Be,Fe)=>{if(Y===Fe)return;const tt=[ph[Fe],"PROJECTION_GLOBE_VIEW"];oe&&tt.push("CUSTOM_ANTIALIASING");const rt=L.isTileAffectedByFog(Be);X=L.getOrCreateProgram("globeRaster",{defines:tt,overrideFog:rt}),Y=Fe},ge=L.colorModeForRenderPass(),_e=new o.ae(Z.LEQUAL,o.ae.ReadWrite,L.depthRangeFor3D);eo.update(j);const se=o.bb(ie),le=[o.aj(ie.center.lng),o.ak(ie.center.lat)],ce=L.globeSharedBuffers,Se=[ie.width*o.e.devicePixelRatio,ie.height*o.e.devicePixelRatio],Oe=Float32Array.from(ie.globeMatrix),pe={useDenormalizedUpVectorScale:!0};{const Be=L.transform,Fe=Sd(Be.zoom,O.exaggeration(),O.sourceCache._source.tileSize);Y=-1;const tt=Z.TRIANGLES;for(const rt of U){const Qe=F.getTile(rt),Pe=o.ag.disabled,je=O.prevTerrainTileForTile[rt.key],Ke=O.terrainTileForTile[rt.key];jl(je,Ke)&&eo.newMorphing(rt.key,je,Ke,j,250),H.activeTexture.set(Z.TEXTURE0),Qe.texture&&Qe.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const bt=eo.getMorphValuesForProxy(rt.key),St=bt?1:0;bt&&o.o(pe,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:o.b9(bt.phase)}});const Pt=o.bc(rt.canonical),Et=o.bd(Pt.getCenter().lat),ot=o.be(rt.canonical,Pt,Et,Be.worldSize/Be._pixelsPerMercatorPixel),Ze=o.bf(o.bg(rt.canonical)),kt=Fm(Be.expandedFarZProjMatrix,Oe,se,Ze,o.a1(Be.zoom),le,Be.frustumCorners.TL,Be.frustumCorners.TR,Be.frustumCorners.BR,Be.frustumCorners.BL,Be.globeCenterInViewSpace,Be.globeRadius,Se,Fe,Be._farZ,ot);if(ue(rt,St),X&&(O.setupElevationDraw(Qe,X,pe),L.uploadCommonUniforms(H,X,rt.toUnwrapped()),ce)){const[cn,sn,yn]=ce.getGridBuffers(Et,Fe!==0);X.draw(L,tt,_e,Pe,ge,o.af.backCCW,kt,"globe_raster",cn,sn,yn)}}}if(ce&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const Be=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Be.push("CUSTOM_ANTIALIASING"),X=L.getOrCreateProgram("globeRaster",{defines:Be});for(const Fe of U){const{x:tt,y:rt,z:Qe}=Fe.canonical,Pe=rt===0,je=rt===(1<<Qe)-1,[Ke,bt,St,Pt]=ce.getPoleBuffers(Qe,!1);if(Pt&&(Pe||je)){const Et=F.getTile(Fe);H.activeTexture.set(Z.TEXTURE0),Et.texture&&Et.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let ot=o.bh(Qe,tt,ie);const Ze=o.bf(o.bg(Fe.canonical)),kt=(cn,sn)=>cn.draw(L,Z.TRIANGLES,_e,o.ag.disabled,ge,o.af.disabled,Fm(ie.expandedFarZProjMatrix,ot,ot,Ze,0,le,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Se,0,ie._farZ),"globe_pole_raster",sn,St,Pt);O.setupElevationDraw(Et,X,pe),L.uploadCommonUniforms(H,X,Fe.toUnwrapped()),Pe&&L.renderDefaultNorthPole&&kt(X,Ke),je&&L.renderDefaultSouthPole&&(ot=o.ad.scale(o.ad.create(),ot,[1,-1,1]),kt(X,bt))}}}})(x,v,S,C,R);else{const L=x.context,O=L.gl;let F,U;const j=x.shadowRenderer,H=mr(x,x.longestCutoffRange),Z=ge=>{if(U===ge)return;const _e=[];_e.push(ph[ge]),H.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),F=x.getOrCreateProgram("terrainRaster",{defines:_e}),U=ge},X=x.colorModeForRenderPass(),Y=new o.ae(O.LEQUAL,o.ae.ReadWrite,x.depthRangeFor3D);eo.update(R);const ie=x.transform,oe=Sd(ie.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let ue=[0,0,0];if(j){const ge=x.style.directionalLight,_e=x.style.ambientLight;ge&&_e&&(ue=ya(x.style,ge,_e))}{U=-1;const ge=O.TRIANGLES,[_e,se]=[v.gridIndexBuffer,v.gridSegments];for(const le of C){const ce=S.getTile(le),Se=o.ag.disabled,Oe=v.prevTerrainTileForTile[le.key],pe=v.terrainTileForTile[le.key];jl(Oe,pe)&&eo.newMorphing(le.key,Oe,pe,R,250),L.activeTexture.set(O.TEXTURE0),ce.texture&&ce.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const Be=eo.getMorphValuesForProxy(le.key),Fe=Be?1:0;let tt;Be&&(tt={morphing:{srcDemTile:Be.from,dstDemTile:Be.to,phase:o.b9(Be.phase)}});const rt=lt(le.projMatrix,ap(le.canonical,ie.renderWorldCopies)?oe/10:oe,ue);if(Z(Fe),!F)continue;v.setupElevationDraw(ce,F,tt);const Qe=le.toUnwrapped();j&&j.setupShadows(Qe,F),x.uploadCommonUniforms(L,F,Qe,null,H),F.draw(x,ge,Y,Se,X,o.af.backCCW,rt,"terrain_raster",v.gridBuffer,_e,se)}}}}(u,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const u=this.painter,p=this.painter.context,x=this.proxySourceCache,v=this.proxiedCoords[x.id],S=this._drapedRenderBatches.shift(),C=u.style.order,R=[];let L=0;for(const O of v){const F=x.getTileByID(O.proxyTileKey),U=x.proxyCachedFBO[O.key]?x.proxyCachedFBO[O.key][i]:void 0,j=U!==void 0?x.renderCache[U]:this.pool[L++],H=U!==void 0;if(F.texture=j.tex,H&&!j.dirty){R.push(F.tileID);continue}let Z;p.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(p.clear({color:o.C.transparent,stencil:0}),j.dirty=!1);for(let X=S.start;X<=S.end;++X){const Y=u.style._mergedLayers[C[X]];if(Y.isHidden(u.transform.zoom))continue;const ie=u.style.getLayerSourceCache(Y),oe=ie?this.proxyToSource[O.key][ie.id]:[O];if(!oe)continue;const ue=oe;p.viewport.set([0,0,j.fb.width,j.fb.height]),Z!==(ie?ie.id:null)&&(this._setupStencil(j,oe,Y,ie),Z=ie?ie.id:null),u.renderLayer(u,ie,Y,ue)}if(this._drapedRenderBatches.length===0)for(const X of this._pendingGroundEffectLayers){const Y=u.style._mergedLayers[C[X]];if(Y.isHidden(u.transform.zoom))continue;const ie=u.style.getLayerSourceCache(Y),oe=ie?this.proxyToSource[O.key][ie.id]:[O];if(!oe)continue;const ue=oe;p.viewport.set([0,0,j.fb.width,j.fb.height]),Z!==(ie?ie.id:null)&&(this._setupStencil(j,oe,Y,ie),Z=ie?ie.id:null),u.renderLayer(u,ie,Y,ue)}this.renderedToTile?(j.dirty=!0,R.push(F.tileID)):H||--L,L===5&&(L=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,u.width,u.height]),S.end+1}postRender(){}isLayerOrderingCorrect(i){const u=i.order.length;let p=-1,x=u;for(let v=0;v<u;++v)this._style.isLayerDraped(i._mergedLayers[i.order[v]])?p=Math.max(p,v):x=Math.min(x,v);return x>p}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{i=Math.min(i,u.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,u,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const S=v.tileID,C=1<<S.overscaledZ,{x:R,y:L}=S.canonical,O=R/C,F=(R+1)/C,U=L/C,j=(L+1)/C;return{minx:O,miny:U,maxx:F,maxy:j,t:v.dem.tree.raycastRoot(O,U,F,j,i,u,p),tile:v}});x.sort((v,S)=>(v.t!==null?v.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const v of x){if(v.t==null)return null;const S=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,i,u,p);if(S!=null)return S}return null}_createFBO(){const i=this.painter.context,u=i.gl,p=this.drapeBufferSize;i.activeTexture.set(u.TEXTURE0);const x=new o.T(i,{width:p[0],height:p[1],data:null},u.RGBA);x.bind(u.LINEAR,u.CLAMP_TO_EDGE);const v=i.createFramebuffer(p[0],p[1],!0,null);return v.colorAttachment.set(x.texture),v.depthAttachment=new ma(i,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:v,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const u=this._style._mergedLayers[i],p=u.isHidden(this.painter.transform.zoom);return u.type==="custom"?!p&&u.shouldRedrape():!p&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const p of this._style.getSources())if(p instanceof vd){i=!0;break}if(!i)return;const u={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(x);if(v&&!u[v.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof o.Z){u[v.id]=!0;for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][v.id];if(C)for(const R of C)this._clearRenderCacheForTile(v.id,R)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof ah){i=!0;break}if(!i)return;const u={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(x);if(!v||u[v.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const S=x.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const R=this.proxyToSource[C.key][v.id];if(R)for(const L of R){const O=Xu(v.getTile(L),v.findLoadedParent(L,0),v,this.painter.transform,S);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(v.id,L)}}}}_setupDrapedRenderBatches(){const i=this._style.order,u=i.length;if(u===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,v=0,S=this._style._mergedLayers[i[v]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++v<u;)S=this._style._mergedLayers[i[v]];for(;v<u;++v){const C=this._style._mergedLayers[i[v]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?x===void 0&&(x=v):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),x!==void 0&&(p.push({start:x,end:v-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:v-1}),p.length!==0){const C=p[p.length-1];this._pendingGroundEffectLayers.every(R=>R>C.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(i){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const S=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let C=0;C<S.length;++C){const R=Object.values(S[C]);u.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let S=p.length-1;S>=0;S--){const C=p[S];if(u.getTileByID(C.key),u.proxyCachedFBO[C.key]!==void 0){const R=i[C.key],L=this.proxyToSource[C.key];let O=0;for(const F in L){const U=L[F],j=R[F];if(!j||j.length!==U.length||U.some((H,Z)=>H!==j[Z]||x[F]&&x[F].hasOwnProperty(H.key))){O=-1;break}++O}for(const F in u.proxyCachedFBO[C.key])u.renderCache[u.proxyCachedFBO[C.key][F]].dirty=O<0||O!==Object.values(R).length}}const v=[...this._drapedRenderBatches];v.sort((S,C)=>C.end-C.start-(S.end-S.start));for(const S of v)for(const C of p){if(u.proxyCachedFBO[C.key])continue;let R=u.renderCachePool.pop();R===void 0&&u.renderCache.length<50&&(R=u.renderCache.length,u.renderCache.push(this._createFBO())),R!==void 0&&(u.proxyCachedFBO[C.key]={},u.proxyCachedFBO[C.key][S.start]=R,u.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(i,u,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,S=v.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let C;if(p.isTileClipped())C=u.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):o.ag.disabled}_renderTileClippingMasks(i,u){const p=this.painter,x=this.painter.context,v=x.gl;p._tileClippingMaskIDs={},x.setColorMode(o.a.disabled),x.setDepthMode(o.ae.disabled);const S=p.getOrCreateProgram("clippingMask");for(const C of i){const R=p._tileClippingMaskIDs[C.key]=--u;S.draw(p,v.TRIANGLES,o.ae.disabled,new o.ag({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),o.a.disabled,o.af.disabled,Zu(C.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(i){const u=this.painter.transform;if(i.x<0||i.x>u.width||i.y<0||i.y>u.height)return null;const p=[i.x,i.y,1,1];o.aA.transformMat4(p,p,u.pixelMatrixInverse),o.aA.scale(p,p,1/p[3]),p[0]/=u.worldSize,p[1]/=u.worldSize;const x=u._camera.position,v=o.ax(1,u.center.lat),S=[x[0],x[1],x[2]/v,0],C=o._.subtract([],p.slice(0,3),S);o._.normalize(C,C);const R=this.raycast(S,C,this._exaggeration);return R!==null&&R?(o._.scaleAndAdd(S,S,C,R),S[3]=S[2],S[2]*=v,S):null}drawDepth(){const i=this.painter,u=i.context,p=this.proxySourceCache,x=Math.ceil(i.width),v=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=u.gl,C=u.createFramebuffer(x,v,!0,"renderbuffer");u.activeTexture.set(S.TEXTURE0);const R=new o.T(u,{width:x,height:v,data:null},S.RGBA);R.bind(S.NEAREST,S.CLAMP_TO_EDGE),C.colorAttachment.set(R.texture);const L=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,x,v);C.depthAttachment.set(L),this._depthFBO=C,this._depthTexture=R}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,x,v]),function(S,C,R,L){if(S.transform.projection.name==="globe")return;const O=S.context,F=O.gl;O.clear({depth:1});const U=S.getOrCreateProgram("terrainDepth"),j=new o.ae(F.LESS,o.ae.ReadWrite,S.depthRangeFor3D);for(const H of L){const Z=R.getTile(H),X=lt(H.projMatrix,0,[0,0,0]);C.setupElevationDraw(Z,U),U.draw(S,F.TRIANGLES,j,o.ag.disabled,o.a.unblended,o.af.backCCW,X,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(i,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,u,p){if(i.getSource()instanceof o.bm)return this._setupProxiedCoordsForImageSource(i,u,p);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],v=this.proxyCoords;for(let R=0;R<v.length;R++){const L=v[R],O=this._findTileCoveringTileID(L,i);if(O){const F=this._createProxiedId(L,O,p[L.key]&&p[L.key][i.id]);x.push(F),this.proxyToSource[L.key][i.id]=[F]}}let S=!1;const C=new Set;for(let R=0;R<u.length;R++){const L=i.getTile(u[R]);if(!L||!L.hasData())continue;const O=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==L.tileID.canonical.z){const F=this.proxyToSource[O.tileID.key][i.id],U=this._createProxiedId(O.tileID,L,p[O.tileID.key]&&p[O.tileID.key][i.id]);F?F.splice(F.length-1,0,U):this.proxyToSource[O.tileID.key][i.id]=[U];const j=this.proxyToSource[O.tileID.key][i.id];C.has(j)||C.add(j),x.push(U),S=!0}}if(this._sourceTilesOverlap[i.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const R of C)R.sort((L,O)=>O.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(i,u,p){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],v=this.proxyCoords,S=i.getSource(),C=S.tileID;if(!C)return;const R=new o.P(C.x,C.y)._div(1<<C.z),L=S.coordinates.map(o.Y.fromLngLat).reduce((F,U)=>(F.min.x=Math.min(F.min.x,U.x-R.x),F.min.y=Math.min(F.min.y,U.y-R.y),F.max.x=Math.max(F.max.x,U.x-R.x),F.max.y=Math.max(F.max.y,U.y-R.y),F),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(F,U)=>{const j=F.wrap+F.canonical.x/(1<<F.canonical.z),H=F.canonical.y/(1<<F.canonical.z),Z=o.a3/(1<<F.canonical.z),X=U.wrap+U.canonical.x/(1<<U.canonical.z),Y=U.canonical.y/(1<<U.canonical.z);return j+Z<X+L.min.x||j>X+L.max.x||H+Z<Y+L.min.y||H>Y+L.max.y};for(let F=0;F<v.length;F++){const U=v[F];for(let j=0;j<u.length;j++){const H=i.getTile(u[j]);if(!H||!H.hasData()||O(U,H.tileID))continue;const Z=this._createProxiedId(U,H,p[U.key]&&p[U.key][i.id]),X=this.proxyToSource[U.key][i.id];X?X.push(Z):this.proxyToSource[U.key][i.id]=[Z],x.push(Z)}}}_createProxiedId(i,u,p){let x=this.orthoMatrix;if(p){const v=p.find(S=>S.key===u.tileID.key);if(v)return v}if(u.tileID.key!==i.key){const v=i.canonical.z-u.tileID.canonical.z;let S,C,R;x=o.ad.create();const L=u.tileID.wrap-i.wrap<<i.overscaledZ;v>0?(S=o.a3>>v,C=S*((u.tileID.canonical.x<<v)-i.canonical.x+L),R=S*((u.tileID.canonical.y<<v)-i.canonical.y)):(S=o.a3<<-v,C=o.a3*(u.tileID.canonical.x-(i.canonical.x+L<<-v)),R=o.a3*(u.tileID.canonical.y-(i.canonical.y<<-v))),o.ad.ortho(x,0,S,0,S,0,1),o.ad.translate(x,x,[C,R,0])}return new Ed(u.tileID,i.key,x)}_findTileCoveringTileID(i,u){let p=u.getTile(i);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[u.id],v=x[i.key];if(p=v?u.getTileByID(v):null,p&&p.hasData()||v===null)return p;let S=p?p.tileID:i,C=S.overscaledZ;const R=u.getSource().minzoom,L=[];if(!v){const F=u.getSource().maxzoom;if(i.canonical.z>=F){const U=i.canonical.z-F;u.getSource().reparseOverscaled?(C=Math.max(i.canonical.z+2,u.transform.tileZoom),S=new o.aL(C,i.wrap,F,i.canonical.x>>U,i.canonical.y>>U)):U!==0&&(C=F,S=new o.aL(C,i.wrap,F,i.canonical.x>>U,i.canonical.y>>U))}S.key!==i.key&&(L.push(S.key),p=u.getTile(S))}const O=F=>{L.forEach(U=>{x[U]=F}),L.length=0};for(C-=1;C>=R&&(!p||!p.hasData());C--){p&&O(p.tileID.key);const F=S.calculateScaledKey(C);if(p=u.getTileByID(F),p&&p.hasData())break;const U=x[F];if(U===null)break;U===void 0?L.push(F):p=u.getTileByID(U)}return O(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,u){let p=this._tilesDirty[i];p||(p=this._tilesDirty[i]={}),p[u.key]=!0}}function bo(f,i,u){const p=function(C,R,L){const O=o._.dot(R,C),F=o._.dot(L,[.2126,.7152,.0722]),U=(H,Z,X)=>(1-X)*H+X*Z,j=U(1-.3*Math.min(F,1),1,Math.min(O+1,1));return U(.92,1,Math.asin(o.at(R[2],-1,1))/Math.PI+.5)*j}(f,[0,0,1],i),x=[0,0,0];o._.scale(x,u.slice(0,3),p);const v=[0,0,0];o._.scale(v,i.slice(0,3),f[2]);const S=[0,0,0];return o._.add(S,x,v),o.b8(S)}const Ya=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],lp=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ku{static cacheKey(i,u,p,x){let v=`${u}${x?x.cacheKey:""}`;for(const S of p)i.usedDefines.includes(S)&&(v+=`/${S}`);return v}constructor(i,u,p,x,v,S){const C=i.gl;this.program=C.createProgram(),this.configuration=x,this.name=u,this.fixedDefines=[...S];const R=x?x.getBinderAttributes():[],L=(p.staticAttributes||[]).concat(R);let O=x?x.defines():[];O=O.concat(S.map(X=>`#define ${X}`));const F=`#version 300 es
`;let U=F+O.concat("precision mediump float;",Om,km.fragmentSource).join(`
`);for(const X of p.fragmentIncludes)U+=`
${rh[X]}`;U+=`
${p.fragmentSource}`;let j=F+O.concat("precision highp float;",Om,km.vertexSource).join(`
`);for(const X of p.vertexIncludes)j+=`
${rh[X]}`;j+=`
${p.vertexSource}`;const H=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(H,U),C.compileShader(H),C.attachShader(this.program,H);const Z=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(Z,j),C.compileShader(Z),C.attachShader(this.program,Z),this.attributes={},this.numAttributes=L.length;for(let X=0;X<this.numAttributes;X++)if(L[X]){const Y=L[X].startsWith("a_")?L[X]:`a_${L[X]}`;C.bindAttribLocation(this.program,X,Y),this.attributes[Y]=X}C.linkProgram(this.program),C.deleteShader(Z),C.deleteShader(H),this.fixedUniforms=v(i),this.binderUniforms=x?x.getUniforms(i):[],S.includes("TERRAIN")&&(this.terrainUniforms=(X=>({u_dem:new o.a7(X),u_dem_prev:new o.a7(X),u_dem_tl:new o.a8(X),u_dem_scale:new o.aa(X),u_dem_tl_prev:new o.a8(X),u_dem_scale_prev:new o.aa(X),u_dem_size:new o.aa(X),u_dem_lerp:new o.aa(X),u_exaggeration:new o.aa(X),u_depth:new o.a7(X),u_depth_size_inv:new o.a8(X),u_meter_to_dem:new o.aa(X),u_label_plane_matrix_inv:new o.a6(X)}))(i)),S.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new o.aq(X),u_tile_tr_up:new o.aq(X),u_tile_br_up:new o.aq(X),u_tile_bl_up:new o.aq(X),u_tile_up_scale:new o.aa(X)}))(i)),S.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new o.a6(X),u_fog_range:new o.a8(X),u_fog_color:new o.as(X),u_fog_horizon_blend:new o.aa(X),u_fog_vertical_limit:new o.a8(X),u_fog_temporal_offset:new o.aa(X),u_frustum_tl:new o.aq(X),u_frustum_tr:new o.aq(X),u_frustum_br:new o.aq(X),u_frustum_bl:new o.aq(X),u_globe_pos:new o.aq(X),u_globe_radius:new o.aa(X),u_globe_transition:new o.aa(X),u_is_globe:new o.a7(X),u_viewport:new o.a8(X)}))(i)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new o.as(X)}))(i)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new o.aq(X),u_lighting_directional_dir:new o.aq(X),u_lighting_directional_color:new o.aq(X),u_ground_radiance:new o.aq(X)}))(i)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new o.a6(X),u_light_matrix_1:new o.a6(X),u_fade_range:new o.a8(X),u_shadow_normal_offset:new o.aq(X),u_shadow_intensity:new o.aa(X),u_shadow_texel_size:new o.aa(X),u_shadow_map_resolution:new o.aa(X),u_shadow_direction:new o.aq(X),u_shadow_bias:new o.aq(X),u_shadowmap_0:new o.a7(X),u_shadowmap_1:new o.a7(X)}))(i))}}setTerrainUniformValues(i,u){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in u)p[x]&&p[x].set(this.program,x,u[x])}}setGlobeUniformValues(i,u){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in u)p[x]&&p[x].set(this.program,x,u[x])}}setFogUniformValues(i,u){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in u)p[x].set(this.program,x,u[x])}}setCutoffUniformValues(i,u){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in u)p[x].set(this.program,x,u[x])}}setLightsUniformValues(i,u){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in u)p[x].set(this.program,x,u[x])}}setShadowUniformValues(i,u){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;i.program.set(this.program);for(const x in u)p[x].set(this.program,x,u[x])}_drawDebugWireframe(i,u,p,x,v,S,C,R,L,O){const F=i.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const U=i.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||i._terrain&&i._terrain.renderingToTexture||!Ya.includes(this.name))||!(!F.layers3D||!lp.includes(this.name))))return;const j=U.gl,H=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,v,U);if(!H)return;const Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");const X=i.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});U.program.set(X.program);const Y=(ue,ge,_e)=>{if(ge[ue]&&_e[ue])for(const se in ge[ue])_e[ue][se]&&_e[ue][se].set(_e.program,se,ge[ue][se].current)};L&&L.setUniforms(X.program,U,X.binderUniforms,C,{zoom:R}),Y("fixedUniforms",this,X),Y("terrainUniforms",this,X),Y("globeUniforms",this,X),Y("fogUniforms",this,X),Y("lightsUniforms",this,X),Y("shadowUniforms",this,X),H.bind(),U.setColorMode(new o.a([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],o.C.transparent,[!0,!0,!0,!1])),U.setDepthMode(new o.ae(u.func===j.LESS?j.LEQUAL:u.func,o.ae.ReadOnly,u.range)),U.setStencilMode(o.ag.disabled);const ie=3*S.primitiveLength*2,oe=3*S.primitiveOffset*2*2;O&&O>1?j.drawElementsInstanced(j.LINES,ie,j.UNSIGNED_SHORT,oe,O):j.drawElements(j.LINES,ie,j.UNSIGNED_SHORT,oe),v.bind(),U.program.set(this.program),U.setDepthMode(u),U.setStencilMode(p),U.setColorMode(x)}draw(i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z,X){const Y=i.context,ie=Y.gl;if(this.failedToCreate)return;Y.program.set(this.program),Y.setDepthMode(p),Y.setStencilMode(x),Y.setColorMode(v),Y.setCullFace(S);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,C[ge]);H&&H.setUniforms(this.program,Y,this.binderUniforms,U,{zoom:j});const oe={[ie.POINTS]:1,[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[u],ue=X&&X>0?1:void 0;for(const ge of F.get()){const _e=ge.vaos||(ge.vaos={});(_e[R]||(_e[R]=new Eg)).bind(Y,this,L,H?H.getPaintVertexBuffers():[],O,ge.vertexOffset,Z||[],ue),X&&X>1?ie.drawElementsInstanced(u,ge.primitiveLength*oe,ie.UNSIGNED_SHORT,ge.primitiveOffset*oe*2,X):O?ie.drawElements(u,ge.primitiveLength*oe,ie.UNSIGNED_SHORT,ge.primitiveOffset*oe*2):ie.drawArrays(u,ge.vertexOffset,ge.vertexLength),u===ie.TRIANGLES&&O&&this._drawDebugWireframe(i,p,x,v,O,ge,U,j,H,X)}}}function Cd(f,i){const u=Math.pow(2,i.tileID.overscaledZ),p=i.tileSize*Math.pow(2,f.transform.tileZoom)/u,x=p*(i.tileID.canonical.x+i.tileID.wrap*u),v=p*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.bB(i,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,v>>16],u_pixel_coord_lower:[65535&x,65535&v]}}const Ad=o.ad.create(),Ju=(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z)=>{const X=i.style.light,Y=X.properties.get("position"),ie=[Y.x,Y.y,Y.z],oe=o.bC.create();X.properties.get("anchor")==="viewport"&&(o.bC.fromRotation(oe,-i.transform.angle),o._.transformMat3(ie,ie,oe));const ue=X.properties.get("color"),ge=i.transform,_e={u_matrix:f,u_lightpos:ie,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[ue.r,ue.g,ue.b],u_vertical_gradient:+u,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ad,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:v,u_flood_light_color:F,u_vertical_scale:U,u_flood_light_intensity:j,u_ground_shadow_factor:H,u_emissive_strength:Z};return ge.projection.name==="globe"&&(_e.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],_e.u_zoom_transition=R,_e.u_inv_rot_matrix=O,_e.u_merc_center=L,_e.u_up_dir=ge.projection.upVector(new o.aO(0,0,0),L[0]*o.a3,L[1]*o.a3),_e.u_height_lift=C),_e},Qu=(f,i,u)=>({u_matrix:f,u_edge_radius:i,u_vertical_scale:u}),up=(f,i,u,p,x,v,S,C,R,L,O,F,U,j)=>{const H=Ju(f,i,u,p,x,v,S,R,L,O,F,U,j,1,[0,0,0],0),Z={u_height_factor:-Math.pow(2,S.overscaledZ)/C.tileSize/8};return o.W(H,Cd(i,C),Z)},Ka=(f,i)=>({u_matrix:f,u_emissive_strength:i}),cp=(f,i,u,p)=>o.W(Ka(f,i),Cd(u,p)),jm=(f,i,u)=>({u_matrix:f,u_world:u,u_emissive_strength:i}),ec=(f,i,u,p,x)=>o.W(cp(f,i,u,p),{u_world:x}),Md=(f,i,u,p)=>{const x=o.a3/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:i.getCameraToCenterDistance(p),u_extrude_scale:[i.pixelsToGLUnits[0]/x,i.pixelsToGLUnits[1]/x]}},To=(f,i,u=1)=>({u_matrix:f,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:u}),Ja=o.ad.create(),Wl=(f,i,u,p,x,v,S)=>{const C=f.transform,R=C.projection.name==="globe",L=R?o.bD(C.zoom,i.canonical)*C._pixelsPerMercatorPixel:o.bB(u,1,v),O={u_matrix:i.projMatrix,u_extrude_scale:L,u_intensity:S,u_inv_rot_matrix:Ja,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){O.u_inv_rot_matrix=p,O.u_merc_center=x,O.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],O.u_zoom_transition=o.a1(C.zoom);const F=x[0]*o.a3,U=x[1]*o.a3;O.u_up_dir=C.projection.upVector(new o.aO(0,0,0),F,U)}return O};function Gm(f,[i,u,p,x],[v,S]){if(v===S)return[0,0,0,0];const C=255*(f-1)/(f*(S-v));return[i*C,u*C,p*C,x*C]}function hp(f,i,[u,p]){return u===p?0:.5/f+(i-u)*(f-1)/(f*(p-u))}const Vo=(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z,X,Y,ie,oe,ue)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:u,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:v,u_scale_parent:L,u_fade_t:O.mix,u_opacity:O.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:o.bE(F.paint.get("raster-saturation")),u_contrast_factor:o.bF(F.paint.get("raster-contrast")),u_spin_weights:os(F.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:j,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:R,u_colorization_mix:Gm(o.bG,Z,Y),u_colorization_offset:hp(o.bG,X,Y),u_color_ramp:H,u_texture_offset:[oe/(ie+2*oe),ie/(ie+2*oe)],u_texture_res:[ie+2*oe,ie+2*oe],u_emissive_strength:ue});function os(f){f*=Math.PI/180;const i=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*i-u+1)/3,(Math.sqrt(3)*i-u+1)/3]}const xa=.15,dp=(f,i,u,p,x,v,S,C,R,L,O,F)=>({u_matrix:f,u_normalize_matrix:i,u_globe_matrix:u,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:v,u_scale_parent:L,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:R}),fp=(f,i,u,p,x,v,S,C,R,L)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_tile_offset:u,u_velocity:p,u_color_ramp:v,u_velocity_res:x,u_max_speed:S,u_uv_offset:C,u_data_scale:R,u_data_offset:L,u_particle_pos_scale:1.3,u_particle_pos_offset:[xa,xa]}),Mg=(f,i,u,p,x,v,S,C,R,L)=>({u_particle_texture:f,u_particle_texture_side_len:i,u_velocity:u,u_velocity_res:p,u_max_speed:x,u_speed_factor:v,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:R,u_data_offset:L,u_particle_pos_scale:1.3,u_particle_pos_offset:[xa,xa]}),So=o.ad.create(),tc=(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z,X,Y)=>{const ie=x.transform,oe={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ie.getCameraToCenterDistance(Z),u_rotate_symbol:+u,u_aspect_ratio:ie.width/ie.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+R,u_pitch_with_map:+p,u_texsize:L,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:So,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:So,u_up_vector:[0,-1,0],u_color_adj_mat:X,u_icon_transition:Y||0};return Z.name==="globe"&&(oe.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],oe.u_zoom_transition=F,oe.u_inv_rot_matrix=j,oe.u_merc_center=U,oe.u_camera_forward=ie._camera.forward(),oe.u_ecef_origin=o.bH(ie.globeMatrix,O.toUnwrapped()),oe.u_tile_matrix=Float32Array.from(ie.globeMatrix),oe.u_up_vector=H),oe},va=(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z,X)=>o.W(tc(f,i,u,p,x,v,S,C,R,L,F,U,j,H,Z,X),{u_gamma_scale:p?x.transform.getCameraToCenterDistance(X)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:o.e.devicePixelRatio,u_is_halo:+O,undefined:void 0}),He=(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z)=>o.W(va(f,i,u,p,x,v,S,C,!0,R,!0,O,F,U,j,H,Z),{u_texsize_icon:L,u_texture_icon:1}),vt=(f,i,u,p)=>({u_matrix:f,u_emissive_strength:i,u_opacity:u,u_color:p}),ct=(f,i,u,p,x,v,S,C)=>o.W(function(R,L,O,F,U){const{width:j,height:H}=F.imageManager.getPixelSize(L),Z=Math.pow(2,U.tileID.overscaledZ),X=U.tileSize*Math.pow(2,F.transform.tileZoom)/Z,Y=X*(U.tileID.canonical.x+U.tileID.wrap*Z),ie=X*U.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[j,H],u_pattern_size:O.displaySize,u_tile_units_to_pixels:1/o.bB(U,1,F.transform.tileZoom),u_pixel_coord_upper:[Y>>16,ie>>16],u_pixel_coord_lower:[65535&Y,65535&ie]}}(0,v,S,p,C),{u_matrix:f,u_emissive_strength:i,u_opacity:u}),Kt=new Float32Array(o.ad.identity([])),An=(f,i,u,p,x,v,S,C,R,L,O,F,U,j=[0,0,0],H)=>{const Z=x.style.light,X=Z.properties.get("position"),Y=[-X.x,-X.y,X.z],ie=o.bC.create();Z.properties.get("anchor")==="viewport"&&(o.bC.fromRotation(ie,-x.transform.angle),o._.transformMat3(Y,Y,ie));const oe=O.alphaMode==="MASK",ue=Z.properties.get("color").toRenderColor(null),ge=U.paint.get("model-ambient-occlusion-intensity"),_e=U.paint.get("model-color").constantOr(o.C.white).toRenderColor(null),se=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:i,u_normal_matrix:u,u_node_matrix:p||Kt,u_lightpos:Y,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ue.r,ue.g,ue.b],u_camera_pos:j,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+oe,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:R,u_roughnessFactor:L,u_baseColorTexture:Di.BaseColor,u_metallicRoughnessTexture:Di.MetallicRoughness,u_normalTexture:Di.Normal,u_occlusionTexture:Di.Occlusion,u_emissionTexture:Di.Emission,u_lutTexture:Di.LUT,u_color_mix:[_e.r,_e.g,_e.b,se],u_aoIntensity:ge,u_emissive_strength:F,u_occlusionTextureTransform:H||[0,0,0,0]}},_r=(f,i=Kt,u=Kt)=>({u_matrix:f,u_instance:i,u_node_matrix:u}),pi=(f,i,u,p,x)=>({u_matrix:Float32Array.from(f),u_anchorPos:i,u_screenSizePx:u,u_occluderSizePx:p,u_color:x}),zr={fillExtrusion:f=>({u_matrix:new o.a6(f),u_lightpos:new o.aq(f),u_lightintensity:new o.aa(f),u_lightcolor:new o.aq(f),u_vertical_gradient:new o.aa(f),u_opacity:new o.aa(f),u_edge_radius:new o.aa(f),u_ao:new o.a8(f),u_tile_id:new o.aq(f),u_zoom_transition:new o.aa(f),u_inv_rot_matrix:new o.a6(f),u_merc_center:new o.a8(f),u_up_dir:new o.aq(f),u_height_lift:new o.aa(f),u_flood_light_color:new o.aq(f),u_vertical_scale:new o.aa(f),u_flood_light_intensity:new o.aa(f),u_ground_shadow_factor:new o.aq(f),u_emissive_strength:new o.aa(f)}),fillExtrusionDepth:f=>({u_matrix:new o.a6(f),u_edge_radius:new o.aa(f),u_vertical_scale:new o.aa(f)}),fillExtrusionPattern:f=>({u_matrix:new o.a6(f),u_lightpos:new o.aq(f),u_lightintensity:new o.aa(f),u_lightcolor:new o.aq(f),u_vertical_gradient:new o.aa(f),u_height_factor:new o.aa(f),u_edge_radius:new o.aa(f),u_ao:new o.a8(f),u_tile_id:new o.aq(f),u_zoom_transition:new o.aa(f),u_inv_rot_matrix:new o.a6(f),u_merc_center:new o.a8(f),u_up_dir:new o.aq(f),u_height_lift:new o.aa(f),u_image:new o.a7(f),u_texsize:new o.a8(f),u_pixel_coord_upper:new o.a8(f),u_pixel_coord_lower:new o.a8(f),u_tile_units_to_pixels:new o.aa(f),u_opacity:new o.aa(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new o.a6(f),u_opacity:new o.aa(f),u_ao_pass:new o.aa(f),u_meter_to_tile:new o.aa(f),u_ao:new o.a8(f),u_flood_light_intensity:new o.aa(f),u_flood_light_color:new o.aq(f),u_attenuation:new o.aa(f),u_edge_radius:new o.aa(f),u_fb:new o.a7(f),u_fb_size:new o.aa(f)}),fill:f=>({u_matrix:new o.a6(f),u_emissive_strength:new o.aa(f)}),fillPattern:f=>({u_matrix:new o.a6(f),u_emissive_strength:new o.aa(f),u_image:new o.a7(f),u_texsize:new o.a8(f),u_pixel_coord_upper:new o.a8(f),u_pixel_coord_lower:new o.a8(f),u_tile_units_to_pixels:new o.aa(f)}),fillOutline:f=>({u_matrix:new o.a6(f),u_emissive_strength:new o.aa(f),u_world:new o.a8(f)}),fillOutlinePattern:f=>({u_matrix:new o.a6(f),u_emissive_strength:new o.aa(f),u_world:new o.a8(f),u_image:new o.a7(f),u_texsize:new o.a8(f),u_pixel_coord_upper:new o.a8(f),u_pixel_coord_lower:new o.a8(f),u_tile_units_to_pixels:new o.aa(f)}),circle:o.bI,collisionBox:f=>({u_matrix:new o.a6(f),u_camera_to_center_distance:new o.aa(f),u_extrude_scale:new o.a8(f)}),collisionCircle:f=>({u_matrix:new o.a6(f),u_inv_matrix:new o.a6(f),u_camera_to_center_distance:new o.aa(f),u_viewport_size:new o.a8(f)}),debug:f=>({u_color:new o.a9(f),u_matrix:new o.a6(f),u_overlay:new o.a7(f),u_overlay_scale:new o.aa(f)}),clippingMask:f=>({u_matrix:new o.a6(f)}),heatmap:f=>({u_extrude_scale:new o.aa(f),u_intensity:new o.aa(f),u_matrix:new o.a6(f),u_inv_rot_matrix:new o.a6(f),u_merc_center:new o.a8(f),u_tile_id:new o.aq(f),u_zoom_transition:new o.aa(f),u_up_dir:new o.aq(f)}),heatmapTexture:f=>({u_image:new o.a7(f),u_color_ramp:new o.a7(f),u_opacity:new o.aa(f)}),hillshade:f=>({u_matrix:new o.a6(f),u_image:new o.a7(f),u_latrange:new o.a8(f),u_light:new o.a8(f),u_shadow:new o.a9(f),u_highlight:new o.a9(f),u_emissive_strength:new o.aa(f),u_accent:new o.a9(f)}),hillshadePrepare:f=>({u_matrix:new o.a6(f),u_image:new o.a7(f),u_dimension:new o.a8(f),u_zoom:new o.aa(f)}),line:o.bJ,linePattern:o.bK,raster:f=>({u_matrix:new o.a6(f),u_normalize_matrix:new o.a6(f),u_globe_matrix:new o.a6(f),u_merc_matrix:new o.a6(f),u_grid_matrix:new o.ar(f),u_tl_parent:new o.a8(f),u_scale_parent:new o.aa(f),u_fade_t:new o.aa(f),u_opacity:new o.aa(f),u_image0:new o.a7(f),u_image1:new o.a7(f),u_brightness_low:new o.aa(f),u_brightness_high:new o.aa(f),u_saturation_factor:new o.aa(f),u_contrast_factor:new o.aa(f),u_spin_weights:new o.aq(f),u_perspective_transform:new o.a8(f),u_raster_elevation:new o.aa(f),u_zoom_transition:new o.aa(f),u_merc_center:new o.a8(f),u_cutoff_params:new o.as(f),u_colorization_mix:new o.as(f),u_colorization_offset:new o.aa(f),u_color_ramp:new o.a7(f),u_texture_offset:new o.a8(f),u_texture_res:new o.a8(f),u_emissive_strength:new o.aa(f)}),rasterParticle:f=>({u_matrix:new o.a6(f),u_normalize_matrix:new o.a6(f),u_globe_matrix:new o.a6(f),u_merc_matrix:new o.a6(f),u_grid_matrix:new o.ar(f),u_tl_parent:new o.a8(f),u_scale_parent:new o.aa(f),u_fade_t:new o.aa(f),u_opacity:new o.aa(f),u_image0:new o.a7(f),u_image1:new o.a7(f),u_raster_elevation:new o.aa(f),u_zoom_transition:new o.aa(f),u_merc_center:new o.a8(f),u_cutoff_params:new o.as(f)}),rasterParticleTexture:f=>({u_texture:new o.a7(f),u_opacity:new o.aa(f)}),rasterParticleDraw:f=>({u_particle_texture:new o.a7(f),u_particle_texture_side_len:new o.aa(f),u_tile_offset:new o.a8(f),u_velocity:new o.a7(f),u_color_ramp:new o.a7(f),u_velocity_res:new o.a8(f),u_max_speed:new o.aa(f),u_uv_offset:new o.a8(f),u_data_scale:new o.as(f),u_data_offset:new o.aa(f),u_particle_pos_scale:new o.aa(f),u_particle_pos_offset:new o.a8(f)}),rasterParticleUpdate:f=>({u_particle_texture:new o.a7(f),u_particle_texture_side_len:new o.aa(f),u_velocity:new o.a7(f),u_velocity_res:new o.a8(f),u_max_speed:new o.aa(f),u_speed_factor:new o.aa(f),u_reset_rate:new o.aa(f),u_rand_seed:new o.aa(f),u_uv_offset:new o.a8(f),u_data_scale:new o.as(f),u_data_offset:new o.aa(f),u_particle_pos_scale:new o.aa(f),u_particle_pos_offset:new o.a8(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new o.a7(f),u_is_size_feature_constant:new o.a7(f),u_size_t:new o.aa(f),u_size:new o.aa(f),u_camera_to_center_distance:new o.aa(f),u_rotate_symbol:new o.a7(f),u_aspect_ratio:new o.aa(f),u_fade_change:new o.aa(f),u_matrix:new o.a6(f),u_label_plane_matrix:new o.a6(f),u_coord_matrix:new o.a6(f),u_is_text:new o.a7(f),u_pitch_with_map:new o.a7(f),u_texsize:new o.a8(f),u_tile_id:new o.aq(f),u_zoom_transition:new o.aa(f),u_inv_rot_matrix:new o.a6(f),u_merc_center:new o.a8(f),u_camera_forward:new o.aq(f),u_tile_matrix:new o.a6(f),u_up_vector:new o.aq(f),u_ecef_origin:new o.aq(f),u_texture:new o.a7(f),u_icon_transition:new o.aa(f),u_color_adj_mat:new o.a6(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new o.a7(f),u_is_size_feature_constant:new o.a7(f),u_size_t:new o.aa(f),u_size:new o.aa(f),u_camera_to_center_distance:new o.aa(f),u_rotate_symbol:new o.a7(f),u_aspect_ratio:new o.aa(f),u_fade_change:new o.aa(f),u_matrix:new o.a6(f),u_label_plane_matrix:new o.a6(f),u_coord_matrix:new o.a6(f),u_is_text:new o.a7(f),u_pitch_with_map:new o.a7(f),u_texsize:new o.a8(f),u_texture:new o.a7(f),u_gamma_scale:new o.aa(f),u_device_pixel_ratio:new o.aa(f),u_tile_id:new o.aq(f),u_zoom_transition:new o.aa(f),u_inv_rot_matrix:new o.a6(f),u_merc_center:new o.a8(f),u_camera_forward:new o.aq(f),u_tile_matrix:new o.a6(f),u_up_vector:new o.aq(f),u_ecef_origin:new o.aq(f),u_is_halo:new o.a7(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new o.a7(f),u_is_size_feature_constant:new o.a7(f),u_size_t:new o.aa(f),u_size:new o.aa(f),u_camera_to_center_distance:new o.aa(f),u_rotate_symbol:new o.a7(f),u_aspect_ratio:new o.aa(f),u_fade_change:new o.aa(f),u_matrix:new o.a6(f),u_label_plane_matrix:new o.a6(f),u_coord_matrix:new o.a6(f),u_is_text:new o.a7(f),u_pitch_with_map:new o.a7(f),u_texsize:new o.a8(f),u_texsize_icon:new o.a8(f),u_texture:new o.a7(f),u_texture_icon:new o.a7(f),u_gamma_scale:new o.aa(f),u_device_pixel_ratio:new o.aa(f),u_is_halo:new o.a7(f)}),background:f=>({u_matrix:new o.a6(f),u_emissive_strength:new o.aa(f),u_opacity:new o.aa(f),u_color:new o.a9(f)}),backgroundPattern:f=>({u_matrix:new o.a6(f),u_emissive_strength:new o.aa(f),u_opacity:new o.aa(f),u_image:new o.a7(f),u_pattern_tl:new o.a8(f),u_pattern_br:new o.a8(f),u_texsize:new o.a8(f),u_pattern_size:new o.a8(f),u_pixel_coord_upper:new o.a8(f),u_pixel_coord_lower:new o.a8(f),u_tile_units_to_pixels:new o.aa(f)}),terrainRaster:yr,terrainDepth:yr,skybox:f=>({u_matrix:new o.a6(f),u_sun_direction:new o.aq(f),u_cubemap:new o.a7(f),u_opacity:new o.aa(f),u_temporal_offset:new o.aa(f)}),skyboxGradient:f=>({u_matrix:new o.a6(f),u_color_ramp:new o.a7(f),u_center_direction:new o.aq(f),u_radius:new o.aa(f),u_opacity:new o.aa(f),u_temporal_offset:new o.aa(f)}),skyboxCapture:f=>({u_matrix_3f:new o.ar(f),u_sun_direction:new o.aq(f),u_sun_intensity:new o.aa(f),u_color_tint_r:new o.as(f),u_color_tint_m:new o.as(f),u_luminance:new o.aa(f)}),globeRaster:f=>({u_proj_matrix:new o.a6(f),u_globe_matrix:new o.a6(f),u_normalize_matrix:new o.a6(f),u_merc_matrix:new o.a6(f),u_zoom_transition:new o.aa(f),u_merc_center:new o.a8(f),u_image0:new o.a7(f),u_grid_matrix:new o.ar(f),u_skirt_height:new o.aa(f),u_far_z_cutoff:new o.aa(f),u_frustum_tl:new o.aq(f),u_frustum_tr:new o.aq(f),u_frustum_br:new o.aq(f),u_frustum_bl:new o.aq(f),u_globe_pos:new o.aq(f),u_globe_radius:new o.aa(f),u_viewport:new o.a8(f)}),globeAtmosphere:f=>({u_frustum_tl:new o.aq(f),u_frustum_tr:new o.aq(f),u_frustum_br:new o.aq(f),u_frustum_bl:new o.aq(f),u_horizon:new o.aa(f),u_transition:new o.aa(f),u_fadeout_range:new o.aa(f),u_color:new o.as(f),u_high_color:new o.as(f),u_space_color:new o.as(f),u_temporal_offset:new o.aa(f),u_horizon_angle:new o.aa(f)}),model:f=>({u_matrix:new o.a6(f),u_lighting_matrix:new o.a6(f),u_normal_matrix:new o.a6(f),u_node_matrix:new o.a6(f),u_lightpos:new o.aq(f),u_lightintensity:new o.aa(f),u_lightcolor:new o.aq(f),u_camera_pos:new o.aq(f),u_opacity:new o.aa(f),u_baseColorFactor:new o.as(f),u_emissiveFactor:new o.as(f),u_metallicFactor:new o.aa(f),u_roughnessFactor:new o.aa(f),u_baseTextureIsAlpha:new o.a7(f),u_alphaMask:new o.a7(f),u_alphaCutoff:new o.aa(f),u_baseColorTexture:new o.a7(f),u_metallicRoughnessTexture:new o.a7(f),u_normalTexture:new o.a7(f),u_occlusionTexture:new o.a7(f),u_emissionTexture:new o.a7(f),u_lutTexture:new o.a7(f),u_color_mix:new o.as(f),u_aoIntensity:new o.aa(f),u_emissive_strength:new o.aa(f),u_occlusionTextureTransform:new o.as(f)}),modelDepth:f=>({u_matrix:new o.a6(f),u_instance:new o.a6(f),u_node_matrix:new o.a6(f)}),groundShadow:f=>({u_matrix:new o.a6(f),u_ground_shadow_factor:new o.aq(f)}),stars:f=>({u_matrix:new o.a6(f),u_up:new o.aq(f),u_right:new o.aq(f),u_intensity_multiplier:new o.aa(f)}),occlusion:f=>({u_matrix:new o.a6(f),u_anchorPos:new o.aq(f),u_screenSizePx:new o.a8(f),u_occluderSizePx:new o.a8(f),u_color:new o.as(f)})};function nc(f,i,u){const p=i.createTileMatrix(f,f.worldSize,u.toUnwrapped());return o.ad.multiply(new Float32Array(16),f.projMatrix,p)}function Ig(f,i,u){if(i.projection.name===u.projection.name)return f.projMatrix;const p=u.clone();return p.setProjection(i.projection),nc(p,i.getProjection(),f)}function $i(f,i,u){return i.name===u.projection.name?f.projMatrix:nc(u,i,f)}let $l;function _h(f,i,u,p,x,v,S){const C=f.context,R=C.gl,L=f.transform,O=f.getOrCreateProgram("collisionBox"),F=[];let U=0,j=0;for(let ue=0;ue<p.length;ue++){const ge=p[ue],_e=i.getTile(ge),se=_e.getBucket(u);if(!se)continue;const le=Ig(ge,se,L);let ce=le;x[0]===0&&x[1]===0||(ce=f.translatePosMatrix(le,_e,x,v));const Se=S?se.textCollisionBox:se.iconCollisionBox,Oe=se.collisionCircleArray;if(Oe.length>0){const pe=o.ad.create(),Be=ce;o.ad.mul(pe,se.placementInvProjMatrix,L.glCoordMatrix),o.ad.mul(pe,pe,se.placementViewportMatrix),F.push({circleArray:Oe,circleOffset:j,transform:Be,invTransform:pe,projection:se.getProjection()}),U+=Oe.length/4,j=U}Se&&(f.terrain&&f.terrain.setupElevationDraw(_e,O),O.draw(f,R.LINES,o.ae.disabled,o.ag.disabled,f.colorModeForRenderPass(),o.af.disabled,Md(ce,L,_e,se.getProjection()),u.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,L.zoom,null,[Se.collisionVertexBuffer,Se.collisionVertexBufferExt]))}if(!S||!F.length)return;const H=f.getOrCreateProgram("collisionCircle"),Z=new o.bL;Z.resize(4*U),Z._trim();let X=0;for(const ue of F)for(let ge=0;ge<ue.circleArray.length/4;ge++){const _e=4*ge,se=ue.circleArray[_e+0],le=ue.circleArray[_e+1],ce=ue.circleArray[_e+2],Se=ue.circleArray[_e+3];Z.emplace(X++,se,le,ce,Se,0),Z.emplace(X++,se,le,ce,Se,1),Z.emplace(X++,se,le,ce,Se,2),Z.emplace(X++,se,le,ce,Se,3)}(!$l||$l.length<2*U)&&($l=function(ue){const ge=2*ue,_e=new o.bu;_e.resize(ge),_e._trim();for(let se=0;se<ge;se++){const le=6*se;_e.uint16[le+0]=4*se+0,_e.uint16[le+1]=4*se+1,_e.uint16[le+2]=4*se+2,_e.uint16[le+3]=4*se+2,_e.uint16[le+4]=4*se+3,_e.uint16[le+5]=4*se+0}return _e}(U));const Y=C.createIndexBuffer($l,!0),ie=C.createVertexBuffer(Z,o.bM.members,!0);for(const ue of F){const ge={u_matrix:ue.transform,u_inv_matrix:ue.invTransform,u_camera_to_center_distance:(oe=L).getCameraToCenterDistance(ue.projection),u_viewport_size:[oe.width,oe.height]};H.draw(f,R.TRIANGLES,o.ae.disabled,o.ag.disabled,f.colorModeForRenderPass(),o.af.disabled,ge,u.id,ie,Y,o.b.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,L.zoom)}var oe;ie.destroy(),Y.destroy()}const to=o.ad.create();function gh(f){const i=f._camera.getWorldToCamera(f.worldSize,1),u=o.ad.multiply([],i,f.globeMatrix);o.ad.invert(u,u);const p=[0,0,0],x=[0,1,0,0];return o.aA.transformMat4(x,x,u),p[0]=x[0],p[1]=x[1],p[2]=x[2],o._.normalize(p,p),p}function Id({width:f,height:i,anchor:u,textOffset:p,textScale:x},v){const{horizontalAlign:S,verticalAlign:C}=o.bQ(u),R=-(S-.5)*f,L=-(C-.5)*i,O=o.bP(u,p);return new o.P((R/x+O[0])*v,(L/x+O[1])*v)}function Tr(f,i,u,p,x,v,S,C,R,L,O){const F=f.text.placedSymbolArray,U=f.text.dynamicLayoutVertexArray,j=f.icon.dynamicLayoutVertexArray,H={},Z=f.getProjection(),X=$i(C,Z,v),Y=v.elevation,ie=Z.upVectorScale(C.canonical,v.center.lat,v.worldSize).metersToTile;U.clear();for(let oe=0;oe<F.length;oe++){const ue=F.get(oe),{tileAnchorX:ge,tileAnchorY:_e,numGlyphs:se}=ue,le=ue.hidden||!ue.crossTileID||f.allowVerticalPlacement&&!ue.placedOrientation?null:p[ue.crossTileID];if(le){let ce=0,Se=0,Oe=0;if(Y){const Ke=Y?Y.getAtTileOffset(C,ge,_e):0,[bt,St,Pt]=Z.upVector(C.canonical,ge,_e);ce=Ke*bt*ie,Se=Ke*St*ie,Oe=Ke*Pt*ie}let[pe,Be,Fe,tt]=gs(ue.projectedAnchorX+ce,ue.projectedAnchorY+Se,ue.projectedAnchorZ+Oe,u?X:S);const rt=Rr(v.getCameraToCenterDistance(Z),tt);let Qe=x.evaluateSizeForFeature(f.textSizeData,L,ue)*rt/o.bN;u&&(Qe*=f.tilePixelRatio/R);const Pe=Id(le,Qe);u?({x:pe,y:Be,z:Fe}=Z.projectTilePoint(ge+Pe.x,_e+Pe.y,C.canonical),[pe,Be,Fe]=gs(pe+ce,Be+Se,Fe+Oe,S)):(i&&Pe._rotate(-v.angle),pe+=Pe.x,Be+=Pe.y,Fe=0);const je=f.allowVerticalPlacement&&ue.placedOrientation===o.aE.vertical?Math.PI/2:0;for(let Ke=0;Ke<se;Ke++)o.aH(U,pe,Be,Fe,je);O&&ue.associatedIconIndex>=0&&(H[ue.associatedIconIndex]={x:pe,y:Be,z:Fe,angle:je})}else Li(se,U)}if(O){j.clear();const oe=f.icon.placedSymbolArray;for(let ue=0;ue<oe.length;ue++){const ge=oe.get(ue),{numGlyphs:_e}=ge,se=H[ue];if(ge.hidden||!se)Li(_e,j);else{const{x:le,y:ce,z:Se,angle:Oe}=se;for(let pe=0;pe<_e;pe++)o.aH(j,le,ce,Se,Oe)}}f.icon.dynamicLayoutVertexBuffer.updateData(j)}f.text.dynamicLayoutVertexBuffer.updateData(U)}function pp(f,i,u,p,x,v,S={}){const C=u.paint.get("icon-translate"),R=u.paint.get("text-translate"),L=u.paint.get("icon-translate-anchor"),O=u.paint.get("text-translate-anchor"),F=u.layout.get("icon-rotation-alignment"),U=u.layout.get("text-rotation-alignment"),j=u.layout.get("icon-pitch-alignment"),H=u.layout.get("text-pitch-alignment"),Z=u.layout.get("icon-keep-upright"),X=u.layout.get("text-keep-upright"),Y=u.paint.get("icon-color-saturation"),ie=u.paint.get("icon-color-contrast"),oe=u.paint.get("icon-color-brightness-min"),ue=u.paint.get("icon-color-brightness-max"),ge=u.paint.get("icon-occlusion-opacity").constantOr(0),_e=u.paint.get("text-occlusion-opacity").constantOr(0),se=f.context,le=se.gl,ce=f.transform,Se=F==="map",Oe=U==="map",pe=j==="map",Be=H==="map",Fe=ge!==1,tt=_e!==1,rt=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Qe=!1;const Pe=f.depthModeForSublayer(0,o.ae.ReadOnly),je=[o.aj(ce.center.lng),o.ak(ce.center.lat)],Ke=u.layout.get("text-variable-anchor"),bt=ce.projection.name==="globe",St=[],Pt=[0,-1,0];for(const Et of p){const ot=i.getTile(Et),Ze=ot.getBucket(u);if(!Ze||Ze.projection.name==="mercator"&&bt||Ze.fullyClipped)continue;const kt=Ze.projection.name==="globe",cn=kt?o.a1(ce.zoom):0,sn=$i(Et,Ze.getProjection(),ce),yn=ce.calculatePixelsToTileUnitsMatrix(ot),Sn=Ke&&Ze.hasTextData(),Vt=Ze.hasIconTextFit()&&Sn&&Ze.hasIconData(),tn=Ze.getProjection().createInversionMatrix(ce,Et.canonical),Hn=()=>{const nt=Se&&u.layout.get("symbol-placement")!=="point",At=[];u.hasInitialOcclusionOpacityProperties&&Fe&&f.symbolParams.useOcclusionQueries&&!kt&&!bt&&At.push("OCCLUSION_QUERIES"),u.hasInitialOcclusionOpacityProperties||At.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");const Mr=nt||Vt,Kn=u.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&pe&&At.push("PITCH_WITH_MAP_TERRAIN"),kt&&(At.push("PROJECTION_GLOBE_VIEW"),Mr&&At.push("PROJECTED_POS_ON_VIEWPORT")),Kn>0&&At.push("ICON_TRANSITION"),Ze.icon.zOffsetVertexBuffer&&At.push("Z_OFFSET"),Y===0&&ie===0&&oe===0&&ue===1||At.push("COLOR_ADJUSTMENT");const ke=Ze.icon.programConfigurations.get(u.id),Vs=f.getOrCreateProgram(Ze.sdfIcons?"symbolSDF":"symbolIcon",{config:ke,defines:At});let Vr;const Sr=ot.imageAtlasTexture?ot.imageAtlasTexture.size:[0,0],ri=Ze.iconSizeData,cs=o.aD(ri,ce.zoom),Us=pe||ce.pitch!==0,js=ga(sn,ot.tileID.canonical,pe,Se,ce,Ze.getProjection(),yn),cl=Ul(sn,ot.tileID.canonical,pe,Se,ce,Ze.getProjection(),yn),io=f.translatePosMatrix(cl,ot,C,L,!0),Xo=f.translatePosMatrix(sn,ot,C,L),Co=Mr?to:js,Ma=Se&&!pe&&!nt;let Ec=Pt;!bt&&!ce.mercatorFromTransition||Se||(Ec=gh(ce));const Cc=kt?Ec:Pt;if(Ze.sdfIcons&&!Ze.iconsInText)Vr=va(ri.kind,cs,Ma,pe,f,Xo,Co,io,!1,Sr,!0,Et,cn,je,tn,Cc,Ze.getProjection());else{const ii=u.getColorAdjustmentMatrix(Y,ie,oe,ue);Vr=tc(ri.kind,cs,Ma,pe,f,Xo,Co,io,!1,Sr,Et,cn,je,tn,Cc,Ze.getProjection(),ii,Kn)}const nu=ot.imageAtlasTexture?ot.imageAtlasTexture:null,ru=u.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear,Bh=Ze.sdfIcons||f.options.rotating||f.options.zooming||ru||Us?le.LINEAR:le.NEAREST,Qd=Ze.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,Fh=f.terrain&&pe&&nt?o.ad.invert(o.ad.create(),js):to;if(nt&&Ze.icon){const ii=ce.elevation,iu=ii?ii.getAtTileOffsetFunc(Et,ce.center.lat,ce.worldSize,Ze.getProjection()):null,hl=Ds(sn,ot.tileID.canonical,pe,Se,ce,Ze.getProjection(),yn);uh(Ze,sn,f,!1,hl,cl,pe,Z,iu,Et)}return{program:Vs,buffers:Ze.icon,uniformValues:Vr,atlasTexture:nu,atlasTextureIcon:null,atlasInterpolation:Bh,atlasInterpolationIcon:null,isSDF:Ze.sdfIcons,hasHalo:Qd,tile:ot,labelPlaneMatrixInv:Fh}},er=()=>{const nt=Oe&&u.layout.get("symbol-placement")!=="point",At=[],Mr=nt||Ke||Vt;u.hasInitialOcclusionOpacityProperties&&tt&&f.symbolParams.useOcclusionQueries&&!kt&&!bt&&At.push("OCCLUSION_QUERIES"),u.hasInitialOcclusionOpacityProperties||At.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),f.terrainRenderModeElevated()&&Be&&At.push("PITCH_WITH_MAP_TERRAIN"),kt&&(At.push("PROJECTION_GLOBE_VIEW"),Mr&&At.push("PROJECTED_POS_ON_VIEWPORT")),Ze.text.zOffsetVertexBuffer&&At.push("Z_OFFSET");const Kn=Ze.text.programConfigurations.get(u.id),ke=f.getOrCreateProgram(Ze.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Kn,defines:At});let Vs,Vr=[0,0],Sr=null;const ri=Ze.textSizeData;Ze.iconsInText&&(Vr=ot.imageAtlasTexture?ot.imageAtlasTexture.size:[0,0],Sr=ot.imageAtlasTexture?ot.imageAtlasTexture:null,Vs=Be||ce.pitch!==0||f.options.rotating||f.options.zooming||ri.kind==="composite"||ri.kind==="camera"?le.LINEAR:le.NEAREST);const cs=ot.glyphAtlasTexture?ot.glyphAtlasTexture.size:[0,0],Us=o.aD(ri,ce.zoom),js=ga(sn,ot.tileID.canonical,Be,Oe,ce,Ze.getProjection(),yn),cl=Ul(sn,ot.tileID.canonical,Be,Oe,ce,Ze.getProjection(),yn),io=f.translatePosMatrix(cl,ot,R,O,!0),Xo=f.translatePosMatrix(sn,ot,R,O),Co=Mr?to:js,Ma=Oe&&!Be&&!nt;let Ec=Pt;!bt&&!ce.mercatorFromTransition||Oe||(Ec=gh(ce));const Cc=kt?Ec:Pt;let nu;nu=Ze.iconsInText?He(ri.kind,Us,Ma,Be,f,Xo,Co,io,cs,Vr,Et,cn,je,tn,Cc,Ze.getProjection()):va(ri.kind,Us,Ma,Be,f,Xo,Co,io,!0,cs,!0,Et,cn,je,tn,Cc,Ze.getProjection());const ru=ot.glyphAtlasTexture?ot.glyphAtlasTexture:null,Bh=le.LINEAR,Qd=u.paint.get("text-halo-width").constantOr(1)!==0,Fh=f.terrain&&Be&&nt?o.ad.invert(o.ad.create(),js):to;if(nt&&Ze.text){const ii=ce.elevation,iu=ii?ii.getAtTileOffsetFunc(Et,ce.center.lat,ce.worldSize,Ze.getProjection()):null,hl=Ds(sn,ot.tileID.canonical,Be,Oe,ce,Ze.getProjection(),yn);uh(Ze,sn,f,!0,hl,cl,Be,X,iu,Et)}return{program:ke,buffers:Ze.text,uniformValues:nu,atlasTexture:ru,atlasTextureIcon:Sr,atlasInterpolation:Bh,atlasInterpolationIcon:Vs,isSDF:!0,hasHalo:Qd,tile:ot,labelPlaneMatrixInv:Fh}},nr=Ze.icon.segments.get().length,En=Ze.text.segments.get().length,ln=nr&&!S.onlyText?Hn():null,Dn=En&&!S.onlyIcons?er():null,vr=u.paint.get("icon-opacity").constantOr(1),ar=u.paint.get("text-opacity").constantOr(1);if(rt&&Ze.canOverlap){Qe=!0;const nt=vr&&!S.onlyText?Ze.icon.segments.get():[],At=ar&&!S.onlyIcons?Ze.text.segments.get():[];for(const Mr of nt)St.push({segments:new o.b([Mr]),sortKey:Mr.sortKey,state:ln});for(const Mr of At)St.push({segments:new o.b([Mr]),sortKey:Mr.sortKey,state:Dn})}else S.onlyText||St.push({segments:vr?Ze.icon.segments:new o.b([]),sortKey:0,state:ln}),S.onlyIcons||St.push({segments:ar?Ze.text.segments:new o.b([]),sortKey:0,state:Dn})}Qe&&St.sort((Et,ot)=>Et.sortKey-ot.sortKey);for(const Et of St){const ot=Et.state;if(ot)if(f.terrain&&f.terrain.setupElevationDraw(ot.tile,ot.program,{useDepthForOcclusion:!u.hasInitialOcclusionOpacityProperties&&ce.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ot.labelPlaneMatrixInv}),se.activeTexture.set(le.TEXTURE0),ot.atlasTexture&&ot.atlasTexture.bind(ot.atlasInterpolation,le.CLAMP_TO_EDGE,!0),ot.atlasTextureIcon&&(se.activeTexture.set(le.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,le.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,ot.program),ot.hasHalo){const Ze=ot.uniformValues;Ze.u_is_halo=1,ql(ot.buffers,Et.segments,u,f,ot.program,Pe,x,v,Ze,2),Ze.u_is_halo=0}else{if(ot.isSDF){const Ze=ot.uniformValues;ot.hasHalo&&(Ze.u_is_halo=1,ql(ot.buffers,Et.segments,u,f,ot.program,Pe,x,v,Ze,1)),Ze.u_is_halo=0}ql(ot.buffers,Et.segments,u,f,ot.program,Pe,x,v,ot.uniformValues,1)}}}function ql(f,i,u,p,x,v,S,C,R,L){const O=p.context.gl,F=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];f.occlusionQueryOpacityVertexBuffer.length>0&&F.push(f.occlusionQueryOpacityVertexBuffer),x.draw(p,O.TRIANGLES,v,S,C,o.af.disabled,R,u.id,f.layoutVertexBuffer,f.indexBuffer,i,u.paint,p.transform.zoom,f.programConfigurations.get(u.id),F,L)}function rc(f,i,u,p,x,v,S){const C=f.context.gl,R=u.paint.get("fill-pattern"),L=R&&R.constantOr(1);let O,F,U,j,H;S?(F=L&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=C.LINES):(F=L?"fillPattern":"fill",O=C.TRIANGLES);for(const Z of p){const X=i.getTile(Z);if(L&&!X.patternsLoaded())continue;const Y=X.getBucket(u);if(!Y)continue;f.prepareDrawTile();const ie=Y.programConfigurations.get(u.id),oe=f.isTileAffectedByFog(Z),ue=f.getOrCreateProgram(F,{config:ie,overrideFog:oe});L&&(f.context.activeTexture.set(C.TEXTURE0),X.imageAtlasTexture&&X.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ie.updatePaintBuffers());const ge=R.constantOr(null);if(ge&&X.imageAtlas){const le=X.imageAtlas.patternPositions[ge.toString()];le&&ie.setConstantPatternPositions(le)}const _e=f.translatePosMatrix(Z.projMatrix,X,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),se=u.paint.get("fill-emissive-strength");if(S){j=Y.indexBuffer2,H=Y.segments2;const le=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];U=F==="fillOutlinePattern"&&L?ec(_e,se,f,X,le):jm(_e,se,le)}else j=Y.indexBuffer,H=Y.segments,U=L?cp(_e,se,f,X):Ka(_e,se);f.uploadCommonUniforms(f.context,ue,Z.toUnwrapped()),ue.draw(f,O,x,f.stencilModeForClipping(Z),v,o.af.disabled,U,u.id,Y.layoutVertexBuffer,j,H,u.paint,f.transform.zoom,ie,void 0)}}function ic(f,i,u,p,x,v,S,C){u.resetLayerRenderingStats(f);const R=f.context,L=R.gl,O=f.transform,F=u.paint.get("fill-extrusion-pattern"),U=F.constantOr(1),j=u.paint.get("fill-extrusion-opacity"),H=f.style.enable3dLights(),Z=u.paint.get(H&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],Y=u.layout.get("fill-extrusion-edge-radius"),ie=Y>0&&!u.paint.get("fill-extrusion-rounded-roof"),oe=ie?0:Y,ue=O.projection.name==="globe"?o.bY():0,ge=O.projection.name==="globe",_e=ge?o.a1(O.zoom):0,se=[o.aj(O.center.lng),o.ak(O.center.lat)],le=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),ce=u.paint.get("fill-extrusion-flood-light-intensity"),Se=u.paint.get("fill-extrusion-vertical-scale"),Oe=mr(f,u.paint.get("fill-extrusion-cutoff-fade-range")),pe=u.paint.get("fill-extrusion-emissive-strength"),Be=[];let Fe;ge&&Be.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&Be.push("FAUX_AO"),ie&&Be.push("ZERO_ROOF_RADIUS"),C&&Be.push("HAS_CENTROID"),ce>0&&Be.push("FLOOD_LIGHT"),Oe.shouldRenderCutoff&&Be.push("RENDER_CUTOFF");const tt=f.renderPass==="shadow",rt=f.shadowRenderer,Qe=tt&&!!rt;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Pe=[0,0,0];if(rt){const bt=f.style.directionalLight,St=f.style.ambientLight;bt&&St&&(Pe=ya(f.style,bt,St)),Fe=Be.concat(["SHADOWS_SINGLE_CASCADE"])}const je=Qe?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",Ke=u.getLayerRenderingStats();for(const bt of p){const St=i.getTile(bt),Pt=St.getBucket(u);if(!Pt||Pt.projection.name!==O.projection.name)continue;let Et=!1;rt&&(Et=rt.getMaxCascadeForTile(bt.toUnwrapped())===0);const ot=f.isTileAffectedByFog(bt),Ze=Pt.programConfigurations.get(u.id),kt=f.getOrCreateProgram(je,{config:Ze,defines:Et?Fe:Be,overrideFog:ot});if(f.terrain&&f.terrain.setupElevationDraw(St,kt,{useMeterToDem:!0}),!Pt.centroidVertexBuffer){const tn=kt.attributes.a_centroid_pos;tn!==void 0&&L.vertexAttrib2f(tn,0,0)}!tt&&rt&&rt.setupShadows(St.tileID.toUnwrapped(),kt,"vector-tile",St.tileID.overscaledZ),U&&(f.context.activeTexture.set(L.TEXTURE0),St.imageAtlasTexture&&St.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ze.updatePaintBuffers());const cn=F.constantOr(null);if(cn&&St.imageAtlas){const tn=St.imageAtlas.patternPositions[cn.toString()];tn&&Ze.setConstantPatternPositions(tn)}const sn=u.paint.get("fill-extrusion-vertical-gradient");let yn;if(tt&&rt){if(Rd(St.tileID,Pt,f))continue;const tn=rt.calculateShadowPassMatrixFromTile(St.tileID.toUnwrapped());yn=Qu(tn,oe,Se)}else{const tn=f.translatePosMatrix(bt.expandedProjMatrix,St,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Hn=O.projection.createInversionMatrix(O,bt.canonical);yn=U?up(tn,f,sn,j,X,oe,bt,St,ue,_e,se,Hn,le,Se):Ju(tn,f,sn,j,X,oe,bt,ue,_e,se,Hn,le,Se,ce,Pe,pe)}f.uploadCommonUniforms(R,kt,bt.toUnwrapped(),null,Oe);let Sn=Pt.segments;if(O.projection.name==="mercator"&&!tt&&(Sn=Pt.getVisibleSegments(St.tileID,f.terrain,f.transform.getFrustum(0)),!Sn.get().length))continue;if(Ke)if(tt)for(const tn of Sn.get())Ke.numRenderedVerticesInShadowPass+=tn.primitiveLength;else for(const tn of Sn.get())Ke.numRenderedVerticesInTransparentPass+=tn.primitiveLength;const Vt=[];(f.terrain||C)&&Vt.push(Pt.centroidVertexBuffer),ge&&Vt.push(Pt.layoutVertexExtBuffer),kt.draw(f,R.gl.TRIANGLES,x,v,S,o.af.backCCW,yn,u.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Sn,u.paint,f.transform.zoom,Ze,Vt)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function as(f,i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z,X,Y,ie){const oe=f.context,ue=oe.gl,ge=f.transform,_e=f.transform.zoom,se=[],le=mr(f,u.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(se.push("CLEAR_SUBPASS"),ie&&(se.push("CLEAR_FROM_TEXTURE"),oe.activeTexture.set(ue.TEXTURE0),ie.bind(ue.LINEAR,ue.CLAMP_TO_EDGE))):L==="sdf"&&se.push("SDF_SUBPASS"),X&&se.push("HAS_CENTROID"),le.shouldRenderCutoff&&se.push("RENDER_CUTOFF");const ce=u.layout.get("fill-extrusion-edge-radius"),Se=(Oe,pe,Be,Fe,tt)=>{const rt=pe.programConfigurations.get(u.id),Qe=f.isTileAffectedByFog(Oe),Pe=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:rt,defines:se,overrideFog:Qe}),je=((bt,St,Pt,Et,ot,Ze,kt,cn,sn,yn,Sn)=>({u_matrix:St,u_opacity:Pt,u_ao_pass:Et?1:0,u_meter_to_tile:ot,u_ao:Ze,u_flood_light_intensity:kt,u_flood_light_color:cn,u_attenuation:sn,u_edge_radius:yn,u_fb:0,u_fb_size:Sn}))(0,Fe,O,R,tt,[F,U*tt],j,H,Z,_e>=17?0:ce*tt,ie?ie.size[0]:0),Ke=[];X&&Ke.push(pe.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(oe,Pe,Oe.toUnwrapped(),null,le),Pe.draw(f,oe.gl.TRIANGLES,x,v,S,C,je,u.id,pe.vertexBuffer,pe.indexBuffer,Be,u.paint,_e,rt,Ke)};for(const Oe of p){const pe=i.getTile(Oe),Be=pe.getBucket(u);if(!Be||Be.projection.name!==ge.projection.name||!Be.groundEffect||Be.groundEffect&&!Be.groundEffect.hasData())continue;const Fe=Be.groundEffect,tt=1/Be.tileToMeter;{const rt=f.translatePosMatrix(Oe.projMatrix,pe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Qe=Fe.getDefaultSegment();Se(Oe,Fe,Qe,rt,tt)}if(Y)for(let rt=0;rt<4;rt++){const Qe=o.bZ[rt](Oe),Pe=i.getTile(Qe);if(!Pe)continue;const je=Pe.getBucket(u);if(!je||je.projection.name!==ge.projection.name||!je.groundEffect||je.groundEffect&&!je.groundEffect.hasData())continue;const Ke=je.groundEffect;let bt,St;rt===0?(bt=[-o.a3,0,0],St=1):rt===1?(bt=[o.a3,0,0],St=0):rt===2?(bt=[0,-o.a3,0],St=3):(bt=[0,o.a3,0],St=2);const Pt=Ke.regionSegments[St];if(!Pt)continue;const Et=new Float32Array(16);o.ad.translate(Et,Oe.projMatrix,bt),Se(Oe,Ke,Pt,f.translatePosMatrix(Et,pe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),tt)}}}function Pd(f,i,u,p,x,v,S){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const C=v?v.findDEMTileFor(u):null;if(!(C&&C.dem||S))return;const R=Y=>new o.P(Math.ceil((Y+o.c0)*o.c1),0),L=Y=>{const ie=i.getSource().minzoom,oe=ge=>{const _e=i.getTileByID(ge);if(_e&&_e.hasData())return _e.getBucket(x)},ue=[0,-1,1];for(const ge of ue){if(Y.overscaledZ+ge<ie)continue;const _e=oe(Y.calculateScaledKey(Y.overscaledZ+ge));if(_e)return _e}},O=[0,0,0],F=(Y,ie)=>(O[0]=Math.min(Y.min.y,ie.min.y),O[1]=Math.max(Y.max.y,ie.max.y),O[2]=o.a3-ie.min.x>Y.max.x?ie.min.x-o.a3:Y.max.x,O),U=(Y,ie)=>(O[0]=Math.min(Y.min.x,ie.min.x),O[1]=Math.max(Y.max.x,ie.max.x),O[2]=o.a3-ie.min.y>Y.max.y?ie.min.y-o.a3:Y.max.y,O),j=[(Y,ie)=>F(Y,ie),(Y,ie)=>F(ie,Y),(Y,ie)=>U(Y,ie),(Y,ie)=>U(ie,Y)],H=(Y,ie,oe,ue,ge,_e,se)=>{if(!v)return 0;const le=[[_e?oe:Y,_e?Y:oe,0],[_e?oe:ie,_e?ie:oe,0]],ce=se<0?o.a3+se:se,Se=[_e?ce:(Y+ie)/2,_e?(Y+ie)/2:ce,0];return oe===0&&se<0||oe!==0&&se>0?v.getForTilePoints(ge,[Se],!0,ue):le.push(Se),v.getForTilePoints(u,le,!0,C),Math.max(le[0][2],le[1][2],Se[2])/v.exaggeration()};for(let Y=0;Y<4;Y++){const ie=p.borderFeatureIndices[Y];if(ie.length===0)continue;const oe=o.bZ[Y](u),ue=L(oe);if(!(ue&&ue instanceof o.b_)||p.borderDoneWithNeighborZ[Y]===ue.canonical.z)continue;ue.centroidVertexArray.length===0&&ue.createCentroidsBuffer();const ge=v?v.findDEMTileFor(oe):null;if(!(ge&&ge.dem||S))continue;const _e=(Y<2?1:5)-Y,se=ue.borderDoneWithNeighborZ[_e]!==p.canonical.z,le=ue.borderFeatureIndices[_e];let ce=0;if(p.canonical.z!==ue.canonical.z){for(const Se of ie)p.showCentroid(p.featuresOnBorder[Se]);if(se)for(const Se of le)ue.showCentroid(ue.featuresOnBorder[Se]);p.borderDoneWithNeighborZ[Y]=ue.canonical.z,ue.borderDoneWithNeighborZ[_e]=p.canonical.z}for(const Se of ie){const Oe=p.featuresOnBorder[Se],pe=p.centroidData[Oe.centroidDataIndex],Be=Oe.borders[Y];let Fe;for(;ce<le.length;){Fe=ue.featuresOnBorder[le[ce]];const tt=Fe.borders[_e];if(tt[1]>Be[0]+3||tt[0]>Be[0]-3)break;ue.showCentroid(Fe),ce++}if(Fe&&ce<le.length){const tt=ce;let rt=0;for(;!(Fe.borders[_e][0]>Be[1]-3)&&(rt++,++ce!==le.length);)Fe=ue.featuresOnBorder[le[ce]];if(Fe=ue.featuresOnBorder[le[tt]],rt>1){const je=Fe.borders[_e];Math.abs(Be[0]-je[0])<3&&Math.abs(Be[1]-je[1])<3&&(rt=1,ce=tt+1)}else if(rt===0){p.showCentroid(Oe);continue}const Qe=ue.centroidData[Fe.centroidDataIndex];S&&rt===1&&(((Z=pe).flags|(X=Qe).flags)&o.b$?(Z.flags|=o.b$,X.flags|=o.b$):(Z.flags&=~o.b$,X.flags&=~o.b$));const Pe=Oe.intersectsCount()>1||Fe.intersectsCount()>1;if(rt>1)ce=tt,pe.centroidXY=Qe.centroidXY=new o.P(0,0);else if(ge&&ge.dem&&!Pe){const je=j[Y](pe,Qe),Ke=Y%2?o.a3-1:0,bt=H(je[0],Math.min(o.a3-1,je[1]),Ke,ge,oe,Y<2,je[2]);pe.centroidXY=Qe.centroidXY=R(bt)}else Pe?pe.centroidXY=Qe.centroidXY=new o.P(0,0):(pe.centroidXY=p.encodeBorderCentroid(Oe),Qe.centroidXY=ue.encodeBorderCentroid(Fe));p.writeCentroidToBuffer(pe),ue.writeCentroidToBuffer(Qe)}else p.showCentroid(Oe)}p.borderDoneWithNeighborZ[Y]=ue.canonical.z,ue.borderDoneWithNeighborZ[_e]=p.canonical.z}var Z,X;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Uo=[1,0,0],wa=[0,1,0],Hl=[0,0,1];function Rd(f,i,u){const p=u.transform,x=u.shadowRenderer;if(!x)return!0;const v=f.toUnwrapped(),S=p.tileSize*x._cascades[u.currentShadowCascade].scale;let C=i.maxHeight;if(p.elevation){const Z=p.elevation.getMinMaxForTile(f);Z&&(C+=Z.max)}const R=[...x.shadowDirection];R[2]=-R[2];const L=x.computeSimplifiedTileShadowVolume(v,C,S,R);if(!L)return!1;const O=[Uo,wa,Hl,R,[R[0],0,R[2]],[0,R[1],R[2]]],F=p.projection.name==="globe",U=p.scaleZoom(S),j=o.aM.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,U,!F),H=x.getCurrentCascadeFrustum();return j.intersectsPrecise(L.vertices,L.planes,O)===0||H.intersectsPrecise(L.vertices,L.planes,O)===0}function Qa(f){return[f[0]*o.c2,f[1]*o.c2,f[2]*o.c2,0]}function sc(f,i,u,p,x,v,S,C,R){const L=p.getSource(),O=u.globeSharedBuffers;if(!O)return;let F,U,j;if(i&&(F=p.getTile(i)),L instanceof o.bm?(U=L.texture,j=o.bh(0,0,u.transform)):F&&i&&(U=F.texture,j=o.bh(i.canonical.z,i.canonical.x,u.transform)),!U||!j)return;f||(j=o.ad.scale(o.ad.create(),j,[1,-1,1]));const H=u.context,Z=H.gl,X=x.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,Y=u.colorModeForDrapableLayerRenderPass(v),ie=S.defines;ie.push("GLOBE_POLES");const oe=new o.ae(Z.LEQUAL,o.ae.ReadWrite,u.depthRangeFor3D),ue=Float32Array.from(u.transform.expandedFarZProjMatrix),ge=Float32Array.from(o.bf(o.bg(new o.aO(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),H.activeTexture.set(Z.TEXTURE0),U.bind(X,Z.CLAMP_TO_EDGE),H.activeTexture.set(Z.TEXTURE1),U.bind(X,Z.CLAMP_TO_EDGE),U.useMipmap&&H.extTextureFilterAnisotropic&&u.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const[_e,se,le,ce]=i?O.getPoleBuffers(i.canonical.z,!1):O.getPoleBuffers(0,!0),Se=x.paint.get("raster-elevation");let Oe;f?(Oe=_e,u.renderDefaultNorthPole=Se!==0):(Oe=se,u.renderDefaultSouthPole=Se!==0);const pe=Qa(S.mix),Be=((tt,rt,Qe,Pe,je,Ke,bt,St,Pt,Et,ot,Ze,kt)=>Vo(tt,rt,Qe,new Float32Array(16),new Float32Array(9),[0,0],Pe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ke,[0,0],St,2,Et,ot,Ze,1,0,kt))(ue,ge,j,o.a1(u.transform.zoom),0,x,0,Se,0,pe,S.offset,S.range,v),Fe=u.getOrCreateProgram("raster",{defines:ie});u.uploadCommonUniforms(H,Fe,null),Fe.draw(u,Z.TRIANGLES,oe,R,Y,C,Be,x.id,Oe,le,ce)}function Gn(f){const i=f._nearZ,u=f.projection.farthestPixelDistance(f),p=u-i,x=.2*f.height,v=i+x;return[i,u,(v-x-i)/p,(v-i)/p]}function Ld(f,i,u,p){if(f)return i instanceof Gl&&f instanceof o.c3?i.getTextureDescriptor(f,u,!0):{texture:f.texture,mix:Qa(p.mix),offset:p.offset,buffer:0,tileSize:1}}function Ht(f,i,u){if(!f)return null;const p=i.getTextureDescriptor(f,u,!0);if(!p)return null;let{texture:x,mix:v,offset:S,tileSize:C,buffer:R,format:L}=p;if(!x||!L)return null;let O=!1;return L==="uint32"&&(O=!0,v[3]=0,v=Gm(o.c4,v,[0,u.paint.get("raster-particle-max-speed")]),S=hp(o.c4,S,[0,u.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[R/(C+2*R),C/(C+2*R)],tileSize:C,scalarData:O,scale:v,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function oc(f){const i=f._nearZ,u=f.projection.farthestPixelDistance(f),p=u-i,x=.2*f.height,v=i+x;return[i,u,(v-x-i)/p,(v-i)/p]}const jo=new o.C(1,0,0,1),ac=new o.C(0,1,0,1),Go=new o.C(0,0,1,1),mp=new o.C(1,0,1,1),lc=new o.C(0,1,1,1);function Rt(f,i,u,p,x,v,S){const C=f.context,R=f.transform,L=C.gl,O=R.projection.name==="globe",F=O?["PROJECTION_GLOBE_VIEW"]:[];let U=o.ad.clone(u.projMatrix);if(O&&o.a1(R.zoom)>0){const pe=o.c5(u.canonical,R),Be=o.c6(pe);U=o.ad.multiply(new Float32Array(16),R.globeMatrix,Be),o.ad.multiply(U,R.projMatrix,U)}const j=o.ad.create();j[12]+=2*x/(o.e.devicePixelRatio*R.width),j[13]+=2*v/(o.e.devicePixelRatio*R.height),o.ad.multiply(U,j,U);const H=f.getOrCreateProgram("debug",{defines:F}),Z=i.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(Z,H);const X=o.ae.disabled,Y=o.ag.disabled,ie=f.colorModeForRenderPass(),oe="$debug";C.activeTexture.set(L.TEXTURE0),f.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),O?Z._makeGlobeTileDebugBuffers(f.context,R):Z._makeDebugTileBoundsBuffers(f.context,R.projection);const ue=Z._tileDebugBuffer||f.debugBuffer,ge=Z._tileDebugIndexBuffer||f.debugIndexBuffer,_e=Z._tileDebugSegments||f.debugSegments;if(H.draw(f,L.LINE_STRIP,X,Y,ie,o.af.disabled,To(U,p),oe,ue,ge,_e,null,null,null,[Z._globeTileDebugBorderBuffer]),S){const pe=Z.latestRawTileData,Be=Math.floor((pe&&pe.byteLength||0)/1024);let Fe=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Fe+=` => ${u.overscaledZ}`),Fe+=` ${Z.state}`,Fe+=` ${Be}kb`,function(tt,rt){tt.initDebugOverlayCanvas();const Qe=tt.debugOverlayCanvas,Pe=tt.context.gl,je=tt.debugOverlayCanvas.getContext("2d");je.clearRect(0,0,Qe.width,Qe.height),je.shadowColor="white",je.shadowBlur=2,je.lineWidth=1.5,je.strokeStyle="white",je.textBaseline="top",je.font="bold 36px Open Sans, sans-serif",je.fillText(rt,5,5),je.strokeText(rt,5,5),tt.debugOverlayTexture.update(Qe),tt.debugOverlayTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}(f,Fe)}const se=i.getTile(u).tileSize,le=512/Math.min(se,512)*(u.overscaledZ/R.zoom)*.5,ce=Z._tileDebugTextBuffer||f.debugBuffer,Se=Z._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Oe=Z._tileDebugTextSegments||f.debugSegments;H.draw(f,L.TRIANGLES,X,Y,o.a.alphaBlended,o.af.disabled,To(U,o.C.transparent,le),oe,ce,Se,Oe,null,null,null,[Z._globeTileDebugTextBuffer])}function On(f,i,u,p){ls(f,0,i+u/2,f.transform.width,u,p)}function Nn(f,i,u,p){ls(f,i-u/2,0,u,f.transform.height,p)}function ls(f,i,u,p,x,v){const S=f.context,C=S.gl;C.enable(C.SCISSOR_TEST),C.scissor(i*o.e.devicePixelRatio,u*o.e.devicePixelRatio,p*o.e.devicePixelRatio,x*o.e.devicePixelRatio),S.clear({color:v}),C.disable(C.SCISSOR_TEST)}const Zl=o.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Wn}=Zl;function Eo(f,i,u,p){f.emplaceBack(i,u,p)}class Xr{constructor(i){this.vertexArray=new o.c8,this.indices=new o.bu,Eo(this.vertexArray,-1,-1,1),Eo(this.vertexArray,1,-1,1),Eo(this.vertexArray,-1,1,1),Eo(this.vertexArray,1,1,1),Eo(this.vertexArray,-1,-1,-1),Eo(this.vertexArray,1,-1,-1),Eo(this.vertexArray,-1,1,-1),Eo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Wn),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=o.b.simpleSegment(0,0,36,12)}}function Gr(f,i,u,p,x,v){const S=f.context.gl,C=i.paint.get("sky-atmosphere-color"),R=i.paint.get("sky-atmosphere-halo-color"),L=i.paint.get("sky-atmosphere-sun-intensity"),O=((F,U,j,H,Z)=>({u_matrix_3f:F,u_sun_direction:U,u_sun_intensity:j,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(o.bC.fromMat4(o.bC.create(),p),x,L,C,R);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+v,i.skyboxTexture,0),u.draw(f,S.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.unblended,o.af.frontCW,O,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const ys=o.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Yr{constructor(i){const u=new o.c9;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const p=new o.bu;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(u,ys.members),this.indexBuffer=i.createIndexBuffer(p),this.segments=o.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Wm=o.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class yh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class xh{constructor(i){this.colorModeAlphaBlendedWriteRGB=new o.a([o.ca,o.cb,o.ca,o.cb],o.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new o.a([o.ca,o.cc,o.ca,o.cc],o.C.transparent,[!1,!1,!1,!0]),this.params=new yh,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const u=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Yr(u);const p=this.params.sizeRange,x=this.params.intensityRange,v=function(O){const F=o.cf(30),U=[];for(let j=0;j<O;++j){const H=2*Math.PI*F(),Z=Math.acos(1-2*F())-.5*Math.PI;U.push(o._.fromValues(Math.cos(Z)*Math.cos(H),Math.cos(Z)*Math.sin(H),Math.sin(Z)))}return U}(this.params.starsCount),S=o.cf(300),C=new o.cd,R=new o.bu;let L=0;for(let O=0;O<v.length;++O){const F=o._.scale([],v[O],200),U=Math.max(0,1+.01*p*(1*S()-.5)),j=Math.max(0,1+.01*x*(1*S()-.5));C.emplaceBack(F[0],F[1],F[2],-1,-1,U,j),C.emplaceBack(F[0],F[1],F[2],1,-1,U,j),C.emplaceBack(F[0],F[1],F[2],1,1,U,j),C.emplaceBack(F[0],F[1],F[2],-1,1,U,j),R.emplaceBack(L+0,L+1,L+2),R.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=u.createVertexBuffer(C,Wm.members),this.starsIdx=u.createIndexBuffer(R),this.starsSegments=o.b.simpleSegment(0,0,C.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,u){const p=i.context,x=p.gl,v=i.transform,S=new o.ae(x.LEQUAL,o.ae.ReadOnly,[0,1]),C=o.a1(v.zoom),R=i.style.getLut(u.scope),L=u.properties.get("color").toRenderColor(R).toArray01(),O=u.properties.get("high-color").toRenderColor(R).toArray01(),F=u.properties.get("space-color").toRenderColor(R).toArray01PremultipliedAlpha(),U=5e-4,j=o.ce(u.properties.get("horizon-blend"),0,1,U,.25),H=o.ba(i,p,v)&&j===U?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,Z=i.frameCounter/1e3%1,X=o._.length(v.globeCenterInViewSpace),Y=Math.sqrt(Math.pow(X,2)-Math.pow(H,2)),ie=Math.acos(Y/X),oe=ue=>{const ge=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ue&&ge.push("ALPHA_PASS");const _e=i.getOrCreateProgram("globeAtmosphere",{defines:ge}),se=((ce,Se,Oe,pe,Be,Fe,tt,rt,Qe,Pe,je,Ke)=>({u_frustum_tl:ce,u_frustum_tr:Se,u_frustum_br:Oe,u_frustum_bl:pe,u_horizon:Be,u_transition:Fe,u_fadeout_range:tt,u_color:rt,u_high_color:Qe,u_space_color:Pe,u_temporal_offset:je,u_horizon_angle:Ke}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,C,j,L,O,F,Z,ie);i.uploadCommonUniforms(p,_e);const le=this.atmosphereBuffer;le&&_e.draw(i,x.TRIANGLES,S,o.ag.disabled,ue?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,o.af.backCW,se,ue?"atmosphere_glow_alpha":"atmosphere_glow",le.vertexBuffer,le.indexBuffer,le.segments)};oe(!1),oe(!0)}drawStars(i,u){const p=o.at(u.properties.get("star-intensity"),0,1);if(p===0)return;const x=i.context,v=x.gl,S=i.transform,C=i.getOrCreateProgram("stars"),R=o.av.identity([]);o.av.rotateX(R,R,-S._pitch),o.av.rotateZ(R,R,-S.angle),o.av.rotateX(R,R,o.ab(S._center.lat)),o.av.rotateY(R,R,-o.ab(S._center.lng));const L=o.ad.fromQuat(new Float32Array(16),R),O=o.ad.multiply([],S.starsProjMatrix,L),F=o.bC.fromMat4([],L),U=o.bC.invert([],F),j=[0,1,0];o._.transformMat3(j,j,U),o._.scale(j,j,this.params.sizeMultiplier);const H=[1,0,0];o._.transformMat3(H,H,U),o._.scale(H,H,this.params.sizeMultiplier);const Z=(X=j,Y=H,ie=p,{u_matrix:Float32Array.from(O),u_up:X,u_right:Y,u_intensity_multiplier:ie});var X,Y,ie;i.uploadCommonUniforms(x,C),this.starsVx&&this.starsIdx&&C.draw(i,v.TRIANGLES,o.ae.disabled,o.ag.disabled,this.colorModeAlphaBlendedWriteRGB,o.af.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Wo(f,i){const u=[...f],p=i.cameraWorldSizeForFog/i.worldSize,x=o.ad.identity([]);return o.ad.scale(x,x,[p,p,1]),o.ad.multiply(u,x,u),o.ad.multiply(u,i.worldToFogMatrix,u),u}function Xl(f,i,u,p,x){const v=u.material,S=p.context,{baseColorTexture:C,metallicRoughnessTexture:R}=v.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:O,emissionTexture:F}=v;function U(j,H,Z){if(j&&(f.push(H),S.activeTexture.set(S.gl.TEXTURE0+Z),j.gfxTexture)){const{minFilter:X,magFilter:Y,wrapS:ie,wrapT:oe}=j.sampler;j.gfxTexture.bindExtraParam(X,Y,ie,oe)}}U(C,"HAS_TEXTURE_u_baseColorTexture",Di.BaseColor),U(R,"HAS_TEXTURE_u_metallicRoughnessTexture",Di.MetallicRoughness),U(L,"HAS_TEXTURE_u_normalTexture",Di.Normal),U(O,"HAS_TEXTURE_u_occlusionTexture",Di.Occlusion),U(F,"HAS_TEXTURE_u_emissionTexture",Di.Emission),x&&(x.texture||(x.texture=new o.ch(p.context,x.image,[x.image.height,x.image.height,x.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Di.LUT),x.texture&&x.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(u.texcoordBuffer)),u.colorBuffer&&(f.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(u.colorBuffer)),u.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(u.normalBuffer)),u.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(u.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function no(f,i,u,p,x,v){const S=u.paint.get("model-opacity"),C=i.context,R=new o.ae(i.context.gl.LEQUAL,o.ae.ReadWrite,i.depthRangeFor3D),L=i.transform,O=f.mesh,F=O.material,U=F.pbrMetallicRoughness,j=i.style.fog;let H;H=i.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:o.ad.multiply([],p.zScaleMatrix,f.nodeModelMatrix),o.ad.multiply(H,p.negCameraPosMatrix,H);const Z=o.ad.invert([],H);o.ad.transpose(Z,Z);const X=u.paint.get("model-emissive-strength").constantOr(0),Y=An(new Float32Array(f.worldViewProjection),new Float32Array(H),new Float32Array(Z),null,i,S,U.baseColorFactor.toRenderColor(null),F.emissiveFactor,U.metallicFactor,U.roughnessFactor,F,X,u),ie={defines:[]},oe=[];Xl(ie.defines,oe,O,i,u.lut);const ue=i.shadowRenderer;ue&&(ue.useNormalOffset=!1);let ge=null;if(j){const le=Wo(f.nodeModelMatrix,i.transform);if(ge=new Float32Array(le),L.projection.name!=="globe"){const ce=O.aabb.min,Se=O.aabb.max,[Oe,pe]=j.getOpacityForBounds(le,ce[0],ce[1],Se[0],Se[1]);ie.overrideFog=Oe>=br||pe>=br}}const _e=mr(i,u.paint.get("model-cutoff-fade-range"));_e.shouldRenderCutoff&&ie.defines.push("RENDER_CUTOFF");const se=i.getOrCreateProgram("model",ie);i.uploadCommonUniforms(C,se,null,ge,_e),i.renderPass!=="shadow"&&ue&&ue.setupShadowsFromMatrix(f.nodeModelMatrix,se),se.draw(i,C.gl.TRIANGLES,R,x,v,O.material.doubleSided?o.af.disabled:o.af.backCCW,Y,u.id,O.vertexBuffer,O.indexBuffer,O.segments,u.paint,i.transform.zoom,void 0,oe)}function oi(f,i,u,p,x,v,S){let C;C=f.projection.name==="globe"?o.ci(u,f):[...u],o.ad.multiply(C,C,i.matrix);const R=o.ad.multiply([],p,C);if(i.meshes)for(const L of i.meshes){if(L.material.alphaMode!=="BLEND"){S.push({mesh:L,depth:0,modelIndex:x,worldViewProjection:R,nodeModelMatrix:C});continue}const O=o._.transformMat4([],L.centroid,R);O[2]>0&&v.push({mesh:L,depth:O[2],modelIndex:x,worldViewProjection:R,nodeModelMatrix:C})}if(i.children)for(const L of i.children)oi(f,L,u,p,x,v,S)}function Ti(f,i,u,p){const x=u.shadowRenderer;if(!x)return;const v=x.getShadowPassDepthMode(),S=x.getShadowPassColorMode(),C=x.calculateShadowPassMatrixFromMatrix(i),R=_r(C);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,v,o.ag.disabled,S,o.af.backCCW,R,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,u.transform.zoom,void 0,void 0)}function vh(f,i,u){const p=i.updateZoomBasedPaintProperties(),x=function(v,S,C){let R,L,O,F=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&F>0){const U=v.terrain,j=U.findDEMTileFor(C);j&&j.dem?R=o.ck.create(U,C,j):F=0}if(F===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),F===S.validForExaggeration&&(F===0||R&&R._demTile&&R._demTile.tileID===S.validForDEMTile.id&&R._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const U in S.instancesPerModel){const j=S.instancesPerModel[U];for(let H=0;H<j.instancedDataArray.length;++H){const Z=(R?F*R.getElevationAt(0|j.instancedDataArray.float32[16*H],0|j.instancedDataArray.float32[16*H+1],!0,!0):0)+j.instancesEvaluatedElevation[H];j.instancedDataArray.float32[16*H+6]=Z,L=L?Math.min(S.terrainElevationMin,Z):Z,O=O?Math.max(S.terrainElevationMax,Z):Z}}return S.terrainElevationMin=L||0,S.terrainElevationMax=O||0,S.validForExaggeration=F,S.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,i,u);(p||x)&&(i.uploaded=!1,i.upload(f.context))}const mi={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.b6([0,0,0],[o.a3,o.a3,0])};function ni(f,i){const u=1<<f.canonical.z,p=i.getFreeCameraOptions().position,x=i.elevation,v=f.canonical.x/u,S=(f.canonical.x+1)/u,C=f.canonical.y/u,R=(f.canonical.y+1)/u;let L=i._centerAltitude;if(x){const j=x.getMinMaxForTile(f);j&&j.max>L&&(L=j.max)}const O=o.at(p.x,v,S)-p.x,F=o.at(p.y,C,R)-p.y,U=o.ax(L,i.center.lat)-p.z;return i._zoomFromMercatorZ(Math.sqrt(O*O+F*F+U*U))}function ro(f,i,u,p,x,v,S){const C=f.context,R=f.renderPass==="shadow",L=f.shadowRenderer,O=R&&L?L.getShadowPassDepthMode():new o.ae(C.gl.LEQUAL,o.ae.ReadWrite,f.depthRangeFor3D),F=f.isTileAffectedByFog(v);if(u.meshes)for(const U of u.meshes){const j=["MODEL_POSITION_ON_GPU"],H=[];let Z,X,Y;p.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const ie=mr(f,i.paint.get("model-cutoff-fade-range"));if(ie.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),R&&L)Z=f.getOrCreateProgram("modelDepth",{defines:j}),X=_r(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(u.matrix)),Y=L.getShadowPassColorMode();else{Xl(j,H,U,f,i.lut),Z=f.getOrCreateProgram("model",{defines:j,overrideFog:F});const ue=U.material,ge=ue.pbrMetallicRoughness,_e=i.paint.get("model-opacity"),se=i.paint.get("model-emissive-strength").constantOr(0);X=An(v.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,f,_e,ge.baseColorFactor.toRenderColor(null),ue.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,ue,se,i,x),L&&(S.shadowUniformsInitialized?Z.setShadowUniformValues(C,L.getShadowUniformValues()):(L.setupShadows(v.toUnwrapped(),Z,"model-tile",v.overscaledZ),S.shadowUniformsInitialized=!0)),Y=ie.shouldRenderCutoff||_e<1||ue.alphaMode!=="OPAQUE"?o.a.alphaBlended:o.a.unblended}f.uploadCommonUniforms(C,Z,v.toUnwrapped(),null,ie);const oe=U.material.doubleSided?o.af.disabled:o.af.backCCW;if(p.instancedDataArray.length>20)H.push(p.instancedDataBuffer),Z.draw(f,C.gl.TRIANGLES,O,o.ag.disabled,Y,oe,X,i.id,U.vertexBuffer,U.indexBuffer,U.segments,i.paint,f.transform.zoom,void 0,H,p.instancedDataArray.length);else{const ue=R?"u_instance":"u_normal_matrix";for(let ge=0;ge<p.instancedDataArray.length;++ge)X[ue]=new Float32Array(p.instancedDataArray.arrayBuffer,64*ge,16),Z.draw(f,C.gl.TRIANGLES,O,o.ag.disabled,Y,oe,X,i.id,U.vertexBuffer,U.indexBuffer,U.segments,i.paint,f.transform.zoom,void 0,H)}}if(u.children)for(const U of u.children)ro(f,i,U,p,x,v,S)}const ba=[1,-1,1];function _i(f,i,u,p){if(!u.modelManager)return!0;const x=u.modelManager;if(!u.shadowRenderer)return!0;const v=u.shadowRenderer,S=i.aabb;let C=!0,R=f.maxHeight;if(R===0){let O=0;for(const F in f.instancesPerModel){const U=x.getModel(F,p);U?O=Math.max(O,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):C=!1}R=f.maxScale*O*1.41+f.maxVerticalOffset,C&&(f.maxHeight=R)}S.max[2]=R,S.min[2]+=f.terrainElevationMin,S.max[2]+=f.terrainElevationMax,o._.transformMat4(S.min,S.min,i.tileMatrix),o._.transformMat4(S.max,S.max,i.tileMatrix);const L=S.intersects(v.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=L===2),L===0}function _p(f,i){const u=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],v=f.uniformValues.u_cutoff_params[3];return p===u||v===x?1:o.at(((i-u)/(p-u)-x)/(v-x),0,1)}function xs(f,i,u,p){if(i.pitch<20)return 1;const x=i.getWorldToCameraMatrix(),v=o.ad.multiply([],x,f),S=[...u.min,1];let C=o.aA.transformMat4([],S,v),R=C,L=C;S[1]=u.max[1],C=o.aA.transformMat4([],S,v),R=C[1]<R[1]?C:R,L=C[1]>L[1]?C:L,S[0]=u.max[0],C=o.aA.transformMat4([],S,v),R=C[1]<R[1]?C:R,L=C[1]>L[1]?C:L,S[1]=u.min[1],C=o.aA.transformMat4([],S,v),R=C[1]<R[1]?C:R,L=C[1]>L[1]?C:L;const O=o.at(p[0],0,1),F=100*i.pixelsPerMeter*o.at(p[1],0,1),U=o.at(p[2],0,1),j=o._.lerp([],R,L,O),H=Math.tan(.5*i.fovX),Z=-j[2]*H;if(F===0)return j[1]<-Math.abs(Z)?U:1;const X=(-Math.abs(Z)-j[1])/F,Y=(oe,ue,ge)=>(1-ge)*oe+ge*ue,ie=o.at(Y(1,U,X),U,1);return Y(1,ie,o.at((i.pitch-20)/20,0,1))}class Ta{}class uc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,u,p){{const F=this._storage.get(u.id);if(F)return F.lastUsedFrameIdx=i,F.buf}const x=p.gl,v=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),S=new ArrayBuffer(v),C=new Int16Array(S);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const R=new o.cm;for(let F=0;F<v/2;F+=3){const U=C[F],j=C[F+1],H=C[F+2];R.emplaceBack(U,j),R.emplaceBack(j,H),R.emplaceBack(H,U)}const L=p.bindVertexArrayOES.current,O=new Ta;return O.buf=new o.I(p,R),O.lastUsedFrameIdx=i,this._storage.set(u.id,O),p.bindVertexArrayOES.set(L),O.buf}update(i){for(const[u,p]of this._storage)i-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(u))}destroy(){for(const[i,u]of this._storage)u.buf.destroy(),this._storage.delete(i)}}const fe=o.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class cc{constructor(i){const u=new o.cn,p=new o.bu;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1),p.emplaceBack(0,1,2),p.emplaceBack(0,2,3),this.segments=o.b.simpleSegment(0,0,u.length,p.length),this.vx=i.createVertexBuffer(u,fe.members),this.idx=i.createIndexBuffer(p)}destroy(){this.vx.destroy(),this.idx.destroy()}}const vs={symbol:function(f,i,u,p,x){if(f.renderPass!=="translucent")return;const v=o.ag.disabled,S=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(L,O,F,U,j,H,Z){const X=O.transform,Y=j==="map",ie=H==="map";for(const oe of L){const ue=U.getTile(oe),ge=ue.getBucket(F);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const _e=o.aD(ge.textSizeData,X.zoom),se=$i(oe,ge.getProjection(),X),le=X.calculatePixelsToTileUnitsMatrix(ue),ce=ga(se,ue.tileID.canonical,ie,Y,X,ge.getProjection(),le),Se=ge.hasIconTextFit()&&ge.hasIconData();if(_e){const Oe=Math.pow(2,X.zoom-ue.tileID.overscaledZ);Tr(ge,Y,ie,Z,o.bO,X,ce,oe,Oe,_e,Se)}}}(p,f,u,i,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),x);const C=u.paint.get("icon-opacity").constantOr(1)!==0,R=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||R)?pp(f,i,u,p,v,S):(C&&pp(f,i,u,p,v,S,{onlyIcons:!0}),R&&pp(f,i,u,p,v,S,{onlyText:!0}),function(L,O,F,U){if(!L.symbolParams.useOcclusionQueries)return;const j=L.context.gl,H=L.transform,Z=F.paint,X=Z.get("icon-occlusion-opacity").constantOr(0),Y=Z.get("text-occlusion-opacity").constantOr(0);if(!F.hasInitialOcclusionOpacityProperties||X===1&&Y===1)return;const ie=H.projection.name==="globe";for(const oe of U){const ue=O.getTile(oe),ge=ue.getBucket(F);if(!ge||ge.projection.name==="mercator"&&ie||ge.fullyClipped)continue;if(ge.projection.name==="globe"){o.w(`Occlusion not supported for globe mode. Layer: ${F.type}`);continue}const _e=$i(oe,ge.getProjection(),H),se=o.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,L.symbolParams.depthOffset,1),le=o.ad.multiply([],se,_e),ce=L.symbolParams.visualizeOcclusions!=="none"?1:L.symbolParams.occlusionQueryFrameWindow;for(let Se=0;Se<ge.symbolInstances.length;Se++){const Oe=ge.symbolInstances.get(Se),pe=L.style.placement.opacities[Oe.crossTileID];if(pe&&pe.isHidden()||(L.frameCounter+Se)%ce!=0)continue;const Be=Oe.tileAnchorX,Fe=Oe.tileAnchorY,tt=Oe.zOffset;let rt;if(L.symbolParams.visualizeOcclusions==="none"){const bt=ge.queries.get(Se);if(bt){if(!bt.isFree()){if(!bt.isResultAvailable())continue;const St=bt.consumeResult();Oe.occlusionState=St===0?0:1;continue}rt=bt}else rt=new $a(L.context),ge.queries.set(Se,rt)}const Qe=L.getOrCreateProgram("occlusion"),Pe=L.symbolParams.occluderSize,je=pi(le,[Be,Fe,tt],[H.width,H.height],[Pe,Pe],L.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);L.terrain&&L.terrain.setupElevationDraw(ue,Qe,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),L.symbolParams.visualizeOcclusions==="none"&&rt&&rt.begin();const Ke=new o.ae(L.symbolParams.visualizeOcclusions==="zPass"?L.context.gl.ALWAYS:L.context.gl.LEQUAL,o.ae.ReadOnly,L.depthRangeFor3D);Qe.draw(L,j.TRIANGLES,Ke,o.ag.disabled,L.symbolParams.visualizeOcclusions!=="none"?o.a.alphaBlendedNonPremultiplied:o.a.disabled,o.af.disabled,je,"occlusion",L.occlusionBuffers.vx,L.occlusionBuffers.idx,L.occlusionBuffers.segments),L.symbolParams.visualizeOcclusions==="none"&&rt&&rt.end()}}}(f,i,u,p)),i.map.showCollisionBoxes&&(_h(f,i,u,p,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),_h(f,i,u,p,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,i,u,p){if(f.renderPass!=="translucent")return;const x=u.paint.get("circle-opacity"),v=u.paint.get("circle-stroke-width"),S=u.paint.get("circle-stroke-opacity"),C=u.layout.get("circle-sort-key").constantOr(1)!==void 0,R=u.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(v.constantOr(1)===0||S.constantOr(1)===0))return;const L=f.context,O=L.gl,F=f.transform,U=f.depthModeForSublayer(0,o.ae.ReadOnly),j=o.ag.disabled,H=f.colorModeForDrapableLayerRenderPass(R),Z=F.projection.name==="globe",X=[o.aj(F.center.lng),o.ak(F.center.lat)],Y=[];for(let oe=0;oe<p.length;oe++){const ue=p[oe],ge=i.getTile(ue),_e=ge.getBucket(u);if(!_e||_e.projection.name!==F.projection.name)continue;const se=_e.programConfigurations.get(u.id),le=o.bR(u),ce=f.isTileAffectedByFog(ue);Z&&le.push("PROJECTION_GLOBE_VIEW");const Se=f.getOrCreateProgram("circle",{config:se,defines:le,overrideFog:ce}),Oe=_e.layoutVertexBuffer,pe=_e.globeExtVertexBuffer,Be=_e.indexBuffer,Fe=F.projection.createInversionMatrix(F,ue.canonical),tt={programConfiguration:se,program:Se,layoutVertexBuffer:Oe,globeExtVertexBuffer:pe,indexBuffer:Be,uniformValues:o.bS(f,ue,ge,Fe,X,u),tile:ge};if(C){const rt=_e.segments.get();for(const Qe of rt)Y.push({segments:new o.b([Qe]),sortKey:Qe.sortKey,state:tt})}else Y.push({segments:_e.segments,sortKey:0,state:tt})}C&&Y.sort((oe,ue)=>oe.sortKey-ue.sortKey);const ie={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const oe of Y){const{programConfiguration:ue,program:ge,layoutVertexBuffer:_e,globeExtVertexBuffer:se,indexBuffer:le,uniformValues:ce,tile:Se}=oe.state,Oe=oe.segments;f.terrain&&f.terrain.setupElevationDraw(Se,ge,ie),f.uploadCommonUniforms(L,ge,Se.tileID.toUnwrapped()),ge.draw(f,O.TRIANGLES,U,j,H,o.af.disabled,ce,u.id,_e,le,Oe,u.paint,F.zoom,ue,[se])}},heatmap:function(f,i,u,p){if(u.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,v=x.gl,S=o.ag.disabled,C=new o.a([v.ONE,v.ONE,v.ONE,v.ONE],o.C.transparent,[!0,!0,!0,!0]);(function(j,H,Z,X){const Y=j.gl,ie=H.width*X,oe=H.height*X;j.activeTexture.set(Y.TEXTURE1),j.viewport.set([0,0,ie,oe]);let ue=Z.heatmapFbo;if(!ue||ue&&(ue.width!==ie||ue.height!==oe)){ue&&ue.destroy();const ge=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,ge),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),ue=Z.heatmapFbo=j.createFramebuffer(ie,oe,!0,null),function(_e,se,le,ce,Se,Oe){const pe=_e.gl;pe.texImage2D(pe.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?pe.RGBA16F:pe.RGBA,Se,Oe,0,pe.RGBA,_e.extRenderToTextureHalfFloat?pe.HALF_FLOAT:pe.UNSIGNED_BYTE,null),ce.colorAttachment.set(le)}(j,0,ge,ue,ie,oe)}else Y.bindTexture(Y.TEXTURE_2D,ue.colorAttachment.get()),j.bindFramebuffer.set(ue.framebuffer)})(x,f,u,f.transform.projection.name==="globe"?.5:.25),x.clear({color:o.C.transparent});const R=f.transform,L=R.projection.name==="globe",O=L?["PROJECTION_GLOBE_VIEW"]:[],F=L?o.af.frontCCW:o.af.disabled,U=[o.aj(R.center.lng),o.ak(R.center.lat)];for(let j=0;j<p.length;j++){const H=p[j];if(i.hasRenderableParent(H))continue;const Z=i.getTile(H),X=Z.getBucket(u);if(!X||X.projection.name!==R.projection.name)continue;const Y=f.isTileAffectedByFog(H),ie=X.programConfigurations.get(u.id),oe=f.getOrCreateProgram("heatmap",{config:ie,defines:O,overrideFog:Y}),{zoom:ue}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Z,oe),f.uploadCommonUniforms(x,oe,H.toUnwrapped());const ge=R.projection.createInversionMatrix(R,H.canonical);oe.draw(f,v.TRIANGLES,o.ae.disabled,S,C,F,Wl(f,H,Z,ge,U,ue,u.paint.get("heatmap-intensity")),u.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,u.paint,f.transform.zoom,ie,L?[X.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,v){const S=x.context,C=S.gl,R=v.heatmapFbo;if(!R)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,R.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1);let L=v.colorRampTexture;L||(L=v.colorRampTexture=new o.T(S,v.colorRamp,C.RGBA)),L.bind(C.LINEAR,C.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,C.TRIANGLES,o.ae.disabled,o.ag.disabled,x.colorModeForRenderPass(),o.af.disabled,((O,F,U,j)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,v),v.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,v.paint,x.transform.zoom)}(f,u))},line:function(f,i,u,p){if(f.renderPass!=="translucent")return;const x=u.paint.get("line-opacity"),v=u.paint.get("line-width");if(x.constantOr(1)===0||v.constantOr(1)===0)return;const S=u.paint.get("line-emissive-strength"),C=u.paint.get("line-occlusion-opacity"),R=f.context,L=R.gl,O=u.layout.get("line-z-offset"),F=!O.isConstant()||!!O.constantOr(0),U=F?new o.ae(f.depthOcclusion?L.GREATER:L.LEQUAL,o.ae.ReadOnly,f.depthRangeFor3D):f.depthModeForSublayer(0,o.ae.ReadOnly),j=f.colorModeForDrapableLayerRenderPass(S),H=f.terrain&&f.terrain.renderingToTexture,Z=H?1:o.e.devicePixelRatio,X=u.paint.get("line-dasharray"),Y=X.constantOr(1),ie=u.layout.get("line-cap"),oe=X.constantOr(null),ue=ie.constantOr(null),ge=u.paint.get("line-pattern"),_e=ge.constantOr(1),se=ge.constantOr(null),le=u.paint.get("line-opacity").constantOr(1);let ce=!_e&&le!==1||f.depthOcclusion&&C>0&&C<1;const Se=u.paint.get("line-gradient"),Oe=_e?"linePattern":"line",pe=o.bT(u);let Be;if(H&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ce=!1),C!==0&&f.depthOcclusion){const tt=u.paint._values["line-opacity"];tt&&tt.value&&tt.value.kind==="constant"?Be=tt.value:o.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}if(F&&(f.forceTerrainMode=!0),!F&&C!==0&&f.terrain&&!H)return void o.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Fe=ce&&F?f.stencilModeFor3D():o.ag.disabled;for(const tt of p){const rt=i.getTile(tt);if(_e&&!rt.patternsLoaded())continue;const Qe=rt.getBucket(u);if(!Qe)continue;f.prepareDrawTile();const Pe=Qe.programConfigurations.get(u.id),je=f.isTileAffectedByFog(tt),Ke=f.getOrCreateProgram(Oe,{config:Pe,defines:F?[...pe,"ELEVATED"]:pe,overrideFog:je});if(se&&rt.imageAtlas){const Ze=rt.imageAtlas.patternPositions[se.toString()];Ze&&Pe.setConstantPatternPositions(Ze)}if(!_e&&oe&&ue&&rt.lineAtlas){const Ze=rt.lineAtlas.getDash(oe,ue);Ze&&Pe.setConstantPatternPositions(Ze)}let[bt,St]=u.paint.get("line-trim-offset");(ue==="round"||ue==="square")&&bt!==St&&(bt===0&&(bt-=1),St===1&&(St+=1));const Pt=H?tt.projMatrix:null,Et=_e?o.bU(f,rt,u,Pt,Z,[bt,St]):o.bV(f,rt,u,Pt,Qe.lineClipsArray.length,Z,[bt,St]);if(Se){const Ze=Qe.gradients[u.id];let kt=Ze.texture;if(u.gradientVersion!==Ze.version){let cn=256;if(u.stepInterpolant){const sn=i.getSource().maxzoom,yn=tt.canonical.z===sn?Math.ceil(1<<f.transform.maxZoom-tt.canonical.z):1;cn=o.at(o.bW(Qe.maxLineLength/o.a3*1024*yn),256,R.maxTextureSize)}Ze.gradient=o.bX({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:cn,image:Ze.gradient||void 0,clips:Qe.lineClipsArray}),Ze.texture?Ze.texture.update(Ze.gradient):Ze.texture=new o.T(R,Ze.gradient,L.RGBA),Ze.version=u.gradientVersion,kt=Ze.texture}R.activeTexture.set(L.TEXTURE1),kt.bind(u.stepInterpolant?L.NEAREST:L.LINEAR,L.CLAMP_TO_EDGE)}Y&&(R.activeTexture.set(L.TEXTURE0),rt.lineAtlasTexture&&rt.lineAtlasTexture.bind(L.LINEAR,L.REPEAT),Pe.updatePaintBuffers()),_e&&(R.activeTexture.set(L.TEXTURE0),rt.imageAtlasTexture&&rt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Pe.updatePaintBuffers()),F&&f.terrain.setupElevationDraw(rt,Ke),f.uploadCommonUniforms(R,Ke,tt.toUnwrapped());const ot=Ze=>{Be!=null&&(Be.value=le*C),Ke.draw(f,L.TRIANGLES,U,Ze,j,o.af.disabled,Et,u.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,u.paint,f.transform.zoom,Pe,[Qe.layoutVertexBuffer2,Qe.patternVertexBuffer,Qe.zOffsetVertexBuffer]),Be!=null&&(Be.value=le)};if(ce&&!F){const Ze=f.stencilModeForClipping(tt).ref;Ze===0&&H&&R.clear({stencil:0});const kt={func:L.EQUAL,mask:255};Et.u_alpha_discard_threshold=.8,ot(new o.ag(kt,Ze,255,L.KEEP,L.KEEP,L.INVERT)),Et.u_alpha_discard_threshold=0,ot(new o.ag(kt,Ze,255,L.KEEP,L.KEEP,L.KEEP))}else ce&&F&&(Et.u_alpha_discard_threshold=.001),ot(F?Fe:f.stencilModeForClipping(tt))}ce&&(f.resetStencilClippingMasks(),H&&R.clear({stencil:0})),C===0||f.depthOcclusion||H||f.layersWithOcclusionOpacity.push(f.currentLayer),F&&(f.forceTerrainMode=!1)},fill:function(f,i,u,p){const x=u.paint.get("fill-color"),v=u.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const S=u.paint.get("fill-emissive-strength"),C=f.colorModeForDrapableLayerRenderPass(S),R=u.paint.get("fill-pattern"),L=f.opaquePassEnabledForLayer()&&!R.constantOr(1)&&x.constantOr(o.C.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===L){const O=f.depthModeForSublayer(1,f.renderPass==="opaque"?o.ae.ReadWrite:o.ae.ReadOnly);rc(f,i,u,p,O,C,!1)}if(f.renderPass==="translucent"&&u.paint.get("fill-antialias")){const O=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,o.ae.ReadOnly);rc(f,i,u,p,O,C,!0)}},"fill-extrusion":function(f,i,u,p){const x=u.paint.get("fill-extrusion-opacity"),v=f.context,S=v.gl,C=f.terrain,R=C&&C.renderingToTexture;if(x===0)return;const L=f.conflationActive&&f.style.isLayerClipped(u,i.getSource()),O=f.style.order.indexOf(u.fqid);if(L&&function(F,U,j,H,Z){for(const X of H){const Y=U.getTile(X).getBucket(j);Y&&(Y.updateReplacement(X,F.replacementSource,Z),Y.uploadCentroid(F.context))}}(f,i,u,p,O),C||L)for(const F of p){const U=i.getTile(F).getBucket(u);U&&Pd(f.context,i,F,U,u,C,L)}if(f.renderPass==="shadow"&&f.shadowRenderer){const F=f.shadowRenderer;if(C&&x<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.Z)return;const U=F.getShadowPassDepthMode(),j=F.getShadowPassColorMode();ic(f,i,u,p,U,o.ag.disabled,j,L)}else if(f.renderPass==="translucent"){const F=!u.paint.get("fill-extrusion-pattern").constantOr(1),U=u.paint.get("fill-extrusion-color").constantOr(o.C.white);if(!R&&U.a!==0){const j=new o.ae(f.context.gl.LEQUAL,o.ae.ReadWrite,f.depthRangeFor3D);x===1&&F?ic(f,i,u,p,j,o.ag.disabled,o.a.unblended,L):(ic(f,i,u,p,j,o.ag.disabled,o.a.disabled,L),ic(f,i,u,p,j,f.stencilModeFor3D(),f.colorModeForRenderPass(),L),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&F&&(!C&&f.transform.projection.name!=="globe"||R)){const j=u.paint.get("fill-extrusion-opacity"),H=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=u.paint.get("fill-extrusion-flood-light-intensity"),Y=u.paint.get("fill-extrusion-flood-light-color").toRenderColor(u.lut).toArray01().slice(0,3),ie=H>0&&Z>0,oe=X>0,ue=(_e,se,le)=>(1-le)*_e+le*se,ge=_e=>{const se=f.depthModeForSublayer(1,o.ae.ReadOnly,S.LEQUAL,!0),le=u.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ce=ue(.1,3,le),Se=f._showOverdrawInspector;if(!Se){const Oe=new o.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),pe=new o.a([S.ONE,S.ONE,S.ONE,S.ONE],o.C.transparent,[!1,!1,!1,!0],S.MIN);as(f,i,u,p,se,Oe,pe,o.af.disabled,_e,"sdf",j,H,Z,X,Y,ce,L,!1)}{const Oe=Se?o.ag.disabled:new o.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),pe=Se?f.colorModeForRenderPass():new o.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.C.transparent,[!0,!0,!0,!0]);as(f,i,u,p,se,Oe,pe,o.af.disabled,_e,"color",j,H,Z,X,Y,ce,L,!1)}};if(R){const _e=(se,le,ce)=>{const Se=f.depthModeForSublayer(1,o.ae.ReadOnly,S.LEQUAL,!1),Oe=u.paint.get(se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),pe=ue(.1,3,Oe);{const Be=new o.a([S.ONE,S.ONE,S.ONE,S.ONE],o.C.transparent,[!1,!1,!1,!0]);as(f,i,u,p,Se,o.ag.disabled,Be,o.af.disabled,se,"clear",j,H,Z,X,Y,pe,L,le)}{const Be=new o.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Fe=new o.a([S.ONE,S.ONE,S.ONE,S.ONE],o.C.transparent,[!1,!1,!1,!0],S.MIN);as(f,i,u,p,Se,Be,Fe,o.af.disabled,se,"sdf",j,H,Z,X,Y,pe,L,le)}{const Be=se?S.ZERO:S.ONE_MINUS_DST_ALPHA,Fe=new o.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),tt=new o.a([Be,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.C.transparent,[!0,!0,!0,!0]);as(f,i,u,p,Se,Fe,tt,o.af.disabled,se,"color",j,H,Z,X,Y,pe,L,le)}{const Be=new o.a([S.ONE,S.ONE,S.ONE,se?S.ZERO:S.ONE],o.C.transparent,[!1,!1,!1,!0],se?S.FUNC_ADD:S.MAX);as(f,i,u,p,Se,o.ag.disabled,Be,o.af.disabled,se,"clear",j,H,Z,X,Y,pe,L,le,ce)}};if(ie||oe){let se;if(f.prepareDrawTile(),C){const le=C.drapeBufferSize[0],ce=C.drapeBufferSize[1];se=C.framebufferCopyTexture,se&&(!se||se.size[0]===le&&se.size[1]===ce)||(se&&se.destroy(),se=C.framebufferCopyTexture=new o.T(v,new o.i({width:le,height:ce}),S.RGBA)),se.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,le,ce,0)}ie&&_e(!0,!1,se),oe&&_e(!1,!0,se)}}else ie&&ge(!0),oe&&ge(!1)}}},hillshade:function(f,i,u,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,v=f.terrain&&f.terrain.renderingToTexture,[S,C]=f.renderPass!=="translucent"||v?[{},p]:f.stencilConfigForOverlap(p);for(const R of C){const L=i.getTile(R);if(L.needsHillshadePrepare&&f.renderPass==="offscreen")Fo(f,L,u);else if(f.renderPass==="translucent"){const O=f.depthModeForSublayer(0,o.ae.ReadOnly),F=u.paint.get("hillshade-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(F),j=v&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):S[R.overscaledZ];Ag(f,R,L,u,O,j,U)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,i,u,p,x,v){if(f.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const S=f.transform.projection.name==="globe",C=u.paint.get("raster-elevation")!==0,R=C&&S;if(f.renderElevatedRasterBackface&&!R)return;const L=f.context,O=L.gl,F=i.getSource(),U=function(_e,se,le,ce){const Se=se.paint.get("raster-color"),Oe=_e.type==="raster-array",pe=[],Be=se.paint.get("raster-resampling"),Fe=se.paint.get("raster-color-mix");let tt=se.paint.get("raster-color-range");const rt=[Fe[0],Fe[1],Fe[2],0],Qe=Fe[3];let Pe=Be==="nearest"?ce.NEAREST:ce.LINEAR;if(Oe&&(pe.push("RASTER_ARRAY"),Se||pe.push("RASTER_COLOR"),Be==="linear"&&pe.push("RASTER_ARRAY_LINEAR"),Pe=ce.NEAREST,!tt&&_e.rasterLayers)){const je=_e.rasterLayers.find(({id:Ke})=>Ke===se.sourceLayer);je&&je.fields&&je.fields.range&&(tt=je.fields.range)}if(tt=tt||[0,1],Se){pe.push("RASTER_COLOR"),le.activeTexture.set(ce.TEXTURE2),se.updateColorRamp(tt);let je=se.colorRampTexture;je||(je=se.colorRampTexture=new o.T(le,se.colorRamp,ce.RGBA)),je.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}return{mix:rt,range:tt,offset:Qe,defines:pe,resampling:Pe}}(F,u,L,O);if(F instanceof o.bm&&!p.length&&!S)return;const j=u.paint.get("raster-emissive-strength"),H=f.colorModeForDrapableLayerRenderPass(j),Z=f.terrain&&f.terrain.renderingToTexture,X=!f.options.moving,Y=u.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;if(F instanceof o.bm&&!p.length&&(F.onNorthPole||F.onSouthPole)){const _e=C?f.stencilModeFor3D():o.ag.disabled;return void sc(!!F.onNorthPole,null,f,i,u,j,U,o.af.disabled,_e)}if(!p.length)return;const[ie,oe]=F instanceof o.bm||Z?[{},p]:f.stencilConfigForOverlap(p),ue=oe[oe.length-1].overscaledZ;R&&U.defines.push("PROJECTION_GLOBE_VIEW"),C&&U.defines.push("RENDER_CUTOFF");const ge=(_e,se,le)=>{for(const ce of _e){const Se=ce.toUnwrapped(),Oe=i.getTile(ce);if(Z&&(!Oe||!Oe.hasData()))continue;L.activeTexture.set(O.TEXTURE0);const pe=Ld(Oe,F,u,U);if(!pe||!pe.texture)continue;const{texture:Be,mix:Fe,offset:tt,tileSize:rt,buffer:Qe}=pe;let Pe,je;Z?(Pe=o.ae.disabled,je=ce.projMatrix):C?(Pe=new o.ae(O.LEQUAL,o.ae.ReadWrite,f.depthRangeFor3D),je=S?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Se,X)):(Pe=f.depthModeForSublayer(ce.overscaledZ-ue,u.paint.get("raster-opacity")===1?o.ae.ReadWrite:o.ae.ReadOnly,O.LESS),je=f.transform.calculateProjMatrix(Se,X));const Ke=f.terrain&&Z?f.terrain.stencilModeForRTTOverlap(ce):ie[ce.overscaledZ],bt=v?0:u.paint.get("raster-fade-duration");Oe.registerFadeDuration(bt);const St=i.findLoadedParent(ce,0),Pt=Xu(Oe,St,i,f.transform,bt);let Et,ot;f.terrain&&f.terrain.prepareDrawTile(),L.activeTexture.set(O.TEXTURE0),Be.bind(Y,O.CLAMP_TO_EDGE),L.activeTexture.set(O.TEXTURE1),St?(St.texture&&St.texture.bind(Y,O.CLAMP_TO_EDGE),Et=Math.pow(2,St.tileID.overscaledZ-Oe.tileID.overscaledZ),ot=[Oe.tileID.canonical.x*Et%1,Oe.tileID.canonical.y*Et%1]):Be.bind(Y,O.CLAMP_TO_EDGE),Be.useMipmap&&L.extTextureFilterAnisotropic&&f.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Ze=f.transform;let kt;const cn=C?Gn(Ze):[0,0,0,0];let sn,yn,Sn,Vt,tn,Hn=0;if(R&&F instanceof o.bm&&F.coordinates.length>3)sn=Float32Array.from(o.bf(o.bg(new o.aO(0,0,0)))),yn=Float32Array.from(Ze.globeMatrix),Sn=Float32Array.from(o.bb(Ze)),Vt=[o.aj(Ze.center.lng),o.ak(Ze.center.lat)],kt=F.elevatedGlobePerspectiveTransform,tn=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const ln=o.bc(ce.canonical);Hn=o.bd(ln.getCenter().lat),sn=Float32Array.from(o.bf(o.bg(ce.canonical))),yn=Float32Array.from(Ze.globeMatrix),Sn=Float32Array.from(o.bb(Ze)),Vt=[o.aj(Ze.center.lng),o.ak(Ze.center.lat)],kt=[0,0],tn=Float32Array.from(o.be(ce.canonical,ln,Hn,Ze.worldSize/Ze._pixelsPerMercatorPixel))}else kt=F instanceof o.bm?F.perspectiveTransform:[0,0],sn=new Float32Array(16),yn=new Float32Array(9),Sn=new Float32Array(16),Vt=[0,0],tn=new Float32Array(9);const er=Vo(je,sn,yn,Sn,tn,ot||[0,0],o.a1(f.transform.zoom),Vt,cn,Et||1,Pt,u,kt,C?u.paint.get("raster-elevation"):0,2,Fe,tt,U.range,rt,Qe,j),nr=f.isTileAffectedByFog(ce),En=f.getOrCreateProgram("raster",{defines:U.defines,overrideFog:nr});if(f.uploadCommonUniforms(L,En,Se),F instanceof o.bm){const ln=F.elevatedGlobeVertexBuffer,Dn=F.elevatedGlobeIndexBuffer;if(Z||!S)F.boundsBuffer&&F.boundsSegments&&En.draw(f,O.TRIANGLES,Pe,o.ag.disabled,H,o.af.disabled,er,u.id,F.boundsBuffer,f.quadTriangleIndexBuffer,F.boundsSegments);else if(ln&&Dn){const vr=Ze.zoom<=o.b1?F.elevatedGlobeSegments:F.getSegmentsForLongitude(Ze.center.lng);vr&&En.draw(f,O.TRIANGLES,Pe,o.ag.disabled,H,se,er,u.id,ln,Dn,vr)}}else if(R){Pe=new o.ae(O.LEQUAL,o.ae.ReadOnly,f.depthRangeFor3D);const ln=f.globeSharedBuffers;if(ln){const[Dn,vr,ar]=ln.getGridBuffers(Hn,!1);En.draw(f,O.TRIANGLES,Pe,le||Ke,f.colorModeForRenderPass(),se,er,u.id,Dn,vr,ar)}}else{const{tileBoundsBuffer:ln,tileBoundsIndexBuffer:Dn,tileBoundsSegments:vr}=f.getTileBoundsBuffers(Oe);En.draw(f,O.TRIANGLES,Pe,Ke,H,o.af.disabled,er,u.id,ln,Dn,vr)}}if(!(F instanceof o.bm)&&R)for(const ce of _e){const Se=ce.canonical.y===(1<<ce.canonical.z)-1;ce.canonical.y===0&&sc(!0,ce,f,i,u,j,U,se,le||o.ag.disabled),Se&&sc(!1,ce,f,i,u,j,U,se===o.af.frontCW?o.af.backCW:o.af.frontCW,le||o.ag.disabled)}};R?ge(oe,f.renderElevatedRasterBackface?o.af.backCW:o.af.frontCW,f.stencilModeFor3D()):ge(oe,o.af.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,i,u,p,x,v){f.renderPass==="offscreen"&&function(S,C,R,L){if(!L.length)return;const O=S.context,F=O.gl,U=C.getSource();if(!(U instanceof Gl))return;const j=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let H=R.particlePositionRGBAImage;if(!H||H.width!==j){const oe=function(ue){const ge=ue*ue,_e=new Uint8Array(4*ge),se=function(ce){return ce|=0,ce=Math.imul(2747636419^ce,2654435769),ce=Math.imul(ce^ce>>>16,2654435769),((ce=Math.imul(ce^ce>>>16,2654435769))>>>0)/4294967296},le=1/1.3;for(let ce=0;ce<ge;ce++){const Se=le*(se(2*ce+0)+xa),Oe=le*(se(2*ce+1)+xa),pe=255*Se%1,Be=255*Oe%1,Fe=pe,tt=Oe-Be/255,rt=Be;_e[4*ce+0]=255*(Se-pe/255),_e[4*ce+1]=255*Fe,_e[4*ce+2]=255*tt,_e[4*ce+3]=255*rt}return _e}(j);H=R.particlePositionRGBAImage=new o.i({width:j,height:j},oe)}let Z=R.particleFramebuffer;Z?Z.width!==j&&(Z.destroy(),Z=R.particleFramebuffer=O.createFramebuffer(j,j,!0,null)):Z=R.particleFramebuffer=O.createFramebuffer(j,j,!0,null);const X=[];for(const oe of L){const ue=C.getTile(oe);if(!(ue instanceof o.c3))continue;const ge=Ht(ue,U,R);if(!ge)continue;const _e=[ue.tileSize,ue.tileSize];let se=R.tileFramebuffer;se||(se=R.tileFramebuffer=O.createFramebuffer(_e[0],_e[1],!0,null));let le=ue.rasterParticleState;le||(le=ue.rasterParticleState=new _s(O,oe,_e,H));const ce=le.update(R.lastInvalidatedAt);le.particleTextureDimension!==j&&le.updateParticleTexture(oe,H);const Se=le.targetColorTexture;le.targetColorTexture=le.backgroundColorTexture,le.backgroundColorTexture=Se;const Oe=le.particleTexture0;le.particleTexture0=le.particleTexture1,le.particleTexture1=Oe,X.push([oe,ge,le,ce])}if(X.length===0)return;const Y=o.e.now(),ie=R.previousDrawTimestamp?.001*(Y-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=Y,R.hasColorMap()){O.activeTexture.set(F.TEXTURE0+2);let oe=R.colorRampTexture;oe||(oe=R.colorRampTexture=new o.T(O,R.colorRamp,F.RGBA)),oe.bind(F.LINEAR,F.CLAMP_TO_EDGE)}O.bindFramebuffer.set(R.tileFramebuffer.framebuffer),function(oe,ue,ge){const _e=oe.context,se=_e.gl,le=ue.tileFramebuffer;_e.activeTexture.set(se.TEXTURE0);const ce={u_texture:0,u_opacity:1.05*(Oe=ue.paint.get("raster-particle-fade-opacity-factor"))/(Oe+.05)},Se=oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Oe;for(const pe of ge){const[,,Be,Fe]=pe;le.colorAttachment.set(Be.targetColorTexture.texture),_e.viewport.set([0,0,le.width,le.height]),_e.clear({color:o.C.transparent}),Fe&&(Be.backgroundColorTexture.bind(se.NEAREST,se.CLAMP_TO_EDGE),Se.draw(oe,se.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.alphaBlended,o.af.disabled,ce,ue.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments))}}(S,R,X),function(oe,ue,ge,_e){const se=oe.context,le=se.gl,ce=ge.tileFramebuffer,Se=oe.transform.projection.name==="globe",Oe=ge.paint.get("raster-particle-max-speed");for(const pe of _e){const[Be,Fe,tt]=pe;se.activeTexture.set(le.TEXTURE0+0),Fe.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),ce.colorAttachment.set(tt.targetColorTexture.texture);const rt=oe.getOrCreateProgram("rasterParticleDraw",{defines:Fe.defines,overrideFog:!1});se.activeTexture.set(le.TEXTURE0+1);const Qe=Fe.scalarData?[]:[0,1,2,3].map(Ke=>o.bZ[Ke](Be));Qe.push(Be);const Pe=Be.canonical.x,je=Be.canonical.y;for(const Ke of Qe){const bt=ue.getTile(Se?Ke.wrapped():Ke);if(!bt)continue;const St=bt.rasterParticleState;if(!St)continue;const Pt=Ke.canonical.x+(1<<Ke.canonical.z)*(Ke.wrap-Be.wrap),Et=Ke.canonical.y;St.particleTexture0.bind(le.NEAREST,le.CLAMP_TO_EDGE);const ot=fp(1,St.particleTexture0.size[0],[Pt-Pe,Et-je],0,Fe.texture.size,2,Oe,Fe.textureOffset,Fe.scale,Fe.offset);rt.draw(oe,le.POINTS,o.ae.disabled,o.ag.disabled,o.a.alphaBlended,o.af.disabled,ot,ge.id,St.particleIndexBuffer,void 0,St.particleSegment)}}}(S,C,R,X),O.bindFramebuffer.set(R.particleFramebuffer.framebuffer),function(oe,ue,ge,_e){const se=oe.context,le=se.gl,ce=ue.paint.get("raster-particle-max-speed"),Se=_e*ue.paint.get("raster-particle-speed-factor")*.15,Oe=function(Be){return Math.pow(Be,6)}(.01+1*ue.paint.get("raster-particle-reset-rate-factor")),pe=ue.particleFramebuffer;se.viewport.set([0,0,pe.width,pe.height]);for(const Be of ge){const[,Fe,tt]=Be;se.activeTexture.set(le.TEXTURE0+0),Fe.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),se.activeTexture.set(le.TEXTURE0+1);const rt=tt.particleTexture0;rt.bind(le.NEAREST,le.CLAMP_TO_EDGE);const Qe=Mg(1,rt.size[0],0,Fe.texture.size,ce,Se,Oe,Fe.textureOffset,Fe.scale,Fe.offset);pe.colorAttachment.set(tt.particleTexture1.texture),se.clear({color:o.C.transparent}),oe.getOrCreateProgram("rasterParticleUpdate",{defines:Fe.defines}).draw(oe,le.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.unblended,o.af.disabled,Qe,ue.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments)}}(S,R,X,ie)}(f,i,u,p),f.renderPass==="translucent"&&(function(S,C,R,L,O){const F=S.context,U=F.gl,j=!S.options.moving,H=S.transform.projection.name==="globe";if(!L.length)return;const[Z,X]=S.stencilConfigForOverlap(L),Y=[];H&&Y.push("PROJECTION_GLOBE_VIEW");const ie=S.stencilModeFor3D();for(const oe of X){const ue=oe.toUnwrapped(),ge=C.getTile(oe);if(!ge.rasterParticleState)continue;const _e=ge.rasterParticleState,se=100;ge.registerFadeDuration(se);const le=C.findLoadedParent(oe,0),ce=Xu(ge,le,C,S.transform,se);let Se,Oe;S.terrain&&S.terrain.prepareDrawTile(),F.activeTexture.set(U.TEXTURE0),_e.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),F.activeTexture.set(U.TEXTURE1),le&&le.rasterParticleState?(le.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Se=Math.pow(2,le.tileID.overscaledZ-ge.tileID.overscaledZ),Oe=[ge.tileID.canonical.x*Se%1,ge.tileID.canonical.y*Se%1]):_e.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const pe=H?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(ue,j),Be=S.transform,Fe=oc(Be),tt=o.bc(oe.canonical),rt=o.bd(tt.getCenter().lat);let Qe,Pe,je,Ke,bt;H?(Qe=Float32Array.from(o.bf(o.bg(oe.canonical))),Pe=Float32Array.from(Be.globeMatrix),je=Float32Array.from(o.bb(Be)),Ke=[o.aj(Be.center.lng),o.ak(Be.center.lat)],bt=Float32Array.from(o.be(oe.canonical,tt,rt,Be.worldSize/Be._pixelsPerMercatorPixel))):(Qe=new Float32Array(16),Pe=new Float32Array(9),je=new Float32Array(16),Ke=[0,0],bt=new Float32Array(9));const St=dp(pe,Qe,Pe,je,bt,Oe||[0,0],o.a1(S.transform.zoom),Ke,Fe,Se||1,ce,250),Pt=S.isTileAffectedByFog(oe),Et=S.getOrCreateProgram("rasterParticle",{defines:Y,overrideFog:Pt});if(S.uploadCommonUniforms(F,Et,ue),H){const ot=new o.ae(U.LEQUAL,o.ae.ReadWrite,S.depthRangeFor3D),Ze=0,kt=S.globeSharedBuffers;if(kt){const[cn,sn,yn]=kt.getGridBuffers(rt,Ze!==0);Et.draw(S,U.TRIANGLES,ot,ie,o.a.alphaBlended,o.af.backCCW,St,R.id,cn,sn,yn)}}else{const ot=S.depthModeForSublayer(0,o.ae.ReadOnly),Ze=Z[oe.overscaledZ],{tileBoundsBuffer:kt,tileBoundsIndexBuffer:cn,tileBoundsSegments:sn}=S.getTileBoundsBuffers(ge);Et.draw(S,U.TRIANGLES,ot,Ze,o.a.alphaBlended,o.af.disabled,St,R.id,kt,cn,sn)}}S.resetStencilClippingMasks()}(f,i,u,p),f.style.map.triggerRepaint())},background:function(f,i,u,p){const x=u.paint.get("background-color"),v=u.paint.get("background-opacity"),S=u.paint.get("background-emissive-strength");if(v===0)return;const C=f.context,R=C.gl,L=f.transform,O=L.tileSize,F=u.paint.get("background-pattern");let U;if(F!==void 0&&(F===null||(U=f.imageManager.getPattern(F.toString(),u.scope,f.style.getLut(u.scope)),!U)))return;const j=!F&&x.a===1&&v===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==j)return;const H=o.ag.disabled,Z=f.depthModeForSublayer(0,j==="opaque"?o.ae.ReadWrite:o.ae.ReadOnly),X=f.colorModeForDrapableLayerRenderPass(S),Y=F?"backgroundPattern":"background";let ie,oe=p;oe||(ie=f.getBackgroundTiles(),oe=Object.values(ie).map(ue=>ue.tileID)),F&&(C.activeTexture.set(R.TEXTURE0),f.imageManager.bind(f.context,u.scope));for(const ue of oe){const ge=f.isTileAffectedByFog(ue),_e=f.getOrCreateProgram(Y,{overrideFog:ge}),se=ue.toUnwrapped(),le=p?ue.projMatrix:f.transform.calculateProjMatrix(se);f.prepareDrawTile();const ce=i?i.getTile(ue):ie?ie[ue.key]:new o.by(ue,O,L.zoom,f),Se=F?ct(le,S,v,f,0,u.scope,U,{tileID:ue,tileSize:O}):vt(le,S,v,x.toRenderColor(u.lut));f.uploadCommonUniforms(C,_e,se);const{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:pe,tileBoundsSegments:Be}=f.getTileBoundsBuffers(ce);_e.draw(f,R.TRIANGLES,Z,H,X,o.af.disabled,Se,u.id,Oe,pe,Be)}},sky:function(f,i,u){const p=f._atmosphere?o.a1(f.transform.zoom):1,x=u.paint.get("sky-opacity")*p;if(x===0)return;const v=f.context,S=u.paint.get("sky-type"),C=new o.ae(v.gl.LEQUAL,o.ae.ReadOnly,[0,1]),R=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?u.needsSkyboxCapture(f)&&(function(L,O,F,U){const j=L.context,H=j.gl;let Z=O.skyboxFbo;if(!Z){Z=O.skyboxFbo=j.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new Xr(j),O.skyboxTexture=j.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,O.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let oe=0;oe<6;++oe)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(Z.framebuffer),j.viewport.set([0,0,32,32]);const X=O.getCenter(L,!0),Y=L.getOrCreateProgram("skyboxCapture"),ie=new Float64Array(16);o.ad.identity(ie),o.ad.rotateY(ie,ie,.5*-Math.PI),Gr(L,O,Y,ie,X,0),o.ad.identity(ie),o.ad.rotateY(ie,ie,.5*Math.PI),Gr(L,O,Y,ie,X,1),o.ad.identity(ie),o.ad.rotateX(ie,ie,.5*-Math.PI),Gr(L,O,Y,ie,X,2),o.ad.identity(ie),o.ad.rotateX(ie,ie,.5*Math.PI),Gr(L,O,Y,ie,X,3),o.ad.identity(ie),Gr(L,O,Y,ie,X,4),o.ad.identity(ie),o.ad.rotateY(ie,ie,Math.PI),Gr(L,O,Y,ie,X,5),j.viewport.set([0,0,L.width,L.height])}(f,u),u.markSkyboxValid(f)):f.renderPass==="sky"&&function(L,O,F,U,j){const H=L.context,Z=H.gl,X=L.transform,Y=L.getOrCreateProgram("skybox");H.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,O.skyboxTexture);const ie=((oe,ue,ge,_e,se)=>({u_matrix:oe,u_sun_direction:ue,u_cubemap:0,u_opacity:_e,u_temporal_offset:se}))(X.skyboxMatrix,O.getCenter(L,!1),0,U,j);L.uploadCommonUniforms(H,Y),Y.draw(L,Z.TRIANGLES,F,o.ag.disabled,L.colorModeForRenderPass(),o.af.backCW,ie,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,u,C,x,R):S==="gradient"&&f.renderPass==="sky"&&function(L,O,F,U,j){const H=L.context,Z=H.gl,X=L.transform,Y=L.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new Xr(H)),H.activeTexture.set(Z.TEXTURE0);let ie=O.colorRampTexture;ie||(ie=O.colorRampTexture=new o.T(H,O.colorRamp,Z.RGBA)),ie.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const oe=((ue,ge,_e,se,le)=>({u_matrix:ue,u_color_ramp:0,u_center_direction:ge,u_radius:o.ab(_e),u_opacity:se,u_temporal_offset:le}))(X.skyboxMatrix,O.getCenter(L,!1),O.paint.get("sky-gradient-radius"),U,j);L.uploadCommonUniforms(H,Y),Y.draw(L,Z.TRIANGLES,F,o.ag.disabled,L.colorModeForRenderPass(),o.af.backCW,oe,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,u,C,x,R)},debug:function(f,i,u,p,x,v){for(let S=0;S<u.length;S++)if(x){const L=new o.C(p.r*.8,p.g*.8,p.b*.8,1);Rt(f,i,u[S],p,-1,-1,v),Rt(f,i,u[S],p,-1,1,v),Rt(f,i,u[S],p,1,1,v),Rt(f,i,u[S],p,1,-1,v),Rt(f,i,u[S],L,0,0,v)}else Rt(f,i,u[S],p,0,0,v)},custom:function(f,i,u,p){const x=f.context,v=u.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&u.isDraped(i)){if(f.renderPass==="offscreen"){const S=v.prerender;if(S){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const C=f.transform.pointMerc;S.call(v,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.a1(f.transform.zoom),[C.x,C.y],f.transform.pixelsPerMeterRatio)}else S.call(v,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const C=v.renderToTile;if(C){const R=p[0].canonical,L=new o.Y(R.x+p[0].wrap*(1<<R.z),R.y,R.z);x.setDepthMode(o.ae.disabled),x.setStencilMode(o.ag.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),C.call(v,x.gl,L),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(o.ag.disabled);const S=v.renderingMode==="3d"?new o.ae(f.context.gl.LEQUAL,o.ae.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,o.ae.ReadOnly);if(x.setDepthMode(S),f.transform.projection.name==="globe"){const C=f.transform.pointMerc;v.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.a1(f.transform.zoom),[C.x,C.y],f.transform.pixelsPerMeterRatio)}else v.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,i,u,p){if(f.renderPass==="opaque")return;const x=u.paint.get("model-opacity");if(x===0)return;const v=u.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!v||f.terrain&&x<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof o.Z))return;const S=f.shadowRenderer,C=u.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,C||(S.enabled=!1));const R=()=>{S&&(S.useNormalOffset=!0,C||(S.enabled=!0))},L=i.getSource();if(f.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(Y,ie,oe,ue,ge){const _e=Y.transform;if(_e.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${_e.projection.name} projection is not yet implemented`);const se=_e.getFreeCameraOptions().position;if(!Y.modelManager)return;const le=Y.modelManager;oe.modelManager=le;const ce=Y.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Se=oe._unevaluatedLayout._values["model-id"],Oe={...oe.layout.get("model-id").parameters},pe=Y.style.order.indexOf(oe.fqid);for(const Be of ue){const Fe=ie.getTile(Be).getBucket(oe);if(!Fe||Fe.projection.name!==_e.projection.name)continue;const tt=Fe.getModelUris();tt&&!Fe.modelsRequested&&(le.addModelsFromBucket(tt,ge),Fe.modelsRequested=!0);const rt=ni(Be,_e);Oe.zoom=rt;const Qe=Se.possiblyEvaluate(Oe);if(vh(Y,Fe,Be),mi.shadowUniformsInitialized=!1,mi.useSingleShadowCascade=!!ce&&ce.getMaxCascadeForTile(Be.toUnwrapped())===0,Y.renderPass==="shadow"&&ce){if(Y.currentShadowCascade===1&&Fe.isInsideFirstShadowMapFrustum)continue;const Ke=_e.calculatePosMatrix(Be.toUnwrapped(),_e.worldSize);if(mi.tileMatrix.set(Ke),mi.shadowTileMatrix=Float32Array.from(ce.calculateShadowPassMatrixFromMatrix(Ke)),mi.aabb.min.fill(0),mi.aabb.max[0]=mi.aabb.max[1]=o.a3,mi.aabb.max[2]=0,_i(Fe,mi,Y,oe.scope))continue}const Pe=1<<Be.canonical.z,je=[((se.x-Be.wrap)*Pe-Be.canonical.x)*o.a3,(se.y*Pe-Be.canonical.y)*o.a3,se.z*Pe*o.a3];Y.conflationActive&&Object.keys(Fe.instancesPerModel).length>0&&Y.style.isLayerClipped(oe,ie.getSource())&&Fe.updateReplacement(Be,Y.replacementSource,pe)&&(Fe.uploaded=!1,Fe.upload(Y.context));for(let Ke in Fe.instancesPerModel){const bt=Fe.instancesPerModel[Ke];bt.features.length>0&&(Ke=Qe.evaluate(bt.features[0].feature,{}));const St=le.getModel(Ke,ge);if(St&&St.uploaded)for(const Pt of St.nodes)ro(Y,oe,Pt,bt,je,Be,mi)}}}(f,i,u,p,L.type==="vector"?u.scope:""),void R();if(!L.loaded())return;if(L.type==="batched-model")return function(Y,ie,oe,ue){oe.resetLayerRenderingStats(Y);const ge=Y.context,_e=Y.transform,se=Y.style.fog,le=Y.shadowRenderer;if(_e.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${_e.projection.name} projection is not yet implemented`);const ce=Y.transform.getFreeCameraOptions().position,Se=o._.scale([],[ce.x,ce.y,ce.z],Y.transform.worldSize);o._.negate(Se,Se);const Oe=o.ad.identity([]),pe=o.cg(_e.center.lat,_e.zoom),Be=o.ad.fromScaling([],[1,1,1/pe]);o.ad.translate(Oe,Oe,Se);const Fe=oe.paint.get("model-opacity"),tt=new o.ae(ge.gl.LEQUAL,o.ae.ReadWrite,Y.depthRangeFor3D),rt=new o.ae(ge.gl.LEQUAL,o.ae.ReadOnly,Y.depthRangeFor3D),Qe=new o.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Pe=Y.renderPass==="shadow",je=Pe&&le?le.getCurrentCascadeFrustum():_e.getFrustum(_e.scaleZoom(_e.worldSize)),Ke=oe.paint.get("model-front-cutoff"),bt=Ke[2]<1,St=mr(Y,oe.paint.get("model-cutoff-fade-range")),Pt=oe.getLayerRenderingStats();(function(Et,ot,Ze,kt){const cn=Et.terrain?Et.terrain.exaggeration():0,sn=Et.transform.zoom;for(const yn of kt){const Sn=ot.getTile(yn).getBucket(Ze);Sn&&(Et.conflationActive&&Sn.updateReplacement(yn,Et.replacementSource),Sn.evaluateScale(Et,Ze),Et.terrain&&cn>0&&Sn.elevationUpdate(Et.terrain,cn,yn,Ze.source),Sn.needsReEvaluation(Et,sn,Ze)&&Sn.evaluate(Ze))}})(Y,ie,oe,ue),function(){let Et,ot,Ze;bt?(Et=ue.length-1,ot=-1,Ze=-1):(Et=0,ot=ue.length,Ze=1);for(let kt=Et;kt!==ot;kt+=Ze){const cn=ue[kt],sn=ie.getTile(cn).getBucket(oe);if(!sn||!sn.uploaded)continue;let yn=!1;le&&(yn=le.getMaxCascadeForTile(cn.toUnwrapped())===0);const Sn=_e.calculatePosMatrix(cn.toUnwrapped(),_e.worldSize),Vt=sn.modelTraits,tn=[];for(const Hn of sn.getNodesInfo()){if(Hn.hiddenByReplacement||!Hn.node.meshes)continue;const er=Hn.node;let nr=0;Y.terrain&&er.elevation&&(nr=er.elevation*Y.terrain.exaggeration());const En=Hn.evaluatedScale;if(En[0]<=1&&En[1]<=1&&En[2]<=1&&(()=>{const ke=Hn.aabb;return Qe.min=[...ke.min],Qe.max=[...ke.max],Qe.min[2]+=nr,Qe.max[2]+=nr,o._.transformMat4(Qe.min,Qe.min,Sn),o._.transformMat4(Qe.max,Qe.max,Sn),Qe})().intersects(je)===0)continue;const ln=[...Sn],Dn=er.anchor?er.anchor[0]:0,vr=er.anchor?er.anchor[1]:0;o.ad.translate(ln,ln,[Dn*(En[0]-1),vr*(En[1]-1),nr]),o._.exactEquals(En,o.cj)||o.ad.scale(ln,ln,En);const ar=o.ad.multiply([],ln,er.matrix),nt=o.ad.multiply([],_e.expandedFarZProjMatrix,ar),At=o.ad.multiply([],_e.expandedFarZProjMatrix,ln),Mr=o.aA.transformMat4([],[Dn,vr,nr,1],nt)[2];er.hidden=!1;let Kn=Fe;Pe||(bt&&(Kn*=xs(ln,_e,Hn.aabb,Ke)),Kn*=_p(St,Mr)),Kn!==0?tn.push({nodeInfo:Hn,depth:Mr,opacity:Kn,wvpForNode:nt,wvpForTile:At,nodeModelMatrix:ar,tileModelMatrix:ln}):er.hidden=!0}Pe||tn.sort((Hn,er)=>!bt||Hn.opacity===1&&er.opacity===1?Hn.depth<er.depth?-1:1:Hn.opacity===1?-1:er.opacity===1?1:Hn.depth>er.depth?-1:1);for(const Hn of tn){const er=Hn.nodeInfo,nr=er.node;let En=o.ad.multiply([],Be,Hn.tileModelMatrix);o.ad.multiply(En,Oe,En);const ln=o.ad.invert([],En);o.ad.transpose(ln,ln),o.ad.scale(ln,ln,ba),En=o.ad.multiply(En,En,nr.matrix);const Dn=Y.renderPass==="light-beam",vr=Vt&o.cl.HasMapboxMeshFeatures,ar=vr?0:er.evaluatedRMEA[0][2];for(let nt=0;nt<nr.meshes.length;++nt){const At=nr.meshes[nt],Mr=nt===nr.lightMeshIndex;let Kn=Hn.wvpForNode;if(Mr){if(!Dn&&!Y.terrain&&Y.shadowRenderer){Y.currentLayer<Y.firstLightBeamLayer&&(Y.firstLightBeamLayer=Y.currentLayer);continue}Kn=Hn.wvpForTile}else if(Dn)continue;const ke={defines:[]},Vs=[];if(Xl(ke.defines,Vs,At,Y,oe.lut),vr||ke.defines.push("DIFFUSE_SHADED"),yn&&ke.defines.push("SHADOWS_SINGLE_CASCADE"),Pt&&(Pe?Pt.numRenderedVerticesInShadowPass+=At.vertexArray.length:Pt.numRenderedVerticesInTransparentPass+=At.vertexArray.length),Pe){Ti(At,Hn.nodeModelMatrix,Y,oe);continue}let Vr=null;if(se){const cl=Wo(Hn.nodeModelMatrix,Y.transform);if(Vr=new Float32Array(cl),_e.projection.name!=="globe"){const io=At.aabb.min,Xo=At.aabb.max,[Co,Ma]=se.getOpacityForBounds(cl,io[0],io[1],Xo[0],Xo[1]);ke.overrideFog=Co>=br||Ma>=br}}const Sr=At.material;let ri;Sr.occlusionTexture&&Sr.occlusionTexture.offsetScale&&(ri=Sr.occlusionTexture.offsetScale,ke.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Pe&&le&&(le.useNormalOffset=!!At.normalBuffer);const cs=Y.getOrCreateProgram("model",ke);!Pe&&le&&le.setupShadowsFromMatrix(Hn.tileModelMatrix,cs,le.useNormalOffset),Y.uploadCommonUniforms(ge,cs,null,Vr);const Us=Sr.pbrMetallicRoughness;Us.metallicFactor=.9,Us.roughnessFactor=.5;const js=An(new Float32Array(Kn),new Float32Array(En),new Float32Array(ln),new Float32Array(nr.matrix),Y,Hn.opacity,Us.baseColorFactor.toRenderColor(null),Sr.emissiveFactor,Us.metallicFactor,Us.roughnessFactor,Sr,ar,oe,[0,0,0],ri);!Mr&&(er.hasTranslucentParts||Hn.opacity<1)&&cs.draw(Y,ge.gl.TRIANGLES,tt,o.ag.disabled,o.a.disabled,o.af.backCCW,js,oe.id,At.vertexBuffer,At.indexBuffer,At.segments,oe.paint,Y.transform.zoom,void 0,Vs),cs.draw(Y,ge.gl.TRIANGLES,Mr?rt:tt,o.ag.disabled,Mr||Hn.opacity<1||er.hasTranslucentParts?o.a.alphaBlended:o.a.unblended,o.af.backCCW,js,oe.id,At.vertexBuffer,At.indexBuffer,At.segments,oe.paint,Y.transform.zoom,void 0,Vs)}}}}()}(f,i,u,p),void R();const O=L.getModels(),F=[],U=f.transform.getFreeCameraOptions().position,j=o._.scale([],[U.x,U.y,U.z],f.transform.worldSize);o._.negate(j,j);const H=[],Z=[];let X=0;for(const Y of O){const ie=u.paint.get("model-rotation").constantOr(null),oe=u.paint.get("model-scale").constantOr(null),ue=u.paint.get("model-translation").constantOr(null);Y.computeModelMatrix(f,ie,oe,ue,!0,!0,!1);const ge=o.ad.identity([]),_e=o.cg(Y.position.lat,f.transform.zoom),se=o.ad.fromScaling([],[1,1,1/_e]);o.ad.translate(ge,ge,j),F.push({zScaleMatrix:se,negCameraPosMatrix:ge});for(const le of Y.nodes)oi(f.transform,le,Y.matrix,f.transform.expandedFarZProjMatrix,X,H,Z);X++}if(H.sort((Y,ie)=>ie.depth-Y.depth),f.renderPass!=="shadow"){if(x===1)for(const Y of Z)no(Y,f,u,F[Y.modelIndex],o.ag.disabled,f.colorModeForRenderPass());else{for(const Y of Z)no(Y,f,u,F[Y.modelIndex],o.ag.disabled,o.a.disabled);for(const Y of Z)no(Y,f,u,F[Y.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const Y of H)no(Y,f,u,F[Y.modelIndex],o.ag.disabled,f.colorModeForRenderPass());R()}else{for(const Y of Z)Ti(Y.mesh,Y.nodeModelMatrix,f,u);for(const Y of H)Ti(Y.mesh,Y.nodeModelMatrix,f,u);R()}}},ks={model:function(f,i,u){const p=i.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,p.type==="vector"?f.scope:""));if(p.type==="batched-model")return;const x=p.getModels();for(const v of x)v.upload(u.context)},raster:function(f,i,u){const p=i.getSource();if(!(p instanceof Gl&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const v=f.paint.get("raster-array-band")||p.getInitialBand(x);if(v==null)return;const S=i.getIds().map(C=>i.getTileByID(C));for(const C of S)C.updateNeeded(x,v)&&p.prepareTile(C,x,v)},"raster-particle":function(f,i,u){const p=i.getSource();if(!(p instanceof Gl&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const v=f.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(v==null)return;const S=i.getIds().map(C=>i.getTileByID(C));for(const C of S)C.updateNeeded(x,v)&&p.prepareTile(C,x,v)}};class or{constructor(i,u,p,x){this.context=new Dl(i,u),this.occlusionBuffers=new cc(this.context),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=o.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const S of v)this._debugParams.enabledLayers[S]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const S of v)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.symbolParams=new qa(x),this.setup(),this.numSublayers=o.bv.maxUnderzooming+o.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new $u(this),this._wireframeDebugCache=new uc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(i,u){const p=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ss(this,i));const x=this._terrain;this.transform.elevation=p?x:null,x.update(i,this.transform,u),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(i){const u=i.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=u.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const v=p+.78*(x-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new ss(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,u){if(this.width=i*o.e.devicePixelRatio,this.height=u*o.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const i=this.context,u=new o.bt;u.emplaceBack(0,0),u.emplaceBack(o.a3,0),u.emplaceBack(0,o.a3),u.emplaceBack(o.a3,o.a3),this.tileExtentBuffer=i.createVertexBuffer(u,o.br.members),this.tileExtentSegments=o.b.simpleSegment(0,0,4,2);const p=new o.bt;p.emplaceBack(0,0),p.emplaceBack(o.a3,0),p.emplaceBack(0,o.a3),p.emplaceBack(o.a3,o.a3),this.debugBuffer=i.createVertexBuffer(p,o.br.members),this.debugSegments=o.b.simpleSegment(0,0,4,5);const x=new o.bt;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,o.br.members),this.viewportSegments=o.b.simpleSegment(0,0,4,2);const v=new o.cp;v.emplaceBack(0,0,0,0),v.emplaceBack(o.a3,0,o.a3,0),v.emplaceBack(0,o.a3,0,o.a3),v.emplaceBack(o.a3,o.a3,o.a3,o.a3),this.mercatorBoundsBuffer=i.createVertexBuffer(v,o.cq.members),this.mercatorBoundsSegments=o.b.simpleSegment(0,0,4,2);const S=new o.bu;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(S);const C=new o.cr;for(const L of[0,1,3,2,0])C.emplaceBack(L);this.debugIndexBuffer=i.createIndexBuffer(C),this.emptyTexture=new o.T(i,new o.i({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=o.ad.create();const R=this.context.gl;this.stencilClearMode=new o.ag({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,o.ae.disabled,this.stencilClearMode,o.a.disabled,o.af.disabled,Zu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,u,p){if(!u||this.currentStencilSource===u.id||!i.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const R of p)if(this._tileClippingMaskIDs[R.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=u.id;const x=this.context,v=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(o.a.disabled),x.setDepthMode(o.ae.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of p){const R=u.getTile(C),L=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:F,tileBoundsSegments:U}=this.getTileBoundsBuffers(R);S.draw(this,v.TRIANGLES,o.ae.disabled,new o.ag({func:v.ALWAYS,mask:0},L,255,v.KEEP,v.KEEP,v.REPLACE),o.a.disabled,o.af.disabled,Zu(C.projMatrix),"$clipping",O,F,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,u=this.context.gl;return new o.ag({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const u=this.context.gl;return new o.ag({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(i){const u=this.context.gl,p=i.sort((S,C)=>C.overscaledZ-S.overscaledZ),x=p[p.length-1].overscaledZ,v=p[0].overscaledZ-x+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const S={};for(let C=0;C<v;C++)S[C+x]=new o.ag({func:u.GEQUAL,mask:255},C+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=v,[S,p]}return[{[x]:o.ag.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new o.a([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new o.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.a.unblended:o.a.alphaBlended}colorModeForDrapableLayerRenderPass(i){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new o.a([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new o.C(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,u,p,x=!1){if(this.depthOcclusion)return new o.ae(this.context.gl.GREATER,o.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return o.ae.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new o.ae(p||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,u)=>i+u/this._fpsHistory.length,0))}render(i,u){const p=o.e.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=u;const x=this.style._mergedLayers,v=this.style.order.filter(le=>{const ce=x[le];return!(ce.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ce.type]}),S=v.map(le=>x[le]),C=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(o.e.now()),this.imageManager.beginFrame();let R=0,L=!1;for(const le in C){const ce=C[le];ce.used&&(ce.prepare(this.context),ce.getSource().usedInConflation&&++R)}let O=!1;for(const le of S)le.isHidden(this.transform.zoom)||(le.type==="clip"&&(O=!0),this.prepareLayer(le));const F={},U={},j={},H={},Z={};for(const le in C){const ce=C[le];F[le]=ce.getVisibleCoordinates(),U[le]=F[le].slice().reverse(),j[le]=ce.getVisibleCoordinates(!0).reverse(),H[le]=ce.getShadowCasterCoordinates(),Z[le]=ce.sortCoordinatesByDistance(F[le])}const X=le=>{const ce=this.style.getLayerSourceCache(le);return ce&&ce.used?ce.getSource():null};if(R||O){const le=[],ce=[];let Se=0;for(const Oe of S)this.isSourceForClippingOrConflation(Oe,X(Oe))&&(le.push(Oe),ce.push(Se)),Se++;if(le&&(O||le.length>1)){const Oe=[];for(let pe=0;pe<le.length;pe++){const Be=le[pe],Fe=ce[pe],tt=this.style.getLayerSourceCache(Be);if(!tt||!tt.used||!tt.getSource().usedInConflation&&Be.type!=="clip")continue;let rt=1/0,Qe=o.cu.None;if(Be.type==="clip"){rt=Fe;for(const Pe of Be.layout.get("clip-layer-types"))Qe|=Pe==="model"?o.cu.Model:Pe==="symbol"?o.cu.Symbol:o.cu.FillExtrusion}Oe.push({layer:Be.fqid,cache:tt,order:rt,clipMask:Qe})}this.replacementSource.setSources(Oe),L=!0}}L||this.replacementSource.clear(),this.conflationActive=L,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let le=0;le<S.length;le++){const ce=S[le],Se=ce.cutoffRange();if(this.longestCutoffRange=Math.max(Se,this.longestCutoffRange),Se>0){const Oe=X(ce);Oe&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom)),ce.minzoom&&(this.minCutoffZoom=Math.max(ce.minzoom,this.minCutoffZoom))}ce.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=le),this._lastOcclusionLayer=le)}const Y=this.style&&this.style.fog;Y?(this._fogVisible=Y.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Y.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(j),this.opaquePassCutoff=0);const ie=this._shadowRenderer;if(ie){ie.updateShadowParameters(this.transform,this.style.directionalLight);for(const le in C)for(const ce of F[le]){let Se={min:0,max:0};this.terrain&&(Se=this.terrain.getMinMaxForTile(ce)||Se),ie.addShadowReceiver(ce.toUnwrapped(),Se.min,Se.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new xh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!o.ct(this.context.gl))return;this.renderPass="offscreen";for(const le of S){const ce=i.getLayerSourceCache(le);if(!le.hasOffscreenPass()||le.isHidden(this.transform.zoom))continue;const Se=ce?U[ce.id]:void 0;(le.type==="custom"||le.type==="raster"||le.type==="raster-particle"||le.isSky()||Se&&Se.length)&&this.renderLayer(this,ce,le,Se)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];const oe=this.terrain;oe&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&oe.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,H)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ue=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ge=(()=>{if(u.showOverdrawInspector)return o.C.black;const le=this.style.fog;if(le&&this.transform.projection.supportsFog){const ce=this.style.getLut(le.scope);if(!ue){const Se=le.properties.get("color").toRenderColor(ce).toArray01();return new o.C(...Se)}if(ue){const Se=le.properties.get("space-color").toRenderColor(ce).toArray01();return new o.C(...Se)}}return o.C.transparent})();if(this.context.clear({color:ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const le=S[this.currentLayer],ce=i.getLayerSourceCache(le);if(le.isSky())continue;const Se=ce?(le.is3D()?Z:U)[ce.id]:void 0;this._renderTileClippingMasks(le,ce,Se),this.renderLayer(this,ce,le,Se)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const le=S[this.currentLayer],ce=i.getLayerSourceCache(le);le.isSky()&&this.renderLayer(this,ce,le,ce?U[ce.id]:void 0)}function _e(le,ce){let Se;return ce&&(Se=(le.type==="symbol"?j:le.is3D()?Z:U)[ce.id]),Se}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){const le=S[this.currentLayer];if(le.type==="raster"){const ce=i.getLayerSourceCache(le);this.renderLayer(this,ce,le,_e(le,ce))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let se=0;for(ie&&(se=ie.getShadowCastingLayerCount());this.currentLayer<v.length;){const le=S[this.currentLayer],ce=i.getLayerSourceCache(le);if(le.isSky())++this.currentLayer;else if(oe&&this.style.isLayerDraped(le)){if(le.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=oe.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(le.is3D()||this.terrain||this._renderTileClippingMasks(le,ce,ce?F[ce.id]:void 0),this.renderLayer(this,ce,le,_e(le,ce)),!oe&&ie&&se>0&&le.hasShadowPass()&&--se==0&&(ie.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Se=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Se;this.currentLayer++){const Oe=S[this.currentLayer];if(!Oe.hasLightBeamPass())continue;const pe=i.getLayerSourceCache(Oe);this.renderLayer(this,pe,Oe,pe?U[pe.id]:void 0)}this.currentLayer=Se,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Se=this.currentLayer;this.depthOcclusion=!0;for(const Oe of this.layersWithOcclusionOpacity){this.currentLayer=Oe;const pe=S[this.currentLayer],Be=i.getLayerSourceCache(pe),Fe=Be?U[Be.id]:void 0;pe.is3D()||this.terrain||this._renderTileClippingMasks(pe,Be,Be?F[Be.id]:void 0),this.renderLayer(this,Be,pe,Fe)}this.depthOcclusion=!1,this.currentLayer=Se,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let le=null;S.forEach(ce=>{const Se=i.getLayerSourceCache(ce);Se&&!ce.isHidden(this.transform.zoom)&&Se.getVisibleCoordinates().length&&(!le||le.getSource().maxzoom<Se.getSource().maxzoom)&&(le=Se)}),le&&this.options.showTileBoundaries&&vs.debug(this,le,le.getVisibleCoordinates(),o.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&vs.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(le){const ce=le.transform.padding;On(le,le.transform.height-(ce.top||0),3,jo),On(le,ce.bottom||0,3,ac),Nn(le,ce.left||0,3,Go),Nn(le,le.transform.width-(ce.right||0),3,mp);const Se=le.transform.centerPoint;(function(Oe,pe,Be,Fe){ls(Oe,pe-1,Be-10,2,20,Fe),ls(Oe,pe-10,Be-1,20,2,Fe)})(le,Se.x,le.transform.height-Se.y,lc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),L||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:u}=this.transform.projection,p=!u||!u.includes(i.type);if(ks[i.type]&&(p||this.terrain&&i.type==="custom")){const x=this.style.getLayerSourceCache(i);ks[i.type](i,x,this)}this.gpuTimingEnd()}renderLayer(i,u,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(p.type)&&(!i.terrain||p.type!=="custom")||p.type==="clip"||vs[p.type](i,u,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[i.id];x||(x=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(u.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,u=this.context.gl,p=u.createQuery();this.deferredRenderGpuTimeQueries.push(p),u.beginQuery(i.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const u={};for(const p in i){const x=i[p],v=this.context.extTimerQuery,S=v.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(x.query),u[p]=S}return u}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery,p=this.context.gl;let x=0;for(const v of i)x+=u.getQueryParameter(v,p.QUERY_RESULT)/1e6,u.deleteQueryEXT(v);return x}translatePosMatrix(i,u,p,x,v){if(!p[0]&&!p[1])return i;const S=v?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(S){const L=Math.sin(S),O=Math.cos(S);p=[p[0]*O-p[1]*L,p[0]*L+p[1]*O]}const C=[v?p[0]:o.bB(u,p[0],this.transform.zoom),v?p[1]:o.bB(u,p[1],this.transform.zoom),0],R=new Float32Array(16);return o.ad.translate(R,i,C),R}saveTileTexture(i){const u=i.size[0],p=this._tileTextures[u];p?p.push(i):this._tileTextures[u]=[i]}getTileTexture(i){const u=this._tileTextures[i];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,u,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,v=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||v.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?v.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):v.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||x||u!==void 0&&!u||v.push("FOG","FOG_DITHERING"),x&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(i,u){this.cache=this.cache||{};const p=u&&u.defines||[],x=u&&u.config,v=this.currentGlobalDefines(i,u&&u.overrideFog,u&&u.overrideRtt).concat(p),S=Ku.cacheKey(Bm[i],i,v,x);return this.cache[S]||(this.cache[S]=new Ku(this.context,i,Bm[i],x,zr[i],v)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,u){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const v=((S,C,R)=>{const L=S.properties.get("direction"),O=S.properties.get("color").toRenderColor(R.getLut(S.scope)).toArray01(),F=S.properties.get("intensity"),U=C.properties.get("color").toRenderColor(R.getLut(C.scope)).toArray01(),j=C.properties.get("intensity"),H=[L.x,L.y,L.z],Z=o.bA(U,j),X=o.bA(O,F);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:H,u_lighting_directional_color:X,u_ground_radiance:bo(H,X,Z)}})(p,x,this.style);u.setLightsUniformValues(i,v)}}}uploadCommonUniforms(i,u,p,x,v){if(this.uploadCommonLightUniforms(i,u),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const C=S.getOpacity(this.transform.pitch),R=((L,O,F,U,j,H,Z,X,Y,ie,oe,ue)=>{const ge=L.transform,_e=O.properties.get("color").toRenderColor(L.style.getLut(O.scope)).toArray01();_e[3]=U;const se=L.frameCounter/1e3%1,[le,ce]=O.properties.get("vertical-range");return{u_fog_matrix:F?ge.calculateFogTileMatrix(F):ue||L.identityMat,u_fog_range:O.getFovAdjustedRange(ge._fov),u_fog_color:_e,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(le,ce),ce],u_fog_temporal_offset:se,u_frustum_tl:j,u_frustum_tr:H,u_frustum_br:Z,u_frustum_bl:X,u_globe_pos:Y,u_globe_radius:ie,u_viewport:oe,u_globe_transition:o.a1(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,S,p,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.e.devicePixelRatio,this.transform.height*o.e.devicePixelRatio],x);u.setFogUniformValues(i,R)}v&&u.setCutoffUniformValues(i,v.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,u=i.createTexture();return i.bindTexture(i.TEXTURE_2D,u),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,u=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)u[x.key]=i[x.key]||new o.by(x,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,u){return!(!i.is3D()||i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||i.sourceLayer!=="building")&&i.type!=="clip"&&(!u||u.type!=="batched-model"))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[i.key];return u||(this._cachedTileFogOpacities[i.key]=u=this.style.fog.getOpacityForTile(i)),u[0]>=br||u[1]>=br}}class Yi{constructor(i,u,p,x){this.screenBounds=i,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(i,u){let p,x;if(i instanceof o.P||typeof i[0]=="number"){const v=o.P.convert(i);p=[v],x=u.isPointAboveHorizon(v)}else{const v=o.P.convert(i[0]),S=o.P.convert(i[1]);p=[v,S],x=o.cv(v,S).every(C=>u.isPointAboveHorizon(C))}return new Yi(p,u.getCameraPoint(),x,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return o.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const u=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.cv(u,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(x[3]=this.cameraPoint)),o.cw(x,i)}bufferedCameraGeometryGlobe(i){const u=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.cv(u,p,i),v=this.cameraPoint.clone();switch(3*((v.y>u.y)+(v.y>p.y))+((v.x>u.x)+(v.x>p.x))){case 0:x[0]=v,x[4]=v.clone();break;case 1:x.splice(1,0,v);break;case 2:x[1]=v;break;case 3:x.splice(4,0,v);break;case 5:x.splice(2,0,v);break;case 6:x[3]=v;break;case 7:x.splice(3,0,v);break;case 8:x[2]=v}return x}containsTile(i,u,p,x=0){const v=i.queryPadding/u._pixelsPerMercatorPixel+1,S=p?this._bufferedCameraMercator(v,u):this._bufferedScreenMercator(v,u);let C=i.tileID.wrap+(S.unwrapped?x:0);const R=S.polygon.map(X=>o.cx(i.tileTransform,X,C));if(!o.cy(R,0,0,o.a3,o.a3))return;C=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const L=this.screenGeometryMercator.polygon.map(X=>o.cz(i.tileTransform,X,C)),O=L.map(X=>new o.P(X[0],X[1])),F=u.getFreeCameraOptions().position||new o.Y(0,0,0),U=o.cz(i.tileTransform,F,C),j=L.map(X=>{const Y=o._.sub(X,X,U);return o._.normalize(Y,Y),new o.aT(U,Y)}),H=o.bB(i,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:j,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(Z=o.cA(R),Z.min.x=o.at(Z.min.x,0,o.a3),Z.min.y=o.at(Z.min.y,0,o.a3),Z.max.x=o.at(Z.max.x,0,o.a3),Z.max.y=o.at(Z.max.y,0,o.a3),Z),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:H};var Z}_bufferedScreenMercator(i,u){const p=Sa(i);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),u):{polygon:this.bufferedScreenGeometry(i).map(v=>u.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(i,u){const p=Sa(i);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),u):{polygon:this.bufferedCameraGeometry(i).map(v=>u.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(i,u){const p=function(v,S){const C=o.ad.multiply([],S.pixelMatrix,S.globeMatrix),R=[0,-o.cD,0,1],L=[0,o.cD,0,1],O=[0,0,0,1];o.aA.transformMat4(R,R,C),o.aA.transformMat4(L,L,C),o.aA.transformMat4(O,O,C);const F=new o.P(R[0]/R[3],R[1]/R[3]),U=new o.P(L[0]/L[3],L[1]/L[3]),j=o.cB(v,F)&&R[3]<O[3],H=o.cB(v,U)&&L[3]<O[3];if(!j&&!H)return null;const Z=function(se,le,ce){for(let Se=1;Se<se.length;Se++){const Oe=el(le.pointCoordinate3D(se[Se-1]).x),pe=el(le.pointCoordinate3D(se[Se]).x);if(ce<0){if(Oe<pe)return{idx:Se,t:-Oe/(pe-1-Oe)}}else if(pe<Oe)return{idx:Se,t:(1-Oe)/(pe+1-Oe)}}return null}(v,S,j?-1:1);if(!Z)return null;const{idx:X,t:Y}=Z;let ie=X>1?gp(v.slice(0,X),S):[],oe=X<v.length?gp(v.slice(X),S):[];ie=ie.map(se=>new o.P(el(se.x),se.y)),oe=oe.map(se=>new o.P(el(se.x),se.y));const ue=[...ie];ue.length===0&&ue.push(oe[oe.length-1]);const ge=o.a2(ue[ue.length-1].y,(oe.length===0?ie[0]:oe[0]).y,Y);let _e;return _e=j?[new o.P(0,ge),new o.P(0,0),new o.P(1,0),new o.P(1,ge)]:[new o.P(1,ge),new o.P(1,1),new o.P(0,1),new o.P(0,ge)],ue.push(..._e),oe.length===0?ue.push(ie[0]):ue.push(...oe),{polygon:ue.map(se=>new o.Y(se.x,se.y)),unwrapped:!1}}(i,u);if(p)return p;const x=function(v,S){let C=!1,R=-1/0,L=0;for(let F=0;F<v.length-1;F++)v[F].x>R&&(R=v[F].x,L=F);for(let F=0;F<v.length-1;F++){const U=(L+F)%(v.length-1),j=v[U],H=v[U+1];Math.abs(j.x-H.x)>.5&&(j.x<H.x?(j.x+=1,U===0&&(v[v.length-1].x+=1)):(H.x+=1,U+1===v.length-1&&(v[0].x+=1)),C=!0)}const O=o.aj(S.center.lng);return C&&O<Math.abs(O-1)&&v.forEach(F=>{F.x-=1}),{polygon:v,unwrapped:C}}(gp(i,u).map(v=>new o.P(el(v.x),v.y)),u);return{polygon:x.polygon.map(v=>new o.Y(v.x,v.y)),unwrapped:x.unwrapped}}}function gp(f,i){return o.cC(f,u=>{const p=i.pointCoordinate3D(u);u.x=p.x,u.y=p.y},1/256)}function el(f){return f<0?1+f%1:f%1}function Sa(f){return 100*f|0}function Pg(f,i){const u=o.ad.identity([]);return o.ad.scale(u,u,[.5*f.width,.5*-f.height,1]),o.ad.translate(u,u,[1,-1,0]),o.ad.multiply(u,u,f.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(u)}function Rg(f,i,u,p,x,v,S,C=!1){const R=f.tilesIn(p,S,C);R.sort(hc);const L=[];for(const F of R)L.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(i,u,f._state,F,x,v,Pg(f.transform,F.tile.tileID),C)});const O=function(F){const U={},j={};for(const H of F){const Z=H.queryResults,X=H.wrappedTileID,Y=j[X]=j[X]||{};for(const ie in Z){const oe=Z[ie],ue=Y[ie]=Y[ie]||{},ge=U[ie]=U[ie]||[];for(const _e of oe)ue[_e.featureIndex]||(ue[_e.featureIndex]=!0,ge.push(_e))}}return U}(L);for(const F in O)O[F].forEach(U=>{const j=U.feature,H=j.layer;H&&H.type!=="background"&&H.type!=="sky"&&H.type!=="slot"&&(j.source=H.source,H["source-layer"]&&(j.sourceLayer=H["source-layer"]),j.state=j.id!==void 0?f.getFeatureState(H["source-layer"],j.id):{})});return O}function wh(f,i){const u=f.getRenderableIds().map(v=>f.getTileByID(v)),p=[],x={};for(let v=0;v<u.length;v++){const S=u[v],C=S.tileID.canonical.key;x[C]||(x[C]=!0,S.querySourceFeatures(p,i))}return p}function hc(f,i){const u=f.tileID,p=i.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}class Lg{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,u=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:i,visibilityChanged:u});else if(x.type==="model"){const v=this.style.getLayerSource(x);v&&v.type==="batched-model"&&this.layers.push({layer:x,visible:i,visibilityChanged:u})}}}onNewFrame(i){this.layersGotHidden=!1;for(const u of this.layers){const p=u.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(i)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(x=!p.isHidden(i)&&p.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!x&&u.visible,u.visible=x}}updateZOffset(i,u){this.currentBuildingBuckets=[];for(const x of this.layers){const v=x.layer,S=this.style.getLayerSourceCache(v);let C=1;v.type==="fill-extrusion"&&(C=x.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let R=S?S.getTile(u):null;if(!R&&S&&u.canonical.z>S.getSource().minzoom){let L=u.scaledTo(Math.min(S.getSource().maxzoom,u.overscaledZ-1));for(;L.overscaledZ>=S.getSource().minzoom&&(R=S.getTile(L),!R&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:R?R.getBucket(v):null,tileID:R?R.tileID:u,verticalScale:C})}i.hasAnyZOffset=!1;let p=!1;for(let x=0;x<i.symbolInstances.length;x++){const v=i.symbolInstances.get(x),S=v.zOffset,C=this._getHeightAtTileOffset(u,v.tileAnchorX,v.tileAnchorY);v.zOffset=C!==Number.NEGATIVE_INFINITY?C:S,p||S===v.zOffset||(p=!0),i.hasAnyZOffset||v.zOffset===0||(i.hasAnyZOffset=!0)}p&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,u,p,x){let v=u,S=p;if(i.canonical.z!==x.canonical.z){const C=x.canonical,R=1/(1<<i.canonical.z-C.z);v=(u+i.canonical.x*o.a3)*R-C.x*o.a3|0,S=(p+i.canonical.y*o.a3)*R-C.y*o.a3|0}return{tileX:v,tileY:S}}_getHeightAtTileOffset(i,u,p){let x,v;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:R,verticalScale:L}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:O,tileY:F}=this._mapCoordToOverlappingTile(i,u,p,R),U=C.getHeightAtTileCoord(O,F);U&&U.height!==void 0&&(U.hidden?x=U.height:v=Math.max(U.height*L,v||0))}if(v!==void 0)return v;for(let S=0;S<this.layers.length;++S){const C=this.layers[S];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:R,tileID:L}=this.currentBuildingBuckets[S];if(!R)continue;const{tileX:O,tileY:F}=this._mapCoordToOverlappingTile(i,u,p,L),U=R.getHeightAtTileCoord(O,F);if(U&&!U.hidden)return U.height===void 0&&x!==void 0?Math.min(U.maxHeight,x)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ws(f,i){const u={};for(const p in f)p!=="ref"&&(u[p]=f[p]);return o.cE.forEach(p=>{p in i&&(u[p]=i[p])}),u}function yp(f){f=f.slice();const i=Object.create(null);for(let u=0;u<f.length;u++)i[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=ws(f[u],i[f[u].ref]));return f}const Vn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ea(f,i,u){u.push({command:Vn.addSource,args:[f,i[f]]})}function $m(f,i,u){i.push({command:Vn.removeSource,args:[f]}),u[f]=!0}function Dg(f,i,u,p){$m(f,u,p),Ea(f,i,u)}function Ca(f,i,u){let p;for(p in f[u])if(f[u].hasOwnProperty(p)&&p!=="data"&&!q(f[u][p],i[u][p]))return!1;for(p in i[u])if(i[u].hasOwnProperty(p)&&p!=="data"&&!q(f[u][p],i[u][p]))return!1;return!0}function bh(f,i,u,p,x,v){let S;for(S in i=i||{},f=f||{})f.hasOwnProperty(S)&&(q(f[S],i[S])||u.push({command:v,args:[p,S,i[S],x]}));for(S in i)i.hasOwnProperty(S)&&!f.hasOwnProperty(S)&&(q(f[S],i[S])||u.push({command:v,args:[p,S,i[S],x]}))}function Dd(f){return f.id}function dc(f,i){return f[i.id]=i,f}class qm{constructor(i,u){this.reset(i,u)}reset(i,u){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=o.at(i,0,1);let u=1,p=this._distances[u];const x=i*this.paddedLength+this.padding;for(;p<x&&u<this._distances.length;)p=this._distances[++u];const v=u-1,S=this._distances[v],C=p-S,R=C>0?(x-S)/C:0;return this.points[v].mult(1-R).add(this.points[u].mult(R))}}class xp{constructor(i,u,p){const x=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(u/p);for(let S=0;S<this.xCellCount*this.yCellCount;S++)x.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,u,p,x,v){this._forEachCell(u,p,x,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(v)}insertCircle(i,u,p,x){this._forEachCell(u-x,p-x,u+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(p),this.circles.push(x)}_insertBoxCell(i,u,p,x,v,S){this.boxCells[v].push(S)}_insertCircleCell(i,u,p,x,v,S){this.circleCells[v].push(S)}_query(i,u,p,x,v,S){if(p<0||i>this.width||x<0||u>this.height)return!v&&[];const C=[];if(i<=0&&u<=0&&this.width<=p&&this.height<=x){if(v)return!0;for(let R=0;R<this.boxKeys.length;R++)C.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const L=this.circles[3*R],O=this.circles[3*R+1],F=this.circles[3*R+2];C.push({key:this.circleKeys[R],x1:L-F,y1:O-F,x2:L+F,y2:O+F})}return S?C.filter(S):C}return this._forEachCell(i,u,p,x,this._queryCell,C,{hitTest:v,seenUids:{box:{},circle:{}}},S),v?C.length>0:C}_queryCircle(i,u,p,x,v){const S=i-p,C=i+p,R=u-p,L=u+p;if(C<0||S>this.width||L<0||R>this.height)return!x&&[];const O=[];return this._forEachCell(S,R,C,L,this._queryCellCircle,O,{hitTest:x,circle:{x:i,y:u,radius:p},seenUids:{box:{},circle:{}}},v),x?O.length>0:O}query(i,u,p,x,v){return this._query(i,u,p,x,!1,v)}hitTest(i,u,p,x,v){return this._query(i,u,p,x,!0,v)}hitTestCircle(i,u,p,x){return this._queryCircle(i,u,p,!0,x)}_queryCell(i,u,p,x,v,S,C,R){const L=C.seenUids,O=this.boxCells[v];if(O!==null){const U=this.bboxes;for(const j of O)if(!L.box[j]){L.box[j]=!0;const H=4*j;if(i<=U[H+2]&&u<=U[H+3]&&p>=U[H+0]&&x>=U[H+1]&&(!R||R(this.boxKeys[j]))){if(C.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[j],x1:U[H],y1:U[H+1],x2:U[H+2],y2:U[H+3]})}}}const F=this.circleCells[v];if(F!==null){const U=this.circles;for(const j of F)if(!L.circle[j]){L.circle[j]=!0;const H=3*j;if(this._circleAndRectCollide(U[H],U[H+1],U[H+2],i,u,p,x)&&(!R||R(this.circleKeys[j]))){if(C.hitTest)return S.push(!0),!0;{const Z=U[H],X=U[H+1],Y=U[H+2];S.push({key:this.circleKeys[j],x1:Z-Y,y1:X-Y,x2:Z+Y,y2:X+Y})}}}}}_queryCellCircle(i,u,p,x,v,S,C,R){const L=C.circle,O=C.seenUids,F=this.boxCells[v];if(F!==null){const j=this.bboxes;for(const H of F)if(!O.box[H]){O.box[H]=!0;const Z=4*H;if(this._circleAndRectCollide(L.x,L.y,L.radius,j[Z+0],j[Z+1],j[Z+2],j[Z+3])&&(!R||R(this.boxKeys[H])))return S.push(!0),!0}}const U=this.circleCells[v];if(U!==null){const j=this.circles;for(const H of U)if(!O.circle[H]){O.circle[H]=!0;const Z=3*H;if(this._circlesCollide(j[Z],j[Z+1],j[Z+2],L.x,L.y,L.radius)&&(!R||R(this.circleKeys[H])))return S.push(!0),!0}}}_forEachCell(i,u,p,x,v,S,C,R){const L=this._convertToXCellCoord(i),O=this._convertToYCellCoord(u),F=this._convertToXCellCoord(p),U=this._convertToYCellCoord(x);for(let j=L;j<=F;j++)for(let H=O;H<=U;H++)if(v.call(this,i,u,p,x,this.xCellCount*H+j,S,C,R))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,u,p,x,v,S){const C=x-i,R=v-u,L=p+S;return L*L>C*C+R*R}_circleAndRectCollide(i,u,p,x,v,S,C){const R=(S-x)/2,L=Math.abs(i-(x+R));if(L>R+p)return!1;const O=(C-v)/2,F=Math.abs(u-(v+O));if(F>O+p)return!1;if(L<=R||F<=O)return!0;const U=L-R,j=F-O;return U*U+j*j<=p*p}}const qi=100;class Hm{constructor(i,u,p=new xp(i.width+200,i.height+200,25),x=new xp(i.width+200,i.height+200,25)){this.transform=i,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+qi,this.screenBottomBoundary=i.height+qi,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=u}placeCollisionBox(i,u,p,x,v,S,C,R){let L=p.projectedAnchorX,O=p.projectedAnchorY,F=p.projectedAnchorZ;const U=p.elevation,j=p.tileID,H=i.getProjection();if(U&&j){const[_e,se,le]=H.upVector(j.canonical,p.tileAnchorX,p.tileAnchorY),ce=H.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=_e*U*ce,O+=se*U*ce,F+=le*U*ce}const Z=this.projectAndGetPerspectiveRatio(C,L,O,F,p.tileID,H.name==="globe"||!!U||this.transform.pitch>0,H),X=S*Z.perspectiveRatio,Y=(p.x1*u+x.x-p.padding)*X+Z.point.x,ie=(p.y1*u+x.y-p.padding)*X+Z.point.y,oe=(p.x2*u+x.x+p.padding)*X+Z.point.x,ue=(p.y2*u+x.y+p.padding)*X+Z.point.y,ge=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(Y,ie,oe,ue)||!v&&this.grid.hitTest(Y,ie,oe,ue,R)||ge?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[Y,ie,oe,ue],offscreen:this.isOffscreen(Y,ie,oe,ue),occluded:!1}}placeCollisionCircles(i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z){const X=[],Y=this.transform.elevation,ie=i.getProjection(),oe=Y?Y.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,ie):null,ue=new o.P(p.tileAnchorX,p.tileAnchorY);let{x:ge,y:_e,z:se}=ie.projectTilePoint(ue.x,ue.y,Z.canonical);if(oe){const[Qe,Pe,je]=oe(ue);ge+=Qe,_e+=Pe,se+=je}const le=ie.name==="globe",ce=this.projectAndGetPerspectiveRatio(C,ge,_e,se,Z,le||!!Y||this.transform.pitch>0,ie),{perspectiveRatio:Se}=ce,Oe=(F?S/Se:S*Se)/o.bN,pe=gs(ge,_e,se,R),Be=ce.signedDistanceFromCamera>0?ch(Oe,v,p.lineOffsetX*Oe,p.lineOffsetY*Oe,!1,pe,ue,p,x,R,{},Y&&!F?oe:null,F&&!!Y,ie,Z,F):null;let Fe=!1,tt=!1,rt=!0;if(Be&&!ce.occluded){const Qe=.5*j*Se+H,Pe=new o.P(-100,-100),je=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new qm,{first:bt,last:St}=Be,Pt=bt.path.length;let Et=[];for(let kt=Pt-1;kt>=1;kt--)Et.push(bt.path[kt]);for(let kt=1;kt<St.path.length;kt++)Et.push(St.path[kt]);const ot=2.5*Qe;L&&(Et=Et.map(([kt,cn,sn],yn)=>(oe&&!le&&(sn=oe(yn<Pt-1?bt.tilePath[Pt-1-yn]:St.tilePath[yn-Pt+2])[2]),gs(kt,cn,sn,L))),Et.some(kt=>kt[3]<=0)&&(Et=[]));let Ze=[];if(Et.length>0){let kt=1/0,cn=-1/0,sn=1/0,yn=-1/0;for(const Sn of Et)kt=Math.min(kt,Sn[0]),sn=Math.min(sn,Sn[1]),cn=Math.max(cn,Sn[0]),yn=Math.max(yn,Sn[1]);cn>=Pe.x&&kt<=je.x&&yn>=Pe.y&&sn<=je.y&&(Ze=[Et.map(Sn=>new o.P(Sn[0],Sn[1]))],(kt<Pe.x||cn>je.x||sn<Pe.y||yn>je.y)&&(Ze=o.cF(Ze,Pe.x,Pe.y,je.x,je.y)))}for(const kt of Ze){Ke.reset(kt,.25*Qe);let cn=0;cn=Ke.length<=.5*Qe?1:Math.ceil(Ke.paddedLength/ot)+1;for(let sn=0;sn<cn;sn++){const yn=sn/Math.max(cn-1,1),Sn=Ke.lerp(yn),Vt=Sn.x+qi,tn=Sn.y+qi;X.push(Vt,tn,Qe,0);const Hn=Vt-Qe,er=tn-Qe,nr=Vt+Qe,En=tn+Qe;if(rt=rt&&this.isOffscreen(Hn,er,nr,En),tt=tt||this.isInsideGrid(Hn,er,nr,En),!u&&this.grid.hitTestCircle(Vt,tn,Qe,U)&&(Fe=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Fe,occluded:!1}}}}return{circles:!O&&Fe||!tt?[]:X,offscreen:rt,collisionDetected:Fe,occluded:ce.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let p=1/0,x=1/0,v=-1/0,S=-1/0;for(const O of i){const F=new o.P(O.x+qi,O.y+qi);p=Math.min(p,F.x),x=Math.min(x,F.y),v=Math.max(v,F.x),S=Math.max(S,F.y),u.push(F)}const C=this.grid.query(p,x,v,S).concat(this.ignoredGrid.query(p,x,v,S)),R={},L={};for(const O of C){const F=O.key;if(R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]={}),R[F.bucketInstanceId][F.featureIndex])continue;const U=[new o.P(O.x1,O.y1),new o.P(O.x2,O.y1),new o.P(O.x2,O.y2),new o.P(O.x1,O.y2)];o.cG(u,U)&&(R[F.bucketInstanceId][F.featureIndex]=!0,L[F.bucketInstanceId]===void 0&&(L[F.bucketInstanceId]=[]),L[F.bucketInstanceId].push(F.featureIndex))}return L}insertCollisionBox(i,u,p,x,v){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:v},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,u,p,x,v){const S=u?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:x,collisionGroupID:v};for(let R=0;R<i.length;R+=4)S.insertCircle(C,i[R],i[R+1],i[R+2])}projectAndGetPerspectiveRatio(i,u,p,x,v,S,C){const R=[u,p,x,1];let L=!1;x||this.transform.pitch>0?(o.aA.transformMat4(R,R,i),this.fogState&&v&&C.name!=="globe"&&(L=function(U,j,H,Z,X,Y){const ie=Y.calculateFogTileMatrix(X),oe=[j,H,Z];return o._.transformMat4(oe,oe,ie),Qr(U,o._.length(oe),Y.pitch,Y._fov)}(this.fogState,u,p,x,v.toUnwrapped(),this.transform)>.9)):No(R,R,i);const O=R[3];return{point:new o.P((R[0]/O+1)/2*this.transform.width+qi,(-R[1]/O+1)/2*this.transform.height+qi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/O*.5,1.5),signedDistanceFromCamera:O,occluded:S&&R[2]>O||L}}isOffscreen(i,u,p,x){return p<qi||i>=this.screenRightBoundary||x<qi||u>this.screenBottomBoundary}isInsideGrid(i,u,p,x){return p>=0&&i<this.gridRightBoundary&&x>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const i=o.ad.identity([]);return o.ad.translate(i,i,[-100,-100,0]),i}}class tl{constructor(i,u,p,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class ki{constructor(i,u,p,x,v,S=!1){this.text=new tl(i?i.text:null,u,p,v),this.icon=new tl(i?i.icon:null,u,x,v),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class zd{constructor(i,u,p,x=!1){this.text=i,this.icon=u,this.skipFade=p,this.clipped=x}}class Zm{constructor(){this.invProjMatrix=o.ad.create(),this.viewportMatrix=o.ad.create(),this.circles=[]}}class Th{constructor(i,u,p,x,v){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=v}}class Sh{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[i]}}function vp(f,i,u,p,x){const{horizontalAlign:v,verticalAlign:S}=o.bQ(f),C=-(v-.5)*i,R=-(S-.5)*u,L=o.bP(f,p);return new o.P(C+L[0]*x,R+L[1]*x)}function fc(f,i,u,p,x){const v=new o.P(f,i);return u&&v._rotate(p?x:-x),v}class Os{constructor(i,u,p,x,v,S){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new Hm(this.transform,v),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Sh(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,u,p,x){const v=p.getBucket(u),S=p.latestFeatureIndex;if(!v||!S||u.fqid!==v.layerIds[0])return;const C=v.layers[0].layout,R=p.collisionBoxArray,L=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),O=p.tileSize/o.a3,F=p.tileID.toUnwrapped();this.transform.setProjection(v.projection);const U=(j=p.tileID,H=v.getProjection(),Z=this.transform,H.name===this.projection?Z.calculateProjMatrix(j.toUnwrapped()):nc(Z,H,j));var j,H,Z;const X=C.get("text-pitch-alignment")==="map",Y=C.get("text-rotation-alignment")==="map";u.compileFilter();const ie=u.dynamicFilter(),oe=u.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(p),ge=Ds(U,p.tileID.canonical,X,Y,this.transform,v.getProjection(),ue);let _e=null;if(X){const ce=Ul(U,p.tileID.canonical,X,Y,this.transform,v.getProjection(),ue);_e=o.ad.multiply([],this.transform.labelPlaneMatrix,ce)}let se=null;ie&&p.latestFeatureIndex&&(se={unwrappedTileID:F,dynamicFilter:ie,dynamicFilterNeedsFeature:oe,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Th(v.bucketInstanceId,S,v.sourceLayerIndex,v.index,p.tileID);const le={bucket:v,layout:C,posMatrix:U,textLabelPlaneMatrix:ge,labelToScreenMatrix:_e,clippingData:se,scale:L,textPixelRatio:O,holdingForFade:p.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.aD(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.aD(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(x)for(const ce of v.sortKeyRanges){const{sortKey:Se,symbolInstanceStart:Oe,symbolInstanceEnd:pe}=ce;i.push({sortKey:Se,symbolInstanceStart:Oe,symbolInstanceEnd:pe,parameters:le})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:le})}attemptAnchorPlacement(i,u,p,x,v,S,C,R,L,O,F,U,j,H,Z,X,Y,ie){const{textOffset0:oe,textOffset1:ue,crossTileID:ge}=U,_e=[oe,ue],se=vp(i,p,x,_e,v),le=this.collisionIndex.placeCollisionBox(H,v,u,fc(se.x,se.y,S,C,this.transform.angle),F,R,L,O.predicate);if(X){const ce=H.getSymbolInstanceIconSize(ie,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(H,ce,X,fc(se.x,se.y,S,C,this.transform.angle),F,R,L,O.predicate).box.length===0)return}if(le.box.length>0){let ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(ce=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:_e,width:p,height:x,anchor:i,textScale:v,prevAnchor:ce},this.markUsedJustification(H,i,U,Z),H.allowVerticalPlacement&&(this.markUsedOrientation(H,Z,U),this.placedOrientations[ge]=Z),{shift:se,placedGlyphBoxes:le}}}placeLayerBucketPart(i,u,p,x){const{bucket:v,layout:S,posMatrix:C,textLabelPlaneMatrix:R,labelToScreenMatrix:L,clippingData:O,textPixelRatio:F,holdingForFade:U,collisionBoxArray:j,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:Z,collisionGroup:X}=i.parameters,Y=S.get("text-optional"),ie=S.get("icon-optional"),oe=S.get("text-allow-overlap"),ue=S.get("icon-allow-overlap"),ge=S.get("text-rotation-alignment")==="map",_e=S.get("text-pitch-alignment")==="map",se=S.get("symbol-z-order")==="viewport-y",le=S.get("symbol-z-elevate");this.transform.setProjection(v.projection);let ce=oe&&(ue||!v.hasIconData()||ie),Se=ue&&(oe||!v.hasTextData()||Y);!v.collisionArrays&&j&&v.deserializeCollisionBoxes(j),p&&x&&v.updateCollisionDebugBuffers(this.transform.zoom,j);const Oe=(pe,Be,Fe)=>{const{crossTileID:tt,numVerticalGlyphVertices:rt}=pe;if(O){const nr={zoom:this.transform.zoom,pitch:this.transform.pitch};let En=null;if(O.dynamicFilterNeedsFeature){const ln=this.retainedQueryData[v.bucketInstanceId];En=O.featureIndex.loadFeature({featureIndex:pe.featureIndex,bucketIndex:ln.bucketIndex,sourceLayerIndex:ln.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(nr,En,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new o.P(pe.tileAnchorX,pe.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[tt]=new zd(!1,!1,!1,!0),void u.add(tt)}if(u.has(tt))return;if(U)return void(this.placements[tt]=new zd(!1,!1,!1));let Qe=!1,Pe=!1,je=!0,Ke=!1,bt=!1,St=null,Pt={box:null,offscreen:null,occluded:null},Et={box:null,offscreen:null,occluded:null},ot=null,Ze=null,kt=null,cn=0,sn=0,yn=0;Fe.textFeatureIndex?cn=Fe.textFeatureIndex:pe.useRuntimeCollisionCircles&&(cn=pe.featureIndex),Fe.verticalTextFeatureIndex&&(sn=Fe.verticalTextFeatureIndex);const Sn=nr=>{nr.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const En=this.transform.elevation;nr.elevation=pe.zOffset+(En?En.getAtTileOffset(nr.tileID,nr.tileAnchorX,nr.tileAnchorY):0)},Vt=Fe.textBox;if(Vt){Sn(Vt);const nr=ln=>{let Dn=o.aE.horizontal;if(v.allowVerticalPlacement&&!ln&&this.prevPlacement){const vr=this.prevPlacement.placedOrientations[tt];vr&&(this.placedOrientations[tt]=vr,Dn=vr,this.markUsedOrientation(v,Dn,pe))}return Dn},En=(ln,Dn)=>{if(v.allowVerticalPlacement&&rt>0&&Fe.verticalTextBox){for(const vr of v.writingModes)if(vr===o.aE.vertical?(Pt=Dn(),Et=Pt):Pt=ln(),Pt&&Pt.box&&Pt.box.length)break}else Pt=ln()};if(S.get("text-variable-anchor")){let ln=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[tt]){const ar=this.prevPlacement.variableOffsets[tt];ln.indexOf(ar.anchor)>0&&(ln=ln.filter(nt=>nt!==ar.anchor),ln.unshift(ar.anchor))}const Dn=(ar,nt,At)=>{const Mr=v.getSymbolInstanceTextSize(H,pe,this.transform.zoom,Be),Kn=(ar.x2-ar.x1)*Mr+2*ar.padding,ke=(ar.y2-ar.y1)*Mr+2*ar.padding,Vs=pe.hasIconTextFit&&!ue?nt:null;Vs&&Sn(Vs);let Vr={box:[],offscreen:!1,occluded:!1};const Sr=oe?2*ln.length:ln.length;for(let ri=0;ri<Sr;++ri){const cs=this.attemptAnchorPlacement(ln[ri%ln.length],ar,Kn,ke,Mr,ge,_e,F,C,X,ri>=ln.length,pe,Be,v,At,Vs,H,Z);if(cs&&(Vr=cs.placedGlyphBoxes,Vr&&Vr.box&&Vr.box.length)){Qe=!0,St=cs.shift;break}}return Vr};En(()=>Dn(Vt,Fe.iconBox,o.aE.horizontal),()=>{const ar=Fe.verticalTextBox;return ar&&Sn(ar),v.allowVerticalPlacement&&!(Pt&&Pt.box&&Pt.box.length)&&rt>0&&ar?Dn(ar,Fe.verticalIconBox,o.aE.vertical):{box:null,offscreen:null,occluded:null}}),Pt&&(Qe=Pt.box,je=Pt.offscreen,Ke=Pt.occluded);const vr=nr(!(!Pt||!Pt.box));if(!Qe&&this.prevPlacement){const ar=this.prevPlacement.variableOffsets[tt];ar&&(this.variableOffsets[tt]=ar,this.markUsedJustification(v,ar.anchor,pe,vr))}}else{const ln=(Dn,vr)=>{const ar=v.getSymbolInstanceTextSize(H,pe,this.transform.zoom,Be),nt=this.collisionIndex.placeCollisionBox(v,ar,Dn,new o.P(0,0),oe,F,C,X.predicate);return nt&&nt.box&&nt.box.length&&(this.markUsedOrientation(v,vr,pe),this.placedOrientations[tt]=vr),nt};En(()=>ln(Vt,o.aE.horizontal),()=>{const Dn=Fe.verticalTextBox;return v.allowVerticalPlacement&&rt>0&&Dn?(Sn(Dn),ln(Dn,o.aE.vertical)):{box:null,offscreen:null,occluded:null}}),nr(!!(Pt&&Pt.box&&Pt.box.length))}}if(ot=Pt,Qe=ot&&ot.box&&ot.box.length>0,je=ot&&ot.offscreen,Ke=ot&&ot.occluded,pe.useRuntimeCollisionCircles){const nr=v.text.placedSymbolArray.get(pe.centerJustifiedTextSymbolIndex>=0?pe.centerJustifiedTextSymbolIndex:pe.verticalPlacedTextSymbolIndex),En=o.aF(v.textSizeData,H,nr),ln=S.get("text-padding");Ze=this.collisionIndex.placeCollisionCircles(v,oe,nr,v.lineVertexArray,v.glyphOffsetArray,En,C,R,L,p,_e,X.predicate,pe.collisionCircleDiameter*En/o.bN,ln,this.retainedQueryData[v.bucketInstanceId].tileID),Qe=oe||Ze.circles.length>0&&!Ze.collisionDetected,je=je&&Ze.offscreen,Ke=Ze.occluded}if(Fe.iconFeatureIndex&&(yn=Fe.iconFeatureIndex),Fe.iconBox){const nr=En=>{Sn(En);const ln=pe.hasIconTextFit&&St?fc(St.x,St.y,ge,_e,this.transform.angle):new o.P(0,0),Dn=v.getSymbolInstanceIconSize(Z,this.transform.zoom,pe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,Dn,En,ln,ue,F,C,X.predicate)};Et&&Et.box&&Et.box.length&&Fe.verticalIconBox?(kt=nr(Fe.verticalIconBox),Pe=kt.box.length>0):(kt=nr(Fe.iconBox),Pe=kt.box.length>0),je=je&&kt.offscreen,bt=kt.occluded}const tn=Y||pe.numHorizontalGlyphVertices===0&&rt===0,Hn=ie||pe.numIconVertices===0;if(tn||Hn?Hn?tn||(Pe=Pe&&Qe):Qe=Pe&&Qe:Pe=Qe=Pe&&Qe,Qe&&ot&&ot.box&&this.collisionIndex.insertCollisionBox(ot.box,S.get("text-ignore-placement"),v.bucketInstanceId,Et&&Et.box&&sn?sn:cn,X.ID),Pe&&kt&&this.collisionIndex.insertCollisionBox(kt.box,S.get("icon-ignore-placement"),v.bucketInstanceId,yn,X.ID),Ze&&(Qe&&this.collisionIndex.insertCollisionCircles(Ze.circles,S.get("text-ignore-placement"),v.bucketInstanceId,cn,X.ID),p)){const nr=v.bucketInstanceId;let En=this.collisionCircleArrays[nr];En===void 0&&(En=this.collisionCircleArrays[nr]=new Zm);for(let ln=0;ln<Ze.circles.length;ln+=4)En.circles.push(Ze.circles[ln+0]),En.circles.push(Ze.circles[ln+1]),En.circles.push(Ze.circles[ln+2]),En.circles.push(Ze.collisionDetected?1:0)}const er=v.projection.name!=="globe";ce=ce&&(er||!Ke),Se=Se&&(er||!bt),this.placements[tt]=new zd(Qe||ce,Pe||Se,je||v.justReloaded),u.add(tt)};if(le&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),se){const pe=v.getSortedSymbolIndexes(this.transform.angle);for(let Be=pe.length-1;Be>=0;--Be){const Fe=pe[Be];Oe(v.symbolInstances.get(Fe),Fe,v.collisionArrays[Fe])}v.hasAnyZOffset&&o.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const pe=v.getSortedIndexesByZOffset();for(let Be=0;Be<pe.length;++Be){const Fe=pe[Be];Oe(v.symbolInstances.get(Fe),Fe,v.collisionArrays[Fe])}}else for(let pe=i.symbolInstanceStart;pe<i.symbolInstanceEnd;pe++)Oe(v.symbolInstances.get(pe),pe,v.collisionArrays[pe]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[v.bucketInstanceId];o.ad.invert(pe.invProjMatrix,C),pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(i,u,p,x){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:R,crossTileID:L}=p,O=o.cJ(u),F=x===o.aE.vertical?R:O==="left"?v:O==="center"?S:O==="right"?C:-1;v>=0&&(i.text.placedSymbolArray.get(v).crossTileID=F>=0&&v!==F?0:L),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=F>=0&&S!==F?0:L),C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=F>=0&&C!==F?0:L),R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=F>=0&&R!==F?0:L)}markUsedOrientation(i,u,p){const x=u===o.aE.horizontal||u===o.aE.horizontalOnly?u:0,v=u===o.aE.vertical?u:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:L}=p,O=i.text.placedSymbolArray;S>=0&&(O.get(S).placedOrientation=x),C>=0&&(O.get(C).placedOrientation=x),R>=0&&(O.get(R).placedOrientation=x),L>=0&&(O.get(L).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const x=u?u.symbolFadeChange(i):1,v=u?u.opacities:{},S=u?u.variableOffsets:{},C=u?u.placedOrientations:{};for(const R in this.placements){const L=this.placements[R],O=v[R];O?(this.opacities[R]=new ki(O,x,L.text,L.icon,null,L.clipped),p=p||L.text!==O.text.placed||L.icon!==O.icon.placed):(this.opacities[R]=new ki(null,x,L.text,L.icon,L.skipFade,L.clipped),p=p||L.text||L.icon)}for(const R in v){const L=v[R];if(!this.opacities[R]){const O=new ki(L,x,!1,!1);O.isHidden()||(this.opacities[R]=O,p=p||L.text.placed||L.icon.placed)}}for(const R in S)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=S[R]);for(const R in C)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=C[R]);p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)}updateLayerOpacities(i,u,p,x){const v=new Set;for(const S of u){const C=S.getBucket(i);C&&S.latestFeatureIndex&&i.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,v,S.collisionBoxArray,p,x,S.tileID),C.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,S.tileID),C.updateZOffset()))}}updateBucketOpacities(i,u,p,x,v,S){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const C=i.layers[0].layout,R=!!i.layers[0].dynamicFilter(),L=new ki(null,0,!1,!1,!0),O=C.get("text-allow-overlap"),F=C.get("icon-allow-overlap"),U=C.get("text-variable-anchor"),j=C.get("text-rotation-alignment")==="map",H=C.get("text-pitch-alignment")==="map",Z=new ki(null,0,O&&(F||!i.hasIconData()||C.get("icon-optional")),F&&(O||!i.hasTextData()||C.get("text-optional")),!0);!i.collisionArrays&&p&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(p);const X=(ie,oe,ue)=>{for(let ge=0;ge<oe/4;ge++)ie.opacityVertexArray.emplaceBack(ue)};let Y=0;v&&i.updateReplacement(S,v);for(let ie=0;ie<i.symbolInstances.length;ie++){const oe=i.symbolInstances.get(ie),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:ge,crossTileID:_e,numIconVertices:se,tileAnchorX:le,tileAnchorY:ce}=oe,Se=u.has(_e);let Oe=this.opacities[_e];Se?Oe=L:Oe||(Oe=Z,this.opacities[_e]=Oe),u.add(_e);const pe=ue>0||ge>0,Be=se>0,Fe=this.placedOrientations[_e],tt=Fe===o.aE.vertical,rt=Fe===o.aE.horizontal||Fe===o.aE.horizontalOnly;!pe&&!Be||Oe.isHidden()||Y++;let Qe=!1;if((pe||Be)&&v)for(const Pe of i.activeReplacements){if(Pe.order<x||Pe.order===1/0||!(Pe.clipMask&o.cu.Symbol)||Pe.min.x>le||le>Pe.max.x||Pe.min.y>ce||ce>Pe.max.y)continue;const je=o.cH(le,ce,S.canonical,Pe.footprintTileId.canonical);if(Qe=o.cI(je,Pe),Qe)break}if(pe){const Pe=Qe?$o:Oi(Oe.text);X(i.text,ue,tt?$o:Pe),X(i.text,ge,rt?$o:Pe);const je=Oe.text.isHidden(),{leftJustifiedTextSymbolIndex:Ke,centerJustifiedTextSymbolIndex:bt,rightJustifiedTextSymbolIndex:St,verticalPlacedTextSymbolIndex:Pt}=oe,Et=i.text.placedSymbolArray,ot=je||tt?1:0;Ke>=0&&(Et.get(Ke).hidden=ot),bt>=0&&(Et.get(bt).hidden=ot),St>=0&&(Et.get(St).hidden=ot),Pt>=0&&(Et.get(Pt).hidden=je||rt?1:0);const Ze=this.variableOffsets[_e];Ze&&this.markUsedJustification(i,Ze.anchor,oe,Fe);const kt=this.placedOrientations[_e];kt&&(this.markUsedJustification(i,"left",oe,kt),this.markUsedOrientation(i,kt,oe))}if(Be){const Pe=Qe?$o:Oi(Oe.icon),{placedIconSymbolIndex:je,verticalPlacedIconSymbolIndex:Ke}=oe,bt=i.icon.placedSymbolArray,St=Oe.icon.isHidden()?1:0;je>=0&&(X(i.icon,se,tt?$o:Pe),bt.get(je).hidden=St),Ke>=0&&(X(i.icon,oe.numVerticalIconVertices,rt?$o:Pe),bt.get(Ke).hidden=St)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Pe=i.collisionArrays[ie];if(Pe){let je=new o.P(0,0),Ke=!0;if(Pe.textBox||Pe.verticalTextBox){if(U){const St=this.variableOffsets[_e];St?(je=vp(St.anchor,St.width,St.height,St.textOffset,St.textScale),j&&je._rotate(H?this.transform.angle:-this.transform.angle)):Ke=!1}R&&(Ke=!Oe.clipped),Pe.textBox&&Eh(i.textCollisionBox.collisionVertexArray,Oe.text.placed,!Ke||tt,je.x,je.y),Pe.verticalTextBox&&Eh(i.textCollisionBox.collisionVertexArray,Oe.text.placed,!Ke||rt,je.x,je.y)}const bt=Ke&&!!(!rt&&Pe.verticalIconBox);Pe.iconBox&&Eh(i.iconCollisionBox.collisionVertexArray,Oe.icon.placed,bt,oe.hasIconTextFit?je.x:0,oe.hasIconTextFit?je.y:0),Pe.verticalIconBox&&Eh(i.iconCollisionBox.collisionVertexArray,Oe.icon.placed,!bt,oe.hasIconTextFit?je.x:0,oe.hasIconTextFit?je.y:0)}}}if(i.fullyClipped=Y===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ie.invProjMatrix,i.placementViewportMatrix=ie.viewportMatrix,i.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,u){const p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function Eh(f,i,u,p,x){f.emplaceBack(i?1:0,u?1:0,p||0,x||0),f.emplaceBack(i?1:0,u?1:0,p||0,x||0),f.emplaceBack(i?1:0,u?1:0,p||0,x||0),f.emplaceBack(i?1:0,u?1:0,p||0,x||0)}const wp=Math.pow(2,25),xt=Math.pow(2,24),pc=Math.pow(2,17),mc=Math.pow(2,16),bp=Math.pow(2,9),Tp=Math.pow(2,8),kd=Math.pow(2,1);function Oi(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const i=f.placed?1:0,u=Math.floor(127*f.opacity);return u*wp+i*xt+u*pc+i*mc+u*bp+i*Tp+u*kd+i}const $o=0;class Bs{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,u,p,x,v){const S=this._bucketParts;for(;this._currentTileIndex<i.length;)if(u.getBucketParts(S,x,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((C,R)=>C.sortKey-R.sortKey));this._currentPartIndex<S.length;){const C=S[this._currentPartIndex];if(u.placeLayerBucketPart(C,this._seenCrossTileIDs,p,C.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class us{constructor(i,u,p,x,v,S,C,R,L){this.placement=new Os(i,v,S,C,R,L),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,u,p,x){const v=o.e.now(),S=()=>{const C=o.e.now()-v;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=u[i[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){const L=C,O=L.layout.get("symbol-z-elevate"),F=this._inProgressLayer=this._inProgressLayer||new Bs(L),U=o.al(C.source,C.scope);if(F.continuePlacement(O?x[U]:p[U],this.placement,this._showCollisionBoxes,C,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const nl=512/o.a3/2;class Xm{constructor(i,u,p){this.tileID=i,this.bucketInstanceId=p,this.index=new o.cK(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=i.canonical.x*o.a3,v=i.canonical.y*o.a3;for(let S=0;S<u.length;S++){const{key:C,crossTileID:R,tileAnchorX:L,tileAnchorY:O}=u.get(S),F=Math.floor((x+L)*nl),U=Math.floor((v+O)*nl);this.index.add(F,U),this.keys.push(C),this.crossTileIDs.push(R)}this.index.finish()}findMatches(i,u,p){const x=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),v=nl/Math.pow(2,u.canonical.z-this.tileID.canonical.z),S=u.canonical.x*o.a3,C=u.canonical.y*o.a3;for(let R=0;R<i.length;R++){const L=i.get(R);if(L.crossTileID)continue;const{key:O,tileAnchorX:F,tileAnchorY:U}=L,j=Math.floor((S+F)*v),H=Math.floor((C+U)*v),Z=this.index.range(j-x,H-x,j+x,H+x);for(const X of Z){const Y=this.crossTileIDs[X];if(this.keys[X]===O&&!p.has(Y)){p.add(Y),L.crossTileID=Y;break}}}}}class Ym{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const u=Math.round((i-this.lng)/360);if(u!==0)for(const p in this.indexes){const x=this.indexes[p],v={};for(const S in x){const C=x[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+u),v[C.tileID.key]=C}this.indexes[p]=v}this.lng=i}addBucket(i,u,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<u.symbolInstances.length;v++)u.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const x=this.usedCrossTileIDs[i.overscaledZ];for(const v in this.indexes){const S=this.indexes[v];if(Number(v)>i.overscaledZ)for(const C in S){const R=S[C];R.tileID.isChildOf(i)&&R.findMatches(u.symbolInstances,i,x)}else{const C=S[i.scaledTo(Number(v)).key];C&&C.findMatches(u.symbolInstances,i,x)}}for(let v=0;v<u.symbolInstances.length;v++){const S=u.symbolInstances.get(v);S.crossTileID||(S.crossTileID=p.generate(),x.add(S.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Xm(i,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(i,u){for(const p of u.crossTileIDs)this.usedCrossTileIDs[i].delete(p)}removeStaleBuckets(i){let u=!1;for(const p in this.indexes){const x=this.indexes[p];for(const v in x)i[x[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[v]),delete x[v],u=!0)}return u}}class rl{constructor(){this.layerIndexes={},this.crossTileIDs=new Ym,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,u,p,x){let v=this.layerIndexes[i.fqid];v===void 0&&(v=this.layerIndexes[i.fqid]=new Yl);let S=!1;const C={};x.name!=="globe"&&v.handleWrapJump(p);for(const R of u){const L=R.getBucket(i);L&&i.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(R.tileID,L,this.crossTileIDs)&&(S=!0),C[L.bucketInstanceId]=!0)}return v.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(i){const u={};i.forEach(p=>{u[p]=!0});for(const p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}const Sp=new o.N({data:new o.O(o.L.colorTheme.data)}),il=(f,i)=>un(f,i&&i.filter(u=>u.identifier!=="source.canvas")),_c=o.ah(Vn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),zg=o.ah(Vn,["setCenter","setZoom","setBearing","setPitch"]),Ep={version:8,layers:[],sources:{}},Bi={duration:300,delay:0};class Fs extends o.E{constructor(i,u={}){super(),this.map=i,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=o.W({},Bi),this._buildingIndex=new Lg(this),this.crossTileSymbolIndex=new rl,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new wn,this.dispatcher=u.dispatcher?u.dispatcher:new o.bw(o.bx(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new zl,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new o.cM(i._requestManager,u.localFontFamily?o.cN.all:u.localIdeographFontFamily?o.cN.ideographs:o.cN.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new ku(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,colorTheme:null},this._styleColorThemeForScope={},this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",o.cO());const p=this;this._rtlTextPluginCallback=Fs.registerForPluginStateChange(x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(v,S)=>{if(o.cP(v),S&&S.every(C=>C))for(const C in p._sourceCaches){const R=p._sourceCaches[C],L=R.getSource().type;L!=="vector"&&L!=="geojson"||R.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const v=this.getOwnSource(x.sourceId);if(v&&v.vectorLayerIds)for(const S in this._layers){const C=this._layers[S];C.source===v.id&&this._validateLayer(C)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(o.cQ(i))return i;const u=o.cR(i);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${o.cS(JSON.stringify(i))}`}_diffStyle(i,u,p){this.globalId=this._getGlobalId(i);const x=(v,S)=>{try{S(null,this.setState(v,p))}catch(C){S(C,!1)}};if(typeof i=="string"){const v=this.map._requestManager.normalizeStyleURL(i),S=this.map._requestManager.transformRequest(v,o.R.Style);o.g(S,(C,R)=>{C?this.fire(new o.d(C)):R&&x(R,u)})}else typeof i=="object"&&x(i,u)}loadURL(i,u={}){this.fire(new o.f("dataloading",{dataType:"style"}));const p=typeof u.validate=="boolean"?u.validate:!o.cQ(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,u.accessToken),this.resolvedImports.add(i);const x=this.importsCache.get(i);if(x)return this._load(x,p);const v=this.map._requestManager.transformRequest(i,o.R.Style);this._request=o.g(v,(S,C)=>{if(this._request=null,S)this.fire(new o.d(S));else if(C)return this.importsCache.set(i,C),this._load(C,p)})}loadJSON(i,u={}){this.fire(new o.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=o.e.frame(()=>{this._request=null,this._load(i,u.validate!==!1)})}loadEmpty(){this.fire(new o.f("dataloading",{dataType:"style"})),this._load(Ep,!1)}_loadImports(i,u,p){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const v of i){const S=this._createFragmentStyle(v),C=new Promise(O=>{S.once("style.import.load",O),S.once("error",O)}).then(()=>this.mergeAll());if(x.push(C),this.resolvedImports.has(v.url)){S.loadEmpty();continue}const R=v.data||this.importsCache.get(v.url);R?(S.loadJSON(R,{validate:u}),this._isInternalStyle(R)&&(S.globalId=null)):v.url?S.loadURL(v.url,{validate:u}):S.loadEmpty();const L={style:S,id:v.id,config:v.config};if(p){const O=this.fragments.findIndex(({id:F})=>F===p);this.fragments=this.fragments.slice(0,O).concat(L).concat(this.fragments.slice(O))}else this.fragments.push(L)}return Promise.allSettled(x)}getImportGlobalIds(i=this,u=new Set){for(const p of i.fragments)p.style.globalId&&u.add(p.style.globalId),this.getImportGlobalIds(p.style,u);return[...u.values()]}_createFragmentStyle(i){const u=this.scope?o.al(i.id,this.scope):i.id;let p;const x=this._initialConfig&&this._initialConfig[u];(i.config||x)&&(p=o.W({},i.config,x));const v=new Fs(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,u){const p=i.schema;if(this._isInternalStyle(i)){const S=o.W({},Ep,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(S,u)}if(this.updateConfig(this._config,p),u&&il(this,ve(i)))return;this._loaded=!0,this.stylesheet=o.cT(i);const x=()=>{for(const L in i.sources)this.addSource(L,i.sources[L],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const S=yp(this.stylesheet.layers);if(this._order=S.map(L=>L.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new Bt(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Bt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const L of S){const O=o.cY(L,this.scope,this._styleColorTheme.lut,this.options);O.isConfigDependent&&this._configDependentLayers.add(O.fqid),O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O,this._serializedLayers[O.id]=O.serialize();const F=this.getOwnLayerSourceCache(O),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&O.canCastShadows()&&U&&(F.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.f("data",{dataType:"style"}));const R=this.isRootStyle();i.imports?this._loadImports(i.imports,u).then(()=>{this._reloadImports(),this.fire(new o.f(R?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.f(R?"style.load":"style.import.load")))},v=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=v,v){const S=this._evaluateColorThemeData(v);this._loadColorTheme(S).then(()=>{x()}).catch(C=>{o.w(`Couldn't load color theme from the stylesheet: ${C}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,u,p,x,v,S,C,R;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(i=O.light),O.stylesheet.lights)for(const F of O.stylesheet.lights)F.type==="ambient"&&O.ambientLight!=null&&(u=O.ambientLight),F.type==="directional"&&O.directionalLight!=null&&(p=O.directionalLight);x=this._prioritizeTerrain(x,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(v=O.fog),O.stylesheet.camera!=null&&(R=O.stylesheet.camera),O.stylesheet.projection!=null&&(S=O.stylesheet.projection),O.stylesheet.transition!=null&&(C=O.stylesheet.transition),L[O.scope]=O._styleColorTheme}}),this.light=i,this.ambientLight=u,this.directionalLight=p,this.fog=v,this._styleColorThemeForScope=L,x===null?delete this.terrain:this.terrain=x,this.camera=R||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=o.W({},Bi,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const u=p=>{for(const x of p.fragments)u(x.style);i(p)};u(this)}_prioritizeTerrain(i,u,p){const x=i&&i.drapeRenderMode===0;return p===null?u&&u.drapeRenderMode===0?u:x?i:null:u!=null&&(!i||x||u&&u.drapeRenderMode===1)?u:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{i=this._prioritizeTerrain(i,u.terrain,u.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(i=u.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},u={},p={};this.forEachFragmentStyle(x=>{for(const v in x._sourceCaches){const S=o.al(v,x.scope);i[S]=x._sourceCaches[v]}for(const v in x._otherSourceCaches){const S=o.al(v,x.scope);u[S]=x._otherSourceCaches[v]}for(const v in x._symbolSourceCaches){const S=o.al(v,x.scope);p[S]=x._symbolSourceCaches[v]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=p}mergeLayers(){const i={},u=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const C of S._order){const R=S._layers[C];if(R.type==="slot"){const L=o.cU(C);if(i[L])continue;i[L]=[]}R.slot&&i[R.slot]?i[R.slot].push(R):u.push(R)}}),this._mergedOrder=[],this._clipLayerIndices=[];let x=0;const v=(S=[])=>{for(const C of S)if(C.type==="slot"){const R=o.cU(C.id);i[R]&&v(i[R]),this._mergedSlots.push(R)}else{const R=o.al(C.id,C.scope);this._mergedOrder.push(R),p[R]=C,C.is3D()&&(this._has3DLayers=!0),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&this._clipLayerIndices.push(x),x++}};v(u),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=o.W({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(u,p,x){const v=o.W({},p);for(const C of Object.keys(o.L.colorTheme))v[C]===void 0&&(v[C]=o.L.colorTheme[C].default);const S=new o.U(Sp,u,new Map(x));return S.setTransitionOrValue(v,x),S.untransitioned().possiblyEvaluate(new o.X(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){return this._styleColorTheme.lutLoading=!0,new Promise((u,p)=>{const x="data:image/png;base64,";if(i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();i.startsWith(x)||(i=x+i);const v="mapbox-reserved-lut",S=new Image;S.src=i,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},S.onload=()=>{this._styleColorTheme.lutLoading=!1;const{width:C,height:R,data:L}=o.e.getImageData(S);if(R>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(C!==R*R)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(v)&&this.removeImage(v),this.addImage(v,{data:new o.i({width:C,height:R},L),pixelRatio:1,sdf:!1,version:0});const O=this.imageManager.getImage(v,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:i},u()):p(new Error("Missing LUT image."))}})}getLut(i){const u=this._styleColorThemeForScope[i];return u?u.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(u,p,x){let v,S,C;const R=o.e.devicePixelRatio>1?"@2x":"";let L=o.g(p.transformRequest(p.normalizeSpriteURL(u,R,".json"),o.R.SpriteJSON),(U,j)=>{L=null,C||(C=U,v=j,F())}),O=o.h(p.transformRequest(p.normalizeSpriteURL(u,R,".png"),o.R.SpriteImage),(U,j)=>{O=null,C||(C=U,S=j,F())});function F(){if(C)x(C);else if(v&&S){const U=o.e.getImageData(S),j={};for(const H in v){const{width:Z,height:X,x:Y,y:ie,sdf:oe,pixelRatio:ue,stretchX:ge,stretchY:_e,content:se}=v[H],le=new o.i({width:Z,height:X});o.i.copy(U,le,{x:Y,y:ie},{x:0,y:0},{width:Z,height:X},null),j[H]={data:le,pixelRatio:ue,sdf:oe,stretchX:ge,stretchY:_e,content:se}}x(null,j)}}return{cancel(){L&&(L.cancel(),L=null),O&&(O.cancel(),O=null)}}}(i,this.map._requestManager,(u,p)=>{if(this._spriteRequest=null,u)this.fire(new o.d(u));else if(p)for(const x in p)this.imageManager.addImage(x,this.scope,p[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.f("data",{dataType:"style"}))})}_validateLayer(i){const u=this.getOwnSource(i.source);if(!u)return;const p=i.sourceLayer;p&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.d(new Error(`Source layer "${p}" does not exist on source "${u.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,u)=>{const p=this.fragments[u];return p&&p.style&&(i.data=p.style.serialize()),i})}_serializeSources(){const i={};for(const u in this._sourceCaches){const p=this._sourceCaches[u].getSource();i[p.id]||(i[p.id]=p.serialize())}return i}_serializeLayers(i){const u=[];for(const p of i){const x=this._layers[p];x&&x.type!=="custom"&&u.push(x.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const u=this.getOwnLayer(i);if(u)return u;this.fire(new o.d(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const u=this.getOwnSource(i);if(u)return u;this.fire(new o.d(new Error(`The source '${i}' does not exist in the map's style.`)))}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const u=this.calculateLightsBrightness();i.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const C in S){const{updatedIds:R,removedIds:L}=S[C];(R||L)&&(this._updateWorkerLayers(C,R,L),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const v={};for(const S in this._mergedSourceCaches){const C=this._mergedSourceCaches[S];v[S]=C.used,C.used=!1,C.tileCoverLift=0}for(const S of this._mergedOrder){const C=this._mergedLayers[S];if(C.recalculate(i,this._availableImages),!C.isHidden(i.zoom)){const R=this.getLayerSourceCache(C);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,C.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let R=C.minzoom||0;R<(C.maxzoom||25.5);R++){const L=this.map.painter;if(L){const O=C.getProgramIds();if(!O)continue;for(const F of O){const U=C.getDefaultProgramParams(F,i.zoom,this._styleColorTheme.lut);U&&(L.style=this,this.fog&&(L._fogVisible=!0,U.overrideFog=!0,L.getOrCreateProgram(F,U)),L._fogVisible=!1,U.overrideFog=!1,L.getOrCreateProgram(F,U),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(U.overrideRtt=!0,L.getOrCreateProgram(F,U)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();for(const S in v){const C=this._mergedSourceCaches[S];v[S]!==C.used&&C.getSource().fire(new o.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new o.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,u,p){const x=this.getFragmentStyle(i);x&&this.dispatcher.broadcast("updateLayers",{layers:u?x._serializeLayers(u):[],scope:i,removedIds:p||[],options:x.options})}setState(i,u){if(this._checkLoaded(),il(this,ve(i)))return!1;(i=o.cT(i)).layers=yp(i.layers);const p=function(S,C){if(!S)return[{command:Vn.setStyle,args:[C]}];let R=[];try{if(!q(S.version,C.version))return[{command:Vn.setStyle,args:[C]}];if(q(S.center,C.center)||R.push({command:Vn.setCenter,args:[C.center]}),q(S.zoom,C.zoom)||R.push({command:Vn.setZoom,args:[C.zoom]}),q(S.bearing,C.bearing)||R.push({command:Vn.setBearing,args:[C.bearing]}),q(S.pitch,C.pitch)||R.push({command:Vn.setPitch,args:[C.pitch]}),q(S.sprite,C.sprite)||R.push({command:Vn.setSprite,args:[C.sprite]}),q(S.glyphs,C.glyphs)||R.push({command:Vn.setGlyphs,args:[C.glyphs]}),q(S.imports,C.imports)||function(j=[],H=[],Z){H=H||[];const X=(j=j||[]).map(Dd),Y=H.map(Dd),ie=j.reduce(dc,{}),oe=H.reduce(dc,{}),ue=X.slice();let ge,_e,se,le;for(ge=0,_e=0;ge<X.length;ge++)se=X[ge],oe.hasOwnProperty(se)?_e++:(Z.push({command:Vn.removeImport,args:[se]}),ue.splice(ue.indexOf(se,_e),1));for(ge=0,_e=0;ge<Y.length;ge++)se=Y[Y.length-1-ge],ue[ue.length-1-ge]!==se&&(ie.hasOwnProperty(se)?(Z.push({command:Vn.removeImport,args:[se]}),ue.splice(ue.lastIndexOf(se,ue.length-_e),1)):_e++,le=ue[ue.length-ge],Z.push({command:Vn.addImport,args:[oe[se],le]}),ue.splice(ue.length-ge,0,se));for(const ce of H){const Se=ie[ce.id];Se&&!q(Se,ce)&&Z.push({command:Vn.updateImport,args:[ce.id,ce]})}}(S.imports,C.imports,R),q(S.transition,C.transition)||R.push({command:Vn.setTransition,args:[C.transition]}),q(S.light,C.light)||R.push({command:Vn.setLight,args:[C.light]}),q(S.fog,C.fog)||R.push({command:Vn.setFog,args:[C.fog]}),q(S.projection,C.projection)||R.push({command:Vn.setProjection,args:[C.projection]}),q(S.lights,C.lights)||R.push({command:Vn.setLights,args:[C.lights]}),q(S.camera,C.camera)||R.push({command:Vn.setCamera,args:[C.camera]}),!q(S["color-theme"],C["color-theme"]))return[{command:Vn.setStyle,args:[C]}];const L={},O=[];(function(j,H,Z,X){let Y;for(Y in H=H||{},j=j||{})j.hasOwnProperty(Y)&&(H.hasOwnProperty(Y)||$m(Y,Z,X));for(Y in H){if(!H.hasOwnProperty(Y))continue;const ie=H[Y];j.hasOwnProperty(Y)?q(j[Y],ie)||(j[Y].type==="geojson"&&ie.type==="geojson"&&Ca(j,H,Y)?Z.push({command:Vn.setGeoJSONSourceData,args:[Y,ie.data]}):Dg(Y,H,Z,X)):Ea(Y,H,Z)}})(S.sources,C.sources,O,L);const F=[];S.layers&&S.layers.forEach(j=>{j.source&&L[j.source]?R.push({command:Vn.removeLayer,args:[j.id]}):F.push(j)});let U=S.terrain;U&&L[U.source]&&(R.push({command:Vn.setTerrain,args:[void 0]}),U=void 0),R=R.concat(O),q(U,C.terrain)||R.push({command:Vn.setTerrain,args:[C.terrain]}),function(j,H,Z){H=H||[];const X=(j=j||[]).map(Dd),Y=H.map(Dd),ie=j.reduce(dc,{}),oe=H.reduce(dc,{}),ue=X.slice(),ge=Object.create(null);let _e,se,le,ce,Se,Oe,pe;for(_e=0,se=0;_e<X.length;_e++)le=X[_e],oe.hasOwnProperty(le)?se++:(Z.push({command:Vn.removeLayer,args:[le]}),ue.splice(ue.indexOf(le,se),1));for(_e=0,se=0;_e<Y.length;_e++)le=Y[Y.length-1-_e],ue[ue.length-1-_e]!==le&&(ie.hasOwnProperty(le)?(Z.push({command:Vn.removeLayer,args:[le]}),ue.splice(ue.lastIndexOf(le,ue.length-se),1)):se++,Oe=ue[ue.length-_e],Z.push({command:Vn.addLayer,args:[oe[le],Oe]}),ue.splice(ue.length-_e,0,le),ge[le]=!0);for(_e=0;_e<Y.length;_e++)if(le=Y[_e],ce=ie[le],Se=oe[le],!ge[le]&&!q(ce,Se))if(q(ce.source,Se.source)&&q(ce["source-layer"],Se["source-layer"])&&q(ce.type,Se.type)){for(pe in bh(ce.layout,Se.layout,Z,le,null,Vn.setLayoutProperty),bh(ce.paint,Se.paint,Z,le,null,Vn.setPaintProperty),q(ce.slot,Se.slot)||Z.push({command:Vn.setSlot,args:[le,Se.slot]}),q(ce.filter,Se.filter)||Z.push({command:Vn.setFilter,args:[le,Se.filter]}),q(ce.minzoom,Se.minzoom)&&q(ce.maxzoom,Se.maxzoom)||Z.push({command:Vn.setLayerZoomRange,args:[le,Se.minzoom,Se.maxzoom]}),ce)ce.hasOwnProperty(pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&pe!=="slot"&&(pe.indexOf("paint.")===0?bh(ce[pe],Se[pe],Z,le,pe.slice(6),Vn.setPaintProperty):q(ce[pe],Se[pe])||Z.push({command:Vn.setLayerProperty,args:[le,pe,Se[pe]]}));for(pe in Se)Se.hasOwnProperty(pe)&&!ce.hasOwnProperty(pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&pe!=="slot"&&(pe.indexOf("paint.")===0?bh(ce[pe],Se[pe],Z,le,pe.slice(6),Vn.setPaintProperty):q(ce[pe],Se[pe])||Z.push({command:Vn.setLayerProperty,args:[le,pe,Se[pe]]}))}else Z.push({command:Vn.removeLayer,args:[le]}),Oe=ue[ue.lastIndexOf(le)+1],Z.push({command:Vn.addLayer,args:[Se,Oe]})}(F,C.layers,R)}catch(L){console.warn("Unable to compute style diff:",L),R=[{command:Vn.setStyle,args:[C]}]}return R}(this.serialize(),i).filter(S=>!(S.command in zg));if(p.length===0)return!1;const x=p.filter(S=>!(S.command in _c));if(x.length>0)throw new Error(`Unimplemented: ${x.map(S=>S.command).join(", ")}.`);const v=[];return p.forEach(S=>{v.push(this[S.command].apply(this,S.args))}),u&&Promise.all(v).then(u),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,u){return this.getImage(i)?this.fire(new o.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,u),this._afterImageUpdated(i),this)}updateImage(i,u){this.imageManager.updateImage(i,this.scope,u)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new o.d(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,u,p={}){return this._checkLoaded(),this._validate(gn,`models.${i}`,u,null,p)||(this.modelManager.addModel(i,u,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new o.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,u,p={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(we,`sources.${i}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const x=Yu(i,u,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const v=S=>{const C=(S?"symbol:":"other:")+x.id,R=o.al(C,this.scope),L=this._sourceCaches[C]=new o.bv(R,x,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=L,L.onAdd(this.map)};v(!1),u.type!=="vector"&&u.type!=="geojson"||v(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const u=this.getOwnSource(i);if(!u)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new o.d(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new o.d(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const p=this.getOwnSourceCaches(i);for(const x of p){const v=o.cU(x.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(x.id),x.fire(new o.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,u){this._checkLoaded(),this.getOwnSource(i).setData(u),this._changes.setDirty()}getOwnSource(i){const u=this.getOwnSourceCache(i);return u&&u.getSource()}getOwnSources(){const i=[];for(const u in this._otherSourceCaches){const p=this.getOwnSourceCache(u);p&&i.push(p.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const u in i){const p=i[u]._tiles;for(const x in p){const v=p[x];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const x of i){if(this._validate(Ge,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(x),v.updateTransitions(u)}else this.ambientLight=new Uu(x,fn,this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(x),v.updateTransitions(u)}else this.directionalLight=new Uu(x,_d,this.scope,this.options)}}const p=new o.X(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,u=this.ambientLight;if(!i||!u)return;const p=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),x=i.properties.get("color").toRenderColor(null).toArray01(),v=i.properties.get("intensity"),S=i.properties.get("direction"),C=1-o.ac(S.x,S.y,S.z)[2]/90,R=p(x)*v*C,L=u.properties.get("color").toRenderColor(null).toArray01(),O=u.properties.get("intensity");return(R+p(L)*O)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(o.cV(i)){const u=o.cW(i),p=this.fragments.find(({id:v})=>v===u);if(!p)throw new Error(`Style import not found: ${i}`);const x=o.cU(i);return p.style.getFragmentStyle(x)}{const u=this.fragments.find(({id:p})=>p===i);if(!u)throw new Error(`Style import not found: ${i}`);return u.style}}getConfigProperty(i,u){const p=this.getFragmentStyle(i);if(!p)return null;const x=o.al(u,p.scope),v=p.options.get(x),S=v?v.value||v.default:null;return S?S.serialize():null}setConfigProperty(i,u,p){const x=this.getFragmentStyle(i);if(!x)return;const v=x.stylesheet.schema;if(!v||!v[u])return;const S=o.y(p);if(S.result!=="success")return void il(this,S.value);const C=S.value.expression,R=o.al(u,x.scope),L=x.options.get(R);if(!L)return;let O;const{minValue:F,maxValue:U,stepValue:j,type:H,values:Z}=v[u],X=o.y(v[u].default);X.result==="success"&&(O=X.value.expression),O?(this.options.set(R,{...L,value:C,default:O,minValue:F,maxValue:U,stepValue:j,type:H,values:Z}),this.updateConfigDependencies()):this.fire(new o.d(new Error(`No schema defined for the config option "${u}" in the "${i}" fragment.`)))}getConfig(i){const u=this.getFragmentStyle(i);if(!u)return null;const p=u.stylesheet.schema;if(!p)return null;const x={};for(const v in p){const S=o.al(v,u.scope),C=u.options.get(S),R=C?C.value||C.default:null;x[v]=R?R.serialize():null}return x}setConfig(i,u){const p=this.getFragmentStyle(i);p&&(p.updateConfig(u,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const u=this.getFragmentStyle(i);return u?u.stylesheet.schema:null}setSchema(i,u){const p=this.getFragmentStyle(i);p&&(p.stylesheet.schema=u,p.updateConfig(p._config,u),this.updateConfigDependencies())}updateConfig(i,u){if(this._config=i,i||u)if(u)for(const p in u){let x,v;const S=o.y(u[p].default);if(S.result==="success"&&(x=S.value.expression),i&&i[p]!==void 0){const U=o.y(i[p]);U.result==="success"&&(v=U.value.expression)}const{minValue:C,maxValue:R,stepValue:L,type:O,values:F}=u[p];if(x){const U=o.al(p,this.scope);this.options.set(U,{default:x,value:v,minValue:C,maxValue:R,stepValue:L,type:O,values:F})}else this.fire(new o.d(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new o.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const i of this._configDependentLayers){const u=this.getLayer(i);u&&(u.possiblyEvaluateVisibility(),this._updateLayer(u))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(i=>{if(i._styleColorTheme.colorTheme){const u=i._evaluateColorThemeData(i._styleColorTheme.colorTheme);(!i._styleColorTheme.lut||i._styleColorTheme.lut&&u!==i._styleColorTheme.lut.data)&&i.setColorTheme(i._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(i,u,p={}){this._checkLoaded();const x=i.id;if(this._layers[x])return void this.fire(new o.d(new Error(`Layer with id "${x}" already exists on this map`)));let v;if(i.type==="custom"){if(il(this,o.cX(i)))return;v=o.cY(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(x,i.source),i=o.cT(i),i=o.W(i,{source:x})),this._validate(gt,`layers.${x}`,i,{arrayIndex:-1},p))return;v=o.cY(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[v.id]=v.serialize()}v.isConfigDependent&&this._configDependentLayers.add(v.fqid);let S=this._order.length;if(u){const O=this._order.indexOf(u);if(O===-1)return void this.fire(new o.d(new Error(`Layer with id "${u}" does not exist on this map.`)));v.slot===this._layers[u].slot?S=O:o.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=v;const C=this.getOwnLayerSourceCache(v),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&v.canCastShadows()&&R&&(C.castsShadows=!0);const L=this._changes.getRemovedLayer(v);if(L&&v.source&&C&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const O=o.al(v.source,v.scope);L.type!==v.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),C.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(i,u){this._checkLoaded();const p=this._checkLayer(i);if(!p||i===u)return;const x=this._order.indexOf(i);this._order.splice(x,1);let v=this._order.length;if(u){const S=this._order.indexOf(u);if(S===-1)return void this.fire(new o.d(new Error(`Layer with id "${u}" does not exist on this map.`)));p.slot===this._layers[u].slot?v=S:o.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const u=this._checkLayer(i);if(!u)return;u.setEventedParent(null);const p=this._order.indexOf(i);this._order.splice(p,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const x=this.getOwnLayerSourceCache(u);if(x&&x.castsShadows){let v=!1;for(const S in this._layers)if(this._layers[S].source===u.source&&this._layers[S].canCastShadows()){v=!0;break}x.castsShadows=v}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const u in this._layers)if(this._layers[u].type===i)return!0;return!1}setLayerZoomRange(i,u,p){this._checkLoaded();const x=this._checkLayer(i);x&&(x.minzoom===u&&x.maxzoom===p||(u!=null&&(x.minzoom=u),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,u){this._checkLoaded();const p=this._checkLayer(i);p&&p.slot!==u&&(p.slot=u,this._updateLayer(p))}setFilter(i,u,p={}){this._checkLoaded();const x=this._checkLayer(i);if(x&&!q(x.filter,u))return u==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(ft,`layers.${x.id}.filter`,u,{layerType:x.type},p)||(x.filter=o.cT(u),this._updateLayer(x)))}getFilter(i){const u=this._checkLayer(i);if(u)return o.cT(u.filter)}setLayoutProperty(i,u,p,x={}){this._checkLoaded();const v=this._checkLayer(i);if(v&&!q(v.getLayoutProperty(u),p)){if(p!=null&&(!x||x.validate!==!1)&&il(v,Yt.call(ve,{key:`layers.${i}.layout.${u}`,layerType:v.type,objectKey:u,value:p,styleSpec:o.L,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(u,p),v.isConfigDependent&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(i,u){const p=this._checkLayer(i);if(p)return p.getLayoutProperty(u)}setPaintProperty(i,u,p,x={}){this._checkLoaded();const v=this._checkLayer(i);if(!v||q(v.getPaintProperty(u),p)||p!=null&&(!x||x.validate!==!1)&&il(v,Ft.call(ve,{key:`layers.${i}.paint.${u}`,layerType:v.type,objectKey:u,value:p,styleSpec:o.L})))return;const S=v.setPaintProperty(u,p);v.isConfigDependent&&this._configDependentLayers.add(v.fqid),S&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(i,u){const p=this._checkLayer(i);if(p)return p.getPaintProperty(u)}setFeatureState(i,u){this._checkLoaded();const p=i.source,x=i.sourceLayer,v=this._checkSource(p);if(!v)return;const S=v.type;if(S==="geojson"&&x)return void this.fire(new o.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!x)return void this.fire(new o.d(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new o.d(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(p);for(const R of C)R.setFeatureState(x,i.id,u)}removeFeatureState(i,u){this._checkLoaded();const p=i.source,x=this._checkSource(p);if(!x)return;const v=x.type,S=v==="vector"?i.sourceLayer:void 0;if(v==="vector"&&!S)return void this.fire(new o.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new o.d(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(p);for(const R of C)R.removeFeatureState(S,i.id,u)}getFeatureState(i){this._checkLoaded();const u=i.source,p=i.sourceLayer,x=this._checkSource(u);if(x){if(x.type!=="vector"||p)return i.id===void 0&&this.fire(new o.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(p,i.id);this.fire(new o.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=o.W({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return o.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),u=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return o.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(i){this._changes.updateLayer(i);const u=this.getLayerSourceCache(i),p=o.al(i.source,i.scope),x=this._changes.getUpdatedSourceCaches();i.source&&!x[p]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),u.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const u=C=>this._mergedLayers[C].type==="fill-extrusion"||this._mergedLayers[C].type==="model",p=this.order,x={},v=[];for(let C=p.length-1;C>=0;C--){const R=p[C];if(u(R)){x[R]=C;for(const L of i){const O=L[R];if(O)for(const F of O)v.push(F)}}}v.sort((C,R)=>R.intersectionZ-C.intersectionZ);const S=[];for(let C=p.length-1;C>=0;C--){const R=p[C];if(u(R))for(let L=v.length-1;L>=0;L--){const O=v[L].feature;if(O.layer&&x[O.layer.id]<C)break;S.push(O),v.pop()}else for(const L of i){const O=L[R];if(O)for(const F of O)S.push(F.feature)}}return S}queryRenderedFeatures(i,u,p){u&&u.filter&&this._validate(ft,"queryRenderedFeatures.filter",u.filter,null,u),u.scope=this.scope,u.availableImages=this._availableImages,u.serializedLayers=this._serializedLayers;const x={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new o.d(new Error("parameters.layers must be an Array."))),[];for(const L of u.layers){const O=this._mergedLayers[L];if(!O)return this.fire(new o.d(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];x[O.source]=!0}}const v=[],S=u.serializedLayers||{},C=u&&u.layers?u.layers.some(L=>{const O=this.getLayer(L);return O&&O.is3D()}):this.has3DLayers(),R=Yi.createFromScreenPoints(i,p);for(const L in this._mergedSourceCaches){const O=this._mergedSourceCaches[L].getSource();if(!O||O.scope!==u.scope)continue;const F=this._mergedSourceCaches[L].getSource().id;u.layers&&!x[F]||v.push(Rg(this._mergedSourceCaches[L],this._mergedLayers,S,R,u,p,C,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(L,O,F,U,j,H,Z){const X={},Y=H.queryRenderedSymbols(U),ie=[];for(const oe of Object.keys(Y).map(Number))ie.push(Z[oe]);ie.sort(hc);for(const oe of ie){const ue=oe.featureIndex.lookupSymbolFeatures(Y[oe.bucketInstanceId],O,oe.bucketIndex,oe.sourceLayerIndex,j.filter,j.layers,j.availableImages,L);for(const ge in ue){const _e=X[ge]=X[ge]||[],se=ue[ge];se.sort((le,ce)=>{const Se=oe.featureSortOrder;if(Se){const Oe=Se.indexOf(le.featureIndex);return Se.indexOf(ce.featureIndex)-Oe}return ce.featureIndex-le.featureIndex});for(const le of se)_e.push(le)}}for(const oe in X)X[oe].forEach(ue=>{const ge=ue.feature,_e=F(L[oe]);if(!_e)return;const se=_e.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=se});return X}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),R.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,u){u&&u.filter&&this._validate(ft,"querySourceFeatures.filter",u.filter,null,u);const p=this.getOwnSourceCaches(i);let x=[];for(const v of p)x=x.concat(wh(v,u));return x}addSourceType(i,u,p){return Fs.getSourceType(i)?p(new Error(`A source type called "${i}" already exists.`)):(Fs.setSourceType(i,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:u.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,u,p={}){this._checkLoaded();const x=this.light.getLight();let v=!1;for(const C in i)if(!q(i[C],x[C])){v=!0;break}if(!v)return;const S=this._getTransitionParameters();this.light.setLight(i,u,p),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,u=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&u!==0||delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=i;const x=i.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const C="terrain-dem-src";this.addSource(C,p.source),p=o.cT(p),p=o.W(p,{source:C})}const v=o.W({},p),S={};if(this.terrain&&x){v.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(S.style=C.serialize())}if(this._validate(Ie,"terrain",v,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&u!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,u),this.fire(new o.f("data",{dataType:"style"}))}else{const v=this.terrain,S=v.get();for(const C of Object.keys(o.L.terrain))!p.hasOwnProperty(C)&&o.L.terrain[C].default&&(p[C]=o.L.terrain[C].default);for(const C in i)if(!q(i[C],S[C])){v.set(i,this.options),this.stylesheet.terrain=i;const R=this._getTransitionParameters({duration:0});v.updateTransitions(R),this.fire(new o.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const u=this.fog=new Qc(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!q(u.get(),i)){u.set(i,this.options),this.stylesheet.fog=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}}else this._createFog(i);this._markersNeedUpdate=!0}setColorTheme(i){this._checkLoaded();const u=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()};if(this._styleColorTheme.colorTheme=i,!i)return this._styleColorTheme.lut=null,void u();const p=this._evaluateColorThemeData(i);this._loadColorTheme(p).then(()=>{u()}).catch(x=>{o.w(`Couldn't set color theme: ${x}`)})}_getTransitionParameters(i){return{now:o.e.now(),transition:o.W(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],u=[];for(const p in this._mergedLayers)this.isLayerDraped(this._mergedLayers[p])?i.push(p):u.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...u)}_createTerrain(i,u){const p=this.terrain=new rr(i,u,this.scope,this.options);u===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const u=this._layers[i];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const u=this._layers[i];u.type==="symbol"&&this._updateLayer(u)}}_validate(i,u,p,x,v={}){if(v&&v.validate===!1)return!1;const S=o.W({},this.serialize());return il(this,i.call(ve,o.W({key:u,style:S,value:p,styleSpec:o.L},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const u=this.getSourceCaches(i);for(const p of u)p.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const u=this.getSourceCaches(i);for(const p of u)p.resume(),p.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let u;this.directionalLight&&(u=fh(this.directionalLight));for(const p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(i,void 0,void 0,u)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const u=this._sourceCaches[i];u.resume(),u.reload()}}_updatePlacement(i,u,p,x,v,S,C=!1){let R=!1,L=!1;const O={},F={};for(const j of this._mergedOrder){const H=this._mergedLayers[j];if(H.type!=="symbol")continue;const Z=o.al(H.source,H.scope);let X=O[Z];if(!X){const ie=this.getLayerSourceCache(H);if(!ie)continue;const oe=ie.getRenderableIds(!0).map(ue=>ie.getTileByID(ue));F[Z]=oe.slice(),X=O[Z]=oe.sort((ue,ge)=>ge.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(ge.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer(H,X,u.center.lng,u.projection);R=R||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new o.f("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.e.now(),u.zoom))&&(this.pauseablePlacement=new us(u,this._mergedOrder,C,p,x,v,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.e.now()),L=!0),R&&this.pauseablePlacement.placement.setStale()),L||R){this._buildingIndex.onNewFrame(u.zoom);for(let j=0;j<this._mergedOrder.length;j++){const H=this._mergedLayers[this._mergedOrder[j]];if(H.type!=="symbol")continue;const Z=this.isLayerClipped(H)&&this._clipLayerIndices.some(X=>j<X);this.placement.updateLayerOpacities(H,O[o.al(H.source,H.scope)],j,Z?S:null)}}let U=!1;for(const j of this._mergedOrder){const H=this._mergedLayers[j];if(H.type!=="symbol")continue;const Z=O[o.al(H.source,H.scope)];for(const X of Z){const Y=X.getBucket(H);Y&&X.latestFeatureIndex&&H.fqid===Y.layerIds[0]&&(U=Y.updateOcclusionOpacities(i.context,i.symbolParams,i._dt)||U)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.e.now())||U,occlusionQueryBasedOpacityChanged:U}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,u){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:v})=>v===i.id)!==-1)return void this.fire(new o.d(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!u)return p.push(i),this._loadImports([i],!0);const x=p.findIndex(({id:v})=>v===u);return x===-1&&this.fire(new o.d(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(i).concat(p.slice(x)),this._loadImports([i],!0,u)}updateImport(i,u){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(i);return x===-1?this:typeof u=="string"?(this.setImportUrl(i,u),this):(u.url&&u.url!==p[x].url&&this.setImportUrl(i,u.url),q(u.config,p[x].config)||this.setImportConfig(i,u.config),q(u.data,p[x].data)||this.setImportData(i,u.data),this)}moveImport(i,u){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(i);if(x===-1)return this;const v=this.getImportIndex(u);if(v===-1)return this;const S=p[x],C=this.fragments[x];return p=p.filter(({id:R})=>R!==i),this.fragments=this.fragments.filter(({id:R})=>R!==i),this.stylesheet.imports=p.slice(0,v).concat(S).concat(p.slice(v)),this.fragments=this.fragments.slice(0,v).concat(C).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(i,u){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(i);if(x===-1)return this;p[x].url=u;const v=this.fragments[x];return v.style=this._createFragmentStyle(p[x]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(u),this}setImportData(i,u){this._checkLoaded();const p=this.getImportIndex(i),x=this.stylesheet.imports||[];return p===-1?this:u?(this.fragments[p].style.setState(u),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(i,x[p].url))}setImportConfig(i,u){this._checkLoaded();const p=this.getImportIndex(i),x=this.stylesheet.imports||[];if(p===-1)return this;u?x[p].config=u:delete x[p].config;const v=this.fragments[p],S=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=u,v.style.updateConfig(u,S),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(i);p!==-1&&(u.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(i){const u=(this.stylesheet.imports||[]).findIndex(p=>p.id===i);return u===-1&&this.fire(new o.d(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),u}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const u in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[u];p&&i.push(p.getSource())}return i}getSource(i,u){const p=this.getSourceCache(i,u);return p&&p.getSource()}getLayerSource(i){const u=this.getLayerSourceCache(i);return u&&u.getSource()}getSourceCache(i,u){const p=o.al(i,u);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(i){const u=o.al(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[i]&&u.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&u.push(this._mergedSymbolSourceCaches[i]),u}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const u in i){const p=i[u];p==="reload"?this.reloadSource(u):p==="clear"&&this.clearSource(u)}}updateLayers(i){const u=this._changes.getUpdatedPaintProperties();for(const p of u){const x=this.getLayer(p);x&&x.updateTransitions(i)}}getImages(i,u,p){this.imageManager.getImages(u.icons,u.scope,p),this._updateTilesForChangedImages();const x=v=>{v&&v.setDependencies(u.tileID.key,u.type,u.icons)};x(this._otherSourceCaches[u.source]),x(this._symbolSourceCaches[u.source])}getGlyphs(i,u,p){this.glyphManager.getGlyphs(u.stacks,u.scope,p)}getResource(i,u,p){return o.c$(u,p)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const u=[];return this._otherSourceCaches[i]&&u.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&u.push(this._symbolSourceCaches[i]),u}_isSourceCacheLoaded(i){const u=this.getOwnSourceCaches(i);return u.length===0?(this.fire(new o.d(new Error(`There is no source with ID '${i}'`))),!1):u.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,u){if(this._clipLayerIndices.length===0&&i.type!=="fill-extrusion")return!1;const p=i.type==="fill-extrusion"&&i.sourceLayer==="building";let x=0;if(i.is3D()){if(p||u&&u.type==="batched-model")return!0;i.type==="model"&&(x=o.cu.Model)}else i.type==="symbol"&&(x=o.cu.Symbol);for(const v of this._clipLayerIndices){const S=this._mergedLayers[this._mergedOrder[v]];if(!S)continue;const C=[];for(const R of S.layout.get("clip-layer-types"))C.push(R==="model"?o.cu.Model:R==="symbol"?o.cu.Symbol:o.cu.FillExtrusion);for(const R of C)if(x&R)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Od(f,i){let u=!1,p=null;const x=()=>{p=null,u&&(f(),p=setTimeout(x,i),u=!1)};return()=>(u=!0,p||x(),p)}Fs.getSourceType=function(f){return zi[f]},Fs.setSourceType=function(f,i){zi[f]=i},Fs.registerForPluginStateChange=o.cL;class qo{constructor(i){this._hashName=i&&encodeURIComponent(i),o.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Od(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const u=Kl(i);if(this._hashName){const p=this._hashName;let x=!1;const v=location.hash.slice(1).split("&").map(S=>{const C=S.split("=")[0];return C===p?(x=!0,`${C}=${u}`):S}).filter(S=>S);return x||v.push(`${p}=${u}`),`#${v.join("&")}`}return`#${u}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let u;return i.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(u=p)}),(u&&u[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(p=>isNaN(p))){const p=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(u[3]||0):i.getBearing();return i.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:p,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Kl(f,i){const u=f.getCenter(),p=Math.round(100*f.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,x),S=Math.round(u.lng*v)/v,C=Math.round(u.lat*v)/v,R=f.getBearing(),L=f.getPitch();let O=i?`/${S}/${C}/${p}`:`${p}/${C}/${S}`;return(R||L)&&(O+="/"+Math.round(10*R)/10),L&&(O+=`/${Math.round(L)}`),O}const Jl={linearity:.3,easing:o.d0(0,0,.3,1)},sl=o.W({deceleration:2500,maxSpeed:1400},Jl),Bd=o.W({deceleration:20,maxSpeed:1400},Jl),Fi=o.W({deceleration:1e3,maxSpeed:360},Jl),Ch=o.W({deceleration:1e3,maxSpeed:90},Jl);class Ql{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.e.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,u=o.e.now();for(;i.length>0&&u-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)u.zoom+=v.zoomDelta||0,u.bearing+=v.bearingDelta||0,u.pitch+=v.pitchDelta||0,v.panDelta&&u.pan._add(v.panDelta),v.around&&(u.around=v.around),v.pinchAround&&(u.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(u.pan.mag()){const v=Ah(u.pan.mag(),p,o.W({},sl,i||{}));x.offset=u.pan.mult(v.amount/u.pan.mag()),x.center=this._map.transform.center,gc(x,v)}if(u.zoom){const v=Ah(u.zoom,p,Bd);x.zoom=this._map.transform.zoom+v.amount,gc(x,v)}if(u.bearing){const v=Ah(u.bearing,p,Fi);x.bearing=this._map.transform.bearing+o.at(v.amount,-179,179),gc(x,v)}if(u.pitch){const v=Ah(u.pitch,p,Ch);x.pitch=this._map.transform.pitch+v.amount,gc(x,v)}if(x.zoom||x.bearing){const v=u.pinchAround===void 0?u.around:u.pinchAround;x.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function gc(f,i){(!f.duration||f.duration<i.duration)&&(f.duration=i.duration,f.easing=i.easing)}function Ah(f,i,u){const{maxSpeed:p,linearity:x,deceleration:v}=u,S=o.at(f*x/(i/1e3),-p,p),C=Math.abs(S)/(v*x);return{easing:u.easing,duration:1e3*C,amount:S*(C/2)}}class gi extends o.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,p,x={}){const v=Ct(u.getCanvasContainer(),p),S=u.unproject(v);super(i,o.W({point:v,lngLat:S,originalEvent:p},x)),this._defaultPrevented=!1,this.target=u}}class ol extends o.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,p){const x=i==="touchend"?p.changedTouches:p.touches,v=Ot(u.getCanvasContainer(),x),S=v.map(R=>u.unproject(R)),C=v.reduce((R,L,O,F)=>R.add(L.div(F.length)),new o.P(0,0));super(i,{points:v,point:C,lngLats:S,lngLat:u.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class al extends o.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class Fd{constructor(i,u){this._map=i,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new al(i.type,this._map,i))}mousedown(i,u){return this._mousedownPos=u,this._firePreventable(new gi(i.type,this._map,i))}mouseup(i){this._map.fire(new gi(i.type,this._map,i))}preclick(i){const u=o.W({},i);u.type="preclick",this._map.fire(new gi(u.type,this._map,u))}click(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(i),this._map.fire(new gi(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new gi(i.type,this._map,i))}mouseover(i){this._map.fire(new gi(i.type,this._map,i))}mouseout(i){this._map.fire(new gi(i.type,this._map,i))}touchstart(i){return this._firePreventable(new ol(i.type,this._map,i))}touchmove(i){this._map.fire(new ol(i.type,this._map,i))}touchend(i){this._map.fire(new ol(i.type,this._map,i))}touchcancel(i){this._map.fire(new ol(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mh{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new gi(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new gi(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nd{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(Ee(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(i,u){if(!this._active)return;const p=u,x=this._startPos,v=this._lastPos;if(!x||!v||v.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const S=Math.min(x.x,p.x),C=Math.max(x.x,p.x),R=Math.min(x.y,p.y),L=Math.max(x.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${R}px)`,this._box.style.width=C-S+"px",this._box.style.height=L-R+"px")})}mouseupWindow(i,u){if(!this._active)return;const p=this._startPos,x=u;if(p&&i.button===0){if(this.reset(),pt(),p.x!==x.x||p.y!==x.y)return this._map.fire(new o.f("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Me(),delete this._startPos,delete this._lastPos}_fireEvent(i,u){return this._map.fire(new o.f(i,{originalEvent:u}))}}function Aa(f,i){const u={};for(let p=0;p<f.length;p++)u[f[p].identifier]=i[p];return u}class Km{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(x){const v=new o.P(0,0);for(const S of x)v._add(S);return v.div(x.length)}(u),this.touches=Aa(p,u)))}touchmove(i,u,p){if(this.aborted||!this.centroid)return;const x=Aa(p,u);for(const v in this.touches){const S=x[v];(!S||S.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(i,u,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Ih{constructor(i){this.singleTap=new Km(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,u,p){this.singleTap.touchstart(i,u,p)}touchmove(i,u,p){this.singleTap.touchmove(i,u,p)}touchend(i,u,p){const x=this.singleTap.touchend(i,u,p);if(x){const v=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(x)<30;if(v&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class yc{constructor(){this._zoomIn=new Ih({numTouches:1,numTaps:2}),this._zoomOut=new Ih({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,u,p){this._zoomIn.touchstart(i,u,p),this._zoomOut.touchstart(i,u,p)}touchmove(i,u,p){this._zoomIn.touchmove(i,u,p),this._zoomOut.touchmove(i,u,p)}touchend(i,u,p){const x=this._zoomIn.touchend(i,u,p),v=this._zoomOut.touchend(i,u,p);return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xc={0:1,2:2};class Vd{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,u){return!1}_move(i,u){return{}}mousedown(i,u){if(this._lastPoint)return;const p=zt(i);this._correctButton(i,p)&&(this._lastPoint=u,this._eventButton=p)}mousemoveWindow(i,u){const p=this._lastPoint;if(p){if(i.preventDefault(),this._eventButton!=null&&function(x,v){const S=xc[v];return x.buttons===void 0||(x.buttons&S)!==S}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(p,u)}}mouseupWindow(i){this._lastPoint&&zt(i)===this._eventButton&&(this._moved&&pt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jm extends Vd{mousedown(i,u){super.mousedown(i,u),this._lastPoint&&(this._active=!0)}_correctButton(i,u){return u===0&&!i.ctrlKey}_move(i,u){return{around:u,panDelta:u.sub(i)}}}class Cp extends Vd{_correctButton(i,u){return u===0&&i.ctrlKey||u===2}_move(i,u){const p=.8*(u.x-i.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(i){i.preventDefault()}}class ll extends Vd{_correctButton(i,u){return u===0&&i.ctrlKey||u===2}_move(i,u){const p=-.5*(u.y-i.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(i){i.preventDefault()}}class Ud{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),o.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(i,u,p){return this._calculateTransform(i,u,p)}touchmove(i,u,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!o.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,u,p)}}touchend(i,u,p){this._calculateTransform(i,u,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,u,p){p.length>0&&(this._active=!0);const x=Aa(p,u),v=new o.P(0,0),S=new o.P(0,0);let C=0;for(const L in x){const O=x[L],F=this._touches[L];F&&(v._add(O),S._add(O.sub(F)),C++,x[L]=O)}if(this._touches=x,C<this._minTouches||!S.mag())return;const R=S.div(C);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ap{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,u,p){return{}}touchstart(i,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(i,u,p){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[v,S]=x,C=vc(p,u,v),R=vc(p,u,S);if(!C||!R)return;const L=this._aroundCenter?null:C.add(R).div(2);return this._move([C,R],L,i)}touchend(i,u,p){if(!this._firstTwoTouches)return;const[x,v]=this._firstTwoTouches,S=vc(p,u,x),C=vc(p,u,v);S&&C||(this._active&&pt(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function vc(f,i,u){for(let p=0;p<f.length;p++)if(f[p].identifier===u)return i[p]}function Mp(f,i){return Math.log(f/i)/Math.LN2}class jd extends Ap{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,u){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Mp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mp(this._distance,p),pinchAround:u}}}function Ph(f,i){return 180*f.angleWith(i)/Math.PI}class wc extends Ap{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,u){const p=this._vector;if(this._vector=i[0].sub(i[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ph(this._vector,p),pinchAround:u}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const u=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=Ph(i,p);return Math.abs(x)<u}}function Rh(f){return Math.abs(f.y)>Math.abs(f.x)}class Ip extends Ap{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Rh(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,u,p){const x=this._lastPoints;if(!x)return;const v=i[0].sub(x[0]),S=i[1].sub(x[1]);return this._map._cooperativeGestures&&!o.d1()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,S,p.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5})}gestureBeginsVertically(i,u,p){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,v=u.mag()>=2;if(!x&&!v)return;if(!x||!v)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const S=i.y>0==u.y>0;return Rh(i)&&Rh(u)&&S}}const Pp={panStep:100,bearingStep:15,pitchStep:10};class kg{constructor(){const i=Pp;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let u=0,p=0,x=0,v=0,S=0;switch(i.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),S=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:C=>{const R=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:bc,zoom:u?Math.round(R)+u*(i.shiftKey?2:1):R,bearing:C.getBearing()+p*this._bearingStep,pitch:C.getPitch()+x*this._pitchStep,offset:[-v*this._panStep,-S*this._panStep],center:C.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bc(f){return f*(2-f)}const Tc=4.000244140625,Gd=1/450;class bs{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Gd,o.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||o.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=o.e.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,u!==0&&u%Tc==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Ct(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Tc?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&O!==0&&(O=1/O);const F=u(),U=Math.pow(2,F),j=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(j*O))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:u(),x=this._startZoom,v=this._easing;let S,C=!1;if(this._type==="wheel"&&x&&v){const L=Math.min((o.e.now()-this._lastWheelEventTime)/200,1),O=v(L);S=o.a2(x,p,O),L<1?this._frameId||(this._frameId=!0):C=!0}else S=p,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=S-u();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let u=o.d2;if(this._prevEase){const p=this._prevEase,x=(o.e.now()-p.start)/p.duration,v=p.easing(x+.01)-p.easing(x),S=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-S*S);u=o.d0(S,C,.25,1)}return this._prevEase={start:o.e.now(),duration:i,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Lh{constructor(i,u){this._clickZoom=i,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,u){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(i.shiftKey?-1:1),around:p.unproject(u)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sc{constructor(){this._tap=new Ih({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,u,p){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=u[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(i,u,p))}touchmove(i,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=u[0],v=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,u,p)}touchend(i,u,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(i,u,p)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yn{constructor(i,u,p){this._el=i,this._mousePan=u,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rp{constructor(i,u,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $d{constructor(i,u,p,x){this._el=i,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ho=f=>f.zoom||f.drag||f.pitch||f.rotate;class qd extends o.f{}class Hd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,u){const p=o._.sub([],u,i);this.radius=o._.length(p[2]<0?o._.div([],p,this.constants):[p[0],p[1],0])}projectRay(i){o._.div(i,i,this.constants),o._.normalize(i,i),o._.mul(i,i,this.constants);const u=o._.scale([],i,this.radius);if(u[2]>0){const p=o._.scale([],[0,0,1],o._.dot(u,[0,0,1])),x=o._.scale([],o._.normalize([],[u[0],u[1],0]),this.radius),v=o._.add([],u,o._.scale([],o._.sub([],o._.add([],x,p),u),2));u[0]=v[0],u[1]=v[1]}return u}}function Dh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Ns{constructor(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ql(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Hd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),o.bp(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,v,S]of this._listeners){const C=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(v,C,S)}}destroy(){for(const[i,u,p]of this._listeners){const x=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(u,x,p)}}_addDefaultHandlers(i){const u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new Fd(u,i));const x=u.boxZoom=new Nd(u,i);this._add("boxZoom",x);const v=new yc,S=new Wd;u.doubleClickZoom=new Lh(S,v),this._add("tapZoom",v),this._add("clickZoom",S);const C=new Sc;this._add("tapDragZoom",C);const R=u.touchPitch=new Ip(u);this._add("touchPitch",R);const L=new Cp(i),O=new ll(i);u.dragRotate=new Rp(i,L,O),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const F=new Jm(i),U=new Ud(u,i);u.dragPan=new Yn(p,F,U),this._add("mousePan",F),this._add("touchPan",U,["touchZoom","touchRotate"]);const j=new wc,H=new jd;u.touchZoomRotate=new $d(p,H,j,C),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Mh(u));const Z=u.scrollZoom=new bs(u,this);this._add("scrollZoom",Z,["mousePan"]);const X=u.keyboard=new kg;this._add("keyboard",X);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[Y]&&u[Y].enable(i[Y])}_add(i,u,p){this._handlers.push({handlerName:i,handler:u,allowed:p}),this._handlersById[i]=u}stop(i){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ho(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,u,p){for(const x in i)if(x!==p&&(!u||u.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const u=[];for(const p of i)this._el.contains(p.target)&&u.push(p);return u}handleEvent(i,u){this._updatingCamera=!0;const p=i.type==="renderFrame",x=p?void 0:i,v={needsRenderFrame:!1},S={},C={},R=i.touches?this._getMapTouches(i.touches):void 0,L=R?Ot(this._el,R):p?void 0:Ct(this._el,i);for(const{handlerName:U,handler:j,allowed:H}of this._handlers){if(!j.isEnabled())continue;let Z;this._blockedByActive(C,H,U)?j.reset():j[u||i.type]&&(Z=j[u||i.type](i,L,R),this.mergeHandlerResult(v,S,Z,U,x),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||j.isActive())&&(C[U]=j)}const O={};for(const U in this._previousActiveHandlers)C[U]||(O[U]=x);this._previousActiveHandlers=C,(Object.keys(O).length||Dh(v))&&(this._changes.push([v,S,O]),this._triggerRenderFrame()),(Object.keys(C).length||Dh(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=v;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(i,u,p,x,v){if(!p)return;o.W(i,p);const S={handlerName:x,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(u.zoom=S),p.panDelta!==void 0&&(u.drag=S),p.pitchDelta!==void 0&&(u.pitch=S),p.bearingDelta!==void 0&&(u.rotate=S)}_applyChanges(){const i={},u={},p={};for(const[x,v,S]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new o.P(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.aroundCoord!==void 0&&(i.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),o.W(u,v),o.W(p,S);this._updateMapTransform(i,u,p),this._changes=[]}_updateMapTransform(i,u,p){const x=this._map,v=x.transform,S=ie=>[ie.x,ie.y,ie.z];if((ie=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!Dh(i)){const ie=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),ie!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&x._stop(!0),!Dh(i))return void this._fireEvents(u,p,!0);let{panDelta:C,zoomDelta:R,bearingDelta:L,pitchDelta:O,around:F,aroundCoord:U,pinchAround:j}=i;v._isCameraConstrained&&(R>0&&(R=0),v._isCameraConstrained=!1),j!==void 0&&(F=j),(R||(ie=>u[ie]&&!this._eventsInProgress[ie])("drag"))&&F&&(this._dragOrigin=S(v.pointCoordinate3D(F)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",x._stop(!0),F=F||x.transform.centerPoint,L&&(v.bearing+=L),O&&(v.pitch+=O),v._updateCameraState();const H=[0,0,0];if(C)if(v.projection.name==="mercator"){const ie=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(F).dir),oe=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(F.sub(C)).dir);H[0]=oe[0]-ie[0],H[1]=oe[1]-ie[1]}else{const ie=v.pointCoordinate(F);if(v.projection.name==="globe"){C=C.rotate(-v.angle);const oe=v._pixelsPerMercatorPixel/v.worldSize;H[0]=-C.x*o.d3(o.ay(ie.y))*oe,H[1]=-C.y*o.d3(v.center.lat)*oe}else{const oe=v.pointCoordinate(F.sub(C));ie&&oe&&(H[0]=oe.x-ie.x,H[1]=oe.y-ie.y)}}const Z=v.zoom,X=[0,0,0];if(R){const ie=S(U||v.pointCoordinate3D(F)),oe={dir:o._.normalize([],o._.sub([],ie,v._camera.position))};if(oe.dir[2]<0){const ue=v.zoomDeltaToMovement(ie,R);o._.scale(X,oe.dir,ue)}}const Y=o._.add(H,H,X);v._translateCameraConstrained(Y),R&&Math.abs(v.zoom-Z)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,p,!0)}_fireEvents(i,u,p){const x=Ho(this._eventsInProgress),v=Ho(i),S={};for(const O in i){const{originalEvent:F}=i[O];this._eventsInProgress[O]||(S[`${O}start`]=F),this._eventsInProgress[O]=i[O]}!x&&v&&this._fireEvent("movestart",v.originalEvent);for(const O in S)this._fireEvent(O,S[O]);v&&this._fireEvent("move",v.originalEvent);for(const O in i){const{originalEvent:F}=i[O];this._fireEvent(O,F)}const C={};let R;for(const O in this._eventsInProgress){const{handlerName:F,originalEvent:U}=this._eventsInProgress[O];this._handlersById[F].isActive()||(delete this._eventsInProgress[O],R=u[F]||U,C[`${O}end`]=R)}for(const O in C)this._fireEvent(O,C[O]);const L=Ho(this._eventsInProgress);if(p&&(x||v)&&!L){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;O?(F(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:R})):(this._map.fire(new o.f("moveend",{originalEvent:R})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,u){this._map.fire(new o.f(i,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new qd("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const eu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Zd extends o.E{constructor(i,u){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,o.bp(["_renderFrameCallback"],this)}getCenter(){return new o.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(i,u){return this.jumpTo({center:i},u)}panBy(i,u,p){return i=o.P.convert(i).mult(-1),this.panTo(this.transform.center,o.W({offset:i},u),p)}panTo(i,u,p){return this.easeTo(o.W({center:i},u),p)}getZoom(){return this.transform.zoom}setZoom(i,u){return this.jumpTo({zoom:i},u),this}zoomTo(i,u,p){return this.easeTo(o.W({zoom:i},u),p)}zoomIn(i,u){return this.zoomTo(this.getZoom()+1,i,u),this}zoomOut(i,u){return this.zoomTo(this.getZoom()-1,i,u),this}getBearing(){return this.transform.bearing}setBearing(i,u){return this.jumpTo({bearing:i},u),this}getPadding(){return this.transform.padding}setPadding(i,u){return this.jumpTo({padding:i},u),this}rotateTo(i,u,p){return this.easeTo(o.W({bearing:i},u),p)}resetNorth(i,u){return this.rotateTo(0,o.W({duration:1e3},i),u),this}resetNorthPitch(i,u){return this.easeTo(o.W({bearing:0,pitch:0,duration:1e3},i),u),this}snapToNorth(i,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,u):this}getPitch(){return this.transform.pitch}setPitch(i,u){return this.jumpTo({pitch:i},u),this}cameraForBounds(i,u){i=o.ai.convert(i);const p=u&&u.bearing||0,x=u&&u.pitch||0,v=i.getNorthWest(),S=i.getSouthEast();return this._cameraForBounds(this.transform,v,S,p,x,u)}_extendPadding(i){const u={top:0,right:0,bottom:0,left:0};return i==null?o.W({},u,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:o.W({},u,i)}_extendCameraOptions(i){return(i=o.W({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,u){const p=u.max[0]-u.min[0],x=u.max[1]-u.min[1];return p/x>i.aspect?p/(2*Math.tan(.5*i.fovX)*i.aspect):x/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,u,p,x,v,S){const C=i.clone(),R=this._extendCameraOptions(S);C.bearing=x,C.pitch=v;const L=o.aI.convert(u),O=o.aI.convert(p),F=.5*(L.lat+O.lat),U=.5*(L.lng+O.lng),j=o.d4(F,U),H=o._.normalize([],j),Z=o._.normalize([],o._.cross([],H,[0,1,0])),X=o._.cross([],Z,H),Y=[Z[0],Z[1],Z[2],0,X[0],X[1],X[2],0,H[0],H[1],H[2],0,0,0,0,1],ie=[j,o.d4(L.lat,L.lng),o.d4(O.lat,L.lng),o.d4(O.lat,O.lng),o.d4(L.lat,O.lng),o.d4(F,L.lng),o.d4(F,O.lng),o.d4(L.lat,U),o.d4(O.lat,U)];let oe=o.b6.fromPoints(ie.map(Ke=>[o._.dot(Z,Ke),o._.dot(X,Ke),o._.dot(H,Ke)]));const ue=o._.transformMat4([],oe.center,Y);o._.squaredLength(ue)===0&&o._.set(ue,0,0,1),o._.normalize(ue,ue),o._.scale(ue,ue,o.cD),C.center=o.d5(ue);const ge=C.getWorldToCameraMatrix(),_e=o.ad.invert(new Float64Array(16),ge);oe=o.b6.applyTransform(oe,o.ad.multiply([],ge,Y));const se=this._extendAABB(oe,C,R,x);if(!se)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=se,o._.transformMat4(ue,ue,ge);const le=.5*(oe.max[2]-oe.min[2]),ce=this._minimumAABBFrustumDistance(C,oe),Se=o._.scale([],[0,0,1],le),Oe=o._.add(Se,ue,Se),pe=ce+(C.pitch===0?0:o._.distance(ue,Oe)),Be=C.globeCenterInViewSpace,Fe=o._.sub([],ue,[Be[0],Be[1],Be[2]]);o._.normalize(Fe,Fe),o._.scale(Fe,Fe,pe);const tt=o._.add([],ue,Fe);o._.transformMat4(tt,tt,_e);const rt=o.d7/o.cD,Qe=o._.length(tt),Pe=o.ax(Math.max(Qe*rt-o.d7,Number.EPSILON),0),je=Math.min(C.zoomFromMercatorZAdjusted(Pe),R.maxZoom);return je>.5*(o.b1+o.aU)?(C.setProjection({name:"mercator"}),C.zoom=je,this._cameraForBounds(C,u,p,x,v,S)):{center:C.center,zoom:je,bearing:x,pitch:v}}_extendAABB(i,u,p,x){const v=.5*((p.padding.left||0)+(p.padding.right||0)),S=.5*((p.padding.top||0)+(p.padding.bottom||0)),C=S,R=v,L=v,O=S,F=u.width-(R+L),U=u.height-(C+O),j=o._.sub([],i.max,i.min),H=Math.min(F/j[0],U/j[1]),Z=Math.min(u.scaleZoom(u.scale*H),p.maxZoom);if(isNaN(Z))return null;const X=u.scale/u.zoomScale(Z),Y=new o.b6([i.min[0]-R*X,i.min[1]-O*X,i.min[2]],[i.max[0]+L*X,i.max[1]+C*X,i.max[2]]),ie=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new o.P(p.offset.x,p.offset.y):o.P.convert(p.offset)).rotate(-o.ab(x));return Y.center[0]-=ie.x*X,Y.center[1]+=ie.y*X,Y}queryTerrainElevation(i,u){const p=this.transform.elevation;return p?(u=o.W({},{exaggerated:!0},u),p.getAtPoint(o.Y.fromLngLat(i),null,u.exaggerated)):null}_cameraForBounds(i,u,p,x,v,S){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,u,p,x,v,S);const C=i.clone(),R=this._extendCameraOptions(S);C.bearing=x,C.pitch=v;const L=o.aI.convert(u),O=o.aI.convert(p),F=new o.aI(L.lng,O.lat),U=new o.aI(O.lng,L.lat),j=C.project(L),H=C.project(O),Z=this.queryTerrainElevation(L),X=this.queryTerrainElevation(O),Y=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(U),oe=[[j.x,j.y,Math.min(Z||0,X||0,Y||0,ie||0)],[H.x,H.y,Math.max(Z||0,X||0,Y||0,ie||0)]];let ue=o.b6.fromPoints(oe);const ge=C.getWorldToCameraMatrix(),_e=o.ad.invert(new Float64Array(16),ge);ue=o.b6.applyTransform(ue,ge);const se=this._extendAABB(ue,C,R,x);if(!se)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=se;const le=.5*o._.sub([],ue.max,ue.min)[2],ce=this._minimumAABBFrustumDistance(C,ue),Se=[0,0,1,0];o.aA.transformMat4(Se,Se,ge),o.aA.normalize(Se,Se);const Oe=o._.scale([],Se,ce+le),pe=o._.add([],ue.center,Oe);o._.transformMat4(ue.center,ue.center,_e),o._.transformMat4(pe,pe,_e);const Be=[ue.center[0],ue.center[1],pe[2]*C.pixelsPerMeter];o._.scale(Be,Be,1/C.worldSize);const Fe=o.d6(Be[0]),tt=o.ay(Be[1]),rt=Math.min(C._zoomFromMercatorZ(Be[2]),R.maxZoom),Qe=new o.aI(Fe,tt);return C.mercatorFromTransition&&rt<.5*(o.b1+o.aU)?(C.setProjection({name:"globe"}),C.zoom=rt,this._cameraForBounds(C,u,p,x,v,S)):{center:Qe,zoom:rt,bearing:x,pitch:v}}fitBounds(i,u,p){const x=this.cameraForBounds(i,u);return this._fitInternal(x,u,p)}fitScreenCoordinates(i,u,p,x,v){const S=o.P.convert(i),C=o.P.convert(u),R=new o.P(Math.min(S.x,C.x),Math.min(S.y,C.y)),L=new o.P(Math.max(S.x,C.x),Math.max(S.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,C))return this;const O=this.transform.pointLocation3D(R),F=this.transform.pointLocation3D(L),U=this.transform.pointLocation3D(new o.P(R.x,L.y)),j=this.transform.pointLocation3D(new o.P(L.x,R.y)),H=[Math.min(O.lng,F.lng,U.lng,j.lng),Math.min(O.lat,F.lat,U.lat,j.lat)],Z=[Math.max(O.lng,F.lng,U.lng,j.lng),Math.max(O.lat,F.lat,U.lat,j.lat)],X=x&&x.pitch?x.pitch:this.getPitch(),Y=this._cameraForBounds(this.transform,H,Z,p,X,x);return this._fitInternal(Y,x,v)}_fitInternal(i,u,p){return i?(u=o.W(i,u)).linear?this.easeTo(u,p):this.flyTo(u,p):this}jumpTo(i,u){this.stop();const p=i.preloadOnly?this.transform.clone():this.transform;let x=!1,v=!1,S=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(x=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=o.aI.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(v=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(S=!0,p.pitch=+i.pitch),i.padding==null||p.isPaddingEqual(i.padding)||(p.padding=i.padding),i.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.f("movestart",u)).fire(new o.f("move",u)),x&&this.fire(new o.f("zoomstart",u)).fire(new o.f("zoom",u)).fire(new o.f("zoomend",u)),v&&this.fire(new o.f("rotatestart",u)).fire(new o.f("rotate",u)).fire(new o.f("rotateend",u)),S&&this.fire(new o.f("pitchstart",u)).fire(new o.f("pitch",u)).fire(new o.f("pitchend",u)),this.fire(new o.f("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(eu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,u){const p=this.transform;if(!p.projection.supportsFreeCamera)return o.w(eu),this;this.stop();const x=p.zoom,v=p.pitch,S=p.bearing;p.setFreeCameraOptions(i);const C=x!==p.zoom,R=v!==p.pitch,L=S!==p.bearing;return this.fire(new o.f("movestart",u)).fire(new o.f("move",u)),C&&this.fire(new o.f("zoomstart",u)).fire(new o.f("zoom",u)).fire(new o.f("zoomend",u)),L&&this.fire(new o.f("rotatestart",u)).fire(new o.f("rotate",u)).fire(new o.f("rotateend",u)),R&&this.fire(new o.f("pitchstart",u)).fire(new o.f("pitch",u)).fire(new o.f("pitchend",u)),this.fire(new o.f("moveend",u)),this}easeTo(i,u){this._stop(!1,i.easeId),((i=o.W({offset:[0,0],duration:500,easing:o.d2},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const p=this.transform,x=this.getZoom(),v=this.getBearing(),S=this.getPitch(),C=this.getPadding(),R="zoom"in i?+i.zoom:x,L="bearing"in i?this._normalizeBearing(i.bearing,v):v,O="pitch"in i?+i.pitch:S,F=this._extendPadding(i.padding),U=o.P.convert(i.offset);let j,H,Z;if(p.projection.name==="globe"){const ce=o.Y.fromLngLat(p.center),Se=U.rotate(-p.angle);ce.x+=Se.x/p.worldSize,ce.y+=Se.y/p.worldSize;const Oe=ce.toLngLat(),pe=o.aI.convert(i.center||Oe);this._normalizeCenter(pe),j=p.centerPoint.add(Se),H=new o.P(ce.x,ce.y).mult(p.worldSize),Z=new o.P(o.aj(pe.lng),o.ak(pe.lat)).mult(p.worldSize).sub(H)}else{j=p.centerPoint.add(U);const ce=p.pointLocation(j),Se=o.aI.convert(i.center||ce);this._normalizeCenter(Se),H=p.project(ce),Z=p.project(Se).sub(H)}const X=p.zoomScale(R-x);let Y,ie;i.around&&(Y=o.aI.convert(i.around),ie=p.locationPoint(Y));const oe=this._zooming||R!==x,ue=this._rotating||v!==L,ge=this._pitching||O!==S,_e=!p.isPaddingEqual(F),se=ce=>Se=>{if(oe&&(ce.zoom=o.a2(x,R,Se)),ue&&(ce.bearing=o.a2(v,L,Se)),ge&&(ce.pitch=o.a2(S,O,Se)),_e&&(ce.interpolatePadding(C,F,Se),j=ce.centerPoint.add(U)),Y)ce.setLocationAtPoint(Y,ie);else{const Oe=ce.zoomScale(ce.zoom-x),pe=R>x?Math.min(2,X):Math.max(.5,X),Be=Math.pow(pe,1-Se),Fe=ce.unproject(H.add(Z.mult(Se*Be)).mult(Oe));ce.setLocationAtPoint(ce.renderWorldCopies?Fe.wrap():Fe,j)}return i.preloadOnly||this._fireMoveEvents(u),ce};if(i.preloadOnly){const ce=this._emulate(se,i.duration,p);return this._preloadTiles(ce),this}const le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ue,this._pitching=ge,this._padding=_e,this._easeId=i.easeId,this._prepareEase(u,i.noMoveStart,le),this._ease(se(p),ce=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(u,ce)},i),this}_prepareEase(i,u,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||p.moving||this.fire(new o.f("movestart",i)),this._zooming&&!p.zooming&&this.fire(new o.f("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new o.f("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new o.f("pitchstart",i))}_fireMoveEvents(i){this.fire(new o.f("move",i)),this._zooming&&this.fire(new o.f("zoom",i)),this._rotating&&this.fire(new o.f("rotate",i)),this._pitching&&this.fire(new o.f("pitch",i))}_afterEase(i,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.f("zoomend",i)),x&&this.fire(new o.f("rotateend",i)),v&&this.fire(new o.f("pitchend",i)),this.fire(new o.f("moveend",i))}flyTo(i,u){if(this._prefersReducedMotion(i)){const je=o.ah(i,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(je,u)}this.stop(),i=o.W({offset:[0,0],speed:1.2,curve:1.42,easing:o.d2},i);const p=this.transform,x=this.getZoom(),v=this.getBearing(),S=this.getPitch(),C=this.getPadding(),R="zoom"in i?o.at(+i.zoom,p.minZoom,p.maxZoom):x,L="bearing"in i?this._normalizeBearing(i.bearing,v):v,O="pitch"in i?+i.pitch:S,F=this._extendPadding(i.padding),U=p.zoomScale(R-x),j=o.P.convert(i.offset);let H=p.centerPoint.add(j);const Z=p.pointLocation(H),X=o.aI.convert(i.center||Z);this._normalizeCenter(X);const Y=p.project(Z),ie=p.project(X).sub(Y);let oe=i.curve;const ue=Math.max(p.width,p.height),ge=ue/U,_e=ie.mag();if("minZoom"in i){const je=o.at(Math.min(i.minZoom,x,R),p.minZoom,p.maxZoom),Ke=ue/p.zoomScale(je-x);oe=Math.sqrt(Ke/_e*2)}const se=oe*oe;function le(je){const Ke=(ge*ge-ue*ue+(je?-1:1)*se*se*_e*_e)/(2*(je?ge:ue)*se*_e);return Math.log(Math.sqrt(Ke*Ke+1)-Ke)}function ce(je){return(Math.exp(je)-Math.exp(-je))/2}function Se(je){return(Math.exp(je)+Math.exp(-je))/2}const Oe=le(0);let pe=function(je){return Se(Oe)/Se(Oe+oe*je)},Be=function(je){return ue*((Se(Oe)*(ce(Ke=Oe+oe*je)/Se(Ke))-ce(Oe))/se)/_e;var Ke},Fe=(le(1)-Oe)/oe;if(Math.abs(_e)<1e-6||!isFinite(Fe)){if(Math.abs(ue-ge)<1e-6)return this.easeTo(i,u);const je=ge<ue?-1:1;Fe=Math.abs(Math.log(ge/ue))/oe,Be=function(){return 0},pe=function(Ke){return Math.exp(je*oe*Ke)}}i.duration="duration"in i?+i.duration:1e3*Fe/("screenSpeed"in i?+i.screenSpeed/oe:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const tt=v!==L,rt=O!==S,Qe=!p.isPaddingEqual(F),Pe=je=>Ke=>{const bt=Ke*Fe,St=1/pe(bt);je.zoom=Ke===1?R:x+je.scaleZoom(St),tt&&(je.bearing=o.a2(v,L,Ke)),rt&&(je.pitch=o.a2(S,O,Ke)),Qe&&(je.interpolatePadding(C,F,Ke),H=je.centerPoint.add(j));const Pt=Ke===1?X:je.unproject(Y.add(ie.mult(Be(bt))).mult(St));return je.setLocationAtPoint(je.renderWorldCopies?Pt.wrap():Pt,H),je._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(u),je};if(i.preloadOnly){const je=this._emulate(Pe,i.duration,p);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=tt,this._pitching=rt,this._padding=Qe,this._prepareEase(u,!1),this._ease(Pe(p),()=>this._afterEase(u),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,u)}if(!i){const p=this.handlers;p&&p.stop(!1)}return this}_ease(i,u,p){p.animate===!1||p.duration===0?(i(1),u()):(this._easeStart=o.e.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((o.e.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,u){i=o.au(i,-180,180);const p=Math.abs(i-u);return Math.abs(i-360-u)<p&&(i-=360),Math.abs(i+360-u)<p&&(i+=360),i}_normalizeCenter(i){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const p=i.lng-u.center.lng;i.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&o.e.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,u,p){const x=Math.ceil(15*u/1e3),v=[],S=i(p.clone());for(let C=0;C<=x;C++){const R=S(C/x);v.push(R.clone())}return v}_preloadTiles(i,u){}}class Xd{constructor(i={}){this.options=i,o.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const u=this.options&&this.options.compact;return this._map=i,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xe("button","mapboxgl-ctrl-attrib-button",this._container),xe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=xe("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,u){const p=this._map._getUIString(`AttributionControl.${u}`);i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.d8.ACCESS_TOKEN}];if(i){const p=u.reduce((x,v,S)=>(v.value&&(x+=`${v.key}=${v.value}${S<u.length-1?"&":""}`),x),"?");i.href=`${o.d8.FEEDBACK_URL}/${p}#${Kl(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const u=this._map.style._mergedSourceCaches;for(const x in u){const v=u[x];if(v.used){const S=v.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i.sort((x,v)=>x.length-v.length),i=i.filter((x,v)=>{for(let S=v+1;S<i.length;S++)if(i[S].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Lp{constructor(){o.bp(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=xe("div","mapboxgl-ctrl");const u=xe("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const u in i){const p=i[u].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Dp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u}remove(i){const u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(const x of p)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const p of u)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ts(f,i,u){if(f=new o.aI(f.lng,f.lat),i){const p=new o.aI(f.lng-360,f.lat),x=new o.aI(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),S=u.locationPoint(f).distSqr(i),C=i.x<0||i.y<0||i.x>u.width||i.y>u.height;u.locationPoint(p).distSqr(i)<S&&(C||Math.abs(p.lng-u.center.lng)<v)?f=p:u.locationPoint(x).distSqr(i)<S&&(C||Math.abs(x.lng-u.center.lng)<v)&&(f=x)}for(;Math.abs(f.lng-u.center.lng)>180;){const p=u.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=u.width&&p.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}const Zo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class tu extends o.E{constructor(i,u){if(super(),(i instanceof HTMLElement||u)&&(i=o.W({element:i},u)),o.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=o.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=xe("div");const v=41,S=27,C=Re("svg",{display:"block",height:v*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${v}`},this._element),R=Re("radialGradient",{id:"shadowGradient"},Re("defs",{},C));Re("stop",{offset:"10%","stop-opacity":.4},R),Re("stop",{offset:"100%","stop-opacity":.05},R),Re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=o.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const p=this._element.classList;for(const v in Zo)p.remove(`mapboxgl-marker-anchor-${v}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const x=i&&i.className?i.className.trim().split(/\s+/):[];p.add(...x),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=o.aI.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const u=i.code,p=i.charCode||i.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(i){const u=i.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,u=this._pos;if(!i||!u)return!1;const p=i.unproject(u),x=i.getFreeCameraOptions();if(!x.position)return!1;const v=x.position.toLngLat();return v.distanceTo(p)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const u=this._pos;if(!u||u.x<0||u.x>i.transform.width||u.y<0||u.y>i.transform.height)return void this._clearFadeTimer();const p=i.unproject(u);let x;i._showingGlobe()&&o.d9(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(p),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${Zo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const i=this._pos,u=this._map,p=this.getPitchAlignment();if(!u||!i||p!=="map")return"";if(!u._showingGlobe()){const R=u.getPitch();return R?`rotateX(${R}deg)`:""}const x=o.b0(o.da(u.transform,this._lngLat)),v=i.sub(o.db(u.transform)),S=Math.abs(v.x)+Math.abs(v.y);if(S===0)return"";const C=x/S;return`rotateX(${-v.y*C}deg) rotateY(${v.x*C}deg)`}_calculateZTransform(){const i=this._pos,u=this._map;if(!u||!i)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(u._showingGlobe()){const v=u.project(new o.aI(this._lngLat.lng,this._lngLat.lat+.001)),S=u.project(new o.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=o.b0(Math.atan2(S.y,S.x))-90}else p=-u.getBearing();else if(x==="horizon"){const v=o.$(4,6,u.getZoom()),S=o.db(u.transform);S.y+=v*u.transform.height;const C=i.sub(S),R=o.b0(Math.atan2(C.y,C.x));p=(R>90?R-270:R+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Ts(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=o.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const u=this._map;if(!u)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const v=this._clickTolerance||u._clickTolerance;if(i.point.dist(p)<v)return;this._isDragging=!0}this._pos=i.point.sub(x),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.f("dragstart"))),this.fire(new o.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.f("dragend")),this._state="inactive"}_addDragHandler(i){const u=this._map,p=this._pos;u&&p&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(p),this._pointerdownPos=i.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const u=this._map;return u&&(i?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Yd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ul(f=new o.P(0,0),i="bottom"){if(typeof f=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(i){case"top":return new o.P(0,f);case"top-left":return new o.P(u,u);case"top-right":return new o.P(-u,u);case"bottom":return new o.P(0,-f);case"bottom-left":return new o.P(u,-u);case"bottom-right":return new o.P(-u,-u);case"left":return new o.P(f,0);case"right":return new o.P(-f,0)}return new o.P(0,0)}return f instanceof o.P||Array.isArray(f)?o.P.convert(f):o.P.convert(f[i]||[0,0])}class Kd{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const u=o.b9((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,u,p){this._start=this.getValue(u),this._end=i,this._startTime=u,this._endTime=u+p}}const zp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Jd{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const kh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Ss={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qm{constructor(i,u,p=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Cp({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,p&&(this.mousePitch=new ll({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),o.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),Ee()}move(i,u){const p=this.map,x=this.mouseRotate.mousemoveWindow(i,u),v=x&&x.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){const S=this.mousePitch.mousemoveWindow(i,u),C=S&&S.pitchDelta;C&&p.setPitch(p.getPitch()+C)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Me(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(o.W({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Ct(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Ct(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ot(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Ot(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Es={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},kp={maxWidth:100,unit:"metric"},Oh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:o.dt,supported:J,setRTLTextPlugin:o.dv,getRTLTextPluginStatus:o.dw,Map:class extends Zd{constructor(f){o.dc.mark(o.dd.create);const i=f;if((f=o.W({},kh,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&o.de(window)&&(f.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new zs(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new Dp,this._domRenderTaskQueue=new Dp,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.df(),this._locale=o.W({},zp,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Kd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new o.dg(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?{...f.contextCreateOptions}:{},typeof f.container=="string"){const u=document.getElementById(f.container);if(!u)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=u}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),o.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Jd),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ns(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||o.d8.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new qo(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const u=f.bounds;u&&(this.resize(),this.fitBounds(u,o.W({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Xd({customAttribution:f.customAttribution})),this._logoControl=new Lp,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new o.f(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new o.f(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(f,i){if(i===void 0&&(i=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new o.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new o.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(f);return i>-1&&this._controls.splice(i,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new o.f("movestart",f)).fire(new o.f("move",f)),this.fire(new o.f("resize",f)),i&&this.fire(new o.f("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(o.ai.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new o.f("zoomstart")).fire(new o.f("zoom")).fire(new o.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new o.f("zoomstart")).fire(new o.f("zoom")).fire(new o.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new o.f("pitchstart")).fire(new o.f("pitch")).fire(new o.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new o.f("pitchstart")).fire(new o.f("pitch")).fire(new o.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(i=>i==="auto"?navigator.language:i):f}setLanguage(f){const i=this._parseLanguage(f);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,i=f.projection.name;let u;i==="globe"&&f.zoom>=o.aU?(f.setMercatorFromTransition(),u=!0):i==="mercator"&&f.zoom<o.aU&&(f.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,i){return this._updateProjection(f||i||{name:"mercator"})}_updateProjection(f){let i;return i=f.name==="globe"&&this.transform.zoom>=o.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(o.aI.convert(f))}unproject(f){return this.transform.pointLocation3D(o.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,i,u){if(f==="mouseenter"||f==="mouseover"){let p=!1;const x=S=>{const C=i.filter(L=>this.getLayer(L)),R=C.length?this.queryRenderedFeatures(S.point,{layers:C}):[];R.length?p||(p=!0,u.call(this,new gi(f,this,S.originalEvent,{features:R}))):p=!1},v=()=>{p=!1};return{layers:new Set(i),listener:u,delegates:{mousemove:x,mouseout:v}}}if(f==="mouseleave"||f==="mouseout"){let p=!1;const x=S=>{const C=i.filter(R=>this.getLayer(R));(C.length?this.queryRenderedFeatures(S.point,{layers:C}):[]).length?p=!0:p&&(p=!1,u.call(this,new gi(f,this,S.originalEvent)))},v=S=>{p&&(p=!1,u.call(this,new gi(f,this,S.originalEvent)))};return{layers:new Set(i),listener:u,delegates:{mousemove:x,mouseout:v}}}{const p=x=>{const v=i.filter(C=>this.getLayer(C)),S=v.length?this.queryRenderedFeatures(x.point,{layers:v}):[];S.length&&(x.features=S,u.call(this,x),delete x.features)};return{layers:new Set(i),listener:u,delegates:{[f]:p}}}}on(f,i,u){if(typeof i=="function"||u===void 0)return super.on(f,i);if(Array.isArray(i)||(i=[i]),i){for(const x of i)if(!this._isValidId(x))return this}const p=this._createDelegatedListener(f,i,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(f,i,u){if(typeof i=="function"||u===void 0)return super.once(f,i);if(Array.isArray(i)||(i=[i]),i){for(const x of i)if(!this._isValidId(x))return this}const p=this._createDelegatedListener(f,i,u);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(f,i,u){if(typeof i=="function"||u===void 0)return super.off(f,i);const p=new Set(Array.isArray(i)?i:[i]);for(const S of p)if(!this._isValidId(S))return this;const x=(S,C)=>{if(S.size!==C.size)return!1;for(const R of S)if(!C.has(R))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(S=>{for(let C=0;C<S.length;C++){const R=S[C];if(R.listener===u&&x(R.layers,p)){for(const L in R.delegates)this.off(L,R.delegates[L]);return S.splice(C,1),this}}})(v),this}queryRenderedFeatures(f,i){if(!this.style)return[];if(i!==void 0||f===void 0||f instanceof o.P||Array.isArray(f)||(i=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(const u of i.layers)if(!this._isValidId(u))return[]}return this.style.queryRenderedFeatures(f,i,this.transform)}querySourceFeatures(f,i){return this._isValidId(f)?this.style.querySourceFeatures(f,i):[]}isPointOnSurface(f){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&o.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(f))}setStyle(f,i){return i=o.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&f&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(f,(u,p)=>{u?(o.w(`Unable to perform style diff: ${String(u.message||u.error||u)}. Rebuilding the style from scratch.`),this._updateStyle(f,i)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(f,i))}_getUIString(f){const i=this._locale[f];if(i==null)throw new Error(`Missing UI string '${f}'`);return i}_updateStyle(f,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const u=o.W({},i);i&&i.config&&(u.initialConfig=i.config,delete u.config),this.style=new Fs(this,u).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Fs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new o.d(new Error("IDs can't be empty."))),!1):!o.cV(f)||(this.fire(new o.d(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,i){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,i),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,i,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,i,u)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,i,{pixelRatio:u=1,sdf:p=!1,stretchX:x,stretchY:v,content:S}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:C,height:R,data:L}=o.e.getImageData(i);this.style.addImage(f,{data:new o.i({width:C,height:R},L),pixelRatio:u,stretchX:x,stretchY:v,content:S,sdf:p,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new o.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:R}=i,L=i;this.style.addImage(f,{data:new o.i({width:C,height:R},new Uint8Array(L.data)),pixelRatio:u,stretchX:x,stretchY:v,content:S,sdf:p,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f)}}updateImage(f,i){this._lazyInitEmptyStyle();const u=this.style.getImage(f);if(!u)return void this.fire(new o.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?o.e.getImageData(i):i,{width:x,height:v,data:S}=p;if(x===void 0||v===void 0)return void this.fire(new o.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==u.data.width||v!==u.data.height)return void this.fire(new o.d(new Error(`The width and height of the updated image (${x}, ${v})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const C=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);u.data.replace(S,C),this.style.updateImage(f,u)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new o.d(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,i){o.h(this._requestManager.transformRequest(f,o.R.Image),(u,p)=>{i(u,p instanceof HTMLImageElement?o.e.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(f,i){this._lazyInitEmptyStyle(),this.style.addModel(f,i)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new o.d(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,i){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,i),this._update(!0)):this}getSlot(f){const i=this.getLayer(f);return i&&i.slot||null}setSlot(f,i){return this.style.setSlot(f,i),this.style.mergeLayers(),this._update(!0)}addImport(f,i){return this.style.addImport(f,i),this}updateImport(f,i){return typeof i!="string"&&i.id!==f?(this.removeImport(f),this.addImport(i)):(this.style.updateImport(f,i),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,i){return this.style.moveImport(f,i),this._update(!0)}moveLayer(f,i){return this._isValidId(f)?(this.style.moveLayer(f,i),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){return this._isValidId(f)?this.style.getOwnLayer(f):null}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,i,u){return this._isValidId(f)?(this.style.setLayerZoomRange(f,i,u),this._update(!0)):this}setFilter(f,i,u={}){return this._isValidId(f)?(this.style.setFilter(f,i,u),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,i,u,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,i,u,p),this._update(!0)):this}getPaintProperty(f,i){return this._isValidId(f)?this.style.getPaintProperty(f,i):null}setLayoutProperty(f,i,u,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,i,u,p),this._update(!0)):this}getLayoutProperty(f,i){return this._isValidId(f)?this.style.getLayoutProperty(f,i):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,i){return this.style.setSchema(f,i),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,i){return this.style.setConfig(f,i),this._update(!0)}getConfigProperty(f,i){return this.style.getConfigProperty(f,i)}setConfigProperty(f,i,u){return this.style.setConfigProperty(f,i,u),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const i=f[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aI.convert(f),this.transform):0}setFeatureState(f,i){return this._isValidId(f.source)?(this.style.setFeatureState(f,i),this._update()):this}removeFeatureState(f,i){return this._isValidId(f.source)?(this.style.removeFeatureState(f,i),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let u,p,x,v=this._container;for(;v&&(!p||!x);){const S=window.getComputedStyle(v).transform;S&&S!=="none"&&(u=S.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(p=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(x=u[3])),v=v.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=xe("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=xe("div","mapboxgl-canvas-container",f);this._canvas=xe("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=xe("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{p[x]=xe("div",`mapboxgl-ctrl-${x}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,i){const u=o.e.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(i),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${i}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const i=this._markers.indexOf(f);i!==-1&&this._markers.splice(i,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const i=this._popups.indexOf(f);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const f=o.W({},J.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",f);i?(o.dh(i,!0),this.painter=new or(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.di.testSupport(i)):this.fire(new o.d(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.f("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new o.f("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let i;this.fire(new o.f("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,p=o.e.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=x.createQuery(),x.beginQuery(u.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,O=this.transform.pitch,F=o.e.now(),U=new o.X(L,{now:F,fadeDuration:v,pitch:O,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(p);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource);if(C&&(this._placementDirty=C.needsRerender,this._occlusionOpacityChanged=C.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.dc.mark(o.dd.load),this.fire(new o.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const L=o.e.now()-p;x.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const O=x.getQueryParameter(i,x.QUERY_RESULT)/1e6;x.deleteQuery(i),this.fire(new o.f("gpu-timing-frame",{cpuTime:L,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(L);this.fire(new o.f("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(L);this.fire(new o.f("gpu-timing-deferred-render",{gpuTime:O}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||S;if((this._sourcesDirty||this._styleDirty||S||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),R||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{const L=!this.isMoving()&&this.loaded();if(L&&(S=this._updateAverageElevation(p,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new o.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new o.f("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!R&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,o.dc.mark(o.dd.fullLoad),this._performanceMetricsCollection&&o.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const i of this._markers)f&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!f||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(f,i=!1){const u=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(i||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const S=Math.abs(x-v);if(S>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(v),u(v);this._averageElevation.easeTo(v,f,300)}else if(S>1e-4)return this._averageElevation.jumpTo(v),u(v)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){o.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===o.dl||f.status===401)){const i=this.painter.context.gl;o.dh(i,!1),this._logoControl instanceof Lp&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&o.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const u=this.painter.context.gl,p=u.createFramebuffer();function x(v){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,v,0);const S=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,S),S}return u.bindFramebuffer(u.FRAMEBUFFER,p),this._canvasPixelComparison(x(f),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(f,i,u){let p=u[1]-u[0];const x=f.length/4;for(let v=0;v<i.length;v++){const S=i[v];let C=0;for(let R=0;R<S.length;R+=4)S[R]===f[R]&&S[R+1]===f[R+1]&&S[R+2]===f[R+2]&&S[R+3]===f[R+3]&&(C+=1);p+=(u[v+2]-u[v+1])*(1-C/x)}return p}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.dp(this.painter.context.gl),o.dq.remove(),o.dr.remove(),this._removed=!0,this.fire(new o.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=o.e.frame(i=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(i)}))}_preloadTiles(f){const i=this.style?this.style.getSourceCaches():[];return o.ds(i,(u,p)=>u._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,i){o.du(f,i)}_occlusionCriteriaSatisfied(){const f=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&f&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return o.dt}},NavigationControl:class{constructor(f){this.options=o.W({},Ss,f),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(o.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:i}):u.resetNorth({},{originalEvent:i}))}),this._compassIcon=xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const i=f.getZoom(),u=i===f.getMaxZoom(),p=i===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qm(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,i){const u=xe("button",f,this._container);return u.type="button",u.addEventListener("click",i),u}_setButtonTitle(f,i){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${i}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends o.E{constructor(f){super();const i=navigator.geolocation;this.options=o.W({geolocation:i},Es,f),o.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Od(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const i=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,f(u)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>i(u.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(f){const i=this._map.getMaxBounds(),u=f.coords;return!!i&&(u.longitude<i.getWest()||u.longitude>i.getEast()||u.latitude<i.getSouth()||u.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.f("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.f("geolocate",f)),this._finish()}}_updateCamera(f){const i=new o.aI(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,p=this._map.getBearing(),x=o.W({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(u),x,{geolocateSource:!0})}_updateMarker(f){if(f){const i=new o.aI(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,i=o.ax(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.f("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=xe("button","mapboxgl-ctrl-geolocate",this._container),xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xe("div","mapboxgl-user-location"),this._dotElement.appendChild(xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new tu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new tu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.f("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xd,ScaleControl:class{constructor(f){this.options=o.W({},kp,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,i=this._map,u=i._containerHeight/2,p=i._containerWidth/2-f/2,x=i.unproject([p,u]),v=i.unproject([p+f,u]),S=x.distanceTo(v);if(this.options.unit==="imperial"){const C=3.2808*S;C>5280?this._setScale(f,C/5280,"mile"):this._setScale(f,C,"foot")}else this.options.unit==="nautical"?this._setScale(f,S/1852,"nautical-mile"):S>=1e3?this._setScale(f,S/1e3,"kilometer"):this._setScale(f,S,"meter")}_setScale(f,i,u){this._map._requestDomTask(()=>{const p=function(v){const S=Math.pow(10,`${Math.floor(v)}`.length-1);let C=v/S;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(R){const L=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*L)/L}(C),S*C}(i),x=p/i;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(p):`${p}&nbsp;${Oh[u]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:o.w("Full screen control 'container' must be a DOM element.")),o.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);xe("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(f){super(),this.options=o.W(Object.create(Yd),f),o.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new o.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new o.f("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=o.aI.convert(f),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const i=document.createDocumentFragment(),u=document.createElement("body");let p;for(u.innerHTML=f;p=u.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=xe("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(f),this.options.closeButton){const u=this._closeButton=xe("button","mapboxgl-popup-close-button",i);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let i;return this._classList.delete(f)?i=!1:(this._classList.add(f),i=!0),this._updateClassList(),i}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const i=this._map,u=this._container,p=this._pos;if(!i||!u||!p)return"bottom";const x=u.offsetWidth,v=u.offsetHeight,S=p.x<x/2,C=p.x>i.transform.width-x/2;if(p.y+f<v)return S?"top-left":C?"top-right":"top";if(p.y>i.transform.height-v){if(S)return"bottom-left";if(C)return"bottom-right"}return S?"left":C?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),f.className=i.join(" ")}_update(f){const i=this._map,u=this._content;if(!i||!this._lngLat&&!this._trackPointer||!u)return;let p=this._container;if(p||(p=this._container=xe("div","mapboxgl-popup",i.getContainer()),this._tip=xe("div","mapboxgl-popup-tip",p),p.appendChild(u)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ts(this._lngLat,this._pos,i.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f?f:i.project(this._lngLat),v=ul(this.options.offset),S=this._anchor=this._getAnchor(v.y),C=ul(this.options.offset,S),R=x.add(C).round();i._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Zo[S]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&i._showingGlobe()){const x=o.d9(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(zh);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:tu,Style:Fs,LngLat:o.aI,LngLatBounds:o.ai,Point:o.P,MercatorCoordinate:o.Y,FreeCameraOptions:sp,Evented:o.E,config:o.d8,prewarm:o.dx,clearPrewarmedResources:o.dy,get accessToken(){return o.d8.ACCESS_TOKEN},set accessToken(f){o.d8.ACCESS_TOKEN=f},get baseApiUrl(){return o.d8.API_URL},set baseApiUrl(f){o.d8.API_URL=f},get workerCount(){return o.dz.workerCount},set workerCount(f){o.dz.workerCount=f},get maxParallelImageRequests(){return o.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){o.d8.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){o.dA(f)},get workerUrl(){return o.dB.workerUrl},set workerUrl(f){o.dB.workerUrl=f},get workerClass(){return o.dB.workerClass},set workerClass(f){o.dB.workerClass=f},get workerParams(){return o.dB.workerParams},set workerParams(f){o.dB.workerParams=f},get dracoUrl(){return o.dC()},set dracoUrl(f){o.dD(f)},get meshoptUrl(){return o.dE()},set meshoptUrl(f){o.dF(f)},setNow:o.e.setNow,restoreNow:o.e.restoreNow}});var V=M;return V})})(y4);var TF=y4.exports;const Mv=pw(TF),SF="https://lionfish-app-ndao4.ondigitalocean.app",EF="pk.eyJ1IjoibnZpY3RvcnkiLCJhIjoiY2xlNjJteTNsMGlyMzNybXIwcXQ5a2I5MSJ9.Limj9aCaV0bMS53BQlTq7A",EI=43.718371,CI=-79.5428643;function CF(){return at.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 52 65",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[at.jsx("path",{d:"M25.536 0C18.7658 0.00768033 12.2751 2.70054 7.48779 7.4878C2.70054 12.2751 0.00768033 18.7658 0 25.536C0 34.6477 4.21053 44.3049 12.1876 53.4659C15.772 57.6056 19.8062 61.3332 24.2156 64.5799C24.606 64.8533 25.071 65 25.5476 65C26.0242 65 26.4892 64.8533 26.8795 64.5799C31.2808 61.3318 35.3072 57.6043 38.8843 53.4659C46.8498 44.3049 51.0719 34.6477 51.0719 25.536C51.0643 18.7658 48.3714 12.2751 43.5841 7.4878C38.7969 2.70054 32.3062 0.00768033 25.536 0Z",fill:"#BB0D2F"}),at.jsx("circle",{cx:"25.536",cy:"26.6967",r:"19.4422",fill:"white"}),at.jsx("path",{d:"M25.4664 39.2241C31.0701 39.2241 33.8995 34.6866 33.8995 34.6866C33.8995 34.6866 33.4013 34.4858 33.2126 34.4117C33.6195 34.2082 34.3367 33.8195 34.3367 33.8195C36.6225 29.4225 35.3262 24.7324 35.3262 24.7324C34.9438 25.2477 34.5529 25.5814 34.5529 25.5814C34.0613 22.7121 32.8859 21.0537 32.8859 21.0537C32.3328 24.393 30.9263 26.8345 30.9263 26.8345C32.5024 20.8815 30.389 18.0137 30.389 18.0137C30.389 18.0137 29.7376 19.0067 29.0098 19.8107C29.0098 19.8107 27.5922 16.2615 25.4664 13.9063C23.3395 16.2617 21.9214 19.8107 21.9214 19.8107C21.1918 19.0067 20.5405 18.0137 20.5405 18.0137C20.5405 18.0137 18.4291 20.8815 20.004 26.8345C20.004 26.8345 18.5989 24.393 18.0444 21.0537C18.0444 21.0537 16.8677 22.7118 16.3775 25.5814C16.3775 25.5814 15.9877 25.2477 15.6039 24.7324C15.6039 24.7324 14.309 29.4225 16.5951 33.8195C16.5951 33.8195 17.3122 34.2082 17.7175 34.4117C17.5302 34.4858 17.0324 34.6866 17.0324 34.6866C17.0324 34.6866 19.8611 39.2241 25.4664 39.2241Z",fill:"#C10230"}),at.jsx("path",{d:"M25.4663 14.8013C27.209 16.9204 28.7617 20.9647 28.7617 20.9647C29.6502 20.3229 30.2882 19.1257 30.2882 19.1257C30.2882 19.1257 32.5876 24.2216 28.4117 30.9866C28.4117 30.9866 32.3752 27.2625 33.0672 22.4251C33.0672 22.4251 33.8732 23.8253 33.9999 26.4789C33.9999 26.4789 34.3601 26.4104 35.0299 25.7594C35.0299 25.7594 35.6504 29.4574 33.8408 33.3899C33.8408 33.3899 32.9196 33.7927 32.4881 34.0986C32.3834 34.1715 32.2367 34.3189 32.4474 34.4422C32.5943 34.5296 33.0356 34.8299 33.0356 34.8299C33.0356 34.8299 30.2938 38.6603 25.4665 38.6603C20.6393 38.6603 17.8972 34.8299 17.8972 34.8299C17.8972 34.8299 18.3377 34.5296 18.4841 34.4422C18.6943 34.3187 18.5483 34.1715 18.4423 34.0986C18.0123 33.7925 17.0883 33.3899 17.0883 33.3899C15.2811 29.4578 15.9012 25.7596 15.9012 25.7596C16.5705 26.4107 16.9305 26.4791 16.9305 26.4791C17.0592 23.8253 17.865 22.4253 17.865 22.4253C18.5561 27.2625 22.5189 30.9869 22.5189 30.9869C18.3432 24.2216 20.644 19.1257 20.644 19.1257C20.644 19.1257 21.28 20.3226 22.1691 20.9647C22.1691 20.9647 23.7211 16.9201 25.4663 14.8013Z",fill:"white"}),at.jsx("path",{d:"M22.5989 21.8975L22.5738 21.9485L22.5116 21.9355C21.5524 21.4809 20.8473 20.6404 20.7537 20.3222C20.3446 22.8511 20.6453 25.7891 21.4953 27.7751C22.1569 29.3229 22.758 30.7614 23.3909 31.567C24.0565 32.4128 24.5843 33.0844 24.5958 33.9618C24.797 33.9794 25.0103 33.9899 25.2408 33.9969L25.1505 16.2033C25.1505 16.2033 23.2054 19.6291 22.5987 21.8973",fill:"#C10230"}),at.jsx("path",{d:"M16.2838 26.7882C16.8816 27.32 17.4107 27.5817 17.8425 27.6532L17.8332 27.6423C17.6679 26.6929 17.5345 26.1043 17.6619 24.136C18.3408 26.7672 19.4566 28.0891 19.9633 28.8889C20.8826 30.3448 21.964 31.1201 22.7571 31.9288C23.5109 32.7002 24.0596 33.2589 24.0987 33.9056C20.1115 33.3543 16.4463 30.237 16.2872 27.1176C16.2872 27.1176 16.2654 26.9221 16.284 26.788",fill:"#C10230"}),at.jsx("path",{d:"M23.0278 35.3434C23.5852 35.1614 23.9454 34.806 24.0598 34.3388C21.0026 34.2225 18.0319 32.1876 16.7087 30.4803C16.823 30.9479 17.3057 32.4032 17.5899 32.9739C17.9739 33.1323 19.5053 33.7714 19.6559 34.2225C19.7219 34.4184 19.1468 34.7982 18.8808 34.8505C20.0944 35.8153 22.1445 35.6303 23.028 35.3432",fill:"#C10230"}),at.jsx("path",{d:"M25.1179 38.1289L25.2012 34.4173C24.9112 34.4115 24.7561 34.4026 24.5407 34.3853C24.1525 36.0282 21.5742 36.3409 19.9657 36.1255C19.9657 36.1255 22.1696 38.1289 25.1176 38.1289",fill:"#C10230"}),at.jsx("path",{d:"M28.3302 21.8975L28.3584 21.9485L28.4197 21.9355C29.3766 21.4809 30.0822 20.6404 30.1771 20.3222C30.5849 22.8511 30.284 25.7891 29.4342 27.7751C28.7737 29.3229 28.1728 30.7614 27.541 31.567C26.875 32.4128 26.3468 33.0844 26.3339 33.9618C26.1334 33.9794 25.9199 33.9899 25.6897 33.9969L25.7794 16.2033C25.7794 16.2033 27.7259 19.6291 28.3299 21.8973",fill:"#C10230"}),at.jsx("path",{d:"M34.6468 26.7882C34.0505 27.32 33.5208 27.5817 33.0876 27.6532L33.0972 27.6423C33.2625 26.6929 33.3965 26.1043 33.2699 24.136C32.5894 26.7672 31.4749 28.0891 30.9689 28.8889C30.0495 30.3448 28.9677 31.1201 28.1737 31.9288C27.4184 32.7002 26.8706 33.2589 26.8297 33.9056C30.8178 33.3543 34.4848 30.237 34.6432 27.1176C34.6432 27.1176 34.6663 26.9221 34.6468 26.788",fill:"#C10230"}),at.jsx("path",{d:"M27.9026 35.3434C27.3455 35.1614 26.9839 34.806 26.871 34.3388C29.9271 34.2225 32.9001 32.1876 34.2206 30.4803C34.1083 30.9479 33.6254 32.4032 33.3414 32.9739C32.9574 33.1323 31.4267 33.7714 31.2754 34.2225C31.2082 34.4184 31.7834 34.7982 32.05 34.8505C30.8369 35.8153 28.7875 35.6303 27.9028 35.3432",fill:"#C10230"}),at.jsx("path",{d:"M25.8134 38.1289L25.7277 34.4173C26.0203 34.4115 26.1763 34.4026 26.389 34.3853C26.7786 36.0282 29.3562 36.3409 30.964 36.1255C30.964 36.1255 28.7615 38.1289 25.8134 38.1289Z",fill:"#C10230"})]})}function AF(r){return at.jsx("button",{className:"MapMarker",...r,children:at.jsx(CF,{})})}Mv.accessToken=EF;function MF(){const r=Ui(b=>b.locale),a=on.useRef(null),h=on.useRef(null),m=ts(b=>b.searchedClubs);return on.useEffect(()=>{h.current||!a.current||(h.current=new Mv.Map({container:a.current,style:"mapbox://styles/mapbox/streets-v12",center:[CI,EI],zoom:12,minZoom:6}))},[]),on.useEffect(()=>{if(!h.current)return;const b=m.filter(P=>P.latitude&&P.longitude)[0],M={lat:xi.get(b,"latitude",EI),lng:xi.get(b,"longitude",CI)};h.current.setCenter({lat:M.lat,lng:M.lng}),m.forEach(P=>{const V=xi.get(P,"latitude",0),o=xi.get(P,"longitude",0),q=xi.get(P,"name",""),J=xi.get(P,"slug",""),Q=xi.get(P,"addressLine1",""),ae=xi.get(P,"addressLine2",""),xe=xi.get(P,"city",""),Re=xi.get(P,`province.name["${r}"]`,""),Ue=xi.get(P,"postalCode",""),Tt=cd(Q&&Q,ae&&`, ${ae}`),Te=cd(xe&&`${xe}, `,Re&&`${Re}`,Ue&&`${Ue}`),Ee=on.createRef();Ee.current=document.createElement("div"),c4(Ee.current).render(at.jsx(AF,{onClick:()=>{const Me=new Mv.Popup({closeOnClick:!0,offset:[0,-50],maxWidth:"350px",closeButton:!1,className:"Map__popup"}).setLngLat([o,V]).setHTML(`
                <a class="Map__popup-inner" href="/clubs/${J}" target="_blank">
                  <div class="Map__popup-content">
                    <h1 class="Map__popup-title">${q}</h1>
                    <p class="Map__popup-address">
                      ${Tt}<br />
                      ${Te}
                    </p>
                  </div>
                  <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 0.555538V7.77754C10 7.92487 9.94147 8.06618 9.83729 8.17036C9.7331 8.27455 9.5918 8.33308 9.44446 8.33308C9.29712 8.33308 9.15582 8.27455 9.05164 8.17036C8.94745 8.06618 8.88892 7.92487 8.88892 7.77754V1.89647L0.948891 9.8372C0.844649 9.94144 0.703267 10 0.555847 10C0.408427 10 0.267045 9.94144 0.162804 9.8372C0.0585623 9.73295 0 9.59157 0 9.44415C0 9.29673 0.0585623 9.15535 0.162804 9.05111L8.10353 1.11108H2.22246C2.07512 1.11108 1.93382 1.05255 1.82964 0.948363C1.72545 0.84418 1.66692 0.702876 1.66692 0.555538C1.66692 0.4082 1.72545 0.266897 1.82964 0.162714C1.93382 0.0585299 2.07512 0 2.22246 0H9.44446C9.5918 0 9.7331 0.0585299 9.83729 0.162714C9.94147 0.266897 10 0.4082 10 0.555538Z" fill="currentColor"/>
                  </svg>
                </a>
              `);h.current&&Me.addTo(h.current)}})),h.current&&(new Mv.Marker(Ee.current,{offset:[0,-20]}).setLngLat({lat:V,lng:o}).addTo(h.current),Ee.current.addEventListener("click",Me=>Me.stopPropagation()))})},[m]),at.jsx("div",{className:"Map",ref:a})}function IF(){const r=po("FILTER_BOX_SORT_BY"),a=po("FILTER_BOX_FILTER_PROVINCE"),h=po("FILTER_BOX_FILTER_PROGRAMS"),m=po("SORT_AUTO"),b=po("SORT_ALPHA"),M=po("SORT_DISTANCE"),P=po("ALL_FILTER_COPY"),V=po("VERIFIED"),o=po("JR_NBA"),q=Ui(Te=>Te.locale),J=Ui(Te=>Te.selectedSort),Q=Ui(Te=>Te.setSelectedSort),ae=Ui(Te=>Te.selectedProgramFilter),xe=Ui(Te=>Te.setSelectedProgramFilter),Re=Ui(Te=>Te.selectedProvinceFilter),Ue=Ui(Te=>Te.setSelectedProvinceFilter),Tt=$c(Te=>Te.provinces);return at.jsxs("div",{className:"FilterBox",children:[at.jsxs("div",{className:"FilterBox__category",children:[at.jsx("p",{className:"FilterBox__label",children:r}),at.jsxs("ul",{className:"FilterBox__chips",children:[at.jsx("li",{children:at.jsx(Yh,{buttonProps:{onClick:()=>Q("auto")},isActive:J==="auto",children:m})}),at.jsx("li",{children:at.jsx(Yh,{buttonProps:{onClick:()=>Q("alpha")},isActive:J==="alpha",children:b})}),at.jsx("li",{children:at.jsx(Yh,{buttonProps:{onClick:()=>Q("distance")},isActive:J==="distance",children:M})})]})]}),at.jsxs("div",{className:"FilterBox__category",children:[at.jsx("p",{className:"FilterBox__label",children:a}),at.jsxs("ul",{className:"FilterBox__chips FilterBox__chips--provinces",children:[at.jsx("li",{children:at.jsx(Yh,{buttonProps:{onClick:()=>Ue("all")},isActive:Re==="all",children:P})}),Tt.map(Te=>at.jsx("li",{children:at.jsx(Yh,{buttonProps:{onClick:()=>Ue(Te.slug)},isActive:Re===Te.slug,children:Te.name[q]})},Te.slug))]})]}),at.jsxs("div",{className:"FilterBox__category",children:[at.jsx("p",{className:"FilterBox__label",children:h}),at.jsxs("ul",{className:"FilterBox__chips",children:[at.jsx("li",{children:at.jsx(Yh,{buttonProps:{onClick:()=>xe("all")},isActive:ae==="all",children:P})}),at.jsx("li",{children:at.jsx(Yh,{buttonProps:{onClick:()=>xe("verified")},isActive:ae==="verified",children:V})}),at.jsx("li",{children:at.jsx(Yh,{buttonProps:{onClick:()=>xe("jr-nba")},isActive:ae==="jr-nba",children:o})})]})]})]})}function PF(){const[r,a]=on.useState("All Clubs"),h=ts(ae=>ae.query),m=ts(ae=>ae.searchStatus),b=ts(ae=>ae.setSearchStatus),M=ts(ae=>ae.setQuery),P=ts(ae=>ae.setSearchedClubs),V=Ui(ae=>ae.location),o=Ui(ae=>ae.mapOpened),q=Ui(ae=>ae.filterBoxOpened),J=$c(ae=>ae.loading);on.useEffect(()=>{V.lat!==0&&V.lng!==0?a("Clubs near your location"):m==="done"&&a(`Clubs in ${h}`)},[m,V]);const Q=()=>{b("none"),M(""),P([]),a("All Clubs")};return at.jsx("div",{className:"ClubsWrapper",children:at.jsx("div",{className:"cl-container",children:at.jsxs("div",{className:"ClubsWrapper__wrapper",children:[at.jsx("h2",{children:r}),m==="none"&&at.jsx(fF,{className:"ClubsWrapper__province-chips"}),J&&at.jsx(yF,{}),m==="done"&&at.jsxs("div",{className:"ClubsWrapper__filters",children:[at.jsx(bF,{}),q&&at.jsx(IF,{}),o&&at.jsx(MF,{})]}),at.jsx(gF,{}),m==="done"&&at.jsx(g4,{icon:at.jsx(xF,{}),buttonProps:{onClick:Q},children:"Show All Clubs"})]})})})}function v4(r,a){return function(){return r.apply(a,arguments)}}const{toString:RF}=Object.prototype,{getPrototypeOf:UE}=Object,Lw=(r=>a=>{const h=RF.call(a);return r[h]||(r[h]=h.slice(8,-1).toLowerCase())})(Object.create(null)),Ru=r=>(r=r.toLowerCase(),a=>Lw(a)===r),Dw=r=>a=>typeof a===r,{isArray:bg}=Array,$0=Dw("undefined");function LF(r){return r!==null&&!$0(r)&&r.constructor!==null&&!$0(r.constructor)&&Ml(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const w4=Ru("ArrayBuffer");function DF(r){let a;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?a=ArrayBuffer.isView(r):a=r&&r.buffer&&w4(r.buffer),a}const zF=Dw("string"),Ml=Dw("function"),b4=Dw("number"),zw=r=>r!==null&&typeof r=="object",kF=r=>r===!0||r===!1,Iv=r=>{if(Lw(r)!=="object")return!1;const a=UE(r);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},OF=Ru("Date"),BF=Ru("File"),FF=Ru("Blob"),NF=Ru("FileList"),VF=r=>zw(r)&&Ml(r.pipe),UF=r=>{let a;return r&&(typeof FormData=="function"&&r instanceof FormData||Ml(r.append)&&((a=Lw(r))==="formdata"||a==="object"&&Ml(r.toString)&&r.toString()==="[object FormData]"))},jF=Ru("URLSearchParams"),[GF,WF,$F,qF]=["ReadableStream","Request","Response","Headers"].map(Ru),HF=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nx(r,a,{allOwnKeys:h=!1}={}){if(r===null||typeof r>"u")return;let m,b;if(typeof r!="object"&&(r=[r]),bg(r))for(m=0,b=r.length;m<b;m++)a.call(null,r[m],m,r);else{const M=h?Object.getOwnPropertyNames(r):Object.keys(r),P=M.length;let V;for(m=0;m<P;m++)V=M[m],a.call(null,r[V],V,r)}}function T4(r,a){a=a.toLowerCase();const h=Object.keys(r);let m=h.length,b;for(;m-- >0;)if(b=h[m],a===b.toLowerCase())return b;return null}const S4=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,E4=r=>!$0(r)&&r!==S4;function TS(){const{caseless:r}=E4(this)&&this||{},a={},h=(m,b)=>{const M=r&&T4(a,b)||b;Iv(a[M])&&Iv(m)?a[M]=TS(a[M],m):Iv(m)?a[M]=TS({},m):bg(m)?a[M]=m.slice():a[M]=m};for(let m=0,b=arguments.length;m<b;m++)arguments[m]&&nx(arguments[m],h);return a}const ZF=(r,a,h,{allOwnKeys:m}={})=>(nx(a,(b,M)=>{h&&Ml(b)?r[M]=v4(b,h):r[M]=b},{allOwnKeys:m}),r),XF=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),YF=(r,a,h,m)=>{r.prototype=Object.create(a.prototype,m),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:a.prototype}),h&&Object.assign(r.prototype,h)},KF=(r,a,h,m)=>{let b,M,P;const V={};if(a=a||{},r==null)return a;do{for(b=Object.getOwnPropertyNames(r),M=b.length;M-- >0;)P=b[M],(!m||m(P,r,a))&&!V[P]&&(a[P]=r[P],V[P]=!0);r=h!==!1&&UE(r)}while(r&&(!h||h(r,a))&&r!==Object.prototype);return a},JF=(r,a,h)=>{r=String(r),(h===void 0||h>r.length)&&(h=r.length),h-=a.length;const m=r.indexOf(a,h);return m!==-1&&m===h},QF=r=>{if(!r)return null;if(bg(r))return r;let a=r.length;if(!b4(a))return null;const h=new Array(a);for(;a-- >0;)h[a]=r[a];return h},e6=(r=>a=>r&&a instanceof r)(typeof Uint8Array<"u"&&UE(Uint8Array)),t6=(r,a)=>{const m=(r&&r[Symbol.iterator]).call(r);let b;for(;(b=m.next())&&!b.done;){const M=b.value;a.call(r,M[0],M[1])}},n6=(r,a)=>{let h;const m=[];for(;(h=r.exec(a))!==null;)m.push(h);return m},r6=Ru("HTMLFormElement"),i6=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(h,m,b){return m.toUpperCase()+b}),AI=(({hasOwnProperty:r})=>(a,h)=>r.call(a,h))(Object.prototype),s6=Ru("RegExp"),C4=(r,a)=>{const h=Object.getOwnPropertyDescriptors(r),m={};nx(h,(b,M)=>{let P;(P=a(b,M,r))!==!1&&(m[M]=P||b)}),Object.defineProperties(r,m)},o6=r=>{C4(r,(a,h)=>{if(Ml(r)&&["arguments","caller","callee"].indexOf(h)!==-1)return!1;const m=r[h];if(Ml(m)){if(a.enumerable=!1,"writable"in a){a.writable=!1;return}a.set||(a.set=()=>{throw Error("Can not rewrite read-only method '"+h+"'")})}})},a6=(r,a)=>{const h={},m=b=>{b.forEach(M=>{h[M]=!0})};return bg(r)?m(r):m(String(r).split(a)),h},l6=()=>{},u6=(r,a)=>r!=null&&Number.isFinite(r=+r)?r:a,f3="abcdefghijklmnopqrstuvwxyz",MI="0123456789",A4={DIGIT:MI,ALPHA:f3,ALPHA_DIGIT:f3+f3.toUpperCase()+MI},c6=(r=16,a=A4.ALPHA_DIGIT)=>{let h="";const{length:m}=a;for(;r--;)h+=a[Math.random()*m|0];return h};function h6(r){return!!(r&&Ml(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const d6=r=>{const a=new Array(10),h=(m,b)=>{if(zw(m)){if(a.indexOf(m)>=0)return;if(!("toJSON"in m)){a[b]=m;const M=bg(m)?[]:{};return nx(m,(P,V)=>{const o=h(P,b+1);!$0(o)&&(M[V]=o)}),a[b]=void 0,M}}return m};return h(r,0)},f6=Ru("AsyncFunction"),p6=r=>r&&(zw(r)||Ml(r))&&Ml(r.then)&&Ml(r.catch),wt={isArray:bg,isArrayBuffer:w4,isBuffer:LF,isFormData:UF,isArrayBufferView:DF,isString:zF,isNumber:b4,isBoolean:kF,isObject:zw,isPlainObject:Iv,isReadableStream:GF,isRequest:WF,isResponse:$F,isHeaders:qF,isUndefined:$0,isDate:OF,isFile:BF,isBlob:FF,isRegExp:s6,isFunction:Ml,isStream:VF,isURLSearchParams:jF,isTypedArray:e6,isFileList:NF,forEach:nx,merge:TS,extend:ZF,trim:HF,stripBOM:XF,inherits:YF,toFlatObject:KF,kindOf:Lw,kindOfTest:Ru,endsWith:JF,toArray:QF,forEachEntry:t6,matchAll:n6,isHTMLForm:r6,hasOwnProperty:AI,hasOwnProp:AI,reduceDescriptors:C4,freezeMethods:o6,toObjectSet:a6,toCamelCase:i6,noop:l6,toFiniteNumber:u6,findKey:T4,global:S4,isContextDefined:E4,ALPHABET:A4,generateString:c6,isSpecCompliantForm:h6,toJSONObject:d6,isAsyncFn:f6,isThenable:p6};function sr(r,a,h,m,b){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",a&&(this.code=a),h&&(this.config=h),m&&(this.request=m),b&&(this.response=b)}wt.inherits(sr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:wt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const M4=sr.prototype,I4={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{I4[r]={value:r}});Object.defineProperties(sr,I4);Object.defineProperty(M4,"isAxiosError",{value:!0});sr.from=(r,a,h,m,b,M)=>{const P=Object.create(M4);return wt.toFlatObject(r,P,function(o){return o!==Error.prototype},V=>V!=="isAxiosError"),sr.call(P,r.message,a,h,m,b),P.cause=r,P.name=r.name,M&&Object.assign(P,M),P};const m6=null;function SS(r){return wt.isPlainObject(r)||wt.isArray(r)}function P4(r){return wt.endsWith(r,"[]")?r.slice(0,-2):r}function II(r,a,h){return r?r.concat(a).map(function(b,M){return b=P4(b),!h&&M?"["+b+"]":b}).join(h?".":""):a}function _6(r){return wt.isArray(r)&&!r.some(SS)}const g6=wt.toFlatObject(wt,{},null,function(a){return/^is[A-Z]/.test(a)});function kw(r,a,h){if(!wt.isObject(r))throw new TypeError("target must be an object");a=a||new FormData,h=wt.toFlatObject(h,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Ue,Tt){return!wt.isUndefined(Tt[Ue])});const m=h.metaTokens,b=h.visitor||J,M=h.dots,P=h.indexes,o=(h.Blob||typeof Blob<"u"&&Blob)&&wt.isSpecCompliantForm(a);if(!wt.isFunction(b))throw new TypeError("visitor must be a function");function q(Re){if(Re===null)return"";if(wt.isDate(Re))return Re.toISOString();if(!o&&wt.isBlob(Re))throw new sr("Blob is not supported. Use a Buffer instead.");return wt.isArrayBuffer(Re)||wt.isTypedArray(Re)?o&&typeof Blob=="function"?new Blob([Re]):Buffer.from(Re):Re}function J(Re,Ue,Tt){let Te=Re;if(Re&&!Tt&&typeof Re=="object"){if(wt.endsWith(Ue,"{}"))Ue=m?Ue:Ue.slice(0,-2),Re=JSON.stringify(Re);else if(wt.isArray(Re)&&_6(Re)||(wt.isFileList(Re)||wt.endsWith(Ue,"[]"))&&(Te=wt.toArray(Re)))return Ue=P4(Ue),Te.forEach(function(Me,et){!(wt.isUndefined(Me)||Me===null)&&a.append(P===!0?II([Ue],et,M):P===null?Ue:Ue+"[]",q(Me))}),!1}return SS(Re)?!0:(a.append(II(Tt,Ue,M),q(Re)),!1)}const Q=[],ae=Object.assign(g6,{defaultVisitor:J,convertValue:q,isVisitable:SS});function xe(Re,Ue){if(!wt.isUndefined(Re)){if(Q.indexOf(Re)!==-1)throw Error("Circular reference detected in "+Ue.join("."));Q.push(Re),wt.forEach(Re,function(Te,Ee){(!(wt.isUndefined(Te)||Te===null)&&b.call(a,Te,wt.isString(Ee)?Ee.trim():Ee,Ue,ae))===!0&&xe(Te,Ue?Ue.concat(Ee):[Ee])}),Q.pop()}}if(!wt.isObject(r))throw new TypeError("data must be an object");return xe(r),a}function PI(r){const a={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(m){return a[m]})}function jE(r,a){this._pairs=[],r&&kw(r,this,a)}const R4=jE.prototype;R4.append=function(a,h){this._pairs.push([a,h])};R4.toString=function(a){const h=a?function(m){return a.call(this,m,PI)}:PI;return this._pairs.map(function(b){return h(b[0])+"="+h(b[1])},"").join("&")};function y6(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function L4(r,a,h){if(!a)return r;const m=h&&h.encode||y6,b=h&&h.serialize;let M;if(b?M=b(a,h):M=wt.isURLSearchParams(a)?a.toString():new jE(a,h).toString(m),M){const P=r.indexOf("#");P!==-1&&(r=r.slice(0,P)),r+=(r.indexOf("?")===-1?"?":"&")+M}return r}class RI{constructor(){this.handlers=[]}use(a,h,m){return this.handlers.push({fulfilled:a,rejected:h,synchronous:m?m.synchronous:!1,runWhen:m?m.runWhen:null}),this.handlers.length-1}eject(a){this.handlers[a]&&(this.handlers[a]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(a){wt.forEach(this.handlers,function(m){m!==null&&a(m)})}}const D4={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},x6=typeof URLSearchParams<"u"?URLSearchParams:jE,v6=typeof FormData<"u"?FormData:null,w6=typeof Blob<"u"?Blob:null,b6={isBrowser:!0,classes:{URLSearchParams:x6,FormData:v6,Blob:w6},protocols:["http","https","file","blob","url","data"]},GE=typeof window<"u"&&typeof document<"u",T6=(r=>GE&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),S6=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",E6=GE&&window.location.href||"http://localhost",C6=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:GE,hasStandardBrowserEnv:T6,hasStandardBrowserWebWorkerEnv:S6,origin:E6},Symbol.toStringTag,{value:"Module"})),Iu={...C6,...b6};function A6(r,a){return kw(r,new Iu.classes.URLSearchParams,Object.assign({visitor:function(h,m,b,M){return Iu.isNode&&wt.isBuffer(h)?(this.append(m,h.toString("base64")),!1):M.defaultVisitor.apply(this,arguments)}},a))}function M6(r){return wt.matchAll(/\w+|\[(\w*)]/g,r).map(a=>a[0]==="[]"?"":a[1]||a[0])}function I6(r){const a={},h=Object.keys(r);let m;const b=h.length;let M;for(m=0;m<b;m++)M=h[m],a[M]=r[M];return a}function z4(r){function a(h,m,b,M){let P=h[M++];if(P==="__proto__")return!0;const V=Number.isFinite(+P),o=M>=h.length;return P=!P&&wt.isArray(b)?b.length:P,o?(wt.hasOwnProp(b,P)?b[P]=[b[P],m]:b[P]=m,!V):((!b[P]||!wt.isObject(b[P]))&&(b[P]=[]),a(h,m,b[P],M)&&wt.isArray(b[P])&&(b[P]=I6(b[P])),!V)}if(wt.isFormData(r)&&wt.isFunction(r.entries)){const h={};return wt.forEachEntry(r,(m,b)=>{a(M6(m),b,h,0)}),h}return null}function P6(r,a,h){if(wt.isString(r))try{return(a||JSON.parse)(r),wt.trim(r)}catch(m){if(m.name!=="SyntaxError")throw m}return(h||JSON.stringify)(r)}const rx={transitional:D4,adapter:["xhr","http","fetch"],transformRequest:[function(a,h){const m=h.getContentType()||"",b=m.indexOf("application/json")>-1,M=wt.isObject(a);if(M&&wt.isHTMLForm(a)&&(a=new FormData(a)),wt.isFormData(a))return b?JSON.stringify(z4(a)):a;if(wt.isArrayBuffer(a)||wt.isBuffer(a)||wt.isStream(a)||wt.isFile(a)||wt.isBlob(a)||wt.isReadableStream(a))return a;if(wt.isArrayBufferView(a))return a.buffer;if(wt.isURLSearchParams(a))return h.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),a.toString();let V;if(M){if(m.indexOf("application/x-www-form-urlencoded")>-1)return A6(a,this.formSerializer).toString();if((V=wt.isFileList(a))||m.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return kw(V?{"files[]":a}:a,o&&new o,this.formSerializer)}}return M||b?(h.setContentType("application/json",!1),P6(a)):a}],transformResponse:[function(a){const h=this.transitional||rx.transitional,m=h&&h.forcedJSONParsing,b=this.responseType==="json";if(wt.isResponse(a)||wt.isReadableStream(a))return a;if(a&&wt.isString(a)&&(m&&!this.responseType||b)){const P=!(h&&h.silentJSONParsing)&&b;try{return JSON.parse(a)}catch(V){if(P)throw V.name==="SyntaxError"?sr.from(V,sr.ERR_BAD_RESPONSE,this,null,this.response):V}}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Iu.classes.FormData,Blob:Iu.classes.Blob},validateStatus:function(a){return a>=200&&a<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};wt.forEach(["delete","get","head","post","put","patch"],r=>{rx.headers[r]={}});const R6=wt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),L6=r=>{const a={};let h,m,b;return r&&r.split(`
`).forEach(function(P){b=P.indexOf(":"),h=P.substring(0,b).trim().toLowerCase(),m=P.substring(b+1).trim(),!(!h||a[h]&&R6[h])&&(h==="set-cookie"?a[h]?a[h].push(m):a[h]=[m]:a[h]=a[h]?a[h]+", "+m:m)}),a},LI=Symbol("internals");function l0(r){return r&&String(r).trim().toLowerCase()}function Pv(r){return r===!1||r==null?r:wt.isArray(r)?r.map(Pv):String(r)}function D6(r){const a=Object.create(null),h=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=h.exec(r);)a[m[1]]=m[2];return a}const z6=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function p3(r,a,h,m,b){if(wt.isFunction(m))return m.call(this,a,h);if(b&&(a=h),!!wt.isString(a)){if(wt.isString(m))return a.indexOf(m)!==-1;if(wt.isRegExp(m))return m.test(a)}}function k6(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(a,h,m)=>h.toUpperCase()+m)}function O6(r,a){const h=wt.toCamelCase(" "+a);["get","set","has"].forEach(m=>{Object.defineProperty(r,m+h,{value:function(b,M,P){return this[m].call(this,a,b,M,P)},configurable:!0})})}class ha{constructor(a){a&&this.set(a)}set(a,h,m){const b=this;function M(V,o,q){const J=l0(o);if(!J)throw new Error("header name must be a non-empty string");const Q=wt.findKey(b,J);(!Q||b[Q]===void 0||q===!0||q===void 0&&b[Q]!==!1)&&(b[Q||o]=Pv(V))}const P=(V,o)=>wt.forEach(V,(q,J)=>M(q,J,o));if(wt.isPlainObject(a)||a instanceof this.constructor)P(a,h);else if(wt.isString(a)&&(a=a.trim())&&!z6(a))P(L6(a),h);else if(wt.isHeaders(a))for(const[V,o]of a.entries())M(o,V,m);else a!=null&&M(h,a,m);return this}get(a,h){if(a=l0(a),a){const m=wt.findKey(this,a);if(m){const b=this[m];if(!h)return b;if(h===!0)return D6(b);if(wt.isFunction(h))return h.call(this,b,m);if(wt.isRegExp(h))return h.exec(b);throw new TypeError("parser must be boolean|regexp|function")}}}has(a,h){if(a=l0(a),a){const m=wt.findKey(this,a);return!!(m&&this[m]!==void 0&&(!h||p3(this,this[m],m,h)))}return!1}delete(a,h){const m=this;let b=!1;function M(P){if(P=l0(P),P){const V=wt.findKey(m,P);V&&(!h||p3(m,m[V],V,h))&&(delete m[V],b=!0)}}return wt.isArray(a)?a.forEach(M):M(a),b}clear(a){const h=Object.keys(this);let m=h.length,b=!1;for(;m--;){const M=h[m];(!a||p3(this,this[M],M,a,!0))&&(delete this[M],b=!0)}return b}normalize(a){const h=this,m={};return wt.forEach(this,(b,M)=>{const P=wt.findKey(m,M);if(P){h[P]=Pv(b),delete h[M];return}const V=a?k6(M):String(M).trim();V!==M&&delete h[M],h[V]=Pv(b),m[V]=!0}),this}concat(...a){return this.constructor.concat(this,...a)}toJSON(a){const h=Object.create(null);return wt.forEach(this,(m,b)=>{m!=null&&m!==!1&&(h[b]=a&&wt.isArray(m)?m.join(", "):m)}),h}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([a,h])=>a+": "+h).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(a){return a instanceof this?a:new this(a)}static concat(a,...h){const m=new this(a);return h.forEach(b=>m.set(b)),m}static accessor(a){const m=(this[LI]=this[LI]={accessors:{}}).accessors,b=this.prototype;function M(P){const V=l0(P);m[V]||(O6(b,P),m[V]=!0)}return wt.isArray(a)?a.forEach(M):M(a),this}}ha.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);wt.reduceDescriptors(ha.prototype,({value:r},a)=>{let h=a[0].toUpperCase()+a.slice(1);return{get:()=>r,set(m){this[h]=m}}});wt.freezeMethods(ha);function m3(r,a){const h=this||rx,m=a||h,b=ha.from(m.headers);let M=m.data;return wt.forEach(r,function(V){M=V.call(h,M,b.normalize(),a?a.status:void 0)}),b.normalize(),M}function k4(r){return!!(r&&r.__CANCEL__)}function Tg(r,a,h){sr.call(this,r??"canceled",sr.ERR_CANCELED,a,h),this.name="CanceledError"}wt.inherits(Tg,sr,{__CANCEL__:!0});function O4(r,a,h){const m=h.config.validateStatus;!h.status||!m||m(h.status)?r(h):a(new sr("Request failed with status code "+h.status,[sr.ERR_BAD_REQUEST,sr.ERR_BAD_RESPONSE][Math.floor(h.status/100)-4],h.config,h.request,h))}function B6(r){const a=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return a&&a[1]||""}function F6(r,a){r=r||10;const h=new Array(r),m=new Array(r);let b=0,M=0,P;return a=a!==void 0?a:1e3,function(o){const q=Date.now(),J=m[M];P||(P=q),h[b]=o,m[b]=q;let Q=M,ae=0;for(;Q!==b;)ae+=h[Q++],Q=Q%r;if(b=(b+1)%r,b===M&&(M=(M+1)%r),q-P<a)return;const xe=J&&q-J;return xe?Math.round(ae*1e3/xe):void 0}}function N6(r,a){let h=0;const m=1e3/a;let b=null;return function(){const P=this===!0,V=Date.now();if(P||V-h>m)return b&&(clearTimeout(b),b=null),h=V,r.apply(null,arguments);b||(b=setTimeout(()=>(b=null,h=Date.now(),r.apply(null,arguments)),m-(V-h)))}}const ow=(r,a,h=3)=>{let m=0;const b=F6(50,250);return N6(M=>{const P=M.loaded,V=M.lengthComputable?M.total:void 0,o=P-m,q=b(o),J=P<=V;m=P;const Q={loaded:P,total:V,progress:V?P/V:void 0,bytes:o,rate:q||void 0,estimated:q&&V&&J?(V-P)/q:void 0,event:M,lengthComputable:V!=null};Q[a?"download":"upload"]=!0,r(Q)},h)},V6=Iu.hasStandardBrowserEnv?function(){const a=/(msie|trident)/i.test(navigator.userAgent),h=document.createElement("a");let m;function b(M){let P=M;return a&&(h.setAttribute("href",P),P=h.href),h.setAttribute("href",P),{href:h.href,protocol:h.protocol?h.protocol.replace(/:$/,""):"",host:h.host,search:h.search?h.search.replace(/^\?/,""):"",hash:h.hash?h.hash.replace(/^#/,""):"",hostname:h.hostname,port:h.port,pathname:h.pathname.charAt(0)==="/"?h.pathname:"/"+h.pathname}}return m=b(window.location.href),function(P){const V=wt.isString(P)?b(P):P;return V.protocol===m.protocol&&V.host===m.host}}():function(){return function(){return!0}}(),U6=Iu.hasStandardBrowserEnv?{write(r,a,h,m,b,M){const P=[r+"="+encodeURIComponent(a)];wt.isNumber(h)&&P.push("expires="+new Date(h).toGMTString()),wt.isString(m)&&P.push("path="+m),wt.isString(b)&&P.push("domain="+b),M===!0&&P.push("secure"),document.cookie=P.join("; ")},read(r){const a=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return a?decodeURIComponent(a[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function j6(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function G6(r,a){return a?r.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):r}function B4(r,a){return r&&!j6(a)?G6(r,a):a}const DI=r=>r instanceof ha?{...r}:r;function Lm(r,a){a=a||{};const h={};function m(q,J,Q){return wt.isPlainObject(q)&&wt.isPlainObject(J)?wt.merge.call({caseless:Q},q,J):wt.isPlainObject(J)?wt.merge({},J):wt.isArray(J)?J.slice():J}function b(q,J,Q){if(wt.isUndefined(J)){if(!wt.isUndefined(q))return m(void 0,q,Q)}else return m(q,J,Q)}function M(q,J){if(!wt.isUndefined(J))return m(void 0,J)}function P(q,J){if(wt.isUndefined(J)){if(!wt.isUndefined(q))return m(void 0,q)}else return m(void 0,J)}function V(q,J,Q){if(Q in a)return m(q,J);if(Q in r)return m(void 0,q)}const o={url:M,method:M,data:M,baseURL:P,transformRequest:P,transformResponse:P,paramsSerializer:P,timeout:P,timeoutMessage:P,withCredentials:P,withXSRFToken:P,adapter:P,responseType:P,xsrfCookieName:P,xsrfHeaderName:P,onUploadProgress:P,onDownloadProgress:P,decompress:P,maxContentLength:P,maxBodyLength:P,beforeRedirect:P,transport:P,httpAgent:P,httpsAgent:P,cancelToken:P,socketPath:P,responseEncoding:P,validateStatus:V,headers:(q,J)=>b(DI(q),DI(J),!0)};return wt.forEach(Object.keys(Object.assign({},r,a)),function(J){const Q=o[J]||b,ae=Q(r[J],a[J],J);wt.isUndefined(ae)&&Q!==V||(h[J]=ae)}),h}const F4=r=>{const a=Lm({},r);let{data:h,withXSRFToken:m,xsrfHeaderName:b,xsrfCookieName:M,headers:P,auth:V}=a;a.headers=P=ha.from(P),a.url=L4(B4(a.baseURL,a.url),r.params,r.paramsSerializer),V&&P.set("Authorization","Basic "+btoa((V.username||"")+":"+(V.password?unescape(encodeURIComponent(V.password)):"")));let o;if(wt.isFormData(h)){if(Iu.hasStandardBrowserEnv||Iu.hasStandardBrowserWebWorkerEnv)P.setContentType(void 0);else if((o=P.getContentType())!==!1){const[q,...J]=o?o.split(";").map(Q=>Q.trim()).filter(Boolean):[];P.setContentType([q||"multipart/form-data",...J].join("; "))}}if(Iu.hasStandardBrowserEnv&&(m&&wt.isFunction(m)&&(m=m(a)),m||m!==!1&&V6(a.url))){const q=b&&M&&U6.read(M);q&&P.set(b,q)}return a},W6=typeof XMLHttpRequest<"u",$6=W6&&function(r){return new Promise(function(h,m){const b=F4(r);let M=b.data;const P=ha.from(b.headers).normalize();let{responseType:V}=b,o;function q(){b.cancelToken&&b.cancelToken.unsubscribe(o),b.signal&&b.signal.removeEventListener("abort",o)}let J=new XMLHttpRequest;J.open(b.method.toUpperCase(),b.url,!0),J.timeout=b.timeout;function Q(){if(!J)return;const xe=ha.from("getAllResponseHeaders"in J&&J.getAllResponseHeaders()),Ue={data:!V||V==="text"||V==="json"?J.responseText:J.response,status:J.status,statusText:J.statusText,headers:xe,config:r,request:J};O4(function(Te){h(Te),q()},function(Te){m(Te),q()},Ue),J=null}"onloadend"in J?J.onloadend=Q:J.onreadystatechange=function(){!J||J.readyState!==4||J.status===0&&!(J.responseURL&&J.responseURL.indexOf("file:")===0)||setTimeout(Q)},J.onabort=function(){J&&(m(new sr("Request aborted",sr.ECONNABORTED,b,J)),J=null)},J.onerror=function(){m(new sr("Network Error",sr.ERR_NETWORK,b,J)),J=null},J.ontimeout=function(){let Re=b.timeout?"timeout of "+b.timeout+"ms exceeded":"timeout exceeded";const Ue=b.transitional||D4;b.timeoutErrorMessage&&(Re=b.timeoutErrorMessage),m(new sr(Re,Ue.clarifyTimeoutError?sr.ETIMEDOUT:sr.ECONNABORTED,b,J)),J=null},M===void 0&&P.setContentType(null),"setRequestHeader"in J&&wt.forEach(P.toJSON(),function(Re,Ue){J.setRequestHeader(Ue,Re)}),wt.isUndefined(b.withCredentials)||(J.withCredentials=!!b.withCredentials),V&&V!=="json"&&(J.responseType=b.responseType),typeof b.onDownloadProgress=="function"&&J.addEventListener("progress",ow(b.onDownloadProgress,!0)),typeof b.onUploadProgress=="function"&&J.upload&&J.upload.addEventListener("progress",ow(b.onUploadProgress)),(b.cancelToken||b.signal)&&(o=xe=>{J&&(m(!xe||xe.type?new Tg(null,r,J):xe),J.abort(),J=null)},b.cancelToken&&b.cancelToken.subscribe(o),b.signal&&(b.signal.aborted?o():b.signal.addEventListener("abort",o)));const ae=B6(b.url);if(ae&&Iu.protocols.indexOf(ae)===-1){m(new sr("Unsupported protocol "+ae+":",sr.ERR_BAD_REQUEST,r));return}J.send(M||null)})},q6=(r,a)=>{let h=new AbortController,m;const b=function(o){if(!m){m=!0,P();const q=o instanceof Error?o:this.reason;h.abort(q instanceof sr?q:new Tg(q instanceof Error?q.message:q))}};let M=a&&setTimeout(()=>{b(new sr(`timeout ${a} of ms exceeded`,sr.ETIMEDOUT))},a);const P=()=>{r&&(M&&clearTimeout(M),M=null,r.forEach(o=>{o&&(o.removeEventListener?o.removeEventListener("abort",b):o.unsubscribe(b))}),r=null)};r.forEach(o=>o&&o.addEventListener&&o.addEventListener("abort",b));const{signal:V}=h;return V.unsubscribe=P,[V,()=>{M&&clearTimeout(M),M=null}]},H6=function*(r,a){let h=r.byteLength;if(!a||h<a){yield r;return}let m=0,b;for(;m<h;)b=m+a,yield r.slice(m,b),m=b},Z6=async function*(r,a,h){for await(const m of r)yield*H6(ArrayBuffer.isView(m)?m:await h(String(m)),a)},zI=(r,a,h,m,b)=>{const M=Z6(r,a,b);let P=0;return new ReadableStream({type:"bytes",async pull(V){const{done:o,value:q}=await M.next();if(o){V.close(),m();return}let J=q.byteLength;h&&h(P+=J),V.enqueue(new Uint8Array(q))},cancel(V){return m(V),M.return()}},{highWaterMark:2})},kI=(r,a)=>{const h=r!=null;return m=>setTimeout(()=>a({lengthComputable:h,total:r,loaded:m}))},Ow=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",N4=Ow&&typeof ReadableStream=="function",ES=Ow&&(typeof TextEncoder=="function"?(r=>a=>r.encode(a))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),X6=N4&&(()=>{let r=!1;const a=new Request(Iu.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!a})(),OI=64*1024,CS=N4&&!!(()=>{try{return wt.isReadableStream(new Response("").body)}catch{}})(),aw={stream:CS&&(r=>r.body)};Ow&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(a=>{!aw[a]&&(aw[a]=wt.isFunction(r[a])?h=>h[a]():(h,m)=>{throw new sr(`Response type '${a}' is not supported`,sr.ERR_NOT_SUPPORT,m)})})})(new Response);const Y6=async r=>{if(r==null)return 0;if(wt.isBlob(r))return r.size;if(wt.isSpecCompliantForm(r))return(await new Request(r).arrayBuffer()).byteLength;if(wt.isArrayBufferView(r))return r.byteLength;if(wt.isURLSearchParams(r)&&(r=r+""),wt.isString(r))return(await ES(r)).byteLength},K6=async(r,a)=>{const h=wt.toFiniteNumber(r.getContentLength());return h??Y6(a)},J6=Ow&&(async r=>{let{url:a,method:h,data:m,signal:b,cancelToken:M,timeout:P,onDownloadProgress:V,onUploadProgress:o,responseType:q,headers:J,withCredentials:Q="same-origin",fetchOptions:ae}=F4(r);q=q?(q+"").toLowerCase():"text";let[xe,Re]=b||M||P?q6([b,M],P):[],Ue,Tt;const Te=()=>{!Ue&&setTimeout(()=>{xe&&xe.unsubscribe()}),Ue=!0};let Ee;try{if(o&&X6&&h!=="get"&&h!=="head"&&(Ee=await K6(J,m))!==0){let Ct=new Request(a,{method:"POST",body:m,duplex:"half"}),Ot;wt.isFormData(m)&&(Ot=Ct.headers.get("content-type"))&&J.setContentType(Ot),Ct.body&&(m=zI(Ct.body,OI,kI(Ee,ow(o)),null,ES))}wt.isString(Q)||(Q=Q?"cors":"omit"),Tt=new Request(a,{...ae,signal:xe,method:h.toUpperCase(),headers:J.normalize().toJSON(),body:m,duplex:"half",withCredentials:Q});let Me=await fetch(Tt);const et=CS&&(q==="stream"||q==="response");if(CS&&(V||et)){const Ct={};["status","statusText","headers"].forEach(zt=>{Ct[zt]=Me[zt]});const Ot=wt.toFiniteNumber(Me.headers.get("content-length"));Me=new Response(zI(Me.body,OI,V&&kI(Ot,ow(V,!0)),et&&Te,ES),Ct)}q=q||"text";let pt=await aw[wt.findKey(aw,q)||"text"](Me,r);return!et&&Te(),Re&&Re(),await new Promise((Ct,Ot)=>{O4(Ct,Ot,{data:pt,headers:ha.from(Me.headers),status:Me.status,statusText:Me.statusText,config:r,request:Tt})})}catch(Me){throw Te(),Me&&Me.name==="TypeError"&&/fetch/i.test(Me.message)?Object.assign(new sr("Network Error",sr.ERR_NETWORK,r,Tt),{cause:Me.cause||Me}):sr.from(Me,Me&&Me.code,r,Tt)}}),AS={http:m6,xhr:$6,fetch:J6};wt.forEach(AS,(r,a)=>{if(r){try{Object.defineProperty(r,"name",{value:a})}catch{}Object.defineProperty(r,"adapterName",{value:a})}});const BI=r=>`- ${r}`,Q6=r=>wt.isFunction(r)||r===null||r===!1,V4={getAdapter:r=>{r=wt.isArray(r)?r:[r];const{length:a}=r;let h,m;const b={};for(let M=0;M<a;M++){h=r[M];let P;if(m=h,!Q6(h)&&(m=AS[(P=String(h)).toLowerCase()],m===void 0))throw new sr(`Unknown adapter '${P}'`);if(m)break;b[P||"#"+M]=m}if(!m){const M=Object.entries(b).map(([V,o])=>`adapter ${V} `+(o===!1?"is not supported by the environment":"is not available in the build"));let P=a?M.length>1?`since :
`+M.map(BI).join(`
`):" "+BI(M[0]):"as no adapter specified";throw new sr("There is no suitable adapter to dispatch the request "+P,"ERR_NOT_SUPPORT")}return m},adapters:AS};function _3(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Tg(null,r)}function FI(r){return _3(r),r.headers=ha.from(r.headers),r.data=m3.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),V4.getAdapter(r.adapter||rx.adapter)(r).then(function(m){return _3(r),m.data=m3.call(r,r.transformResponse,m),m.headers=ha.from(m.headers),m},function(m){return k4(m)||(_3(r),m&&m.response&&(m.response.data=m3.call(r,r.transformResponse,m.response),m.response.headers=ha.from(m.response.headers))),Promise.reject(m)})}const U4="1.7.2",WE={};["object","boolean","number","function","string","symbol"].forEach((r,a)=>{WE[r]=function(m){return typeof m===r||"a"+(a<1?"n ":" ")+r}});const NI={};WE.transitional=function(a,h,m){function b(M,P){return"[Axios v"+U4+"] Transitional option '"+M+"'"+P+(m?". "+m:"")}return(M,P,V)=>{if(a===!1)throw new sr(b(P," has been removed"+(h?" in "+h:"")),sr.ERR_DEPRECATED);return h&&!NI[P]&&(NI[P]=!0,console.warn(b(P," has been deprecated since v"+h+" and will be removed in the near future"))),a?a(M,P,V):!0}};function eN(r,a,h){if(typeof r!="object")throw new sr("options must be an object",sr.ERR_BAD_OPTION_VALUE);const m=Object.keys(r);let b=m.length;for(;b-- >0;){const M=m[b],P=a[M];if(P){const V=r[M],o=V===void 0||P(V,M,r);if(o!==!0)throw new sr("option "+M+" must be "+o,sr.ERR_BAD_OPTION_VALUE);continue}if(h!==!0)throw new sr("Unknown option "+M,sr.ERR_BAD_OPTION)}}const MS={assertOptions:eN,validators:WE},Af=MS.validators;class Em{constructor(a){this.defaults=a,this.interceptors={request:new RI,response:new RI}}async request(a,h){try{return await this._request(a,h)}catch(m){if(m instanceof Error){let b;Error.captureStackTrace?Error.captureStackTrace(b={}):b=new Error;const M=b.stack?b.stack.replace(/^.+\n/,""):"";try{m.stack?M&&!String(m.stack).endsWith(M.replace(/^.+\n.+\n/,""))&&(m.stack+=`
`+M):m.stack=M}catch{}}throw m}}_request(a,h){typeof a=="string"?(h=h||{},h.url=a):h=a||{},h=Lm(this.defaults,h);const{transitional:m,paramsSerializer:b,headers:M}=h;m!==void 0&&MS.assertOptions(m,{silentJSONParsing:Af.transitional(Af.boolean),forcedJSONParsing:Af.transitional(Af.boolean),clarifyTimeoutError:Af.transitional(Af.boolean)},!1),b!=null&&(wt.isFunction(b)?h.paramsSerializer={serialize:b}:MS.assertOptions(b,{encode:Af.function,serialize:Af.function},!0)),h.method=(h.method||this.defaults.method||"get").toLowerCase();let P=M&&wt.merge(M.common,M[h.method]);M&&wt.forEach(["delete","get","head","post","put","patch","common"],Re=>{delete M[Re]}),h.headers=ha.concat(P,M);const V=[];let o=!0;this.interceptors.request.forEach(function(Ue){typeof Ue.runWhen=="function"&&Ue.runWhen(h)===!1||(o=o&&Ue.synchronous,V.unshift(Ue.fulfilled,Ue.rejected))});const q=[];this.interceptors.response.forEach(function(Ue){q.push(Ue.fulfilled,Ue.rejected)});let J,Q=0,ae;if(!o){const Re=[FI.bind(this),void 0];for(Re.unshift.apply(Re,V),Re.push.apply(Re,q),ae=Re.length,J=Promise.resolve(h);Q<ae;)J=J.then(Re[Q++],Re[Q++]);return J}ae=V.length;let xe=h;for(Q=0;Q<ae;){const Re=V[Q++],Ue=V[Q++];try{xe=Re(xe)}catch(Tt){Ue.call(this,Tt);break}}try{J=FI.call(this,xe)}catch(Re){return Promise.reject(Re)}for(Q=0,ae=q.length;Q<ae;)J=J.then(q[Q++],q[Q++]);return J}getUri(a){a=Lm(this.defaults,a);const h=B4(a.baseURL,a.url);return L4(h,a.params,a.paramsSerializer)}}wt.forEach(["delete","get","head","options"],function(a){Em.prototype[a]=function(h,m){return this.request(Lm(m||{},{method:a,url:h,data:(m||{}).data}))}});wt.forEach(["post","put","patch"],function(a){function h(m){return function(M,P,V){return this.request(Lm(V||{},{method:a,headers:m?{"Content-Type":"multipart/form-data"}:{},url:M,data:P}))}}Em.prototype[a]=h(),Em.prototype[a+"Form"]=h(!0)});class $E{constructor(a){if(typeof a!="function")throw new TypeError("executor must be a function.");let h;this.promise=new Promise(function(M){h=M});const m=this;this.promise.then(b=>{if(!m._listeners)return;let M=m._listeners.length;for(;M-- >0;)m._listeners[M](b);m._listeners=null}),this.promise.then=b=>{let M;const P=new Promise(V=>{m.subscribe(V),M=V}).then(b);return P.cancel=function(){m.unsubscribe(M)},P},a(function(M,P,V){m.reason||(m.reason=new Tg(M,P,V),h(m.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(a){if(this.reason){a(this.reason);return}this._listeners?this._listeners.push(a):this._listeners=[a]}unsubscribe(a){if(!this._listeners)return;const h=this._listeners.indexOf(a);h!==-1&&this._listeners.splice(h,1)}static source(){let a;return{token:new $E(function(b){a=b}),cancel:a}}}function tN(r){return function(h){return r.apply(null,h)}}function nN(r){return wt.isObject(r)&&r.isAxiosError===!0}const IS={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(IS).forEach(([r,a])=>{IS[a]=r});function j4(r){const a=new Em(r),h=v4(Em.prototype.request,a);return wt.extend(h,Em.prototype,a,{allOwnKeys:!0}),wt.extend(h,a,null,{allOwnKeys:!0}),h.create=function(b){return j4(Lm(r,b))},h}const ns=j4(rx);ns.Axios=Em;ns.CanceledError=Tg;ns.CancelToken=$E;ns.isCancel=k4;ns.VERSION=U4;ns.toFormData=kw;ns.AxiosError=sr;ns.Cancel=ns.CanceledError;ns.all=function(a){return Promise.all(a)};ns.spread=tN;ns.isAxiosError=nN;ns.mergeConfig=Lm;ns.AxiosHeaders=ha;ns.formToJSON=r=>z4(wt.isHTMLForm(r)?new FormData(r):r);ns.getAdapter=V4.getAdapter;ns.HttpStatusCode=IS;ns.default=ns;const Rv=ns.create({baseURL:SF,timeout:15e3});function rN(){return at.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[at.jsx("rect",{width:"20",height:"20",rx:"10",fill:"#DBDBDB"}),at.jsx("path",{d:"M14.2468 13.6278C14.2874 13.6684 14.3197 13.7167 14.3417 13.7698C14.3637 13.8229 14.375 13.8798 14.375 13.9373C14.375 13.9948 14.3637 14.0517 14.3417 14.1048C14.3197 14.1579 14.2874 14.2061 14.2468 14.2468C14.2061 14.2874 14.1579 14.3197 14.1048 14.3417C14.0517 14.3637 13.9948 14.375 13.9373 14.375C13.8798 14.375 13.8229 14.3637 13.7698 14.3417C13.7167 14.3197 13.6684 14.2874 13.6278 14.2468L10 10.6185L6.37223 14.2468C6.29014 14.3289 6.17881 14.375 6.06272 14.375C5.94663 14.375 5.83529 14.3289 5.7532 14.2468C5.67112 14.1647 5.625 14.0534 5.625 13.9373C5.625 13.8212 5.67112 13.7099 5.7532 13.6278L9.38152 10L5.7532 6.37223C5.67112 6.29014 5.625 6.17881 5.625 6.06272C5.625 5.94663 5.67112 5.83529 5.7532 5.7532C5.83529 5.67112 5.94663 5.625 6.06272 5.625C6.17881 5.625 6.29014 5.67112 6.37223 5.7532L10 9.38152L13.6278 5.7532C13.7099 5.67112 13.8212 5.625 13.9373 5.625C14.0534 5.625 14.1647 5.67112 14.2468 5.7532C14.3289 5.83529 14.375 5.94663 14.375 6.06272C14.375 6.17881 14.3289 6.29014 14.2468 6.37223L10.6185 10L14.2468 13.6278Z",fill:"white"})]})}function iN(r){const[a,h]=on.useState("");return on.useEffect(()=>{r.onChange&&r.onChange(a)},[a,r]),at.jsxs("div",{className:cd("Input",r.className),children:[at.jsx("input",{...r.inputProps,value:a,onChange:m=>h(m.target.value)}),r.showClearIcon&&a.trim().length>0&&at.jsx("button",{className:"Input__clear",onClick:()=>h(""),"aria-label":"Clear search input",type:"button",children:at.jsx(rN,{})})]})}function sN(){return at.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:at.jsx("g",{children:at.jsx("path",{d:"M11.8091 0.184353C11.6868 0.062109 11.5225 -1.52588e-05 11.3561 -1.52588e-05C11.2559 -1.52588e-05 11.1557 0.0240328 11.0615 0.070125L0.358288 5.42684C0.117767 5.53906 -0.0265457 5.79558 0.00151513 6.06411C0.0195542 6.32664 0.197941 6.55309 0.446479 6.63125L4.32689 7.8557L5.55956 11.5531C5.63973 11.8136 5.87224 11.984 6.1328 12C6.13681 12 6.14082 12 6.14683 12H6.1789C6.42744 12 6.65393 11.8557 6.76216 11.6393L11.9334 0.929844C12.0616 0.673331 11.9995 0.374734 11.8091 0.184353Z",fill:"currentColor"})})})}const oN=on.forwardRef((r,a)=>{const h=po("SEARCH_BOX_HELPER"),m=ts(M=>M.searchStatus),b=()=>{navigator.geolocation.getCurrentPosition(M=>{const{latitude:P,longitude:V}=M.coords;r.cb&&r.cb({lat:P,lng:V})},M=>console.error(M))};return at.jsx("div",{className:cd("SearchBoxHelper",r.className),ref:a,children:at.jsxs("button",{className:"SearchBoxHelper__btn",onClick:b,disabled:m==="in-progress",children:[at.jsx("span",{className:"SearchBoxHelper__btn-icon",children:at.jsx(sN,{})}),at.jsx("span",{className:"SearchBoxHelper__btn-label",children:h})]})})}),G4=on.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"}),Bw=on.createContext({}),qE=on.createContext(null),HE=typeof document<"u",aN=HE?on.useLayoutEffect:on.useEffect,W4=on.createContext({strict:!1}),Fw=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),lN="framerAppearId",$4="data-"+Fw(lN),uN={skipAnimations:!1,useManualTiming:!1};class VI{constructor(){this.order=[],this.scheduled=new Set}add(a){if(!this.scheduled.has(a))return this.scheduled.add(a),this.order.push(a),!0}remove(a){const h=this.order.indexOf(a);h!==-1&&(this.order.splice(h,1),this.scheduled.delete(a))}clear(){this.order.length=0,this.scheduled.clear()}}function cN(r){let a=new VI,h=new VI,m=0,b=!1,M=!1;const P=new WeakSet,V={schedule:(o,q=!1,J=!1)=>{const Q=J&&b,ae=Q?a:h;return q&&P.add(o),ae.add(o)&&Q&&b&&(m=a.order.length),o},cancel:o=>{h.remove(o),P.delete(o)},process:o=>{if(b){M=!0;return}if(b=!0,[a,h]=[h,a],h.clear(),m=a.order.length,m)for(let q=0;q<m;q++){const J=a.order[q];P.has(J)&&(V.schedule(J),r()),J(o)}b=!1,M&&(M=!1,V.process(o))}};return V}const fv=["read","resolveKeyframes","update","preRender","render","postRender"],hN=40;function q4(r,a){let h=!1,m=!0;const b={delta:0,timestamp:0,isProcessing:!1},M=()=>h=!0,P=fv.reduce((Te,Ee)=>(Te[Ee]=cN(M),Te),{}),{read:V,resolveKeyframes:o,update:q,preRender:J,render:Q,postRender:ae}=P,xe=()=>{const Te=performance.now();h=!1,b.delta=m?1e3/60:Math.max(Math.min(Te-b.timestamp,hN),1),b.timestamp=Te,b.isProcessing=!0,V.process(b),o.process(b),q.process(b),J.process(b),Q.process(b),ae.process(b),b.isProcessing=!1,h&&a&&(m=!1,r(xe))},Re=()=>{h=!0,m=!0,b.isProcessing||r(xe)};return{schedule:fv.reduce((Te,Ee)=>{const Me=P[Ee];return Te[Ee]=(et,pt=!1,Ct=!1)=>(h||Re(),Me.schedule(et,pt,Ct)),Te},{}),cancel:Te=>{for(let Ee=0;Ee<fv.length;Ee++)P[fv[Ee]].cancel(Te)},state:b,steps:P}}const{schedule:ZE,cancel:P7}=q4(queueMicrotask,!1);function Q_(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}const H4=on.createContext({});let UI=!1;function dN(r,a,h,m,b){const{visualElement:M}=on.useContext(Bw),P=on.useContext(W4),V=on.useContext(qE),o=on.useContext(G4).reducedMotion,q=on.useRef();m=m||P.renderer,!q.current&&m&&(q.current=m(r,{visualState:a,parent:M,props:h,presenceContext:V,blockInitialAnimation:V?V.initial===!1:!1,reducedMotionConfig:o}));const J=q.current,Q=on.useContext(H4);J&&!J.projection&&b&&(J.type==="html"||J.type==="svg")&&pN(q.current,h,b,Q),on.useInsertionEffect(()=>{J&&J.update(h,V)});const ae=on.useRef(!!(h[$4]&&!window.HandoffComplete));return aN(()=>{J&&(J.updateFeatures(),ZE.render(J.render),ae.current&&J.animationState&&J.animationState.animateChanges())}),on.useEffect(()=>{J&&(!ae.current&&J.animationState&&J.animationState.animateChanges(),ae.current&&(ae.current=!1,UI||(UI=!0,queueMicrotask(fN))))}),J}function fN(){window.HandoffComplete=!0}function pN(r,a,h,m){const{layoutId:b,layout:M,drag:P,dragConstraints:V,layoutScroll:o,layoutRoot:q}=a;r.projection=new h(r.latestValues,a["data-framer-portal-id"]?void 0:Z4(r.parent)),r.projection.setOptions({layoutId:b,layout:M,alwaysMeasureLayout:!!P||V&&Q_(V),visualElement:r,scheduleRender:()=>r.scheduleRender(),animationType:typeof M=="string"?M:"both",initialPromotionConfig:m,layoutScroll:o,layoutRoot:q})}function Z4(r){if(r)return r.options.allowProjection!==!1?r.projection:Z4(r.parent)}function mN(r,a,h){return on.useCallback(m=>{m&&r.mount&&r.mount(m),a&&(m?a.mount(m):a.unmount()),h&&(typeof h=="function"?h(m):Q_(h)&&(h.current=m))},[a])}function q0(r){return typeof r=="string"||Array.isArray(r)}function H0(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}const XE=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],YE=["initial",...XE];function Nw(r){return H0(r.animate)||YE.some(a=>q0(r[a]))}function X4(r){return!!(Nw(r)||r.variants)}function _N(r,a){if(Nw(r)){const{initial:h,animate:m}=r;return{initial:h===!1||q0(h)?h:void 0,animate:q0(m)?m:void 0}}return r.inherit!==!1?a:{}}function gN(r){const{initial:a,animate:h}=_N(r,on.useContext(Bw));return on.useMemo(()=>({initial:a,animate:h}),[jI(a),jI(h)])}function jI(r){return Array.isArray(r)?r.join(" "):r}const GI={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},gg={};for(const r in GI)gg[r]={isEnabled:a=>GI[r].some(h=>!!a[h])};function yN(r){for(const a in r)gg[a]={...gg[a],...r[a]}}const Y4=on.createContext({}),xN=Symbol.for("motionComponentSymbol"),go=r=>r;let PS=go;function vN({preloadedFeatures:r,createVisualElement:a,useRender:h,useVisualState:m,Component:b}){r&&yN(r);function M(V,o){let q;const J={...on.useContext(G4),...V,layoutId:wN(V)},{isStatic:Q}=J,ae=gN(V),xe=m(V,Q);if(!Q&&HE){bN();const Re=TN(J);q=Re.MeasureLayout,ae.visualElement=dN(b,xe,J,a,Re.ProjectionNode)}return at.jsxs(Bw.Provider,{value:ae,children:[q&&ae.visualElement?at.jsx(q,{visualElement:ae.visualElement,...J}):null,h(b,V,mN(xe,ae.visualElement,o),xe,Q,ae.visualElement)]})}const P=on.forwardRef(M);return P[xN]=b,P}function wN({layoutId:r}){const a=on.useContext(Y4).id;return a&&r!==void 0?a+"-"+r:r}function bN(r,a){on.useContext(W4).strict}function TN(r){const{drag:a,layout:h}=gg;if(!a&&!h)return{};const m={...a,...h};return{MeasureLayout:a!=null&&a.isEnabled(r)||h!=null&&h.isEnabled(r)?m.MeasureLayout:void 0,ProjectionNode:m.ProjectionNode}}function SN(r){function a(m,b={}){return vN(r(m,b))}if(typeof Proxy>"u")return a;const h=new Map;return new Proxy(a,{get:(m,b)=>(h.has(b)||h.set(b,a(b)),h.get(b))})}const EN=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function KE(r){return typeof r!="string"||r.includes("-")?!1:!!(EN.indexOf(r)>-1||/[A-Z]/u.test(r))}const lw={};function CN(r){Object.assign(lw,r)}const ix=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Qf=new Set(ix);function K4(r,{layout:a,layoutId:h}){return Qf.has(r)||r.startsWith("origin")||(a||h!==void 0)&&(!!lw[r]||r==="opacity")}const _o=r=>!!(r&&r.getVelocity),AN={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},MN=ix.length;function IN(r,a,h){let m="";for(let b=0;b<MN;b++){const M=ix[b];if(r[M]!==void 0){const P=AN[M]||M;m+=`${P}(${r[M]}) `}}return m=m.trim(),h?m=h(r,a?"":m):a&&(m="none"),m}const J4=r=>a=>typeof a=="string"&&a.startsWith(r),Q4=J4("--"),PN=J4("var(--"),JE=r=>PN(r)?RN.test(r.split("/*")[0].trim()):!1,RN=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,LN=(r,a)=>a&&typeof r=="number"?a.transform(r):r,Zf=(r,a,h)=>h>a?a:h<r?r:h,Sg={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},S0={...Sg,transform:r=>Zf(0,1,r)},pv={...Sg,default:1},E0=r=>Math.round(r*1e5)/1e5,QE=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,DN=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,zN=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function sx(r){return typeof r=="string"}function kN(r){return r==null}const ox=r=>({test:a=>sx(a)&&a.endsWith(r)&&a.split(" ").length===1,parse:parseFloat,transform:a=>`${a}${r}`}),Mf=ox("deg"),Zc=ox("%"),Bn=ox("px"),ON=ox("vh"),BN=ox("vw"),WI={...Zc,parse:r=>Zc.parse(r)/100,transform:r=>Zc.transform(r*100)},$I={...Sg,transform:Math.round},eD={borderWidth:Bn,borderTopWidth:Bn,borderRightWidth:Bn,borderBottomWidth:Bn,borderLeftWidth:Bn,borderRadius:Bn,radius:Bn,borderTopLeftRadius:Bn,borderTopRightRadius:Bn,borderBottomRightRadius:Bn,borderBottomLeftRadius:Bn,width:Bn,maxWidth:Bn,height:Bn,maxHeight:Bn,size:Bn,top:Bn,right:Bn,bottom:Bn,left:Bn,padding:Bn,paddingTop:Bn,paddingRight:Bn,paddingBottom:Bn,paddingLeft:Bn,margin:Bn,marginTop:Bn,marginRight:Bn,marginBottom:Bn,marginLeft:Bn,rotate:Mf,rotateX:Mf,rotateY:Mf,rotateZ:Mf,scale:pv,scaleX:pv,scaleY:pv,scaleZ:pv,skew:Mf,skewX:Mf,skewY:Mf,distance:Bn,translateX:Bn,translateY:Bn,translateZ:Bn,x:Bn,y:Bn,z:Bn,perspective:Bn,transformPerspective:Bn,opacity:S0,originX:WI,originY:WI,originZ:Bn,zIndex:$I,backgroundPositionX:Bn,backgroundPositionY:Bn,fillOpacity:S0,strokeOpacity:S0,numOctaves:$I};function eC(r,a,h){const{style:m,vars:b,transform:M,transformOrigin:P}=r;let V=!1,o=!1,q=!0;for(const J in a){const Q=a[J];if(Q4(J)){b[J]=Q;continue}const ae=eD[J],xe=LN(Q,ae);if(Qf.has(J)){if(V=!0,M[J]=xe,!q)continue;Q!==(ae.default||0)&&(q=!1)}else J.startsWith("origin")?(o=!0,P[J]=xe):m[J]=xe}if(a.transform||(V||h?m.transform=IN(r.transform,q,h):m.transform&&(m.transform="none")),o){const{originX:J="50%",originY:Q="50%",originZ:ae=0}=P;m.transformOrigin=`${J} ${Q} ${ae}`}}const tC=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function tD(r,a,h){for(const m in a)!_o(a[m])&&!K4(m,h)&&(r[m]=a[m])}function FN({transformTemplate:r},a){return on.useMemo(()=>{const h=tC();return eC(h,a,r),Object.assign({},h.vars,h.style)},[a])}function NN(r,a){const h=r.style||{},m={};return tD(m,h,r),Object.assign(m,FN(r,a)),m}function VN(r,a){const h={},m=NN(r,a);return r.drag&&r.dragListener!==!1&&(h.draggable=!1,m.userSelect=m.WebkitUserSelect=m.WebkitTouchCallout="none",m.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(h.tabIndex=0),h.style=m,h}const UN=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function uw(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||UN.has(r)}let nD=r=>!uw(r);function jN(r){r&&(nD=a=>a.startsWith("on")?!uw(a):r(a))}try{jN(require("@emotion/is-prop-valid").default)}catch{}function GN(r,a,h){const m={};for(const b in r)b==="values"&&typeof r.values=="object"||(nD(b)||h===!0&&uw(b)||!a&&!uw(b)||r.draggable&&b.startsWith("onDrag"))&&(m[b]=r[b]);return m}function qI(r,a,h){return typeof r=="string"?r:Bn.transform(a+h*r)}function WN(r,a,h){const m=qI(a,r.x,r.width),b=qI(h,r.y,r.height);return`${m} ${b}`}const $N={offset:"stroke-dashoffset",array:"stroke-dasharray"},qN={offset:"strokeDashoffset",array:"strokeDasharray"};function HN(r,a,h=1,m=0,b=!0){r.pathLength=1;const M=b?$N:qN;r[M.offset]=Bn.transform(-m);const P=Bn.transform(a),V=Bn.transform(h);r[M.array]=`${P} ${V}`}function nC(r,{attrX:a,attrY:h,attrScale:m,originX:b,originY:M,pathLength:P,pathSpacing:V=1,pathOffset:o=0,...q},J,Q){if(eC(r,q,Q),J){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:ae,style:xe,dimensions:Re}=r;ae.transform&&(Re&&(xe.transform=ae.transform),delete ae.transform),Re&&(b!==void 0||M!==void 0||xe.transform)&&(xe.transformOrigin=WN(Re,b!==void 0?b:.5,M!==void 0?M:.5)),a!==void 0&&(ae.x=a),h!==void 0&&(ae.y=h),m!==void 0&&(ae.scale=m),P!==void 0&&HN(ae,P,V,o,!1)}const rD=()=>({...tC(),attrs:{}}),rC=r=>typeof r=="string"&&r.toLowerCase()==="svg";function ZN(r,a,h,m){const b=on.useMemo(()=>{const M=rD();return nC(M,a,rC(m),r.transformTemplate),{...M.attrs,style:{...M.style}}},[a]);if(r.style){const M={};tD(M,r.style,r),b.style={...M,...b.style}}return b}function XN(r=!1){return(h,m,b,{latestValues:M},P)=>{const o=(KE(h)?ZN:VN)(m,M,P,h),q=GN(m,typeof h=="string",r),J=h!==on.Fragment?{...q,...o,ref:b}:{},{children:Q}=m,ae=on.useMemo(()=>_o(Q)?Q.get():Q,[Q]);return on.createElement(h,{...J,children:ae})}}function iD(r,{style:a,vars:h},m,b){Object.assign(r.style,a,b&&b.getProjectionStyles(m));for(const M in h)r.style.setProperty(M,h[M])}const sD=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function oD(r,a,h,m){iD(r,a,void 0,m);for(const b in a.attrs)r.setAttribute(sD.has(b)?b:Fw(b),a.attrs[b])}function iC(r,a,h){var m;const{style:b}=r,M={};for(const P in b)(_o(b[P])||a.style&&_o(a.style[P])||K4(P,r)||((m=h==null?void 0:h.getValue(P))===null||m===void 0?void 0:m.liveStyle)!==void 0)&&(M[P]=b[P]);return h&&b&&typeof b.willChange=="string"&&(h.applyWillChange=!1),M}function aD(r,a,h){const m=iC(r,a,h);for(const b in r)if(_o(r[b])||_o(a[b])){const M=ix.indexOf(b)!==-1?"attr"+b.charAt(0).toUpperCase()+b.substring(1):b;m[M]=r[b]}return m}function HI(r){const a=[{},{}];return r==null||r.values.forEach((h,m)=>{a[0][m]=h.get(),a[1][m]=h.getVelocity()}),a}function sC(r,a,h,m){if(typeof a=="function"){const[b,M]=HI(m);a=a(h!==void 0?h:r.custom,b,M)}if(typeof a=="string"&&(a=r.variants&&r.variants[a]),typeof a=="function"){const[b,M]=HI(m);a=a(h!==void 0?h:r.custom,b,M)}return a}function YN(r){const a=on.useRef(null);return a.current===null&&(a.current=r()),a.current}const RS=r=>Array.isArray(r),KN=r=>!!(r&&typeof r=="object"&&r.mix&&r.toValue),JN=r=>RS(r)?r[r.length-1]||0:r;function Lv(r){const a=_o(r)?r.get():r;return KN(a)?a.toValue():a}const lD=new Set(["opacity","clipPath","filter","transform"]);function uD(r){if(Qf.has(r))return"transform";if(lD.has(r))return Fw(r)}function Vw(r,a){r.indexOf(a)===-1&&r.push(a)}function Uw(r,a){const h=r.indexOf(a);h>-1&&r.splice(h,1)}function QN({applyWillChange:r=!1,scrapeMotionValuesFromProps:a,createRenderState:h,onMount:m},b,M,P,V){const o={latestValues:t8(b,M,P,V?!1:r,a),renderState:h()};return m&&(o.mount=q=>m(b,q,o)),o}const cD=r=>(a,h)=>{const m=on.useContext(Bw),b=on.useContext(qE),M=()=>QN(r,a,m,b,h);return h?M():YN(M)};function e8(r,a){const h=uD(a);h&&Vw(r,h)}function ZI(r,a,h){const m=Array.isArray(a)?a:[a];for(let b=0;b<m.length;b++){const M=sC(r,m[b]);if(M){const{transitionEnd:P,transition:V,...o}=M;h(o,P)}}}function t8(r,a,h,m,b){var M;const P={},V=[],o=m&&((M=r.style)===null||M===void 0?void 0:M.willChange)===void 0,q=b(r,{});for(const Tt in q)P[Tt]=Lv(q[Tt]);let{initial:J,animate:Q}=r;const ae=Nw(r),xe=X4(r);a&&xe&&!ae&&r.inherit!==!1&&(J===void 0&&(J=a.initial),Q===void 0&&(Q=a.animate));let Re=h?h.initial===!1:!1;Re=Re||J===!1;const Ue=Re?Q:J;return Ue&&typeof Ue!="boolean"&&!H0(Ue)&&ZI(r,Ue,(Tt,Te)=>{for(const Ee in Tt){let Me=Tt[Ee];if(Array.isArray(Me)){const et=Re?Me.length-1:0;Me=Me[et]}Me!==null&&(P[Ee]=Me)}for(const Ee in Te)P[Ee]=Te[Ee]}),o&&(Q&&J!==!1&&!H0(Q)&&ZI(r,Q,Tt=>{for(const Te in Tt)e8(V,Te)}),V.length&&(P.willChange=V.join(","))),P}const{schedule:qr,cancel:hd,state:Zs,steps:g3}=q4(typeof requestAnimationFrame<"u"?requestAnimationFrame:go,!0),n8={useVisualState:cD({scrapeMotionValuesFromProps:aD,createRenderState:rD,onMount:(r,a,{renderState:h,latestValues:m})=>{qr.read(()=>{try{h.dimensions=typeof a.getBBox=="function"?a.getBBox():a.getBoundingClientRect()}catch{h.dimensions={x:0,y:0,width:0,height:0}}}),qr.render(()=>{nC(h,m,rC(a.tagName),r.transformTemplate),oD(a,h)})}})},r8={useVisualState:cD({applyWillChange:!0,scrapeMotionValuesFromProps:iC,createRenderState:tC})};function i8(r,{forwardMotionProps:a=!1},h,m){return{...KE(r)?n8:r8,preloadedFeatures:h,useRender:XN(a),createVisualElement:m,Component:r}}function td(r,a,h,m={passive:!0}){return r.addEventListener(a,h,m),()=>r.removeEventListener(a,h)}const hD=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1;function jw(r,a="page"){return{point:{x:r[`${a}X`],y:r[`${a}Y`]}}}const s8=r=>a=>hD(a)&&r(a,jw(a));function rd(r,a,h,m){return td(r,a,s8(h),m)}const o8=(r,a)=>h=>a(r(h)),id=(...r)=>r.reduce(o8);function dD(r){let a=null;return()=>{const h=()=>{a=null};return a===null?(a=r,h):!1}}const XI=dD("dragHorizontal"),YI=dD("dragVertical");function fD(r){let a=!1;if(r==="y")a=YI();else if(r==="x")a=XI();else{const h=XI(),m=YI();h&&m?a=()=>{h(),m()}:(h&&h(),m&&m())}return a}function pD(){const r=fD(!0);return r?(r(),!1):!0}class ep{constructor(a){this.isMounted=!1,this.node=a}update(){}}function KI(r,a){const h=a?"pointerenter":"pointerleave",m=a?"onHoverStart":"onHoverEnd",b=(M,P)=>{if(M.pointerType==="touch"||pD())return;const V=r.getProps();r.animationState&&V.whileHover&&r.animationState.setActive("whileHover",a);const o=V[m];o&&qr.postRender(()=>o(M,P))};return rd(r.current,h,b,{passive:!r.getProps()[m]})}class a8 extends ep{mount(){this.unmount=id(KI(this.node,!0),KI(this.node,!1))}unmount(){}}class l8 extends ep{constructor(){super(...arguments),this.isActive=!1}onFocus(){let a=!1;try{a=this.node.current.matches(":focus-visible")}catch{a=!0}!a||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=id(td(this.node.current,"focus",()=>this.onFocus()),td(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const mD=(r,a)=>a?r===a?!0:mD(r,a.parentElement):!1;function y3(r,a){if(!a)return;const h=new PointerEvent("pointer"+r);a(h,jw(h))}class u8 extends ep{constructor(){super(...arguments),this.removeStartListeners=go,this.removeEndListeners=go,this.removeAccessibleListeners=go,this.startPointerPress=(a,h)=>{if(this.isPressing)return;this.removeEndListeners();const m=this.node.getProps(),M=rd(window,"pointerup",(V,o)=>{if(!this.checkPressEnd())return;const{onTap:q,onTapCancel:J,globalTapTarget:Q}=this.node.getProps(),ae=!Q&&!mD(this.node.current,V.target)?J:q;ae&&qr.update(()=>ae(V,o))},{passive:!(m.onTap||m.onPointerUp)}),P=rd(window,"pointercancel",(V,o)=>this.cancelPress(V,o),{passive:!(m.onTapCancel||m.onPointerCancel)});this.removeEndListeners=id(M,P),this.startPress(a,h)},this.startAccessiblePress=()=>{const a=M=>{if(M.key!=="Enter"||this.isPressing)return;const P=V=>{V.key!=="Enter"||!this.checkPressEnd()||y3("up",(o,q)=>{const{onTap:J}=this.node.getProps();J&&qr.postRender(()=>J(o,q))})};this.removeEndListeners(),this.removeEndListeners=td(this.node.current,"keyup",P),y3("down",(V,o)=>{this.startPress(V,o)})},h=td(this.node.current,"keydown",a),m=()=>{this.isPressing&&y3("cancel",(M,P)=>this.cancelPress(M,P))},b=td(this.node.current,"blur",m);this.removeAccessibleListeners=id(h,b)}}startPress(a,h){this.isPressing=!0;const{onTapStart:m,whileTap:b}=this.node.getProps();b&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),m&&qr.postRender(()=>m(a,h))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!pD()}cancelPress(a,h){if(!this.checkPressEnd())return;const{onTapCancel:m}=this.node.getProps();m&&qr.postRender(()=>m(a,h))}mount(){const a=this.node.getProps(),h=rd(a.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(a.onTapStart||a.onPointerStart)}),m=td(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=id(h,m)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const LS=new WeakMap,x3=new WeakMap,c8=r=>{const a=LS.get(r.target);a&&a(r)},h8=r=>{r.forEach(c8)};function d8({root:r,...a}){const h=r||document;x3.has(h)||x3.set(h,{});const m=x3.get(h),b=JSON.stringify(a);return m[b]||(m[b]=new IntersectionObserver(h8,{root:r,...a})),m[b]}function f8(r,a,h){const m=d8(a);return LS.set(r,h),m.observe(r),()=>{LS.delete(r),m.unobserve(r)}}const p8={some:0,all:1};class m8 extends ep{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:a={}}=this.node.getProps(),{root:h,margin:m,amount:b="some",once:M}=a,P={root:h?h.current:void 0,rootMargin:m,threshold:typeof b=="number"?b:p8[b]},V=o=>{const{isIntersecting:q}=o;if(this.isInView===q||(this.isInView=q,M&&!q&&this.hasEnteredView))return;q&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",q);const{onViewportEnter:J,onViewportLeave:Q}=this.node.getProps(),ae=q?J:Q;ae&&ae(o)};return f8(this.node.current,P,V)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:a,prevProps:h}=this.node;["amount","margin","root"].some(_8(a,h))&&this.startObserver()}unmount(){}}function _8({viewport:r={}},{viewport:a={}}={}){return h=>r[h]!==a[h]}const g8={inView:{Feature:m8},tap:{Feature:u8},focus:{Feature:l8},hover:{Feature:a8}};function _D(r,a){if(!Array.isArray(a))return!1;const h=a.length;if(h!==r.length)return!1;for(let m=0;m<h;m++)if(a[m]!==r[m])return!1;return!0}function Gw(r,a,h){const m=r.getProps();return sC(m,a,h!==void 0?h:m.custom,r)}const Wf=r=>r*1e3,sd=r=>r/1e3,y8={type:"spring",stiffness:500,damping:25,restSpeed:10},x8=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),v8={type:"keyframes",duration:.8},w8={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},b8=(r,{keyframes:a})=>a.length>2?v8:Qf.has(r)?r.startsWith("scale")?x8(a[1]):y8:w8;function T8({when:r,delay:a,delayChildren:h,staggerChildren:m,staggerDirection:b,repeat:M,repeatType:P,repeatDelay:V,from:o,elapsed:q,...J}){return!!Object.keys(J).length}function oC(r,a){return r[a]||r.default||r}const S8=r=>r!==null;function Ww(r,{repeat:a,repeatType:h="loop"},m){const b=r.filter(S8),M=a&&h!=="loop"&&a%2===1?0:b.length-1;return!M||m===void 0?b[M]:m}let Dv;function E8(){Dv=void 0}const $f={now:()=>(Dv===void 0&&$f.set(Zs.isProcessing||uN.useManualTiming?Zs.timestamp:performance.now()),Dv),set:r=>{Dv=r,queueMicrotask(E8)}},gD=r=>/^0[^.\s]+$/u.test(r);function C8(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||gD(r):!0}const yD=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r),A8=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function M8(r){const a=A8.exec(r);if(!a)return[,];const[,h,m,b]=a;return[`--${h??m}`,b]}function xD(r,a,h=1){const[m,b]=M8(r);if(!m)return;const M=window.getComputedStyle(a).getPropertyValue(m);if(M){const P=M.trim();return yD(P)?parseFloat(P):P}return JE(b)?xD(b,a,h+1):b}const I8=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),JI=r=>r===Sg||r===Bn,QI=(r,a)=>parseFloat(r.split(", ")[a]),eP=(r,a)=>(h,{transform:m})=>{if(m==="none"||!m)return 0;const b=m.match(/^matrix3d\((.+)\)$/u);if(b)return QI(b[1],a);{const M=m.match(/^matrix\((.+)\)$/u);return M?QI(M[1],r):0}},P8=new Set(["x","y","z"]),R8=ix.filter(r=>!P8.has(r));function L8(r){const a=[];return R8.forEach(h=>{const m=r.getValue(h);m!==void 0&&(a.push([h,m.get()]),m.set(h.startsWith("scale")?1:0))}),a}const yg={width:({x:r},{paddingLeft:a="0",paddingRight:h="0"})=>r.max-r.min-parseFloat(a)-parseFloat(h),height:({y:r},{paddingTop:a="0",paddingBottom:h="0"})=>r.max-r.min-parseFloat(a)-parseFloat(h),top:(r,{top:a})=>parseFloat(a),left:(r,{left:a})=>parseFloat(a),bottom:({y:r},{top:a})=>parseFloat(a)+(r.max-r.min),right:({x:r},{left:a})=>parseFloat(a)+(r.max-r.min),x:eP(4,13),y:eP(5,14)};yg.translateX=yg.x;yg.translateY=yg.y;const vD=r=>a=>a.test(r),D8={test:r=>r==="auto",parse:r=>r},wD=[Sg,Bn,Zc,Mf,BN,ON,D8],tP=r=>wD.find(vD(r)),Cm=new Set;let DS=!1,zS=!1;function bD(){if(zS){const r=Array.from(Cm).filter(m=>m.needsMeasurement),a=new Set(r.map(m=>m.element)),h=new Map;a.forEach(m=>{const b=L8(m);b.length&&(h.set(m,b),m.render())}),r.forEach(m=>m.measureInitialState()),a.forEach(m=>{m.render();const b=h.get(m);b&&b.forEach(([M,P])=>{var V;(V=m.getValue(M))===null||V===void 0||V.set(P)})}),r.forEach(m=>m.measureEndState()),r.forEach(m=>{m.suspendedScrollY!==void 0&&window.scrollTo(0,m.suspendedScrollY)})}zS=!1,DS=!1,Cm.forEach(r=>r.complete()),Cm.clear()}function TD(){Cm.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(zS=!0)})}function z8(){TD(),bD()}class aC{constructor(a,h,m,b,M,P=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...a],this.onComplete=h,this.name=m,this.motionValue=b,this.element=M,this.isAsync=P}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Cm.add(this),DS||(DS=!0,qr.read(TD),qr.resolveKeyframes(bD))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:a,name:h,element:m,motionValue:b}=this;for(let M=0;M<a.length;M++)if(a[M]===null)if(M===0){const P=b==null?void 0:b.get(),V=a[a.length-1];if(P!==void 0)a[0]=P;else if(m&&h){const o=m.readValue(h,V);o!=null&&(a[0]=o)}a[0]===void 0&&(a[0]=V),b&&P===void 0&&b.set(a[0])}else a[M]=a[M-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Cm.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Cm.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const lC=(r,a)=>h=>!!(sx(h)&&zN.test(h)&&h.startsWith(r)||a&&!kN(h)&&Object.prototype.hasOwnProperty.call(h,a)),SD=(r,a,h)=>m=>{if(!sx(m))return m;const[b,M,P,V]=m.match(QE);return{[r]:parseFloat(b),[a]:parseFloat(M),[h]:parseFloat(P),alpha:V!==void 0?parseFloat(V):1}},k8=r=>Zf(0,255,r),v3={...Sg,transform:r=>Math.round(k8(r))},bm={test:lC("rgb","red"),parse:SD("red","green","blue"),transform:({red:r,green:a,blue:h,alpha:m=1})=>"rgba("+v3.transform(r)+", "+v3.transform(a)+", "+v3.transform(h)+", "+E0(S0.transform(m))+")"};function O8(r){let a="",h="",m="",b="";return r.length>5?(a=r.substring(1,3),h=r.substring(3,5),m=r.substring(5,7),b=r.substring(7,9)):(a=r.substring(1,2),h=r.substring(2,3),m=r.substring(3,4),b=r.substring(4,5),a+=a,h+=h,m+=m,b+=b),{red:parseInt(a,16),green:parseInt(h,16),blue:parseInt(m,16),alpha:b?parseInt(b,16)/255:1}}const kS={test:lC("#"),parse:O8,transform:bm.transform},eg={test:lC("hsl","hue"),parse:SD("hue","saturation","lightness"),transform:({hue:r,saturation:a,lightness:h,alpha:m=1})=>"hsla("+Math.round(r)+", "+Zc.transform(E0(a))+", "+Zc.transform(E0(h))+", "+E0(S0.transform(m))+")"},fo={test:r=>bm.test(r)||kS.test(r)||eg.test(r),parse:r=>bm.test(r)?bm.parse(r):eg.test(r)?eg.parse(r):kS.parse(r),transform:r=>sx(r)?r:r.hasOwnProperty("red")?bm.transform(r):eg.transform(r)};function B8(r){var a,h;return isNaN(r)&&sx(r)&&(((a=r.match(QE))===null||a===void 0?void 0:a.length)||0)+(((h=r.match(DN))===null||h===void 0?void 0:h.length)||0)>0}const ED="number",CD="color",F8="var",N8="var(",nP="${}",V8=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Z0(r){const a=r.toString(),h=[],m={color:[],number:[],var:[]},b=[];let M=0;const V=a.replace(V8,o=>(fo.test(o)?(m.color.push(M),b.push(CD),h.push(fo.parse(o))):o.startsWith(N8)?(m.var.push(M),b.push(F8),h.push(o)):(m.number.push(M),b.push(ED),h.push(parseFloat(o))),++M,nP)).split(nP);return{values:h,split:V,indexes:m,types:b}}function AD(r){return Z0(r).values}function MD(r){const{split:a,types:h}=Z0(r),m=a.length;return b=>{let M="";for(let P=0;P<m;P++)if(M+=a[P],b[P]!==void 0){const V=h[P];V===ED?M+=E0(b[P]):V===CD?M+=fo.transform(b[P]):M+=b[P]}return M}}const U8=r=>typeof r=="number"?0:r;function j8(r){const a=AD(r);return MD(r)(a.map(U8))}const Xf={test:B8,parse:AD,createTransformer:MD,getAnimatableNone:j8},G8=new Set(["brightness","contrast","saturate","opacity"]);function W8(r){const[a,h]=r.slice(0,-1).split("(");if(a==="drop-shadow")return r;const[m]=h.match(QE)||[];if(!m)return r;const b=h.replace(m,"");let M=G8.has(a)?1:0;return m!==h&&(M*=100),a+"("+M+b+")"}const $8=/\b([a-z-]*)\(.*?\)/gu,OS={...Xf,getAnimatableNone:r=>{const a=r.match($8);return a?a.map(W8).join(" "):r}},q8={...eD,color:fo,backgroundColor:fo,outlineColor:fo,fill:fo,stroke:fo,borderColor:fo,borderTopColor:fo,borderRightColor:fo,borderBottomColor:fo,borderLeftColor:fo,filter:OS,WebkitFilter:OS},uC=r=>q8[r];function ID(r,a){let h=uC(r);return h!==OS&&(h=Xf),h.getAnimatableNone?h.getAnimatableNone(a):void 0}const H8=new Set(["auto","none","0"]);function Z8(r,a,h){let m=0,b;for(;m<r.length&&!b;){const M=r[m];typeof M=="string"&&!H8.has(M)&&Z0(M).values.length&&(b=r[m]),m++}if(b&&h)for(const M of a)r[M]=ID(h,b)}class PD extends aC{constructor(a,h,m,b){super(a,h,m,b,b==null?void 0:b.owner,!0)}readKeyframes(){const{unresolvedKeyframes:a,element:h,name:m}=this;if(!h.current)return;super.readKeyframes();for(let o=0;o<a.length;o++){let q=a[o];if(typeof q=="string"&&(q=q.trim(),JE(q))){const J=xD(q,h.current);J!==void 0&&(a[o]=J),o===a.length-1&&(this.finalKeyframe=q)}}if(this.resolveNoneKeyframes(),!I8.has(m)||a.length!==2)return;const[b,M]=a,P=tP(b),V=tP(M);if(P!==V)if(JI(P)&&JI(V))for(let o=0;o<a.length;o++){const q=a[o];typeof q=="string"&&(a[o]=parseFloat(q))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:a,name:h}=this,m=[];for(let b=0;b<a.length;b++)C8(a[b])&&m.push(b);m.length&&Z8(a,m,h)}measureInitialState(){const{element:a,unresolvedKeyframes:h,name:m}=this;if(!a.current)return;m==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=yg[m](a.measureViewportBox(),window.getComputedStyle(a.current)),h[0]=this.measuredOrigin;const b=h[h.length-1];b!==void 0&&a.getValue(m,b).jump(b,!1)}measureEndState(){var a;const{element:h,name:m,unresolvedKeyframes:b}=this;if(!h.current)return;const M=h.getValue(m);M&&M.jump(this.measuredOrigin,!1);const P=b.length-1,V=b[P];b[P]=yg[m](h.measureViewportBox(),window.getComputedStyle(h.current)),V!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=V),!((a=this.removedTransforms)===null||a===void 0)&&a.length&&this.removedTransforms.forEach(([o,q])=>{h.getValue(o).set(q)}),this.resolveNoneKeyframes()}}function RD(r){let a;return()=>(a===void 0&&(a=r()),a)}const rP=(r,a)=>a==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(Xf.test(r)||r==="0")&&!r.startsWith("url("));function X8(r){const a=r[0];if(r.length===1)return!0;for(let h=0;h<r.length;h++)if(r[h]!==a)return!0}function Y8(r,a,h,m){const b=r[0];if(b===null)return!1;if(a==="display"||a==="visibility")return!0;const M=r[r.length-1],P=rP(b,a),V=rP(M,a);return!P||!V?!1:X8(r)||h==="spring"&&m}class LD{constructor({autoplay:a=!0,delay:h=0,type:m="keyframes",repeat:b=0,repeatDelay:M=0,repeatType:P="loop",...V}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:a,delay:h,type:m,repeat:b,repeatDelay:M,repeatType:P,...V},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&z8(),this._resolved}onKeyframesResolved(a,h){this.hasAttemptedResolve=!0;const{name:m,type:b,velocity:M,delay:P,onComplete:V,onUpdate:o,isGenerator:q}=this.options;if(!q&&!Y8(a,m,b,M))if(P)this.options.duration=0;else{o==null||o(Ww(a,this.options,h)),V==null||V(),this.resolveFinishedPromise();return}const J=this.initPlayback(a,h);J!==!1&&(this._resolved={keyframes:a,finalKeyframe:h,...J},this.onPostResolved())}onPostResolved(){}then(a,h){return this.currentFinishedPromise.then(a,h)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(a=>{this.resolveFinishedPromise=a})}}function DD(r,a){return a?r*(1e3/a):0}const K8=5;function zD(r,a,h){const m=Math.max(a-K8,0);return DD(h-r(m),a-m)}const w3=.001,J8=.01,Q8=10,eV=.05,tV=1;function nV({duration:r=800,bounce:a=.25,velocity:h=0,mass:m=1}){let b,M,P=1-a;P=Zf(eV,tV,P),r=Zf(J8,Q8,sd(r)),P<1?(b=q=>{const J=q*P,Q=J*r,ae=J-h,xe=BS(q,P),Re=Math.exp(-Q);return w3-ae/xe*Re},M=q=>{const Q=q*P*r,ae=Q*h+h,xe=Math.pow(P,2)*Math.pow(q,2)*r,Re=Math.exp(-Q),Ue=BS(Math.pow(q,2),P);return(-b(q)+w3>0?-1:1)*((ae-xe)*Re)/Ue}):(b=q=>{const J=Math.exp(-q*r),Q=(q-h)*r+1;return-w3+J*Q},M=q=>{const J=Math.exp(-q*r),Q=(h-q)*(r*r);return J*Q});const V=5/r,o=iV(b,M,V);if(r=Wf(r),isNaN(o))return{stiffness:100,damping:10,duration:r};{const q=Math.pow(o,2)*m;return{stiffness:q,damping:P*2*Math.sqrt(m*q),duration:r}}}const rV=12;function iV(r,a,h){let m=h;for(let b=1;b<rV;b++)m=m-r(m)/a(m);return m}function BS(r,a){return r*Math.sqrt(1-a*a)}const sV=["duration","bounce"],oV=["stiffness","damping","mass"];function iP(r,a){return a.some(h=>r[h]!==void 0)}function aV(r){let a={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...r};if(!iP(r,oV)&&iP(r,sV)){const h=nV(r);a={...a,...h,mass:1},a.isResolvedFromDuration=!0}return a}function kD({keyframes:r,restDelta:a,restSpeed:h,...m}){const b=r[0],M=r[r.length-1],P={done:!1,value:b},{stiffness:V,damping:o,mass:q,duration:J,velocity:Q,isResolvedFromDuration:ae}=aV({...m,velocity:-sd(m.velocity||0)}),xe=Q||0,Re=o/(2*Math.sqrt(V*q)),Ue=M-b,Tt=sd(Math.sqrt(V/q)),Te=Math.abs(Ue)<5;h||(h=Te?.01:2),a||(a=Te?.005:.5);let Ee;if(Re<1){const Me=BS(Tt,Re);Ee=et=>{const pt=Math.exp(-Re*Tt*et);return M-pt*((xe+Re*Tt*Ue)/Me*Math.sin(Me*et)+Ue*Math.cos(Me*et))}}else if(Re===1)Ee=Me=>M-Math.exp(-Tt*Me)*(Ue+(xe+Tt*Ue)*Me);else{const Me=Tt*Math.sqrt(Re*Re-1);Ee=et=>{const pt=Math.exp(-Re*Tt*et),Ct=Math.min(Me*et,300);return M-pt*((xe+Re*Tt*Ue)*Math.sinh(Ct)+Me*Ue*Math.cosh(Ct))/Me}}return{calculatedDuration:ae&&J||null,next:Me=>{const et=Ee(Me);if(ae)P.done=Me>=J;else{let pt=xe;Me!==0&&(Re<1?pt=zD(Ee,Me,et):pt=0);const Ct=Math.abs(pt)<=h,Ot=Math.abs(M-et)<=a;P.done=Ct&&Ot}return P.value=P.done?M:et,P}}}function sP({keyframes:r,velocity:a=0,power:h=.8,timeConstant:m=325,bounceDamping:b=10,bounceStiffness:M=500,modifyTarget:P,min:V,max:o,restDelta:q=.5,restSpeed:J}){const Q=r[0],ae={done:!1,value:Q},xe=zt=>V!==void 0&&zt<V||o!==void 0&&zt>o,Re=zt=>V===void 0?o:o===void 0||Math.abs(V-zt)<Math.abs(o-zt)?V:o;let Ue=h*a;const Tt=Q+Ue,Te=P===void 0?Tt:P(Tt);Te!==Tt&&(Ue=Te-Q);const Ee=zt=>-Ue*Math.exp(-zt/m),Me=zt=>Te+Ee(zt),et=zt=>{const Zn=Ee(zt),wn=Me(zt);ae.done=Math.abs(Zn)<=q,ae.value=ae.done?Te:wn};let pt,Ct;const Ot=zt=>{xe(ae.value)&&(pt=zt,Ct=kD({keyframes:[ae.value,Re(ae.value)],velocity:zD(Me,zt,ae.value),damping:b,stiffness:M,restDelta:q,restSpeed:J}))};return Ot(0),{calculatedDuration:null,next:zt=>{let Zn=!1;return!Ct&&pt===void 0&&(Zn=!0,et(zt),Ot(zt)),pt!==void 0&&zt>=pt?Ct.next(zt-pt):(!Zn&&et(zt),ae)}}}const OD=(r,a,h)=>(((1-3*h+3*a)*r+(3*h-6*a))*r+3*a)*r,lV=1e-7,uV=12;function cV(r,a,h,m,b){let M,P,V=0;do P=a+(h-a)/2,M=OD(P,m,b)-r,M>0?h=P:a=P;while(Math.abs(M)>lV&&++V<uV);return P}function ax(r,a,h,m){if(r===a&&h===m)return go;const b=M=>cV(M,0,1,r,h);return M=>M===0||M===1?M:OD(b(M),a,m)}const hV=ax(.42,0,1,1),dV=ax(0,0,.58,1),BD=ax(.42,0,.58,1),fV=r=>Array.isArray(r)&&typeof r[0]!="number",FD=r=>a=>a<=.5?r(2*a)/2:(2-r(2*(1-a)))/2,ND=r=>a=>1-r(1-a),cC=r=>1-Math.sin(Math.acos(r)),VD=ND(cC),pV=FD(cC),UD=ax(.33,1.53,.69,.99),hC=ND(UD),mV=FD(hC),_V=r=>(r*=2)<1?.5*hC(r):.5*(2-Math.pow(2,-10*(r-1))),oP={linear:go,easeIn:hV,easeInOut:BD,easeOut:dV,circIn:cC,circInOut:pV,circOut:VD,backIn:hC,backInOut:mV,backOut:UD,anticipate:_V},aP=r=>{if(Array.isArray(r)){PS(r.length===4);const[a,h,m,b]=r;return ax(a,h,m,b)}else if(typeof r=="string")return PS(oP[r]!==void 0),oP[r];return r},X0=(r,a,h)=>{const m=a-r;return m===0?1:(h-r)/m},Ai=(r,a,h)=>r+(a-r)*h;function b3(r,a,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?r+(a-r)*6*h:h<1/2?a:h<2/3?r+(a-r)*(2/3-h)*6:r}function gV({hue:r,saturation:a,lightness:h,alpha:m}){r/=360,a/=100,h/=100;let b=0,M=0,P=0;if(!a)b=M=P=h;else{const V=h<.5?h*(1+a):h+a-h*a,o=2*h-V;b=b3(o,V,r+1/3),M=b3(o,V,r),P=b3(o,V,r-1/3)}return{red:Math.round(b*255),green:Math.round(M*255),blue:Math.round(P*255),alpha:m}}function cw(r,a){return h=>h>0?a:r}const T3=(r,a,h)=>{const m=r*r,b=h*(a*a-m)+m;return b<0?0:Math.sqrt(b)},yV=[kS,bm,eg],xV=r=>yV.find(a=>a.test(r));function lP(r){const a=xV(r);if(!a)return!1;let h=a.parse(r);return a===eg&&(h=gV(h)),h}const uP=(r,a)=>{const h=lP(r),m=lP(a);if(!h||!m)return cw(r,a);const b={...h};return M=>(b.red=T3(h.red,m.red,M),b.green=T3(h.green,m.green,M),b.blue=T3(h.blue,m.blue,M),b.alpha=Ai(h.alpha,m.alpha,M),bm.transform(b))},FS=new Set(["none","hidden"]);function vV(r,a){return FS.has(r)?h=>h<=0?r:a:h=>h>=1?a:r}function wV(r,a){return h=>Ai(r,a,h)}function dC(r){return typeof r=="number"?wV:typeof r=="string"?JE(r)?cw:fo.test(r)?uP:SV:Array.isArray(r)?jD:typeof r=="object"?fo.test(r)?uP:bV:cw}function jD(r,a){const h=[...r],m=h.length,b=r.map((M,P)=>dC(M)(M,a[P]));return M=>{for(let P=0;P<m;P++)h[P]=b[P](M);return h}}function bV(r,a){const h={...r,...a},m={};for(const b in h)r[b]!==void 0&&a[b]!==void 0&&(m[b]=dC(r[b])(r[b],a[b]));return b=>{for(const M in m)h[M]=m[M](b);return h}}function TV(r,a){var h;const m=[],b={color:0,var:0,number:0};for(let M=0;M<a.values.length;M++){const P=a.types[M],V=r.indexes[P][b[P]],o=(h=r.values[V])!==null&&h!==void 0?h:0;m[M]=o,b[P]++}return m}const SV=(r,a)=>{const h=Xf.createTransformer(a),m=Z0(r),b=Z0(a);return m.indexes.var.length===b.indexes.var.length&&m.indexes.color.length===b.indexes.color.length&&m.indexes.number.length>=b.indexes.number.length?FS.has(r)&&!b.values.length||FS.has(a)&&!m.values.length?vV(r,a):id(jD(TV(m,b),b.values),h):cw(r,a)};function GD(r,a,h){return typeof r=="number"&&typeof a=="number"&&typeof h=="number"?Ai(r,a,h):dC(r)(r,a)}function EV(r,a,h){const m=[],b=h||GD,M=r.length-1;for(let P=0;P<M;P++){let V=b(r[P],r[P+1]);if(a){const o=Array.isArray(a)?a[P]||go:a;V=id(o,V)}m.push(V)}return m}function CV(r,a,{clamp:h=!0,ease:m,mixer:b}={}){const M=r.length;if(PS(M===a.length),M===1)return()=>a[0];if(M===2&&r[0]===r[1])return()=>a[1];r[0]>r[M-1]&&(r=[...r].reverse(),a=[...a].reverse());const P=EV(a,m,b),V=P.length,o=q=>{let J=0;if(V>1)for(;J<r.length-2&&!(q<r[J+1]);J++);const Q=X0(r[J],r[J+1],q);return P[J](Q)};return h?q=>o(Zf(r[0],r[M-1],q)):o}function AV(r,a){const h=r[r.length-1];for(let m=1;m<=a;m++){const b=X0(0,a,m);r.push(Ai(h,1,b))}}function MV(r){const a=[0];return AV(a,r.length-1),a}function IV(r,a){return r.map(h=>h*a)}function PV(r,a){return r.map(()=>a||BD).splice(0,r.length-1)}function hw({duration:r=300,keyframes:a,times:h,ease:m="easeInOut"}){const b=fV(m)?m.map(aP):aP(m),M={done:!1,value:a[0]},P=IV(h&&h.length===a.length?h:MV(a),r),V=CV(P,a,{ease:Array.isArray(b)?b:PV(a,b)});return{calculatedDuration:r,next:o=>(M.value=V(o),M.done=o>=r,M)}}const cP=2e4;function RV(r){let a=0;const h=50;let m=r.next(a);for(;!m.done&&a<cP;)a+=h,m=r.next(a);return a>=cP?1/0:a}const LV=r=>{const a=({timestamp:h})=>r(h);return{start:()=>qr.update(a,!0),stop:()=>hd(a),now:()=>Zs.isProcessing?Zs.timestamp:$f.now()}},DV={decay:sP,inertia:sP,tween:hw,keyframes:hw,spring:kD},zV=r=>r/100;class fC extends LD{constructor({KeyframeResolver:a=aC,...h}){super(h),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:V}=this.options;V&&V()};const{name:m,motionValue:b,keyframes:M}=this.options,P=(V,o)=>this.onKeyframesResolved(V,o);m&&b&&b.owner?this.resolver=b.owner.resolveKeyframes(M,P,m,b):this.resolver=new a(M,P,m,b),this.resolver.scheduleResolve()}initPlayback(a){const{type:h="keyframes",repeat:m=0,repeatDelay:b=0,repeatType:M,velocity:P=0}=this.options,V=DV[h]||hw;let o,q;V!==hw&&typeof a[0]!="number"&&(o=id(zV,GD(a[0],a[1])),a=[0,100]);const J=V({...this.options,keyframes:a});M==="mirror"&&(q=V({...this.options,keyframes:[...a].reverse(),velocity:-P})),J.calculatedDuration===null&&(J.calculatedDuration=RV(J));const{calculatedDuration:Q}=J,ae=Q+b,xe=ae*(m+1)-b;return{generator:J,mirroredGenerator:q,mapPercentToKeyframes:o,calculatedDuration:Q,resolvedDuration:ae,totalDuration:xe}}onPostResolved(){const{autoplay:a=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!a?this.pause():this.state=this.pendingPlayState}tick(a,h=!1){const{resolved:m}=this;if(!m){const{keyframes:zt}=this.options;return{done:!0,value:zt[zt.length-1]}}const{finalKeyframe:b,generator:M,mirroredGenerator:P,mapPercentToKeyframes:V,keyframes:o,calculatedDuration:q,totalDuration:J,resolvedDuration:Q}=m;if(this.startTime===null)return M.next(0);const{delay:ae,repeat:xe,repeatType:Re,repeatDelay:Ue,onUpdate:Tt}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,a):this.speed<0&&(this.startTime=Math.min(a-J/this.speed,this.startTime)),h?this.currentTime=a:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(a-this.startTime)*this.speed;const Te=this.currentTime-ae*(this.speed>=0?1:-1),Ee=this.speed>=0?Te<0:Te>J;this.currentTime=Math.max(Te,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=J);let Me=this.currentTime,et=M;if(xe){const zt=Math.min(this.currentTime,J)/Q;let Zn=Math.floor(zt),wn=zt%1;!wn&&zt>=1&&(wn=1),wn===1&&Zn--,Zn=Math.min(Zn,xe+1),!!(Zn%2)&&(Re==="reverse"?(wn=1-wn,Ue&&(wn-=Ue/Q)):Re==="mirror"&&(et=P)),Me=Zf(0,1,wn)*Q}const pt=Ee?{done:!1,value:o[0]}:et.next(Me);V&&(pt.value=V(pt.value));let{done:Ct}=pt;!Ee&&q!==null&&(Ct=this.speed>=0?this.currentTime>=J:this.currentTime<=0);const Ot=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Ct);return Ot&&b!==void 0&&(pt.value=Ww(o,this.options,b)),Tt&&Tt(pt.value),Ot&&this.finish(),pt}get duration(){const{resolved:a}=this;return a?sd(a.calculatedDuration):0}get time(){return sd(this.currentTime)}set time(a){a=Wf(a),this.currentTime=a,this.holdTime!==null||this.speed===0?this.holdTime=a:this.driver&&(this.startTime=this.driver.now()-a/this.speed)}get speed(){return this.playbackSpeed}set speed(a){const h=this.playbackSpeed!==a;this.playbackSpeed=a,h&&(this.time=sd(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:a=LV,onPlay:h}=this.options;this.driver||(this.driver=a(b=>this.tick(b))),h&&h();const m=this.driver.now();this.holdTime!==null?this.startTime=m-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=m),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var a;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(a=this.currentTime)!==null&&a!==void 0?a:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:a}=this.options;a&&a()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(a){return this.startTime=0,this.tick(a,!0)}}const WD=r=>Array.isArray(r)&&typeof r[0]=="number";function $D(r){return!!(!r||typeof r=="string"&&r in pC||WD(r)||Array.isArray(r)&&r.every($D))}const p0=([r,a,h,m])=>`cubic-bezier(${r}, ${a}, ${h}, ${m})`,pC={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:p0([0,.65,.55,1]),circOut:p0([.55,0,1,.45]),backIn:p0([.31,.01,.66,-.59]),backOut:p0([.33,1.53,.69,.99])};function kV(r){return qD(r)||pC.easeOut}function qD(r){if(r)return WD(r)?p0(r):Array.isArray(r)?r.map(kV):pC[r]}function OV(r,a,h,{delay:m=0,duration:b=300,repeat:M=0,repeatType:P="loop",ease:V,times:o}={}){const q={[a]:h};o&&(q.offset=o);const J=qD(V);return Array.isArray(J)&&(q.easing=J),r.animate(q,{delay:m,duration:b,easing:Array.isArray(J)?"linear":J,fill:"both",iterations:M+1,direction:P==="reverse"?"alternate":"normal"})}const BV=RD(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),dw=10,FV=2e4;function NV(r){return r.type==="spring"||!$D(r.ease)}function VV(r,a){const h=new fC({...a,keyframes:r,repeat:0,delay:0,isGenerator:!0});let m={done:!1,value:r[0]};const b=[];let M=0;for(;!m.done&&M<FV;)m=h.sample(M),b.push(m.value),M+=dw;return{times:void 0,keyframes:b,duration:M-dw,ease:"linear"}}class hP extends LD{constructor(a){super(a);const{name:h,motionValue:m,keyframes:b}=this.options;this.resolver=new PD(b,(M,P)=>this.onKeyframesResolved(M,P),h,m),this.resolver.scheduleResolve()}initPlayback(a,h){var m;let{duration:b=300,times:M,ease:P,type:V,motionValue:o,name:q}=this.options;if(!(!((m=o.owner)===null||m===void 0)&&m.current))return!1;if(NV(this.options)){const{onComplete:Q,onUpdate:ae,motionValue:xe,...Re}=this.options,Ue=VV(a,Re);a=Ue.keyframes,a.length===1&&(a[1]=a[0]),b=Ue.duration,M=Ue.times,P=Ue.ease,V="keyframes"}const J=OV(o.owner.current,q,a,{...this.options,duration:b,times:M,ease:P});return J.startTime=$f.now(),this.pendingTimeline?(J.timeline=this.pendingTimeline,this.pendingTimeline=void 0):J.onfinish=()=>{const{onComplete:Q}=this.options;o.set(Ww(a,this.options,h)),Q&&Q(),this.cancel(),this.resolveFinishedPromise()},{animation:J,duration:b,times:M,type:V,ease:P,keyframes:a}}get duration(){const{resolved:a}=this;if(!a)return 0;const{duration:h}=a;return sd(h)}get time(){const{resolved:a}=this;if(!a)return 0;const{animation:h}=a;return sd(h.currentTime||0)}set time(a){const{resolved:h}=this;if(!h)return;const{animation:m}=h;m.currentTime=Wf(a)}get speed(){const{resolved:a}=this;if(!a)return 1;const{animation:h}=a;return h.playbackRate}set speed(a){const{resolved:h}=this;if(!h)return;const{animation:m}=h;m.playbackRate=a}get state(){const{resolved:a}=this;if(!a)return"idle";const{animation:h}=a;return h.playState}attachTimeline(a){if(!this._resolved)this.pendingTimeline=a;else{const{resolved:h}=this;if(!h)return go;const{animation:m}=h;m.timeline=a,m.onfinish=null}return go}play(){if(this.isStopped)return;const{resolved:a}=this;if(!a)return;const{animation:h}=a;h.playState==="finished"&&this.updateFinishedPromise(),h.play()}pause(){const{resolved:a}=this;if(!a)return;const{animation:h}=a;h.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:a}=this;if(!a)return;const{animation:h,keyframes:m,duration:b,type:M,ease:P,times:V}=a;if(h.playState==="idle"||h.playState==="finished")return;if(this.time){const{motionValue:q,onUpdate:J,onComplete:Q,...ae}=this.options,xe=new fC({...ae,keyframes:m,duration:b,type:M,ease:P,times:V,isGenerator:!0}),Re=Wf(this.time);q.setWithVelocity(xe.sample(Re-dw).value,xe.sample(Re).value,dw)}const{onStop:o}=this.options;o&&o(),this.cancel()}complete(){const{resolved:a}=this;a&&a.animation.finish()}cancel(){const{resolved:a}=this;a&&a.animation.cancel()}static supports(a){const{motionValue:h,name:m,repeatDelay:b,repeatType:M,damping:P,type:V}=a;return BV()&&m&&lD.has(m)&&h&&h.owner&&h.owner.current instanceof HTMLElement&&!h.owner.getProps().onUpdate&&!b&&M!=="mirror"&&P!==0&&V!=="inertia"}}function UV(r,a){let h;const m=()=>{const{currentTime:b}=a,P=(b===null?0:b.value)/100;h!==P&&r(P),h=P};return qr.update(m,!0),()=>hd(m)}const jV=RD(()=>window.ScrollTimeline!==void 0);class GV{constructor(a){this.stop=()=>this.runAll("stop"),this.animations=a.filter(Boolean)}then(a,h){return Promise.all(this.animations).then(a).catch(h)}getAll(a){return this.animations[0][a]}setAll(a,h){for(let m=0;m<this.animations.length;m++)this.animations[m][a]=h}attachTimeline(a){const h=this.animations.map(m=>{if(jV()&&m.attachTimeline)m.attachTimeline(a);else return m.pause(),UV(b=>{m.time=m.duration*b},a)});return()=>{h.forEach((m,b)=>{m&&m(),this.animations[b].stop()})}}get time(){return this.getAll("time")}set time(a){this.setAll("time",a)}get speed(){return this.getAll("speed")}set speed(a){this.setAll("speed",a)}get duration(){let a=0;for(let h=0;h<this.animations.length;h++)a=Math.max(a,this.animations[h].duration);return a}runAll(a){this.animations.forEach(h=>h[a]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}const mC=(r,a,h,m={},b,M,P)=>V=>{const o=oC(m,r)||{},q=o.delay||m.delay||0;let{elapsed:J=0}=m;J=J-Wf(q);let Q={keyframes:Array.isArray(h)?h:[null,h],ease:"easeOut",velocity:a.getVelocity(),...o,delay:-J,onUpdate:xe=>{a.set(xe),o.onUpdate&&o.onUpdate(xe)},onComplete:()=>{V(),o.onComplete&&o.onComplete(),P&&P()},onStop:P,name:r,motionValue:a,element:M?void 0:b};T8(o)||(Q={...Q,...b8(r,Q)}),Q.duration&&(Q.duration=Wf(Q.duration)),Q.repeatDelay&&(Q.repeatDelay=Wf(Q.repeatDelay)),Q.from!==void 0&&(Q.keyframes[0]=Q.from);let ae=!1;if((Q.type===!1||Q.duration===0&&!Q.repeatDelay)&&(Q.duration=0,Q.delay===0&&(ae=!0)),ae&&!M&&a.get()!==void 0){const xe=Ww(Q.keyframes,o);if(xe!==void 0)return qr.update(()=>{Q.onUpdate(xe),Q.onComplete()}),new GV([])}return!M&&hP.supports(Q)?new hP(Q):new fC(Q)};class _C{constructor(){this.subscriptions=[]}add(a){return Vw(this.subscriptions,a),()=>Uw(this.subscriptions,a)}notify(a,h,m){const b=this.subscriptions.length;if(b)if(b===1)this.subscriptions[0](a,h,m);else for(let M=0;M<b;M++){const P=this.subscriptions[M];P&&P(a,h,m)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const dP=30,WV=r=>!isNaN(parseFloat(r));class HD{constructor(a,h={}){this.version="11.3.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(m,b=!0)=>{const M=$f.now();this.updatedAt!==M&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(m),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),b&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(a),this.owner=h.owner}setCurrent(a){this.current=a,this.updatedAt=$f.now(),this.canTrackVelocity===null&&a!==void 0&&(this.canTrackVelocity=WV(this.current))}setPrevFrameValue(a=this.current){this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt}onChange(a){return this.on("change",a)}on(a,h){this.events[a]||(this.events[a]=new _C);const m=this.events[a].add(h);return a==="change"?()=>{m(),qr.read(()=>{this.events.change.getSize()||this.stop()})}:m}clearListeners(){for(const a in this.events)this.events[a].clear()}attach(a,h){this.passiveEffect=a,this.stopPassiveEffect=h}set(a,h=!0){!h||!this.passiveEffect?this.updateAndNotify(a,h):this.passiveEffect(a,this.updateAndNotify)}setWithVelocity(a,h,m){this.set(h),this.prev=void 0,this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt-m}jump(a,h=!0){this.updateAndNotify(a),this.prev=a,this.prevUpdatedAt=this.prevFrameValue=void 0,h&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const a=$f.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||a-this.updatedAt>dP)return 0;const h=Math.min(this.updatedAt-this.prevUpdatedAt,dP);return DD(parseFloat(this.current)-parseFloat(this.prevFrameValue),h)}start(a){return this.stop(),new Promise(h=>{this.hasAnimated=!0,this.animation=a(h),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Y0(r,a){return new HD(r,a)}function $V(r,a,h){r.hasValue(a)?r.getValue(a).set(h):r.addValue(a,Y0(h))}function qV(r,a){const h=Gw(r,a);let{transitionEnd:m={},transition:b={},...M}=h||{};M={...M,...m};for(const P in M){const V=JN(M[P]);$V(r,P,V)}}function ZD(r){return r.getProps()[$4]}class HV extends HD{constructor(){super(...arguments),this.output=[],this.counts=new Map}add(a){const h=uD(a);if(!h)return;const m=this.counts.get(h)||0;this.counts.set(h,m+1),m===0&&(this.output.push(h),this.update());let b=!1;return()=>{if(b)return;b=!0;const M=this.counts.get(h)-1;this.counts.set(h,M),M===0&&(Uw(this.output,h),this.update())}}update(){this.set(this.output.length?this.output.join(", "):"auto")}}function ZV(r){return!!(_o(r)&&r.add)}function NS(r,a){var h;if(!r.applyWillChange)return;let m=r.getValue("willChange");if(!m&&!(!((h=r.props.style)===null||h===void 0)&&h.willChange)&&(m=new HV("auto"),r.addValue("willChange",m)),ZV(m))return m.add(a)}function XV({protectedKeys:r,needsAnimating:a},h){const m=r.hasOwnProperty(h)&&a[h]!==!0;return a[h]=!1,m}function XD(r,a,{delay:h=0,transitionOverride:m,type:b}={}){var M;let{transition:P=r.getDefaultTransition(),transitionEnd:V,...o}=a;m&&(P=m);const q=[],J=b&&r.animationState&&r.animationState.getState()[b];for(const Q in o){const ae=r.getValue(Q,(M=r.latestValues[Q])!==null&&M!==void 0?M:null),xe=o[Q];if(xe===void 0||J&&XV(J,Q))continue;const Re={delay:h,elapsed:0,...oC(P||{},Q)};let Ue=!1;if(window.HandoffAppearAnimations){const Te=ZD(r);if(Te){const Ee=window.HandoffAppearAnimations(Te,Q,ae,qr);Ee!==null&&(Re.elapsed=Ee,Ue=!0)}}ae.start(mC(Q,ae,xe,r.shouldReduceMotion&&Qf.has(Q)?{type:!1}:Re,r,Ue,NS(r,Q)));const Tt=ae.animation;Tt&&q.push(Tt)}return V&&Promise.all(q).then(()=>{qr.update(()=>{V&&qV(r,V)})}),q}function VS(r,a,h={}){var m;const b=Gw(r,a,h.type==="exit"?(m=r.presenceContext)===null||m===void 0?void 0:m.custom:void 0);let{transition:M=r.getDefaultTransition()||{}}=b||{};h.transitionOverride&&(M=h.transitionOverride);const P=b?()=>Promise.all(XD(r,b,h)):()=>Promise.resolve(),V=r.variantChildren&&r.variantChildren.size?(q=0)=>{const{delayChildren:J=0,staggerChildren:Q,staggerDirection:ae}=M;return YV(r,a,J+q,Q,ae,h)}:()=>Promise.resolve(),{when:o}=M;if(o){const[q,J]=o==="beforeChildren"?[P,V]:[V,P];return q().then(()=>J())}else return Promise.all([P(),V(h.delay)])}function YV(r,a,h=0,m=0,b=1,M){const P=[],V=(r.variantChildren.size-1)*m,o=b===1?(q=0)=>q*m:(q=0)=>V-q*m;return Array.from(r.variantChildren).sort(KV).forEach((q,J)=>{q.notify("AnimationStart",a),P.push(VS(q,a,{...M,delay:h+o(J)}).then(()=>q.notify("AnimationComplete",a)))}),Promise.all(P)}function KV(r,a){return r.sortNodePosition(a)}function JV(r,a,h={}){r.notify("AnimationStart",a);let m;if(Array.isArray(a)){const b=a.map(M=>VS(r,M,h));m=Promise.all(b)}else if(typeof a=="string")m=VS(r,a,h);else{const b=typeof a=="function"?Gw(r,a,h.custom):a;m=Promise.all(XD(r,b,h))}return m.then(()=>{qr.postRender(()=>{r.notify("AnimationComplete",a)})})}const QV=[...XE].reverse(),eU=XE.length;function tU(r){return a=>Promise.all(a.map(({animation:h,options:m})=>JV(r,h,m)))}function nU(r){let a=tU(r),h=fP(),m=!0;const b=o=>(q,J)=>{var Q;const ae=Gw(r,J,o==="exit"?(Q=r.presenceContext)===null||Q===void 0?void 0:Q.custom:void 0);if(ae){const{transition:xe,transitionEnd:Re,...Ue}=ae;q={...q,...Ue,...Re}}return q};function M(o){a=o(r)}function P(o){const q=r.getProps(),J=r.getVariantContext(!0)||{},Q=[],ae=new Set;let xe={},Re=1/0;for(let Tt=0;Tt<eU;Tt++){const Te=QV[Tt],Ee=h[Te],Me=q[Te]!==void 0?q[Te]:J[Te],et=q0(Me),pt=Te===o?Ee.isActive:null;pt===!1&&(Re=Tt);let Ct=Me===J[Te]&&Me!==q[Te]&&et;if(Ct&&m&&r.manuallyAnimateOnMount&&(Ct=!1),Ee.protectedKeys={...xe},!Ee.isActive&&pt===null||!Me&&!Ee.prevProp||H0(Me)||typeof Me=="boolean")continue;let zt=rU(Ee.prevProp,Me)||Te===o&&Ee.isActive&&!Ct&&et||Tt>Re&&et,Zn=!1;const wn=Array.isArray(Me)?Me:[Me];let xn=wn.reduce(b(Te),{});pt===!1&&(xn={});const{prevResolvedValues:rs={}}=Ee,bn={...rs,...xn},xo=Jr=>{zt=!0,ae.has(Jr)&&(Zn=!0,ae.delete(Jr)),Ee.needsAnimating[Jr]=!0;const Pi=r.getValue(Jr);Pi&&(Pi.liveStyle=!1)};for(const Jr in bn){const Pi=xn[Jr],Cn=rs[Jr];if(xe.hasOwnProperty(Jr))continue;let Gt=!1;RS(Pi)&&RS(Cn)?Gt=!_D(Pi,Cn):Gt=Pi!==Cn,Gt?Pi!=null?xo(Jr):ae.add(Jr):Pi!==void 0&&ae.has(Jr)?xo(Jr):Ee.protectedKeys[Jr]=!0}Ee.prevProp=Me,Ee.prevResolvedValues=xn,Ee.isActive&&(xe={...xe,...xn}),m&&r.blockInitialAnimation&&(zt=!1),zt&&(!Ct||Zn)&&Q.push(...wn.map(Jr=>({animation:Jr,options:{type:Te}})))}if(ae.size){const Tt={};ae.forEach(Te=>{const Ee=r.getBaseTarget(Te),Me=r.getValue(Te);Me&&(Me.liveStyle=!0),Tt[Te]=Ee??null}),Q.push({animation:Tt})}let Ue=!!Q.length;return m&&(q.initial===!1||q.initial===q.animate)&&!r.manuallyAnimateOnMount&&(Ue=!1),m=!1,Ue?a(Q):Promise.resolve()}function V(o,q){var J;if(h[o].isActive===q)return Promise.resolve();(J=r.variantChildren)===null||J===void 0||J.forEach(ae=>{var xe;return(xe=ae.animationState)===null||xe===void 0?void 0:xe.setActive(o,q)}),h[o].isActive=q;const Q=P(o);for(const ae in h)h[ae].protectedKeys={};return Q}return{animateChanges:P,setActive:V,setAnimateFunction:M,getState:()=>h,reset:()=>{h=fP(),m=!0}}}function rU(r,a){return typeof a=="string"?a!==r:Array.isArray(a)?!_D(a,r):!1}function pm(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function fP(){return{animate:pm(!0),whileInView:pm(),whileHover:pm(),whileTap:pm(),whileDrag:pm(),whileFocus:pm(),exit:pm()}}class iU extends ep{constructor(a){super(a),a.animationState||(a.animationState=nU(a))}updateAnimationControlsSubscription(){const{animate:a}=this.node.getProps();H0(a)&&(this.unmountControls=a.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:a}=this.node.getProps(),{animate:h}=this.node.prevProps||{};a!==h&&this.updateAnimationControlsSubscription()}unmount(){var a;this.node.animationState.reset(),(a=this.unmountControls)===null||a===void 0||a.call(this)}}let sU=0;class oU extends ep{constructor(){super(...arguments),this.id=sU++}update(){if(!this.node.presenceContext)return;const{isPresent:a,onExitComplete:h}=this.node.presenceContext,{isPresent:m}=this.node.prevPresenceContext||{};if(!this.node.animationState||a===m)return;const b=this.node.animationState.setActive("exit",!a);h&&!a&&b.then(()=>h(this.id))}mount(){const{register:a}=this.node.presenceContext||{};a&&(this.unmount=a(this.id))}unmount(){}}const aU={animation:{Feature:iU},exit:{Feature:oU}},pP=(r,a)=>Math.abs(r-a);function lU(r,a){const h=pP(r.x,a.x),m=pP(r.y,a.y);return Math.sqrt(h**2+m**2)}class YD{constructor(a,h,{transformPagePoint:m,contextWindow:b,dragSnapToOrigin:M=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Q=E3(this.lastMoveEventInfo,this.history),ae=this.startEvent!==null,xe=lU(Q.offset,{x:0,y:0})>=3;if(!ae&&!xe)return;const{point:Re}=Q,{timestamp:Ue}=Zs;this.history.push({...Re,timestamp:Ue});const{onStart:Tt,onMove:Te}=this.handlers;ae||(Tt&&Tt(this.lastMoveEvent,Q),this.startEvent=this.lastMoveEvent),Te&&Te(this.lastMoveEvent,Q)},this.handlePointerMove=(Q,ae)=>{this.lastMoveEvent=Q,this.lastMoveEventInfo=S3(ae,this.transformPagePoint),qr.update(this.updatePoint,!0)},this.handlePointerUp=(Q,ae)=>{this.end();const{onEnd:xe,onSessionEnd:Re,resumeAnimation:Ue}=this.handlers;if(this.dragSnapToOrigin&&Ue&&Ue(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Tt=E3(Q.type==="pointercancel"?this.lastMoveEventInfo:S3(ae,this.transformPagePoint),this.history);this.startEvent&&xe&&xe(Q,Tt),Re&&Re(Q,Tt)},!hD(a))return;this.dragSnapToOrigin=M,this.handlers=h,this.transformPagePoint=m,this.contextWindow=b||window;const P=jw(a),V=S3(P,this.transformPagePoint),{point:o}=V,{timestamp:q}=Zs;this.history=[{...o,timestamp:q}];const{onSessionStart:J}=h;J&&J(a,E3(V,this.history)),this.removeListeners=id(rd(this.contextWindow,"pointermove",this.handlePointerMove),rd(this.contextWindow,"pointerup",this.handlePointerUp),rd(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(a){this.handlers=a}end(){this.removeListeners&&this.removeListeners(),hd(this.updatePoint)}}function S3(r,a){return a?{point:a(r.point)}:r}function mP(r,a){return{x:r.x-a.x,y:r.y-a.y}}function E3({point:r},a){return{point:r,delta:mP(r,KD(a)),offset:mP(r,uU(a)),velocity:cU(a,.1)}}function uU(r){return r[0]}function KD(r){return r[r.length-1]}function cU(r,a){if(r.length<2)return{x:0,y:0};let h=r.length-1,m=null;const b=KD(r);for(;h>=0&&(m=r[h],!(b.timestamp-m.timestamp>Wf(a)));)h--;if(!m)return{x:0,y:0};const M=sd(b.timestamp-m.timestamp);if(M===0)return{x:0,y:0};const P={x:(b.x-m.x)/M,y:(b.y-m.y)/M};return P.x===1/0&&(P.x=0),P.y===1/0&&(P.y=0),P}function Va(r){return r.max-r.min}function US(r,a=0,h=.01){return Math.abs(r-a)<=h}function _P(r,a,h,m=.5){r.origin=m,r.originPoint=Ai(a.min,a.max,r.origin),r.scale=Va(h)/Va(a),(US(r.scale,1,1e-4)||isNaN(r.scale))&&(r.scale=1),r.translate=Ai(h.min,h.max,r.origin)-r.originPoint,(US(r.translate)||isNaN(r.translate))&&(r.translate=0)}function C0(r,a,h,m){_P(r.x,a.x,h.x,m?m.originX:void 0),_P(r.y,a.y,h.y,m?m.originY:void 0)}function gP(r,a,h){r.min=h.min+a.min,r.max=r.min+Va(a)}function hU(r,a,h){gP(r.x,a.x,h.x),gP(r.y,a.y,h.y)}function yP(r,a,h){r.min=a.min-h.min,r.max=r.min+Va(a)}function A0(r,a,h){yP(r.x,a.x,h.x),yP(r.y,a.y,h.y)}function dU(r,{min:a,max:h},m){return a!==void 0&&r<a?r=m?Ai(a,r,m.min):Math.max(r,a):h!==void 0&&r>h&&(r=m?Ai(h,r,m.max):Math.min(r,h)),r}function xP(r,a,h){return{min:a!==void 0?r.min+a:void 0,max:h!==void 0?r.max+h-(r.max-r.min):void 0}}function fU(r,{top:a,left:h,bottom:m,right:b}){return{x:xP(r.x,h,b),y:xP(r.y,a,m)}}function vP(r,a){let h=a.min-r.min,m=a.max-r.max;return a.max-a.min<r.max-r.min&&([h,m]=[m,h]),{min:h,max:m}}function pU(r,a){return{x:vP(r.x,a.x),y:vP(r.y,a.y)}}function mU(r,a){let h=.5;const m=Va(r),b=Va(a);return b>m?h=X0(a.min,a.max-m,r.min):m>b&&(h=X0(r.min,r.max-b,a.min)),Zf(0,1,h)}function _U(r,a){const h={};return a.min!==void 0&&(h.min=a.min-r.min),a.max!==void 0&&(h.max=a.max-r.min),h}const jS=.35;function gU(r=jS){return r===!1?r=0:r===!0&&(r=jS),{x:wP(r,"left","right"),y:wP(r,"top","bottom")}}function wP(r,a,h){return{min:bP(r,a),max:bP(r,h)}}function bP(r,a){return typeof r=="number"?r:r[a]||0}const TP=()=>({translate:0,scale:1,origin:0,originPoint:0}),tg=()=>({x:TP(),y:TP()}),SP=()=>({min:0,max:0}),Zi=()=>({x:SP(),y:SP()});function Tl(r){return[r("x"),r("y")]}function JD({top:r,left:a,right:h,bottom:m}){return{x:{min:a,max:h},y:{min:r,max:m}}}function yU({x:r,y:a}){return{top:a.min,right:r.max,bottom:a.max,left:r.min}}function xU(r,a){if(!a)return r;const h=a({x:r.left,y:r.top}),m=a({x:r.right,y:r.bottom});return{top:h.y,left:h.x,bottom:m.y,right:m.x}}function C3(r){return r===void 0||r===1}function GS({scale:r,scaleX:a,scaleY:h}){return!C3(r)||!C3(a)||!C3(h)}function gm(r){return GS(r)||QD(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function QD(r){return EP(r.x)||EP(r.y)}function EP(r){return r&&r!=="0%"}function fw(r,a,h){const m=r-h,b=a*m;return h+b}function CP(r,a,h,m,b){return b!==void 0&&(r=fw(r,b,m)),fw(r,h,m)+a}function WS(r,a=0,h=1,m,b){r.min=CP(r.min,a,h,m,b),r.max=CP(r.max,a,h,m,b)}function e5(r,{x:a,y:h}){WS(r.x,a.translate,a.scale,a.originPoint),WS(r.y,h.translate,h.scale,h.originPoint)}function vU(r,a,h,m=!1){const b=h.length;if(!b)return;a.x=a.y=1;let M,P;for(let V=0;V<b;V++){M=h[V],P=M.projectionDelta;const o=M.instance;o&&o.style&&o.style.display==="contents"||(m&&M.options.layoutScroll&&M.scroll&&M!==M.root&&ng(r,{x:-M.scroll.offset.x,y:-M.scroll.offset.y}),P&&(a.x*=P.x.scale,a.y*=P.y.scale,e5(r,P)),m&&gm(M.latestValues)&&ng(r,M.latestValues))}a.x=AP(a.x),a.y=AP(a.y)}function AP(r){return Number.isInteger(r)||r>1.0000000000001||r<.999999999999?r:1}function Rf(r,a){r.min=r.min+a,r.max=r.max+a}function MP(r,a,[h,m,b]){const M=a[b]!==void 0?a[b]:.5,P=Ai(r.min,r.max,M);WS(r,a[h],a[m],P,a.scale)}const wU=["x","scaleX","originX"],bU=["y","scaleY","originY"];function ng(r,a){MP(r.x,a,wU),MP(r.y,a,bU)}function t5(r,a){return JD(xU(r.getBoundingClientRect(),a))}function TU(r,a,h){const m=t5(r,h),{scroll:b}=a;return b&&(Rf(m.x,b.offset.x),Rf(m.y,b.offset.y)),m}const n5=({current:r})=>r?r.ownerDocument.defaultView:null,SU=new WeakMap;class EU{constructor(a){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Zi(),this.visualElement=a}start(a,{snapToCursor:h=!1}={}){const{presenceContext:m}=this.visualElement;if(m&&m.isPresent===!1)return;const b=J=>{const{dragSnapToOrigin:Q}=this.getProps();Q?this.pauseAnimation():this.stopAnimation(),h&&this.snapToCursor(jw(J,"page").point)},M=(J,Q)=>{var ae;const{drag:xe,dragPropagation:Re,onDragStart:Ue}=this.getProps();if(xe&&!Re&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=fD(xe),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Tl(Te=>{let Ee=this.getAxisMotionValue(Te).get()||0;if(Zc.test(Ee)){const{projection:Me}=this.visualElement;if(Me&&Me.layout){const et=Me.layout.layoutBox[Te];et&&(Ee=Va(et)*(parseFloat(Ee)/100))}}this.originPoint[Te]=Ee}),Ue&&qr.postRender(()=>Ue(J,Q)),(ae=this.removeWillChange)===null||ae===void 0||ae.call(this),this.removeWillChange=NS(this.visualElement,"transform");const{animationState:Tt}=this.visualElement;Tt&&Tt.setActive("whileDrag",!0)},P=(J,Q)=>{const{dragPropagation:ae,dragDirectionLock:xe,onDirectionLock:Re,onDrag:Ue}=this.getProps();if(!ae&&!this.openGlobalLock)return;const{offset:Tt}=Q;if(xe&&this.currentDirection===null){this.currentDirection=CU(Tt),this.currentDirection!==null&&Re&&Re(this.currentDirection);return}this.updateAxis("x",Q.point,Tt),this.updateAxis("y",Q.point,Tt),this.visualElement.render(),Ue&&Ue(J,Q)},V=(J,Q)=>this.stop(J,Q),o=()=>Tl(J=>{var Q;return this.getAnimationState(J)==="paused"&&((Q=this.getAxisMotionValue(J).animation)===null||Q===void 0?void 0:Q.play())}),{dragSnapToOrigin:q}=this.getProps();this.panSession=new YD(a,{onSessionStart:b,onStart:M,onMove:P,onSessionEnd:V,resumeAnimation:o},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:q,contextWindow:n5(this.visualElement)})}stop(a,h){var m;(m=this.removeWillChange)===null||m===void 0||m.call(this);const b=this.isDragging;if(this.cancel(),!b)return;const{velocity:M}=h;this.startAnimation(M);const{onDragEnd:P}=this.getProps();P&&qr.postRender(()=>P(a,h))}cancel(){this.isDragging=!1;const{projection:a,animationState:h}=this.visualElement;a&&(a.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:m}=this.getProps();!m&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),h&&h.setActive("whileDrag",!1)}updateAxis(a,h,m){const{drag:b}=this.getProps();if(!m||!mv(a,b,this.currentDirection))return;const M=this.getAxisMotionValue(a);let P=this.originPoint[a]+m[a];this.constraints&&this.constraints[a]&&(P=dU(P,this.constraints[a],this.elastic[a])),M.set(P)}resolveConstraints(){var a;const{dragConstraints:h,dragElastic:m}=this.getProps(),b=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(a=this.visualElement.projection)===null||a===void 0?void 0:a.layout,M=this.constraints;h&&Q_(h)?this.constraints||(this.constraints=this.resolveRefConstraints()):h&&b?this.constraints=fU(b.layoutBox,h):this.constraints=!1,this.elastic=gU(m),M!==this.constraints&&b&&this.constraints&&!this.hasMutatedConstraints&&Tl(P=>{this.constraints!==!1&&this.getAxisMotionValue(P)&&(this.constraints[P]=_U(b.layoutBox[P],this.constraints[P]))})}resolveRefConstraints(){const{dragConstraints:a,onMeasureDragConstraints:h}=this.getProps();if(!a||!Q_(a))return!1;const m=a.current,{projection:b}=this.visualElement;if(!b||!b.layout)return!1;const M=TU(m,b.root,this.visualElement.getTransformPagePoint());let P=pU(b.layout.layoutBox,M);if(h){const V=h(yU(P));this.hasMutatedConstraints=!!V,V&&(P=JD(V))}return P}startAnimation(a){const{drag:h,dragMomentum:m,dragElastic:b,dragTransition:M,dragSnapToOrigin:P,onDragTransitionEnd:V}=this.getProps(),o=this.constraints||{},q=Tl(J=>{if(!mv(J,h,this.currentDirection))return;let Q=o&&o[J]||{};P&&(Q={min:0,max:0});const ae=b?200:1e6,xe=b?40:1e7,Re={type:"inertia",velocity:m?a[J]:0,bounceStiffness:ae,bounceDamping:xe,timeConstant:750,restDelta:1,restSpeed:10,...M,...Q};return this.startAxisValueAnimation(J,Re)});return Promise.all(q).then(V)}startAxisValueAnimation(a,h){const m=this.getAxisMotionValue(a);return m.start(mC(a,m,0,h,this.visualElement,!1,NS(this.visualElement,a)))}stopAnimation(){Tl(a=>this.getAxisMotionValue(a).stop())}pauseAnimation(){Tl(a=>{var h;return(h=this.getAxisMotionValue(a).animation)===null||h===void 0?void 0:h.pause()})}getAnimationState(a){var h;return(h=this.getAxisMotionValue(a).animation)===null||h===void 0?void 0:h.state}getAxisMotionValue(a){const h=`_drag${a.toUpperCase()}`,m=this.visualElement.getProps(),b=m[h];return b||this.visualElement.getValue(a,(m.initial?m.initial[a]:void 0)||0)}snapToCursor(a){Tl(h=>{const{drag:m}=this.getProps();if(!mv(h,m,this.currentDirection))return;const{projection:b}=this.visualElement,M=this.getAxisMotionValue(h);if(b&&b.layout){const{min:P,max:V}=b.layout.layoutBox[h];M.set(a[h]-Ai(P,V,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:a,dragConstraints:h}=this.getProps(),{projection:m}=this.visualElement;if(!Q_(h)||!m||!this.constraints)return;this.stopAnimation();const b={x:0,y:0};Tl(P=>{const V=this.getAxisMotionValue(P);if(V&&this.constraints!==!1){const o=V.get();b[P]=mU({min:o,max:o},this.constraints[P])}});const{transformTemplate:M}=this.visualElement.getProps();this.visualElement.current.style.transform=M?M({},""):"none",m.root&&m.root.updateScroll(),m.updateLayout(),this.resolveConstraints(),Tl(P=>{if(!mv(P,a,null))return;const V=this.getAxisMotionValue(P),{min:o,max:q}=this.constraints[P];V.set(Ai(o,q,b[P]))})}addListeners(){if(!this.visualElement.current)return;SU.set(this.visualElement,this);const a=this.visualElement.current,h=rd(a,"pointerdown",o=>{const{drag:q,dragListener:J=!0}=this.getProps();q&&J&&this.start(o)}),m=()=>{const{dragConstraints:o}=this.getProps();Q_(o)&&o.current&&(this.constraints=this.resolveRefConstraints())},{projection:b}=this.visualElement,M=b.addEventListener("measure",m);b&&!b.layout&&(b.root&&b.root.updateScroll(),b.updateLayout()),qr.read(m);const P=td(window,"resize",()=>this.scalePositionWithinConstraints()),V=b.addEventListener("didUpdate",({delta:o,hasLayoutChanged:q})=>{this.isDragging&&q&&(Tl(J=>{const Q=this.getAxisMotionValue(J);Q&&(this.originPoint[J]+=o[J].translate,Q.set(Q.get()+o[J].translate))}),this.visualElement.render())});return()=>{P(),h(),M(),V&&V()}}getProps(){const a=this.visualElement.getProps(),{drag:h=!1,dragDirectionLock:m=!1,dragPropagation:b=!1,dragConstraints:M=!1,dragElastic:P=jS,dragMomentum:V=!0}=a;return{...a,drag:h,dragDirectionLock:m,dragPropagation:b,dragConstraints:M,dragElastic:P,dragMomentum:V}}}function mv(r,a,h){return(a===!0||a===r)&&(h===null||h===r)}function CU(r,a=10){let h=null;return Math.abs(r.y)>a?h="y":Math.abs(r.x)>a&&(h="x"),h}class AU extends ep{constructor(a){super(a),this.removeGroupControls=go,this.removeListeners=go,this.controls=new EU(a)}mount(){const{dragControls:a}=this.node.getProps();a&&(this.removeGroupControls=a.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||go}unmount(){this.removeGroupControls(),this.removeListeners()}}const IP=r=>(a,h)=>{r&&qr.postRender(()=>r(a,h))};class MU extends ep{constructor(){super(...arguments),this.removePointerDownListener=go}onPointerDown(a){this.session=new YD(a,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:n5(this.node)})}createPanHandlers(){const{onPanSessionStart:a,onPanStart:h,onPan:m,onPanEnd:b}=this.node.getProps();return{onSessionStart:IP(a),onStart:IP(h),onMove:m,onEnd:(M,P)=>{delete this.session,b&&qr.postRender(()=>b(M,P))}}}mount(){this.removePointerDownListener=rd(this.node.current,"pointerdown",a=>this.onPointerDown(a))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function IU(){const r=on.useContext(qE);if(r===null)return[!0,null];const{isPresent:a,onExitComplete:h,register:m}=r,b=on.useId();return on.useEffect(()=>m(b),[]),!a&&h?[!1,()=>h&&h(b)]:[!0]}const zv={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function PP(r,a){return a.max===a.min?0:r/(a.max-a.min)*100}const u0={correct:(r,a)=>{if(!a.target)return r;if(typeof r=="string")if(Bn.test(r))r=parseFloat(r);else return r;const h=PP(r,a.target.x),m=PP(r,a.target.y);return`${h}% ${m}%`}},PU={correct:(r,{treeScale:a,projectionDelta:h})=>{const m=r,b=Xf.parse(r);if(b.length>5)return m;const M=Xf.createTransformer(r),P=typeof b[0]!="number"?1:0,V=h.x.scale*a.x,o=h.y.scale*a.y;b[0+P]/=V,b[1+P]/=o;const q=Ai(V,o,.5);return typeof b[2+P]=="number"&&(b[2+P]/=q),typeof b[3+P]=="number"&&(b[3+P]/=q),M(b)}};class RU extends on.Component{componentDidMount(){const{visualElement:a,layoutGroup:h,switchLayoutGroup:m,layoutId:b}=this.props,{projection:M}=a;CN(LU),M&&(h.group&&h.group.add(M),m&&m.register&&b&&m.register(M),M.root.didUpdate(),M.addEventListener("animationComplete",()=>{this.safeToRemove()}),M.setOptions({...M.options,onExitComplete:()=>this.safeToRemove()})),zv.hasEverUpdated=!0}getSnapshotBeforeUpdate(a){const{layoutDependency:h,visualElement:m,drag:b,isPresent:M}=this.props,P=m.projection;return P&&(P.isPresent=M,b||a.layoutDependency!==h||h===void 0?P.willUpdate():this.safeToRemove(),a.isPresent!==M&&(M?P.promote():P.relegate()||qr.postRender(()=>{const V=P.getStack();(!V||!V.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:a}=this.props.visualElement;a&&(a.root.didUpdate(),ZE.postRender(()=>{!a.currentAnimation&&a.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:a,layoutGroup:h,switchLayoutGroup:m}=this.props,{projection:b}=a;b&&(b.scheduleCheckAfterUnmount(),h&&h.group&&h.group.remove(b),m&&m.deregister&&m.deregister(b))}safeToRemove(){const{safeToRemove:a}=this.props;a&&a()}render(){return null}}function r5(r){const[a,h]=IU(),m=on.useContext(Y4);return at.jsx(RU,{...r,layoutGroup:m,switchLayoutGroup:on.useContext(H4),isPresent:a,safeToRemove:h})}const LU={borderRadius:{...u0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:u0,borderTopRightRadius:u0,borderBottomLeftRadius:u0,borderBottomRightRadius:u0,boxShadow:PU},i5=["TopLeft","TopRight","BottomLeft","BottomRight"],DU=i5.length,RP=r=>typeof r=="string"?parseFloat(r):r,LP=r=>typeof r=="number"||Bn.test(r);function zU(r,a,h,m,b,M){b?(r.opacity=Ai(0,h.opacity!==void 0?h.opacity:1,kU(m)),r.opacityExit=Ai(a.opacity!==void 0?a.opacity:1,0,OU(m))):M&&(r.opacity=Ai(a.opacity!==void 0?a.opacity:1,h.opacity!==void 0?h.opacity:1,m));for(let P=0;P<DU;P++){const V=`border${i5[P]}Radius`;let o=DP(a,V),q=DP(h,V);if(o===void 0&&q===void 0)continue;o||(o=0),q||(q=0),o===0||q===0||LP(o)===LP(q)?(r[V]=Math.max(Ai(RP(o),RP(q),m),0),(Zc.test(q)||Zc.test(o))&&(r[V]+="%")):r[V]=q}(a.rotate||h.rotate)&&(r.rotate=Ai(a.rotate||0,h.rotate||0,m))}function DP(r,a){return r[a]!==void 0?r[a]:r.borderRadius}const kU=s5(0,.5,VD),OU=s5(.5,.95,go);function s5(r,a,h){return m=>m<r?0:m>a?1:h(X0(r,a,m))}function zP(r,a){r.min=a.min,r.max=a.max}function bl(r,a){zP(r.x,a.x),zP(r.y,a.y)}function kP(r,a,h,m,b){return r-=a,r=fw(r,1/h,m),b!==void 0&&(r=fw(r,1/b,m)),r}function BU(r,a=0,h=1,m=.5,b,M=r,P=r){if(Zc.test(a)&&(a=parseFloat(a),a=Ai(P.min,P.max,a/100)-P.min),typeof a!="number")return;let V=Ai(M.min,M.max,m);r===M&&(V-=a),r.min=kP(r.min,a,h,V,b),r.max=kP(r.max,a,h,V,b)}function OP(r,a,[h,m,b],M,P){BU(r,a[h],a[m],a[b],a.scale,M,P)}const FU=["x","scaleX","originX"],NU=["y","scaleY","originY"];function BP(r,a,h,m){OP(r.x,a,FU,h?h.x:void 0,m?m.x:void 0),OP(r.y,a,NU,h?h.y:void 0,m?m.y:void 0)}function FP(r){return r.translate===0&&r.scale===1}function o5(r){return FP(r.x)&&FP(r.y)}function VU(r,a){return r.x.min===a.x.min&&r.x.max===a.x.max&&r.y.min===a.y.min&&r.y.max===a.y.max}function a5(r,a){return Math.round(r.x.min)===Math.round(a.x.min)&&Math.round(r.x.max)===Math.round(a.x.max)&&Math.round(r.y.min)===Math.round(a.y.min)&&Math.round(r.y.max)===Math.round(a.y.max)}function NP(r){return Va(r.x)/Va(r.y)}class UU{constructor(){this.members=[]}add(a){Vw(this.members,a),a.scheduleRender()}remove(a){if(Uw(this.members,a),a===this.prevLead&&(this.prevLead=void 0),a===this.lead){const h=this.members[this.members.length-1];h&&this.promote(h)}}relegate(a){const h=this.members.findIndex(b=>a===b);if(h===0)return!1;let m;for(let b=h;b>=0;b--){const M=this.members[b];if(M.isPresent!==!1){m=M;break}}return m?(this.promote(m),!0):!1}promote(a,h){const m=this.lead;if(a!==m&&(this.prevLead=m,this.lead=a,a.show(),m)){m.instance&&m.scheduleRender(),a.scheduleRender(),a.resumeFrom=m,h&&(a.resumeFrom.preserveOpacity=!0),m.snapshot&&(a.snapshot=m.snapshot,a.snapshot.latestValues=m.animationValues||m.latestValues),a.root&&a.root.isUpdating&&(a.isLayoutDirty=!0);const{crossfade:b}=a.options;b===!1&&m.hide()}}exitAnimationComplete(){this.members.forEach(a=>{const{options:h,resumingFrom:m}=a;h.onExitComplete&&h.onExitComplete(),m&&m.options.onExitComplete&&m.options.onExitComplete()})}scheduleRender(){this.members.forEach(a=>{a.instance&&a.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function VP(r,a,h){let m="";const b=r.x.translate/a.x,M=r.y.translate/a.y,P=(h==null?void 0:h.z)||0;if((b||M||P)&&(m=`translate3d(${b}px, ${M}px, ${P}px) `),(a.x!==1||a.y!==1)&&(m+=`scale(${1/a.x}, ${1/a.y}) `),h){const{transformPerspective:q,rotate:J,rotateX:Q,rotateY:ae,skewX:xe,skewY:Re}=h;q&&(m=`perspective(${q}px) ${m}`),J&&(m+=`rotate(${J}deg) `),Q&&(m+=`rotateX(${Q}deg) `),ae&&(m+=`rotateY(${ae}deg) `),xe&&(m+=`skewX(${xe}deg) `),Re&&(m+=`skewY(${Re}deg) `)}const V=r.x.scale*a.x,o=r.y.scale*a.y;return(V!==1||o!==1)&&(m+=`scale(${V}, ${o})`),m||"none"}const jU=(r,a)=>r.depth-a.depth;class GU{constructor(){this.children=[],this.isDirty=!1}add(a){Vw(this.children,a),this.isDirty=!0}remove(a){Uw(this.children,a),this.isDirty=!0}forEach(a){this.isDirty&&this.children.sort(jU),this.isDirty=!1,this.children.forEach(a)}}function WU(r,a){const h=$f.now(),m=({timestamp:b})=>{const M=b-h;M>=a&&(hd(m),r(M-a))};return qr.read(m,!0),()=>hd(m)}function $U(r){window.MotionDebug&&window.MotionDebug.record(r)}function qU(r){return r instanceof SVGElement&&r.tagName!=="svg"}function HU(r,a,h){const m=_o(r)?r:Y0(r);return m.start(mC("",m,a,h)),m.animation}const A3=["","X","Y","Z"],ZU={visibility:"hidden"},UP=1e3;let XU=0;const ym={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function M3(r,a,h,m){const{latestValues:b}=a;b[r]&&(h[r]=b[r],a.setStaticValue(r,0),m&&(m[r]=0))}function l5(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return!1;const{visualElement:a}=r.options;return a?ZD(a)?!0:r.parent&&!r.parent.hasCheckedOptimisedAppear?l5(r.parent):!1:!1}function u5({attachResizeListener:r,defaultParent:a,measureScroll:h,checkIsScrollRoot:m,resetTransform:b}){return class{constructor(P={},V=a==null?void 0:a()){this.id=XU++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ym.totalNodes=ym.resolvedTargetDeltas=ym.recalculatedProjection=0,this.nodes.forEach(JU),this.nodes.forEach(r7),this.nodes.forEach(i7),this.nodes.forEach(QU),$U(ym)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=P,this.root=V?V.root||V:this,this.path=V?[...V.path,V]:[],this.parent=V,this.depth=V?V.depth+1:0;for(let o=0;o<this.path.length;o++)this.path[o].shouldResetTransform=!0;this.root===this&&(this.nodes=new GU)}addEventListener(P,V){return this.eventHandlers.has(P)||this.eventHandlers.set(P,new _C),this.eventHandlers.get(P).add(V)}notifyListeners(P,...V){const o=this.eventHandlers.get(P);o&&o.notify(...V)}hasListeners(P){return this.eventHandlers.has(P)}mount(P,V=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=qU(P),this.instance=P;const{layoutId:o,layout:q,visualElement:J}=this.options;if(J&&!J.current&&J.mount(P),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),V&&(q||o)&&(this.isLayoutDirty=!0),r){let Q;const ae=()=>this.root.updateBlockedByResize=!1;r(P,()=>{this.root.updateBlockedByResize=!0,Q&&Q(),Q=WU(ae,250),zv.hasAnimatedSinceResize&&(zv.hasAnimatedSinceResize=!1,this.nodes.forEach(GP))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&J&&(o||q)&&this.addEventListener("didUpdate",({delta:Q,hasLayoutChanged:ae,hasRelativeTargetChanged:xe,layout:Re})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Ue=this.options.transition||J.getDefaultTransition()||u7,{onLayoutAnimationStart:Tt,onLayoutAnimationComplete:Te}=J.getProps(),Ee=!this.targetLayout||!a5(this.targetLayout,Re)||xe,Me=!ae&&xe;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||Me||ae&&(Ee||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(Q,Me);const et={...oC(Ue,"layout"),onPlay:Tt,onComplete:Te};(J.shouldReduceMotion||this.options.layoutRoot)&&(et.delay=0,et.type=!1),this.startAnimation(et)}else ae||GP(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Re})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const P=this.getStack();P&&P.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,hd(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(s7),this.animationId++)}getTransformTemplate(){const{visualElement:P}=this.options;return P&&P.getProps().transformTemplate}willUpdate(P=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.HandoffCancelAllAnimations&&l5(this)&&window.HandoffCancelAllAnimations(),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let J=0;J<this.path.length;J++){const Q=this.path[J];Q.shouldResetTransform=!0,Q.updateScroll("snapshot"),Q.options.layoutRoot&&Q.willUpdate(!1)}const{layoutId:V,layout:o}=this.options;if(V===void 0&&!o)return;const q=this.getTransformTemplate();this.prevTransformTemplateValue=q?q(this.latestValues,""):void 0,this.updateSnapshot(),P&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(jP);return}this.isUpdating||this.nodes.forEach(t7),this.isUpdating=!1,this.nodes.forEach(n7),this.nodes.forEach(YU),this.nodes.forEach(KU),this.clearAllSnapshots();const V=$f.now();Zs.delta=Zf(0,1e3/60,V-Zs.timestamp),Zs.timestamp=V,Zs.isProcessing=!0,g3.update.process(Zs),g3.preRender.process(Zs),g3.render.process(Zs),Zs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,ZE.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(e7),this.sharedNodes.forEach(o7)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,qr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){qr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let o=0;o<this.path.length;o++)this.path[o].updateScroll();const P=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Zi(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:V}=this.options;V&&V.notify("LayoutMeasure",this.layout.layoutBox,P?P.layoutBox:void 0)}updateScroll(P="measure"){let V=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===P&&(V=!1),V&&(this.scroll={animationId:this.root.animationId,phase:P,isRoot:m(this.instance),offset:h(this.instance)})}resetTransform(){if(!b)return;const P=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,V=this.projectionDelta&&!o5(this.projectionDelta),o=this.getTransformTemplate(),q=o?o(this.latestValues,""):void 0,J=q!==this.prevTransformTemplateValue;P&&(V||gm(this.latestValues)||J)&&(b(this.instance,q),this.shouldResetTransform=!1,this.scheduleRender())}measure(P=!0){const V=this.measurePageBox();let o=this.removeElementScroll(V);return P&&(o=this.removeTransform(o)),c7(o),{animationId:this.root.animationId,measuredBox:V,layoutBox:o,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:P}=this.options;if(!P)return Zi();const V=P.measureViewportBox(),{scroll:o}=this.root;return o&&(Rf(V.x,o.offset.x),Rf(V.y,o.offset.y)),V}removeElementScroll(P){const V=Zi();bl(V,P);for(let o=0;o<this.path.length;o++){const q=this.path[o],{scroll:J,options:Q}=q;if(q!==this.root&&J&&Q.layoutScroll){if(J.isRoot){bl(V,P);const{scroll:ae}=this.root;ae&&(Rf(V.x,-ae.offset.x),Rf(V.y,-ae.offset.y))}Rf(V.x,J.offset.x),Rf(V.y,J.offset.y)}}return V}applyTransform(P,V=!1){const o=Zi();bl(o,P);for(let q=0;q<this.path.length;q++){const J=this.path[q];!V&&J.options.layoutScroll&&J.scroll&&J!==J.root&&ng(o,{x:-J.scroll.offset.x,y:-J.scroll.offset.y}),gm(J.latestValues)&&ng(o,J.latestValues)}return gm(this.latestValues)&&ng(o,this.latestValues),o}removeTransform(P){const V=Zi();bl(V,P);for(let o=0;o<this.path.length;o++){const q=this.path[o];if(!q.instance||!gm(q.latestValues))continue;GS(q.latestValues)&&q.updateSnapshot();const J=Zi(),Q=q.measurePageBox();bl(J,Q),BP(V,q.latestValues,q.snapshot?q.snapshot.layoutBox:void 0,J)}return gm(this.latestValues)&&BP(V,this.latestValues),V}setTargetDelta(P){this.targetDelta=P,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(P){this.options={...this.options,...P,crossfade:P.crossfade!==void 0?P.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Zs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(P=!1){var V;const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const q=!!this.resumingFrom||this!==o;if(!(P||q&&this.isSharedProjectionDirty||this.isProjectionDirty||!((V=this.parent)===null||V===void 0)&&V.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:Q,layoutId:ae}=this.options;if(!(!this.layout||!(Q||ae))){if(this.resolvedRelativeTargetAt=Zs.timestamp,!this.targetDelta&&!this.relativeTarget){const xe=this.getClosestProjectingParent();xe&&xe.layout&&this.animationProgress!==1?(this.relativeParent=xe,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zi(),this.relativeTargetOrigin=Zi(),A0(this.relativeTargetOrigin,this.layout.layoutBox,xe.layout.layoutBox),bl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Zi(),this.targetWithTransforms=Zi()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),hU(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):bl(this.target,this.layout.layoutBox),e5(this.target,this.targetDelta)):bl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const xe=this.getClosestProjectingParent();xe&&!!xe.resumingFrom==!!this.resumingFrom&&!xe.options.layoutScroll&&xe.target&&this.animationProgress!==1?(this.relativeParent=xe,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zi(),this.relativeTargetOrigin=Zi(),A0(this.relativeTargetOrigin,this.target,xe.target),bl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ym.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||GS(this.parent.latestValues)||QD(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var P;const V=this.getLead(),o=!!this.resumingFrom||this!==V;let q=!0;if((this.isProjectionDirty||!((P=this.parent)===null||P===void 0)&&P.isProjectionDirty)&&(q=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(q=!1),this.resolvedRelativeTargetAt===Zs.timestamp&&(q=!1),q)return;const{layout:J,layoutId:Q}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(J||Q))return;bl(this.layoutCorrected,this.layout.layoutBox);const ae=this.treeScale.x,xe=this.treeScale.y;vU(this.layoutCorrected,this.treeScale,this.path,o),V.layout&&!V.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(V.target=V.layout.layoutBox,V.targetWithTransforms=Zi());const{target:Re}=V;if(!Re){this.projectionTransform&&(this.projectionDelta=tg(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=tg(),this.projectionDeltaWithTransform=tg());const Ue=this.projectionTransform;C0(this.projectionDelta,this.layoutCorrected,Re,this.latestValues),this.projectionTransform=VP(this.projectionDelta,this.treeScale),(this.projectionTransform!==Ue||this.treeScale.x!==ae||this.treeScale.y!==xe)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Re)),ym.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(P=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),P){const V=this.getStack();V&&V.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(P,V=!1){const o=this.snapshot,q=o?o.latestValues:{},J={...this.latestValues},Q=tg();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!V;const ae=Zi(),xe=o?o.source:void 0,Re=this.layout?this.layout.source:void 0,Ue=xe!==Re,Tt=this.getStack(),Te=!Tt||Tt.members.length<=1,Ee=!!(Ue&&!Te&&this.options.crossfade===!0&&!this.path.some(l7));this.animationProgress=0;let Me;this.mixTargetDelta=et=>{const pt=et/1e3;WP(Q.x,P.x,pt),WP(Q.y,P.y,pt),this.setTargetDelta(Q),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(A0(ae,this.layout.layoutBox,this.relativeParent.layout.layoutBox),a7(this.relativeTarget,this.relativeTargetOrigin,ae,pt),Me&&VU(this.relativeTarget,Me)&&(this.isProjectionDirty=!1),Me||(Me=Zi()),bl(Me,this.relativeTarget)),Ue&&(this.animationValues=J,zU(J,q,this.latestValues,pt,Ee,Te)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=pt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(P){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(hd(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=qr.update(()=>{zv.hasAnimatedSinceResize=!0,this.currentAnimation=HU(0,UP,{...P,onUpdate:V=>{this.mixTargetDelta(V),P.onUpdate&&P.onUpdate(V)},onComplete:()=>{P.onComplete&&P.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const P=this.getStack();P&&P.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(UP),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const P=this.getLead();let{targetWithTransforms:V,target:o,layout:q,latestValues:J}=P;if(!(!V||!o||!q)){if(this!==P&&this.layout&&q&&c5(this.options.animationType,this.layout.layoutBox,q.layoutBox)){o=this.target||Zi();const Q=Va(this.layout.layoutBox.x);o.x.min=P.target.x.min,o.x.max=o.x.min+Q;const ae=Va(this.layout.layoutBox.y);o.y.min=P.target.y.min,o.y.max=o.y.min+ae}bl(V,o),ng(V,J),C0(this.projectionDeltaWithTransform,this.layoutCorrected,V,J)}}registerSharedNode(P,V){this.sharedNodes.has(P)||this.sharedNodes.set(P,new UU),this.sharedNodes.get(P).add(V);const q=V.options.initialPromotionConfig;V.promote({transition:q?q.transition:void 0,preserveFollowOpacity:q&&q.shouldPreserveFollowOpacity?q.shouldPreserveFollowOpacity(V):void 0})}isLead(){const P=this.getStack();return P?P.lead===this:!0}getLead(){var P;const{layoutId:V}=this.options;return V?((P=this.getStack())===null||P===void 0?void 0:P.lead)||this:this}getPrevLead(){var P;const{layoutId:V}=this.options;return V?(P=this.getStack())===null||P===void 0?void 0:P.prevLead:void 0}getStack(){const{layoutId:P}=this.options;if(P)return this.root.sharedNodes.get(P)}promote({needsReset:P,transition:V,preserveFollowOpacity:o}={}){const q=this.getStack();q&&q.promote(this,o),P&&(this.projectionDelta=void 0,this.needsReset=!0),V&&this.setOptions({transition:V})}relegate(){const P=this.getStack();return P?P.relegate(this):!1}resetSkewAndRotation(){const{visualElement:P}=this.options;if(!P)return;let V=!1;const{latestValues:o}=P;if((o.z||o.rotate||o.rotateX||o.rotateY||o.rotateZ||o.skewX||o.skewY)&&(V=!0),!V)return;const q={};o.z&&M3("z",P,q,this.animationValues);for(let J=0;J<A3.length;J++)M3(`rotate${A3[J]}`,P,q,this.animationValues),M3(`skew${A3[J]}`,P,q,this.animationValues);P.render();for(const J in q)P.setStaticValue(J,q[J]),this.animationValues&&(this.animationValues[J]=q[J]);P.scheduleRender()}getProjectionStyles(P){var V,o;if(!this.instance||this.isSVG)return;if(!this.isVisible)return ZU;const q={visibility:""},J=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,q.opacity="",q.pointerEvents=Lv(P==null?void 0:P.pointerEvents)||"",q.transform=J?J(this.latestValues,""):"none",q;const Q=this.getLead();if(!this.projectionDelta||!this.layout||!Q.target){const Ue={};return this.options.layoutId&&(Ue.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,Ue.pointerEvents=Lv(P==null?void 0:P.pointerEvents)||""),this.hasProjected&&!gm(this.latestValues)&&(Ue.transform=J?J({},""):"none",this.hasProjected=!1),Ue}const ae=Q.animationValues||Q.latestValues;this.applyTransformsToTarget(),q.transform=VP(this.projectionDeltaWithTransform,this.treeScale,ae),J&&(q.transform=J(ae,q.transform));const{x:xe,y:Re}=this.projectionDelta;q.transformOrigin=`${xe.origin*100}% ${Re.origin*100}% 0`,Q.animationValues?q.opacity=Q===this?(o=(V=ae.opacity)!==null&&V!==void 0?V:this.latestValues.opacity)!==null&&o!==void 0?o:1:this.preserveOpacity?this.latestValues.opacity:ae.opacityExit:q.opacity=Q===this?ae.opacity!==void 0?ae.opacity:"":ae.opacityExit!==void 0?ae.opacityExit:0;for(const Ue in lw){if(ae[Ue]===void 0)continue;const{correct:Tt,applyTo:Te}=lw[Ue],Ee=q.transform==="none"?ae[Ue]:Tt(ae[Ue],Q);if(Te){const Me=Te.length;for(let et=0;et<Me;et++)q[Te[et]]=Ee}else q[Ue]=Ee}return this.options.layoutId&&(q.pointerEvents=Q===this?Lv(P==null?void 0:P.pointerEvents)||"":"none"),q}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(P=>{var V;return(V=P.currentAnimation)===null||V===void 0?void 0:V.stop()}),this.root.nodes.forEach(jP),this.root.sharedNodes.clear()}}}function YU(r){r.updateLayout()}function KU(r){var a;const h=((a=r.resumeFrom)===null||a===void 0?void 0:a.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&h&&r.hasListeners("didUpdate")){const{layoutBox:m,measuredBox:b}=r.layout,{animationType:M}=r.options,P=h.source!==r.layout.source;M==="size"?Tl(Q=>{const ae=P?h.measuredBox[Q]:h.layoutBox[Q],xe=Va(ae);ae.min=m[Q].min,ae.max=ae.min+xe}):c5(M,h.layoutBox,m)&&Tl(Q=>{const ae=P?h.measuredBox[Q]:h.layoutBox[Q],xe=Va(m[Q]);ae.max=ae.min+xe,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[Q].max=r.relativeTarget[Q].min+xe)});const V=tg();C0(V,m,h.layoutBox);const o=tg();P?C0(o,r.applyTransform(b,!0),h.measuredBox):C0(o,m,h.layoutBox);const q=!o5(V);let J=!1;if(!r.resumeFrom){const Q=r.getClosestProjectingParent();if(Q&&!Q.resumeFrom){const{snapshot:ae,layout:xe}=Q;if(ae&&xe){const Re=Zi();A0(Re,h.layoutBox,ae.layoutBox);const Ue=Zi();A0(Ue,m,xe.layoutBox),a5(Re,Ue)||(J=!0),Q.options.layoutRoot&&(r.relativeTarget=Ue,r.relativeTargetOrigin=Re,r.relativeParent=Q)}}}r.notifyListeners("didUpdate",{layout:m,snapshot:h,delta:o,layoutDelta:V,hasLayoutChanged:q,hasRelativeTargetChanged:J})}else if(r.isLead()){const{onExitComplete:m}=r.options;m&&m()}r.options.transition=void 0}function JU(r){ym.totalNodes++,r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function QU(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function e7(r){r.clearSnapshot()}function jP(r){r.clearMeasurements()}function t7(r){r.isLayoutDirty=!1}function n7(r){const{visualElement:a}=r.options;a&&a.getProps().onBeforeLayoutMeasure&&a.notify("BeforeLayoutMeasure"),r.resetTransform()}function GP(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function r7(r){r.resolveTargetDelta()}function i7(r){r.calcProjection()}function s7(r){r.resetSkewAndRotation()}function o7(r){r.removeLeadSnapshot()}function WP(r,a,h){r.translate=Ai(a.translate,0,h),r.scale=Ai(a.scale,1,h),r.origin=a.origin,r.originPoint=a.originPoint}function $P(r,a,h,m){r.min=Ai(a.min,h.min,m),r.max=Ai(a.max,h.max,m)}function a7(r,a,h,m){$P(r.x,a.x,h.x,m),$P(r.y,a.y,h.y,m)}function l7(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const u7={duration:.45,ease:[.4,0,.1,1]},qP=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),HP=qP("applewebkit/")&&!qP("chrome/")?Math.round:go;function ZP(r){r.min=HP(r.min),r.max=HP(r.max)}function c7(r){ZP(r.x),ZP(r.y)}function c5(r,a,h){return r==="position"||r==="preserve-aspect"&&!US(NP(a),NP(h),.2)}const h7=u5({attachResizeListener:(r,a)=>td(r,"resize",a),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),I3={current:void 0},h5=u5({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!I3.current){const r=new h7({});r.mount(window),r.setOptions({layoutScroll:!0}),I3.current=r}return I3.current},resetTransform:(r,a)=>{r.style.transform=a!==void 0?a:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),d7={pan:{Feature:MU},drag:{Feature:AU,ProjectionNode:h5,MeasureLayout:r5}},$S={current:null},d5={current:!1};function f7(){if(d5.current=!0,!!HE)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),a=()=>$S.current=r.matches;r.addListener(a),a()}else $S.current=!1}function p7(r,a,h){for(const m in a){const b=a[m],M=h[m];if(_o(b))r.addValue(m,b);else if(_o(M))r.addValue(m,Y0(b,{owner:r}));else if(M!==b)if(r.hasValue(m)){const P=r.getValue(m);P.liveStyle===!0?P.jump(b):P.hasAnimated||P.set(b)}else{const P=r.getStaticValue(m);r.addValue(m,Y0(P!==void 0?P:b,{owner:r}))}}for(const m in h)a[m]===void 0&&r.removeValue(m);return a}const XP=new WeakMap,m7=[...wD,fo,Xf],_7=r=>m7.find(vD(r)),YP=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],g7=YE.length;class y7{scrapeMotionValuesFromProps(a,h,m){return{}}constructor({parent:a,props:h,presenceContext:m,reducedMotionConfig:b,blockInitialAnimation:M,visualState:P},V={}){this.applyWillChange=!1,this.resolveKeyframes=(ae,xe,Re,Ue)=>new this.KeyframeResolver(ae,xe,Re,Ue,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=aC,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>qr.render(this.render,!1,!0);const{latestValues:o,renderState:q}=P;this.latestValues=o,this.baseTarget={...o},this.initialValues=h.initial?{...o}:{},this.renderState=q,this.parent=a,this.props=h,this.presenceContext=m,this.depth=a?a.depth+1:0,this.reducedMotionConfig=b,this.options=V,this.blockInitialAnimation=!!M,this.isControllingVariants=Nw(h),this.isVariantNode=X4(h),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(a&&a.current);const{willChange:J,...Q}=this.scrapeMotionValuesFromProps(h,{},this);for(const ae in Q){const xe=Q[ae];o[ae]!==void 0&&_o(xe)&&xe.set(o[ae],!1)}}mount(a){this.current=a,XP.set(a,this),this.projection&&!this.projection.instance&&this.projection.mount(a),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((h,m)=>this.bindToMotionValue(m,h)),d5.current||f7(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:$S.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){XP.delete(this.current),this.projection&&this.projection.unmount(),hd(this.notifyUpdate),hd(this.render),this.valueSubscriptions.forEach(a=>a()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const a in this.events)this.events[a].clear();for(const a in this.features){const h=this.features[a];h&&(h.unmount(),h.isMounted=!1)}this.current=null}bindToMotionValue(a,h){const m=Qf.has(a),b=h.on("change",P=>{this.latestValues[a]=P,this.props.onUpdate&&qr.preRender(this.notifyUpdate),m&&this.projection&&(this.projection.isTransformDirty=!0)}),M=h.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(a,()=>{b(),M(),h.owner&&h.stop()})}sortNodePosition(a){return!this.current||!this.sortInstanceNodePosition||this.type!==a.type?0:this.sortInstanceNodePosition(this.current,a.current)}updateFeatures(){let a="animation";for(a in gg){const h=gg[a];if(!h)continue;const{isEnabled:m,Feature:b}=h;if(!this.features[a]&&b&&m(this.props)&&(this.features[a]=new b(this)),this.features[a]){const M=this.features[a];M.isMounted?M.update():(M.mount(),M.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Zi()}getStaticValue(a){return this.latestValues[a]}setStaticValue(a,h){this.latestValues[a]=h}update(a,h){(a.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=a,this.prevPresenceContext=this.presenceContext,this.presenceContext=h;for(let m=0;m<YP.length;m++){const b=YP[m];this.propEventSubscriptions[b]&&(this.propEventSubscriptions[b](),delete this.propEventSubscriptions[b]);const M="on"+b,P=a[M];P&&(this.propEventSubscriptions[b]=this.on(b,P))}this.prevMotionValues=p7(this,this.scrapeMotionValuesFromProps(a,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(a){return this.props.variants?this.props.variants[a]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(a=!1){if(a)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const m=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(m.initial=this.props.initial),m}const h={};for(let m=0;m<g7;m++){const b=YE[m],M=this.props[b];(q0(M)||M===!1)&&(h[b]=M)}return h}addVariantChild(a){const h=this.getClosestVariantNode();if(h)return h.variantChildren&&h.variantChildren.add(a),()=>h.variantChildren.delete(a)}addValue(a,h){const m=this.values.get(a);h!==m&&(m&&this.removeValue(a),this.bindToMotionValue(a,h),this.values.set(a,h),this.latestValues[a]=h.get())}removeValue(a){this.values.delete(a);const h=this.valueSubscriptions.get(a);h&&(h(),this.valueSubscriptions.delete(a)),delete this.latestValues[a],this.removeValueFromRenderState(a,this.renderState)}hasValue(a){return this.values.has(a)}getValue(a,h){if(this.props.values&&this.props.values[a])return this.props.values[a];let m=this.values.get(a);return m===void 0&&h!==void 0&&(m=Y0(h===null?void 0:h,{owner:this}),this.addValue(a,m)),m}readValue(a,h){var m;let b=this.latestValues[a]!==void 0||!this.current?this.latestValues[a]:(m=this.getBaseTargetFromProps(this.props,a))!==null&&m!==void 0?m:this.readValueFromInstance(this.current,a,this.options);return b!=null&&(typeof b=="string"&&(yD(b)||gD(b))?b=parseFloat(b):!_7(b)&&Xf.test(h)&&(b=ID(a,h)),this.setBaseTarget(a,_o(b)?b.get():b)),_o(b)?b.get():b}setBaseTarget(a,h){this.baseTarget[a]=h}getBaseTarget(a){var h;const{initial:m}=this.props;let b;if(typeof m=="string"||typeof m=="object"){const P=sC(this.props,m,(h=this.presenceContext)===null||h===void 0?void 0:h.custom);P&&(b=P[a])}if(m&&b!==void 0)return b;const M=this.getBaseTargetFromProps(this.props,a);return M!==void 0&&!_o(M)?M:this.initialValues[a]!==void 0&&b===void 0?void 0:this.baseTarget[a]}on(a,h){return this.events[a]||(this.events[a]=new _C),this.events[a].add(h)}notify(a,...h){this.events[a]&&this.events[a].notify(...h)}}class f5 extends y7{constructor(){super(...arguments),this.KeyframeResolver=PD}sortInstanceNodePosition(a,h){return a.compareDocumentPosition(h)&2?1:-1}getBaseTargetFromProps(a,h){return a.style?a.style[h]:void 0}removeValueFromRenderState(a,{vars:h,style:m}){delete h[a],delete m[a]}}function x7(r){return window.getComputedStyle(r)}class v7 extends f5{constructor(){super(...arguments),this.type="html",this.applyWillChange=!0}readValueFromInstance(a,h){if(Qf.has(h)){const m=uC(h);return m&&m.default||0}else{const m=x7(a),b=(Q4(h)?m.getPropertyValue(h):m[h])||0;return typeof b=="string"?b.trim():b}}measureInstanceViewportBox(a,{transformPagePoint:h}){return t5(a,h)}build(a,h,m){eC(a,h,m.transformTemplate)}scrapeMotionValuesFromProps(a,h,m){return iC(a,h,m)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:a}=this.props;_o(a)&&(this.childSubscription=a.on("change",h=>{this.current&&(this.current.textContent=`${h}`)}))}renderInstance(a,h,m,b){iD(a,h,m,b)}}class w7 extends f5{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(a,h){return a[h]}readValueFromInstance(a,h){if(Qf.has(h)){const m=uC(h);return m&&m.default||0}return h=sD.has(h)?h:Fw(h),a.getAttribute(h)}measureInstanceViewportBox(){return Zi()}scrapeMotionValuesFromProps(a,h,m){return aD(a,h,m)}build(a,h,m){nC(a,h,this.isSVGTag,m.transformTemplate)}renderInstance(a,h,m,b){oD(a,h,m,b)}mount(a){this.isSVGTag=rC(a.tagName),super.mount(a)}}const b7=(r,a)=>KE(r)?new w7(a):new v7(a,{allowProjection:r!==on.Fragment}),T7={layout:{ProjectionNode:h5,MeasureLayout:r5}},S7={...aU,...g8,...d7,...T7},E7=SN((r,a)=>i8(r,a,S7,b7)),C7=E7(oN);function A7(){const r=po("SEARCH_BOX_TITLE"),a=po("SEARCH_BOX_INPUT_PLACEHOLDER"),h=po("SEARCH_BOX_BUTTON_LABEL"),m=ts(xe=>xe.query),b=ts(xe=>xe.setQuery),M=ts(xe=>xe.searchStatus),P=ts(xe=>xe.setSearchStatus),V=ts(xe=>xe.setSearchedClubs),o=Ui(xe=>xe.setLocation),q=$c(xe=>xe.setLoading),J=async xe=>{P("in-progress"),q(!0);const Re=await Rv({method:"GET",url:xe});V(Re.data),P("done"),q(!1)},Q=async xe=>{xe.preventDefault(),m.trim().length>0&&J(`/clubs?query=${m}`)},ae=xe=>{o({lat:xe.lat,lng:xe.lng}),J(`/clubs?coords=${xe.lat},${xe.lng}`)};return at.jsx("div",{className:"SearchBox",children:at.jsxs("div",{className:"cl-container narrow",children:[at.jsx("h2",{children:r}),at.jsxs("form",{className:"SearchBox__wrapper",onSubmit:Q,children:[at.jsx(iN,{onChange:xe=>b(xe),inputProps:{placeholder:a,autoFocus:!0,disabled:M==="in-progress"},showClearIcon:!0}),at.jsx(g4,{fullWidth:!0,buttonProps:{type:"submit",disabled:M==="in-progress"},children:h}),at.jsx(C7,{cb:ae,initial:{opacity:0},animate:{opacity:m.length===0?1:0,pointerEvents:m.length===0?"auto":"none"},transition:{duration:.3,ease:"easeInOut"},className:"SearchBox__helper"})]})]})})}function M7(){const r=$c(P=>P.setProvinces),a=$c(P=>P.addClubs),h=$c(P=>P.clubs),m=$c(P=>P.setLoading),b=ts(P=>P.selectedProvince),M=ts(P=>P.setSelectedProvince);on.useEffect(()=>{async function P(){const V=await Rv({method:"GET",url:"/provinces"});r(V.data),M(V.data[0]);const o=await Rv({method:"GET",url:`/clubs?province=${V.data[0].slug}`});a(V.data[0].slug,o.data)}P()},[]),on.useEffect(()=>{b&&!h[b.slug]&&(m(!0),Rv({method:"GET",url:`/clubs?province=${b.slug}`}).then(P=>{a(b.slug,P.data),m(!1)}).catch(P=>console.error(P)))},[b,h])}function I7(){return M7(),at.jsxs("div",{className:"App",children:[at.jsx(A7,{}),at.jsx(PF,{})]})}P3.createRoot(document.getElementById("find-your-club")).render(at.jsx(aR.StrictMode,{children:at.jsx(I7,{})}));
